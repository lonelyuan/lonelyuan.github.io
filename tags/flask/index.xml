<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>flask on lonelyuan's Blog</title><link>https://lonelyuan.github.io/HugoBlog/tags/flask/</link><description>Recent content in flask on lonelyuan's Blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Thu, 16 Sep 2021 12:43:23 +0000</lastBuildDate><atom:link href="https://lonelyuan.github.io/HugoBlog/tags/flask/index.xml" rel="self" type="application/rss+xml"/><item><title>å¹´è½»äººçš„ç¬¬äºŒä¸ªç½‘ç«™ï¼ˆäºŒï¼‰ - flask-supreme-tutorial</title><link>https://lonelyuan.github.io/HugoBlog/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99%E4%BA%8C-flask-supreme-tutorial/</link><pubDate>Thu, 16 Sep 2021 12:43:23 +0000</pubDate><guid>https://lonelyuan.github.io/HugoBlog/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99%E4%BA%8C-flask-supreme-tutorial/</guid><description>&lt;blockquote>
&lt;p>&lt;a class="link" href="https://lonelyuan.github.io/post/flask-mega-tutorial/" target="_blank" rel="noopener"
>ä¸Šå›žä¹¦&lt;/a>è¯´åˆ°ï¼Œç½‘ç«™åˆå…·é›å½¢ï¼Œä½†ç»é«˜äººæŒ‡ç‚¹ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šä¸è¶³ã€‚
æœ¬æ–‡å°†å¤§èƒ†æ‰©å……ç½‘ç«™ç»“æž„ï¼Œç›®æ ‡æ˜¯å°†ç½‘ç«™æ‹“å±•æˆä¸€ä¸ª CMS ã€‚
æ‰€ä»¥ï¼Œä¸è¦åœä¸‹æ¥å•Šï¼ðŸ‘†ï¼ˆæŒ‡å¼€å‘&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;h2 id="0x00-è“å›¾ä¸Žé‡æž„">0x00 è“å›¾ä¸Žé‡æž„&lt;/h2>
&lt;p>ä¸Žä¹‹å‰ç›¸æ¯”ï¼Œç½‘ç«™å°†å¢žåŠ ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>å›¾åº“ï¼šæ–‡ä»¶ä¸Šä¼ æ¨¡å—&lt;/li>
&lt;li>è¯„è®ºï¼šæ¥¼ä¸­æ¥¼åŠŸèƒ½&lt;/li>
&lt;li>åŽå°ï¼šæƒé™æ¨¡å—ï¼ŒåŽå°æ¨¡å—&lt;/li>
&lt;li>ä¼˜åŒ–ï¼šæ›´å¥å£®çš„æ•°æ®åº“æŽ¥å£ï¼Œæ›´ç»†è‡´çš„æƒé™æŽ§åˆ¶&lt;/li>
&lt;li>plusåŠŸèƒ½ï¼šç”¨ redis å®žçŽ°çƒ­æœ&lt;/li>
&lt;/ul>
&lt;p>åœ¨å¼€å‘è¿™äº›åŠŸèƒ½ä¹‹å‰ï¼Œé¦–å…ˆé‡æ•´é¡¹ç›®ç»“æž„ã€‚å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>å®Œå…¨è“å›¾åŒ–ã€‚&lt;a class="link" href="https://blog.csdn.net/ldq_sd/article/details/104766636" target="_blank" rel="noopener"
>å‚è€ƒ&lt;/a>
&lt;ul>
&lt;li>æ¨¡æ¿ä¹Ÿæ”¾å…¥ç‹¬ç«‹å­ç›®å½•é‡Œï¼Œè“å›¾æ³¨å†Œæ—¶ä½¿ç”¨template_folderå‚æ•°ï¼Œä¸è¿‡è¿™æ ·å®¹æ˜“äº§ç”Ÿbugï¼Œflask å®˜æ–¹æŽ¨èä½¿ç”¨ç¡¬ç¼–ç ï¼Œæ±—ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æ¸…ç†ä¾èµ–ï¼Œä¸ä½¿ç”¨ç»´æŠ¤çŠ¶æ€å·®çš„åº“ã€‚
&lt;ul>
&lt;li>å¼€å‘æ–°åŠŸèƒ½çš„æ—¶å€™ï¼ŒåŽ»å“ªé‡Œæ‰¾æœ€ä½³å®žè·µï¼Œæ‰¾å¥½ç”¨çš„åº“å‘¢ï¼Ÿæœ‰ä¸€ä¸ª Github æœç´¢å°æŠ€å·§ï¼Œåä¸º &amp;ldquo;awesome-xxx&amp;rdquo; çš„ä»“åº“é€šå¸¸æ˜¯æŸæŠ€æœ¯çš„ä¼˜è´¨èµ„æºåˆ—è¡¨ã€‚å¦‚ï¼šhttps://github.com/humiaozuzu/awesome-flask&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="0x01-æ–‡ä»¶ç³»ç»Ÿ">0x01 æ–‡ä»¶ç³»ç»Ÿ&lt;/h2>
&lt;blockquote>
&lt;p>æœ¬éƒ¨åˆ†å‚è€ƒäº†&lt;a class="link" href="https://greyli.com" target="_blank" rel="noopener"
>æŽè¾‰&lt;/a>å¤§ä½¬çš„ç³»åˆ—æ–‡ç« ï¼Œ
&lt;a class="link" href="https://zhuanlan.zhihu.com/p/23731819?refer=flask" target="_blank" rel="noopener"
>https://zhuanlan.zhihu.com/p/23731819?refer=flask&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>å¤´åƒï¼Œç…§ç‰‡â€¦â€¦æ–‡ä»¶ä¸Šä¼ æ˜¯ç»•ä¸å¼€çš„è¯é¢˜ã€‚åœ¨&lt;a class="link" href="#shangyipian" >ä¸Šä¸€ç¯‡&lt;/a>å‚è€ƒçš„æ•™ç¨‹ä¸­ï¼Œå¤´åƒçš„å®žçŽ°æ˜¯ç”±æ‰˜ç®¡ç½‘ç«™ç”Ÿæˆéšæœºçš„å›¾ç‰‡ã€‚é—æ†¾çš„æ˜¯å¹¶æ²¡æœ‰åƒ ORM ä¸€æ ·æ–¹ä¾¿æ•°æ®åº“å¤„ç†çš„æ–‡ä»¶å¤„ç†æ¡†æž¶å¯ä¾›ä½¿ç”¨ï¼Œè¿˜æ˜¯è‡ªå·±æŠŠä»–å•ƒä¸‹æ¥å§ã€‚&lt;/p>
&lt;p>æ³¨æ„è¸©å‘ï¼å¤§éƒ¨ä»½èµ„æ–™æŽ¨èä½¿ç”¨Flask_uploadsæ’ä»¶ï¼Œç„¶è€Œä½¿ç”¨è¯¥æ’ä»¶æ—¶å‡ºçŽ°å¦‚ä¸‹æŠ¥é”™ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ImportError: cannot import name &amp;#39;secure_filename&amp;#39; from &amp;#39;werkzeug&amp;#39;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æŸ¥é˜…Stackoverflowå¾—çŸ¥æ˜¯PYPIæºä¸Šçš„Flask_uploadsæ’ä»¶ä¸å†ç»´æŠ¤äº†ï¼ŒäºŽæ˜¯å’Œ werkzeug åº“çš„apiä¸å…¼å®¹ï¼Œæ˜¯æ’ä»¶å†…åœ¨çš„bugã€‚ç½‘ä¸Šçš„è§£å†³æ–¹æ³•æœ‰äºŒï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸€æ˜¯ä¿®æ”¹åº“æºç &lt;/li>
&lt;li>äºŒæ˜¯æ¢å¦ä¸€ä¸ªåº“ï¼Œç»´æŠ¤è‰¯å¥½ä¸”å¯æ— ç¼è¿ç§»ï¼Œåä¸º&lt;a class="link" href="https://pypi.org/project/Flask-Reuploaded/" target="_blank" rel="noopener"
>Flask-Reuploaded&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>å‰è€…ä¸åˆ©äºŽåŽç»­éƒ¨ç½²ï¼Œæœ¬äººå€¾å‘äºŽåŽè€…ã€‚ç„¶è€Œï¼Œä½¿ç”¨æ–°åº“ä¹Ÿé‡åˆ°äº†è¯¸å¤šéº»çƒ¦ï¼Œä½¿ç”¨&lt;code>UploadSet.url()&lt;/code>æ–¹æ³•æ—¶ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">werkzeug.routing.BuildError: Could not build url for endpoint &amp;#39;_uploads.uploaded_file&amp;#39; with values [&amp;#39;filename&amp;#39;, &amp;#39;setname&amp;#39;].
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>UploadSet.url()&lt;/code>æ–¹æ³•è¿”å›žå¯¹åº”æ–‡ä»¶çš„å¯è®¿é—®urlï¼Œè¿”å›žçš„urlé»˜è®¤å¸¦æœ‰&lt;code>_upload/&lt;/code>å‰ç¼€ï¼Œè¿™æ˜¯ Flask-Uploads è‡ªå¸¦çš„è·¯ç”±ï¼Œä¹Ÿè¢«ç§°ä¸º autoserve ã€‚
ç„¶è€Œå®˜æ–¹æ–‡æ¡£é‡Œæœ‰è¿™æ ·ä¸€å¥è¯&lt;/p>
&lt;blockquote>
&lt;p>autoserve of uploaded images now has been deactivated; this was a poorly documented â€œfeatureâ€, which even could have lead to unwanted data disclosure; if you want to activate the feature again, you need to set UPLOADS_AUTOSERVE=True&lt;/p>
&lt;/blockquote>
&lt;p>çœ‹æ¥ Flask-Reuploaded çš„ä½œè€…ä¼¼ä¹Žè®¤ä¸ºæ–‡ä»¶è¯»å–åŠŸèƒ½ä¸Žæˆ‘æ— ç“œã€‚å¥½å§ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬è‡ªå·±å®žçŽ°ã€‚&lt;/p>
&lt;p>// æµªè´¹äº†ä¸€æ™šä¸Šdebugï¼Œç»“æžœåªæ˜¯å› ä¸ºæ–‡æ¡£æ²¡çœ‹æ˜Žç™½ï¼Œå†æ¬¡è¯æ˜Žè¯»æ–‡æ¡£çš„é‡è¦æ€§ã€‚&lt;/p>
&lt;h3 id="flask-reuploaded-æ–‡ä»¶ä¸Šä¼ ">Flask-Reuploaded: æ–‡ä»¶ä¸Šä¼ &lt;/h3>
&lt;p>æ’ä»¶å°†ä¸Šä¼ çš„ä¸€ç±»æ–‡ä»¶æŠ½è±¡æˆé›†åˆ&lt;code>UploadSet&lt;/code>ã€‚å¯¹æ¯ä¸ª Set æœ‰å¦‚ä¸‹æ“ä½œï¼š&lt;/p>
&lt;ul>
&lt;li>é…ç½®æ–‡ä»¶ç±»åž‹ï¼š&lt;code>photos = UploadSet('photos', IMAGES)&lt;/code> //ç±»åž‹åŒ…æ‹¬ï¼šIMAGESã€TEXTã€AUDIOâ€¦â€¦&lt;/li>
&lt;li>é…ç½®å­˜è´®è·¯å¾„ï¼š&lt;code>app.config['UPLOADED_PHOTOS_DEST']&lt;/code> // Photos ä¸º Set çš„å˜é‡å&lt;/li>
&lt;li>ä¿å­˜æ–‡ä»¶ï¼š&lt;code>filename = photos.save(request.files['photo'])&lt;/code>&lt;/li>
&lt;li>è¿”å›žé“¾æŽ¥ï¼š&lt;code>photos.url(filename)&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æœ€åŽï¼Œæ³¨å†Œ Set å’Œæ’ä»¶æ³¨å†Œç±»ä¼¼ï¼š&lt;code>configure_uploads(app, [avatars, photos])&lt;/code> //å¯ä¸€æ¬¡æ€§å…¨éƒ¨æ³¨å†Œ&lt;/p>
&lt;p>å®žçŽ°å¤´åƒä¸Šä¼ çš„æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ¨¡åž‹å±‚ï¼š User æ·»åŠ  avatar å­—æ®µï¼Œå‚¨å­˜å¤´åƒçš„æ–‡ä»¶åã€‚åŽŸ&lt;code>avatar()&lt;/code>æ–¹æ³•ä½œä¸ºé»˜è®¤å¤´åƒã€‚&lt;/li>
&lt;li>è¡¨å•å±‚ï¼š edit_profile è¡¨å•å¢žåŠ &lt;code>FileField&lt;/code>å­—æ®µ&lt;/li>
&lt;li>è§†å›¾å±‚ï¼š å‚¨å­˜æ–‡ä»¶ï¼Œå‘æ•°æ®åº“æäº¤æ–‡ä»¶åã€‚&lt;/li>
&lt;li>æ¨¡æ¿å±‚ï¼š æ”¹ç”¨ç¡¬è·¯ç”±èŽ·å–urlã€‚// æœ€ç»ˆ .url() è¿˜æ˜¯æœ‰bugï¼Œå†æ¬¡è¯´æ˜Žä¸è¦ä¹±ç”¨ä¸çŸ¥åçš„æ’ä»¶&lt;/li>
&lt;/ul>
&lt;h3 id="å›¾åº“æ¨¡å—">å›¾åº“æ¨¡å—&lt;/h3>
&lt;p>æœ¬æ¨¡å—åŒ…æ‹¬å¦‚ä¸‹è·¯ç”±ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>/index&lt;/code>ï¼šä¸»é¡µæ˜¾ç¤ºç€‘å¸ƒæµ&lt;/li>
&lt;li>&lt;code>/upload&lt;/code>ï¼šä¸Šä¼ æŽ¥å£ï¼šå‚è€ƒå¤´åƒä¸Šä¼ &lt;/li>
&lt;li>&lt;code>/detail&lt;/code>ï¼šè¯¦æƒ…ï¼Œæ˜¾ç¤ºè¯„è®º&lt;/li>
&lt;li>&lt;code>/delete&lt;/code>ï¼šåˆ é™¤æŽ¥å£ï¼šåŒæ—¶åˆ é™¤æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;p>ç”±äºŽæœ¬é¡¹ç›®å‰ç«¯æ¡†æž¶æ˜¯ Bootstrap ï¼ŒðŸ‘´ä¸æƒ³å†™Jqueryï¼Œæ‰€ä»¥ç›´æŽ¥åˆ·æ–°é¡µé¢ï¼Œä¹Ÿä¸å¼„æ— é™æ»šåŠ¨äº†ï¼ŒæŒ‰é’®äº†äº‹ã€‚å¦å¤–ä¸ºäº†ä¸åŒåˆ—é•¿åº¦å°½é‡å‡åŒ€ï¼Œæ•…é‡‡ç”¨å–å·§çš„æ–¹æ³•ï¼Œå¹³å‡åˆ†é…ã€‚æ ¹æ®å¤§æ•°å®šç†ï¼Œåªè¦éšæœºå›¾ç‰‡è¶³å¤Ÿå¤šè‚¯å®šä¼šå·®ä¸å¤šå‡åŒ€ã€‚ã€‚ã€‚ã€‚&lt;/p>
&lt;h2 id="0x02-è¯„è®ºç³»ç»Ÿ">0x02 è¯„è®ºç³»ç»Ÿ&lt;/h2>
&lt;h3 id="æ•°æ®åº“è®¾è®¡">æ•°æ®åº“è®¾è®¡&lt;/h3>
&lt;p>è¯„è®ºåŒ…å«äº†ä¸¤ä¸ªä¸€å¯¹å¤šå…³ç³»ï¼Œæ—¢æ˜¯è¯„è®ºå’Œæ–‡ç« çš„ä¸€å¯¹å¤šå…³ç³»ï¼Œä¹Ÿæ˜¯è¯„è®ºå’Œç”¨æˆ·çš„ä¸€å¯¹å¤šã€‚ä¸ºæ­¤ï¼Œåªéœ€è¦ç»™Userå’ŒPostæ·»åŠ å…³ç³»å³å¯ã€‚
ç„¶è€Œï¼Œæˆ‘ä»¬å¸Œæœ›è®¾è®¡ç»Ÿä¸€çš„Commentæ¨¡åž‹ï¼Œè¯„è®ºçš„å¯¹è±¡æ—¢å¯ä»¥æ˜¯æ–‡ç« ï¼Œä¹Ÿå¯ä»¥æ˜¯å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–è¯„è®ºã€‚ä¸ºæ­¤ï¼Œæ·»åŠ ä¸€ä¸ªæžšä¸¾ç±»åž‹çš„å­—æ®µæŒ‡ç¤ºè¯„è®ºç±»åž‹ï¼Œä»Žè€Œé‡‡ç”¨ä¸åŒçš„å¤„ç†é€»è¾‘ã€‚&lt;/p>
&lt;h3 id="æ¥¼ä¸­æ¥¼">æ¥¼ä¸­æ¥¼&lt;/h3>
&lt;p>è€Œä¸»æµç½‘ç«™ä¸å…‰æ”¯æŒå¯¹æ–‡ç« è¯„è®ºï¼Œè¿˜æ”¯æŒæ¥¼ä¸­æ¥¼ã€‚å¯¹æ¥¼ä¸­æ¥¼çš„å®žçŽ°æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆï¼š&lt;/p>
&lt;ul>
&lt;li>æŒ‰æ—¶é—´å¹³é“ºï¼šä»¥åŽŸç™¾åº¦è´´å§ä¸ºä¾‹
&lt;ul>
&lt;li>æ·»åŠ  &lt;code>reply_id&lt;/code> å­—æ®µï¼ŒæŒ‡ç¤ºè¦å›žå¤çš„äºº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å¥—å¨ƒå¼ç¼©è¿›ï¼šä»¥æŸäº›è€å¼bbsä¸ºä¾‹
&lt;ul>
&lt;li>æ·»åŠ  &lt;code>parent_id&lt;/code> å­—æ®µï¼ŒæŒ‡ç¤ºçˆ¶è¯„è®ºï¼ˆé¡¶å±‚è¯„è®ºåˆ™ä¸ºæœ¬èº«idï¼‰ï¼Œåœ¨å®žä½“ç±»ä¸­ä¿å­˜å­è¯„è®ºåˆ—è¡¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å¼¹çª—å¼æŸ¥çœ‹ï¼šä»¥çŸ¥ä¹Žï¼Œbç«™ä¸ºä¾‹
&lt;ul>
&lt;li>åœ¨æŒ‰æ—¶é—´å¹³é“ºçš„åŸºç¡€ä¸Šï¼Œè‹¥ &lt;code>reply_id&lt;/code>å­˜åœ¨æ·»åŠ â€œæŸ¥çœ‹å¯¹è¯â€æŒ‰é’®ï¼Œé€’å½’çš„æž„å»ºå¯¹è¯å¹¶å¼¹çª—ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å…¶ä¸­ï¼Œç¬¬ä¸€ç§å®žçŽ°ç®€å•ï¼Œç”¨æˆ·ä¸å‹å¥½ï¼›ç¬¬äºŒç§å®žçŽ°å¤æ‚ï¼Œå¯¹å¤šå±‚çº§å¯¹è¯æ— æ³•èƒœä»»ï¼›ç¬¬ä¸‰ç§æ˜¯æœ€ä¸»æµçš„å®žçŽ°æ–¹å¼ã€‚&lt;/p>
&lt;p>é€šè¿‡ä»¥&lt;code>reply_id&lt;/code>ä½œä¸ºæŒ‡é’ˆï¼Œæ‰€æœ‰è¯„è®ºè¿žæŽ¥æˆäº†ä¸€æ£µæ ‘ï¼Œåœ¨ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œâ€œæŸ¥çœ‹å¯¹è¯â€æ“ä½œï¼Œå°±æ˜¯æ‰§è¡Œæ ‘çš„å¯»æ ¹ã€‚â€œæŸ¥çœ‹å¯¹è¯â€å‡½æ•°å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@staticmethod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">view_dialogue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c_id&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dialogue&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">c_id&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="n">Comment&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;comment&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c_id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Comment&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reply_id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">Comment&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c_id&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dialogue&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c_id&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">dialogue&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="0x03-ç½‘ç«™åŽå°">0x03 ç½‘ç«™åŽå°&lt;/h2>
&lt;p>ç½‘ç«™çš„åŽå°é€šå¸¸ç»™ç®¡ç†å‘˜æä¾›ç»Ÿä¸€ç›‘ç®¡æ•°æ®åº“çš„ç•Œé¢ã€‚æœ‰ä»¥ä¸‹æ’ä»¶å¸®åŠ©å®žçŽ°ï¼š&lt;/p>
&lt;ul>
&lt;li>Flask-adminï¼šä¸€é”®ç”ŸæˆåŽå°é¡µé¢ï¼Œå¹¶å¯ä»¥è‡ªå®šä¹‰è§†å›¾å’Œæ¨¡åž‹ã€‚&lt;/li>
&lt;li>Flask-Securityï¼š æ¯”adminå±‚æ¬¡æ›´é«˜ï¼Œå°è£…äº†å¸¸ç”¨è§†å›¾å’Œæ¨¡æ¿ã€‚ä½†æ˜¯æ–‡æ¡£å°‘ï¼Œä¸”å¾ˆå¤šåŠŸèƒ½æˆ‘ä»¬å·²ç»å®žçŽ°äº†ï¼Œå†ä½¿ç”¨å®ƒå°±è¦æŽ¨ç¿»é‡åšã€‚é‚å¼ƒç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;p>æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨äº† RBACï¼ˆRole-Based Access Control) åŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶ï¼Œç®€å•è¯´å°±æ˜¯è®¾è®¡ä¸€ä¸ªè§’è‰²è¡¨ï¼Œç”¨æˆ·è¡¨å’Œè§’è‰²è¡¨ç”¨å…³è”è¡¨å®žçŽ°å¤šå¯¹å¤šå…³è”ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œé’ˆå¯¹è§’è‰²çš„æƒé™åˆ†é…ï¼Œä¿®æ”¹æƒé™æ—¶æ— éœ€ä¿®æ”¹æ¯ä¸ªç”¨æˆ·ã€‚&lt;/p>
&lt;h2 id="0x04-çƒ­æœ">0x04 çƒ­æœ&lt;/h2>
&lt;p>æœ¬èŠ‚å†åŠ å…¥ä¸€ä¸ªé‡é‡çº§å†…å®¹ï¼Œåˆ©ç”¨ redis å®žçŽ°æµè§ˆé‡æŽ’è¡Œæ¦œï¼Œä¹Ÿå°±æ˜¯çƒ­æœã€‚å½“ç„¶ï¼ŒçœŸæ­£çš„çƒ­æœæ¦œå•æŽ’åè§„åˆ™æ›´åŠ å¤æ‚ï¼Œè¿™é‡Œåªé€šè¿‡ç®€å•çš„æµè§ˆé‡è®¡æ•°æ¥ç»ƒä¹  redis çš„ä½¿ç”¨ã€‚&lt;/p>
&lt;p>ã€ðŸ‘´æœ‰æ—¶é—´å†åšã€‘&lt;/p>
&lt;h2 id="ä¸è¦è®©å¼€å‘åœä¸‹æ¥">ä¸è¦è®©å¼€å‘åœä¸‹æ¥&lt;/h2>
&lt;p>å¯ä»¥åŠ çš„åŠŸèƒ½è¿˜æœ‰å¾ˆå¤šï¼šæ—¶é—´çº¿ï¼Œemojiæ”¯æŒï¼Œå¤šåª’ä½“ï¼Œå‰åŽç«¯åˆ†ç¦»(Vue)ï¼Œï¼Œ&lt;/p>
&lt;p>é™¤äº†åŠŸèƒ½ï¼Œå½“é¢å¯¹æ›´é«˜é‡çº§çš„æµé‡æ—¶ï¼Œç½‘ç«™æ€§èƒ½ä¾¿æ›´åŠ é‡è¦ï¼Œè¿™æ—¶å€™æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒPRCï¼Œå¾®æœåŠ¡/åˆ†å¸ƒå¼ï¼Œï¼Œï¼Œæ›´è®©äººå¤´ç§ƒã€‚&lt;/p>
&lt;p>Webå¼€å‘ä¹‹è·¯ï¼Œé“é˜»ä¸”é•¿ã€‚ä½†æ˜¯ï¼Œåªè¦å¼€å‘ä¸åœä¸‹æ¥ï¼Œé“è·¯å°±ä¼šä¸æ–­å»¶ç”³ã€‚ã€‚ã€‚ï¼ˆå¸Œæœ›ä¹‹èŠ±.mp3ï¼‰&lt;/p></description></item><item><title>å¹´è½»äººçš„ç¬¬äºŒä¸ªç½‘ç«™ - The Flask Mega Tutorial</title><link>https://lonelyuan.github.io/HugoBlog/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99-the-flask-mega-tutorial/</link><pubDate>Thu, 09 Sep 2021 20:18:56 +0000</pubDate><guid>https://lonelyuan.github.io/HugoBlog/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99-the-flask-mega-tutorial/</guid><description>&lt;blockquote>
&lt;p>æœ¬æ–‡ä¸º Flask æ¡†æž¶å­¦ä¹ ç¬”è®°ï¼Œä¸»è¦å‚è€ƒäº† &lt;a class="link" href="https://luhuisicnu.gitbook.io/the-flask-mega-tutorial-zh" target="_blank" rel="noopener"
>The-Flask-Mega-Tutorial&lt;/a> å’Œ ã€ŠFlask Webå¼€å‘ï¼šåŸºäºŽPythonçš„Webåº”ç”¨å¼€å‘å®žæˆ˜ã€‹ä¸¤æœ¬ä¹¦ï¼Œå¹¶åœ¨åŽŸé¡¹ç›®çš„åŸºç¡€ä¸Šæ‹“å±•ã€‚ï¼ˆä¸‹æ–‡ç»Ÿç§°è¿™ä¸¤ä¸ªèµ„æºä¸ºâ€œæœ¬æ•™ç¨‹â€ï¼‰
ä¸ç†Ÿæ‚‰ Flask æ¡†æž¶è¯·å…ˆé˜…è¯»&lt;a class="link" href="https://dormousehole.readthedocs.io/en/latest/quickstart.html" target="_blank" rel="noopener"
>å¿«é€Ÿä¸Šæ‰‹ - flask ä¸­æ–‡æ–‡æ¡£&lt;/a> ã€‚&lt;/p>
&lt;p>è¿™ä¸¤æœ¬ä¹¦çš„ä½œè€…æ˜¯åŒä¸€ä¸ªäººï¼Œå°±å†…å®¹ä¸Šè¯´åŽè€…ç®—æ˜¯å‰è€…çš„è±ªåŽç‰ˆã€‚æœ¬æ•™ç¨‹çš„ä¼˜ç‚¹æ˜¯å†…å®¹å…¨é¢ï¼Œä»Žå…¥é—¨åˆ°éƒ¨ç½²ä¸€ç«™å¼æœåŠ¡ï¼›ç¼ºç‚¹æ˜¯ä¸å¤Ÿæ·±å…¥ï¼Œä¸”æœ‰äº›è¿‡æ—¶ï¼Œä¹¦ä¸­ä¸¾ä¾‹çš„è¯¸å¤šæ’ä»¶å‡ä¸ºä½œè€…ä¸ºäº†æ­¤ä¹¦è€Œå¼€å‘çš„ï¼Œå·²ç»è®¸ä¹…ä¸å†ç»´æŠ¤ï¼Œå¯¼è‡´å¾ˆéš¾åœ¨å…¶ç¤ºä¾‹é¡¹ç›®ä¸Šæ‹“å±•ã€‚ä¸€çœ‹æ‰‰é¡µï¼Œ2015å¹´å‡ºç‰ˆï¼Œé‚£æ²¡äº‹äº†ã€‚
è‡³äºŽç¬¬ä¸€ä¸ªç½‘ç«™ï¼Ÿå‚è§&lt;a class="link" href="#%e6%88%91%e8%bf%98%e6%b2%a1%e5%86%99%e5%91%a2" >#TODO:å¹´è½»äººçš„ç¬¬ä¸€ä¸ªç½‘ç«™&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;h2 id="0x00-å¤§åž‹é¡¹ç›®ç»“æž„">0x00 å¤§åž‹é¡¹ç›®ç»“æž„&lt;/h2>
&lt;p>åœ¨å¤§éƒ¨åˆ†é¢å‘åˆå­¦è€…çš„ demo ä¸­ï¼Œåº”ç”¨ä»¥ç®€å•çš„é¡¹ç›®ç»“æž„ç”šè‡³å•æ–‡ä»¶è¡¨ç¤ºã€‚åœ¨å¤§åž‹é¡¹ç›®ä¸­ï¼Œç½‘ç«™çš„ä¸åŒåŠŸèƒ½è¢«æ‹†åˆ†æˆç‹¬ç«‹çš„æ¨¡å—ï¼Œä»¥æ–¹ä¾¿æ‹“å±•å’Œç»´æŠ¤ã€‚ä¸€ä¸ªæ›´é€šç”¨çš„ Flask é¡¹ç›®ä»£ç æž¶æž„å¦‚ä¸‹ï¼šï¼ˆä»…è€ƒè™‘ä¸šåŠ¡ä»£ç ï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">microblog/ # æ ¹ç›®å½•
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app/ # é¡¹ç›®æºç 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> __init__.py # é¡¹ç›®åˆå§‹åŒ–ï¼Œå½“è¯¥åŒ…è¢«importï¼Œé¦–å…ˆæ‰§è¡Œ__init__.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> routes.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> forms.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> main.py # æ¡†æž¶å…¥å£
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config.py # Configé…ç½®ç±»
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .flaskenv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶æœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>app/&lt;/code>æ‰€æœ‰ç½‘ç«™æºä»£ç ç»Ÿä¸€å½’åˆ°appç›®å½•ä¸‹ã€‚
&lt;ul>
&lt;li>åœ¨&lt;code>app/&lt;/code>å†…éƒ¨ï¼Œä¸åŒçš„åŠŸèƒ½å¯è¿›ä¸€æ­¥åˆ’åˆ†æˆç‹¬ç«‹æ¨¡å—ï¼Œè¯¦è§[æ¨¡å—åŒ–åº”ç”¨](#0x05 æ¨¡å—åŒ–åº”ç”¨ï¼šåŠŸèƒ½è§£è€¦)ä¸€ç« ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>main.py&lt;/code>: å…¥å£è„šæœ¬ï¼Œé€šè¿‡è¯¥æ–‡ä»¶å¼•å…¥appä¸­çš„ä»£ç å¹¶ç”Ÿæˆåº”ç”¨å®žä¾‹ï¼ˆå‘½åéšæ„ï¼‰&lt;/li>
&lt;li>&lt;code>.flaskenv&lt;/code>: flaskçŽ¯å¢ƒå˜é‡ï¼Œä»¥é…åˆflaskå‘½ä»¤ã€‚å…¥å£è„šæœ¬è¢«å®šä¹‰ä¸º&lt;code>FLASK_APP&lt;/code>ï¼Œæ‰§è¡Œ&lt;code>flask run&lt;/code>æ—¶å°†å¯åŠ¨è¯¥è„šæœ¬ã€‚&lt;/li>
&lt;li>&lt;code>config.py&lt;/code>: é…ç½®è„šæœ¬ï¼Œæ•´ä¸ªé¡¹ç›®çš„é…ç½®ä¿¡æ¯éƒ½å†™åœ¨Configç±»é‡Œã€‚ä¸ŽçŽ¯å¢ƒå˜é‡çš„åŒºåˆ«åœ¨äºŽï¼Œå› ä¸ºæ˜¯pythonè„šæœ¬ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼Œå¯è¢«ä»»ä½•åœ°æ–¹çš„ä»£ç å¼•ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="0x01-hello-worldæ¨¡æ¿å’Œè§†å›¾">0x01 Hello worldï¼šæ¨¡æ¿å’Œè§†å›¾&lt;/h2>
&lt;p>æœ€åŸºæœ¬çš„ web åŠŸèƒ½ï¼Œæ— éžæŽ¥å—è¯·æ±‚ã€è¿”å›žæ•°æ®ã€‚å…¶ä¸­ï¼Œè·¯ç”± (route) ç”¨æ¥åŒºåˆ†ä¸åŒçš„è¯·æ±‚ï¼Œæ¨¡æ¿ (templates) ç”¨æ¥ç”Ÿæˆä¸åŒçš„æ•°æ®ã€‚&lt;/p>
&lt;h4 id="è·¯ç”±è§†å›¾">è·¯ç”±/è§†å›¾&lt;/h4>
&lt;p>åœ¨éžå‰åŽç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼Œè§†å›¾å‡½æ•°ç›´æŽ¥è¿”å›žæ¸²æŸ“å¥½çš„ç½‘é¡µï¼Œç”±&lt;code>@app.route()&lt;/code>ä¿®é¥°åŽï¼Œè§†å›¾å’Œè·¯ç”±ä¾¿ç»‘å®šåœ¨ä¸€èµ·ã€‚
åœ¨mvcæ¨¡åž‹ä¸­æ›´åƒcontrolleræŽ§åˆ¶å™¨çš„è§’è‰²ï¼Œç„¶è€Œåœ¨flaskç”Ÿæ€ä¸­æ›´å–œæ¬¢ç§°ä¸ºè§†å›¾å‡½æ•°ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>url_for()&lt;/code> ä½¿ç”¨URLåˆ°è§†å›¾å‡½æ•°çš„å†…éƒ¨æ˜ å°„å…³ç³»æ¥ç”ŸæˆURLï¼Œç”¨æ¥æ›¿æ¢ç¡¬é“¾æŽ¥ã€‚åœ¨ä¸šåŠ¡åŠŸèƒ½è§£è€¦åŽå¿…é¡»ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚
&lt;ul>
&lt;li>NOTEï¼šå½“è·¯ç”±å’Œè§†å›¾å‡½æ•°åä¸ä¸€è‡´ï¼Œè®¿é—®è¯¥è·¯ç”±å¯ä»¥æ­£ç¡®å“åº”ï¼Œä½†æ˜¯ä½¿ç”¨&lt;code>url_for()&lt;/code>è°ƒç”¨è¯¥è§†å›¾æ—¶ä¼šæŠ¥é”™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>{% extends &amp;quot;base.html&amp;quot; %}&lt;/code> and &lt;code>{% include &amp;quot;_post.html&amp;quot; %}&lt;/code> ä½¿ç”¨å­æ¨¡æ¿æ¥å®žçŽ°ç½‘é¡µå…¬ç”¨çš„éƒ¨åˆ†ã€‚å¦‚ï¼šé¡µçœ‰ï¼Œé¡µè„šï¼Œåˆ—è¡¨é¡¹ç­‰ã€‚
&lt;ul>
&lt;li>æ¨¡æ¿å’Œ Python ä»£ç çš„å…³ç³»æœ‰äº›ç±»ä¼¼ä¸Ž JSP å’Œ Java ä»£ç çš„å…³ç³»ï¼Œä½†æ¨¡æ¿è¯­æ³•å¹¶ä¸æ˜¯å®Œæ•´çš„è„šæœ¬è¯­è¨€ï¼Œç›¸è¾ƒè€Œè¨€é™åˆ¶æ›´å¤šï¼Œå®‰å…¨æ€§æ›´å¥½ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="è¡¨å•">è¡¨å•&lt;/h4>
&lt;blockquote>
&lt;p>å‡ ä¹Žæ‰€æœ‰æˆåŠŸçš„æ¡†æž¶éƒ½æœ‰ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ã€‚ä¸‹é¢å¼•å…¥æ–°åŠŸèƒ½æ—¶ï¼Œå¤§å¤šå€ŸåŠ©æ’ä»¶æ¥æ–¹ä¾¿çš„å®žçŽ°ã€‚å¤§å¤šæ•°Flaskæ’ä»¶ä½¿ç”¨&lt;code>flask_&amp;lt;name&amp;gt;&lt;/code> å‘½åçº¦å®šã€‚&lt;/p>
&lt;/blockquote>
&lt;p>Flask-WTFæ’ä»¶æä¾›äº†å¯¹Webè¡¨å•çš„æŠ½è±¡ï¼Œåªéœ€å®šä¹‰è¡¨å•ç±»ä»¥åŠè®¾ç½®ç±»å±žæ€§å³å¯ã€‚&lt;/p>
&lt;p>æ¨¡æ¿è¯­æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>{{ form.&amp;lt;name&amp;gt;.label }}&lt;/code>æ¸²æŸ“æ ‡ç­¾&lt;/li>
&lt;li>&lt;code>{{ form.&amp;lt;name&amp;gt;() }}&lt;/code>èŽ·å–å±žæ€§å€¼&lt;/li>
&lt;li>&lt;code>form.hidden_tag()&lt;/code>æ¨¡æ¿å‚æ•°ç”Ÿæˆäº†ä¸€ä¸ªéšè—å­—æ®µï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç”¨äºŽä¿æŠ¤è¡¨å•å…å—CSRFæ”»å‡»çš„token&lt;/li>
&lt;/ul>
&lt;p>å°†è¡¨å•å¼•å…¥æ¨¡æ¿&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">form&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">LoginForm&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># ç”Ÿæˆäº†ä¸€ä¸ªå®žä¾‹ä¼ å…¥æ¨¡æ¿&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">return&lt;/span> &lt;span class="n">render_template&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;login.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">title&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Sign In&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">form&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">form&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="flash-é—ªçŽ°æ¶ˆæ¯">flash é—ªçŽ°æ¶ˆæ¯&lt;/h4>
&lt;p>flash é€šè¿‡ session å‚¨å­˜ï¼Œç”¨äºŽæ˜¾ç¤ºåªå‡ºçŽ°ä¸€æ¬¡çš„æç¤ºæ¶ˆæ¯ã€‚ç”¨æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨è·¯ç”±ä¸­ä½¿ç”¨&lt;code>flash()&lt;/code>ï¼Œè§¦å‘æ—¶æ¶ˆæ¯ä¾¿å†™å…¥ session ä¸­çš„ message åˆ—è¡¨&lt;/li>
&lt;li>åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨&lt;code>get_flashed_messages()&lt;/code>ï¼Œä»Ž session ä¸­è¯»å–&lt;/li>
&lt;/ul>
&lt;h2 id="0x02-æ•°æ®åº“-orm">0x02 æ•°æ®åº“ ORM&lt;/h2>
&lt;p>å¾ˆä¹…å¾ˆä¹…ä»¥å‰ï¼Œwebç½‘ç«™å’Œæ•°æ®åº“äº¤äº’è¿˜éœ€è¦å†™å¾ˆå¤šå¾ˆç¡¬çš„ SQL è¯­å¥ï¼Œæ•ˆçŽ‡ä½Žä¸”å®¹æ˜“å‡ºçŽ°æ³¨å…¥æ¼æ´ž(SQLi)ã€‚çŽ°ä»£webå¼€å‘éƒ½ä½¿ç”¨ ORM æ¡†æž¶ç®€åŒ–æ•°æ®åº“äº¤äº’ï¼Œä¸”åŸºæœ¬æœç»äº† SQLi æ¼æ´žã€‚&lt;/p>
&lt;p>æœ¬é¡¹ç›®ä½¿ç”¨å¦‚ä¸‹æ’ä»¶æ‰“é€šæ•°æ®åº“ï¼š&lt;/p>
&lt;ul>
&lt;li>Flask-SQLAlchemy: Pythonç”Ÿæ€æœ€çŸ¥åçš„ORMæ¡†æž¶&lt;/li>
&lt;li>Flask-Migrate: æœ¬æ•™ç¨‹ä½œè€…ç¼–å†™çš„æ•°æ®åº“è¿ç§»æ¡†æž¶&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æ’ä»¶é¦–å…ˆè¦æ³¨å†Œã€‚ç»Ÿä¸€æµç¨‹: åˆå§‹åŒ–appå®žä¾‹ï¼Œä¼ å…¥æ’ä»¶ç±»ä½œä¸ºæ’ä»¶å®žä¾‹çš„å‚æ•°&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># app/__init__.py&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Flask&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="vm">__name__&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># flaskåŸºç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_object&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Config&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SQLAlchemy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">migrate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Migrate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">db&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/blockquote>
&lt;h3 id="sqlalchemymodelå±‚">SQLalchemyï¼šmodelå±‚&lt;/h3>
&lt;h4 id="æ¨¡åž‹å®šä¹‰">æ¨¡åž‹å®šä¹‰&lt;/h4>
&lt;p>ä½¿ç”¨ç±»å’Œç±»å±žæ€§ä»£è¡¨ table å’Œ colunm ï¼Œä¾¿å¯è½»æ¾ç¼–å†™æ•°æ®æ¨¡åž‹ã€‚SQLalchemy çš„æ¦‚å¿µæŠ½è±¡å¦‚ä¸‹å›¾ï¼š
&lt;img src="https://lonelyuan.github.io/HugoBlog/HugoBlog/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99-the-flask-mega-tutorial/1631793936306.png"
width="760"
height="229"
srcset="https://lonelyuan.github.io/HugoBlog/HugoBlog/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99-the-flask-mega-tutorial/1631793936306_hu7f25cecc8aefde770917be517cb2f54b_27444_480x0_resize_box_3.png 480w, https://lonelyuan.github.io/HugoBlog/HugoBlog/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99-the-flask-mega-tutorial/1631793936306_hu7f25cecc8aefde770917be517cb2f54b_27444_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="331"
data-flex-basis="796px"
>&lt;/p>
&lt;p>Flask-SQLAlchemy è‡ªåŠ¨è®¾ç½®ç±»åä¸ºå°å†™æ¥ä½œä¸ºå¯¹åº”è¡¨çš„åç§°ï¼Œä¹Ÿå¯ä»¥ç”¨&lt;code>__tablename__&lt;/code>ç±»å±žæ€§æ¥å®šä¹‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Post&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Model&lt;/span>&lt;span class="p">):&lt;/span> &lt;span class="c1"># è¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">primary_key&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># åˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">....&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="curdåŸºæœ¬æ“ä½œ">CURDåŸºæœ¬æ“ä½œ&lt;/h4>
&lt;p>ORM æ¡†æž¶é€šå¸¸é›†æˆäº†å¸¸ç”¨æ“ä½œï¼Œä½†ä¹Ÿæ”¯æŒæ›´åº•å±‚çš„æ•°æ®åº“æŽ¥å£ã€‚&lt;/p>
&lt;blockquote>
&lt;p>åœ¨ Springboot Jpa ä¸­ï¼Œæ ¹æ®æ–¹æ³•åçš„æ‹¼å†™æ¥å†™è‡ªå®šä¹‰æŸ¥è¯¢ï¼Œè€Œåœ¨ SQLalchemy ä¸­ï¼Œæä¾›çš„æŽ¥å£é€šè¿‡é“¾å¼è°ƒç”¨æ‹¼æŽ¥ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>åœ¨ SQLalchemy ä¸­ï¼ŒåŸºæœ¬æ“ä½œå¤§éƒ½æœ‰åŸºäºŽäº‹åŠ¡ (session) çš„å’ŒåŸºäºŽæŸ¥è¯¢ (query) çš„ä¸¤ç§æ–¹å¼ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æŸ¥&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">session&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">User&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>queryæ–¹æ³•åªæœ‰æž„é€ ä¸€ä¸ªæŸ¥è¯¢ï¼Œåªæœ‰åœ¨&lt;code>Query.get()&lt;/code>ã€&lt;code>Query.all()&lt;/code>ã€&lt;code>Query.one()&lt;/code>ç­‰ç»“æŸç¬¦ä¹‹åŽæ‰ä¼šæ‰§è¡ŒæŸ¥è¯¢&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¢žï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">commit&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>åˆ &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">session&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">User&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">delete&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">session&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">delete&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">User&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">session&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">commit&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>æ”¹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">query&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">session&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">.&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">User&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">.&lt;/span>&lt;span class="n">filter_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">.&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="s2">&amp;#34;username&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">User&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">username&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span> &lt;span class="n">synchronize_session&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">user&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">User&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">user&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;zxcv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">session&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">commit&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="flask-migrate-æ•°æ®åº“è¿ç§»">Flask-Migrate: æ•°æ®åº“è¿ç§»&lt;/h3>
&lt;p>é…ç½®æ•°æ®åº“çš„åˆå§‹æ•°æ®æ¡†æž¶ï¼Œä¸€èˆ¬å†™æˆSQLè„šæœ¬å½¢å¼ã€‚
migrate æ¡†æž¶ç›´æŽ¥æ ¹æ® model å±‚ç”Ÿæˆè¿ç§»è„šæœ¬ï¼Œå¯ä»¥æ–¹ä¾¿çš„è·Ÿè¸ªæ•°æ®æ¨¡åž‹çš„ä¿®æ”¹å’Œæ•°æ®åº“çš„åˆ‡æ¢ã€‚ï¼ˆè¿™ä¸ªæ¡†æž¶è¿˜æ˜¯æœ¬æ•™ç¨‹ä½œè€…è‡ªå·±å¼€å‘çš„ï¼Œå¼ºï¼‰&lt;/p>
&lt;p>flask dbå­å‘½ä»¤&lt;/p>
&lt;ul>
&lt;li>&lt;code>flask db init&lt;/code>ï¼šåˆå§‹åŒ–ï¼Œç”Ÿæˆmigrationsç›®å½•&lt;/li>
&lt;li>&lt;code>flask db migrate&lt;/code>ï¼šç”Ÿæˆè¿ç§»è„šæœ¬ï¼Œä¿®æ”¹modelåŽä½¿å…¶ç”Ÿæ•ˆ
&lt;ul>
&lt;li>&lt;code>flask db migrate -m &amp;quot;posts table&amp;quot; &lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>flask db upgrade&lt;/code>ï¼šåº”ç”¨æ•°æ®åº“ä¿®æ”¹ï¼ˆå¼€å‘é˜¶æ®µé»˜è®¤ä½¿ç”¨sqliteæ•°æ®åº“&lt;/li>
&lt;li>&lt;code>flask db downgrade&lt;/code>ï¼šå›žæ»šä¸Šæ¬¡çš„è¿ç§»&lt;/li>
&lt;/ul>
&lt;h2 id="0x03-å¼€å‘èŒƒå¼ç”¨æˆ·ç³»ç»Ÿ">0x03 å¼€å‘èŒƒå¼ï¼šç”¨æˆ·ç³»ç»Ÿ&lt;/h2>
&lt;blockquote>
&lt;p>mixinï¼šæ··å…¥ï¼Œå¤šé‡ç»§æ‰¿çš„ä¸€ç§å½¢å¼&lt;/p>
&lt;/blockquote>
&lt;p>è¡¨å•å’Œæ•°æ®åº“æ”¯æŒåˆ†åˆ«è§£å†³äº†å‰ç«¯å’ŒåŽç«¯çš„åŸºæœ¬éœ€æ±‚ï¼Œä¸‹é¢å¯ä»¥ä¸Šçº¿ä¸€ä¸ªåŸºæœ¬åŠŸèƒ½äº†ï¼Œç”¨æˆ·ç™»å½•ã€‚
æ‰€éœ€æ’ä»¶ï¼šFlask-Loginã€‚&lt;/p>
&lt;h4 id="usermixinç±»">UserMixinç±»&lt;/h4>
&lt;p>UserMixinç±»é›†æˆäº†loginæ’ä»¶è¦æ±‚çš„ç”¨æˆ·æ¨¡åž‹å±žæ€§ï¼Œå°†å…¶æ··å…¥åˆ° User æ¨¡åž‹ä¸­ï¼Œå³å¯ç”¨&lt;code>@login_required &lt;/code>å®žçŽ°æƒé™æŽ§åˆ¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">@app.route(&amp;#39;/result/&amp;#39;, methods=[&amp;#39;POST&amp;#39;]) # NOTEï¼šæœ‰é¡ºåºå…³ç³»ï¼Œåä¹‹åˆ™ä¸ç”Ÿæ•ˆ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@login_required
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”¨æˆ·ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç™»å½•ã€ç™»å‡ºã€æ³¨å†Œå‡ ä¸ªåŠŸèƒ½ã€‚ç¼–å†™è¿™äº›åŠŸèƒ½çš„æ­¥éª¤å…¶å®žå¾ˆç±»ä¼¼ï¼š&lt;/p>
&lt;ul>
&lt;li>è®¾è®¡æ•°æ®åº“ï¼Œåœ¨model.pyä¸­&lt;/li>
&lt;li>è®¾è®¡è¡¨å•å¯¹è±¡ï¼Œåœ¨form.pyä¸­&lt;/li>
&lt;li>è®¾è®¡é¡µé¢ï¼Œåœ¨æ¨¡æ¿.htmlä¸­&lt;/li>
&lt;li>è®¾è®¡è§†å›¾å‡½æ•°ï¼Œåœ¨routes.pyä¸­&lt;/li>
&lt;/ul>
&lt;p>ä¹Ÿå¯¹åº”äº†mvcæ¡†æž¶çš„è®¾è®¡ç†å¿µï¼Œæ¯”å¦‚è®¾è®¡è¡¨å•å°±æœ‰äº›åƒ javaweb ä¸­çš„ DAO å±‚ã€‚ä½†ä¹Ÿæœ‰åŒºåˆ«ï¼Œ Flask æ¡†æž¶æ›´å¸Œæœ›ä¸šåŠ¡é€»è¾‘å†™åœ¨æ•°æ®åº“æ¨¡åž‹ä¸­ï¼Œè€Œè§†å›¾å‡½æ•°å°½é‡ä¿æŒç®€æ´ï¼Œä»¥æ–¹ä¾¿å•å…ƒæµ‹è¯•ã€‚&lt;/p>
&lt;h4 id="prg-æ¨¡å¼">PRG æ¨¡å¼&lt;/h4>
&lt;p>å³ä¸º &lt;code>Post/Redirect/Get&lt;/code>ï¼Œå…¶æ ¼å¼å¤§æ¦‚å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@bp.route&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;/some_form&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">methods&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;GET&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;POST&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">some_form&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># prepare forms &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">form&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">validate_on_submit&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># submit modification&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">redirect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">url_for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;main.some_form&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">method&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;GET&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># GET data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render_template&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;some_form.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">form&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">form&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é»˜è®¤æƒ…å†µï¼Œæäº¤ POST è¯·æ±‚åŽï¼Œå¦‚æžœç›´æŽ¥åˆ·æ–°æµè§ˆå™¨ï¼Œä¼šé‡æ–°åœ¨ POST ä¸€æ¬¡ã€‚ä½¿ç”¨PRGæ¨¡å¼å³å¯è§£å†³é‡å¤æäº¤è¡¨å•çš„é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="0x04-æ·±å…¥æ•°æ®åº“ç²‰ä¸æœºåˆ¶">0x04 æ·±å…¥æ•°æ®åº“ï¼šç²‰ä¸æœºåˆ¶&lt;/h2>
&lt;h3 id="æ•°æ®åº“å…³ç³»">æ•°æ®åº“å…³ç³»&lt;/h3>
&lt;p>è¦å…³æ³¨åˆ«äººï¼Œå°±è¦è®©æ•°æ®åº“è®°ä½æˆ‘å…³æ³¨çš„äººçš„åå­—ï¼Œå½“ç„¶ï¼Œåªè®°ä½åå­—è‚¯å®šä¸å¤Ÿï¼Œä¸‡ä¸€æ”¹åäº†å‘¢ã€‚å› æ­¤æ¯ä¸ªç”¨æˆ·éƒ½éœ€è¦æœ‰å”¯ä¸€æœ‰æ•ˆçš„æ ‡è¯†ï¼ˆå…¶å®žæ›´é‡è¦çš„æ˜¯æ€§èƒ½å› ç´ ï¼‰ã€‚æ­£å› å¦‚æ­¤ï¼Œæ•°æ®åº“ä¸­æ¯ä¸ªè¡¨éƒ½è¦æœ‰ä¸€ä¸ªå”¯ä¸€çš„åˆ—ï¼Œç§°ä¸º&lt;strong>ä¸»é”®&lt;/strong>(primary key)ã€‚å½“ä¸åŒè¡¨ä¹‹é—´å­˜åœ¨å…³ç³»ï¼Œä¸€ä¸ªè¡¨è¦é€šè¿‡ä¸»é”®å¯»æ‰¾å…¶ä»–è¡¨é¡¹ï¼Œå…¶ä»–è¡¨çš„ä¸»é”®å‚¨å­˜åœ¨æœ¬è¡¨ä¸­ï¼Œç§°ä¸º&lt;strong>å¤–é”®&lt;/strong>(foreign key)ã€‚å¤–é”®å…³è”æ—¢å¯ä»¥è¡¨ç¤ºä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œä¹Ÿå¯ä»¥ä¸€å¯¹å¤š(1-&amp;gt;n)ã€‚&lt;/p>
&lt;p>SQLalchemy å¯¹å…³ç³»çš„å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>å¤–é”®ï¼š&lt;code>db.ForeignKey('user.id')&lt;/code>&lt;/li>
&lt;li>å…³ç³»ï¼š&lt;code>db.relationship('Post', backref='author', lazy='dynamic')&lt;/code>
&lt;ul>
&lt;li>å‚æ•°1ï¼šæ‰€å…³è”çš„è¡¨(n in 1-&amp;gt;n)ï¼Œè¿™é‡Œæ˜¯æ¨¡åž‹çš„å˜é‡å&lt;/li>
&lt;li>å‚æ•°2ï¼šç”± &amp;ldquo;n&amp;rdquo; å›žè°ƒ &amp;ldquo;1&amp;rdquo; çš„è™šæ‹Ÿå­—æ®µï¼Œç”¨æ³•ï¼š&lt;code>post.author&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="ç²‰ä¸æœºåˆ¶">ç²‰ä¸æœºåˆ¶&lt;/h3>
&lt;p>ç„¶è€Œï¼Œç²‰ä¸æœºåˆ¶åŒ…æ‹¬å…³æ³¨å’Œè¢«å…³æ³¨ã€‚è¿™æ˜¯ä¸€ç§å¤šå¯¹å¤šçš„å…³ç³»ï¼ŒäºŽæ˜¯éœ€è¦ç”¨å«æœ‰ä¸¤ä¸ªå¤–é”®çš„&lt;strong>å…³è”è¡¨&lt;/strong>è¡¨ç¤ºã€‚åˆå› ä¸ºå…³æ³¨è€…å’Œè¢«å…³æ³¨è€…åœ¨ä¸€ä¸ªè¡¨é‡Œï¼ˆUserï¼‰ï¼Œè¿™ç§å…³ç³»åˆç§°ä¸º&lt;strong>è‡ªå¼•ç”¨&lt;/strong>ã€‚&lt;/p>
&lt;h4 id="æ¨¡åž‹">æ¨¡åž‹&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>å…³è”è¡¨åªæœ‰å¼•ç”¨ç±»åž‹ï¼Œæ•…ä¸éœ€è¦æ´¾ç”Ÿæ¨¡åž‹ç±»&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">followers&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Table&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;followers&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;follower_id&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ForeignKey&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;user.id&amp;#39;&lt;/span>&lt;span class="p">)),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;followed_id&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ForeignKey&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;user.id&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ä¸ºUseræ·»åŠ å…³ç³»&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">followed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relationship&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;User&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># å³ä¾§å®žä½“&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">secondary&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">followers&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># æŒ‡å®šå…³è”è¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">primaryjoin&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">followers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">follower_id&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nb">id&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="c1"># æŒ‡å®šå·¦å…³ç³»&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">secondaryjoin&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">followers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">followed_id&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nb">id&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="c1"># æŒ‡å®šå³å…³ç³»&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">backref&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backref&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;followers&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lazy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;dynamic&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">lazy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;dynamic&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># æŒ‡å®šå›žè°ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="å¤æ‚æŸ¥è¯¢">å¤æ‚æŸ¥è¯¢&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>æŸ¥è¯¢ç²‰ä¸åˆ—è¡¨&lt;/p>
&lt;ul>
&lt;li>
&lt;p>SQL è¯­å¥ï¼š&lt;code>SELECT * FROM user, followers WHERE followers.follower_id = 3 AND followers.followed_id = user.id&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SQLalchemy æŽ¥å£ï¼š&lt;code>user.followers.all()&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®žé™…æ‰§è¡Œçš„ SQL è¯­å¥ï¼šï¼ˆæ‰“å° query å¯¹è±¡å¾—åˆ°ï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">SELECT ,,, FROM user, followers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WHERE followers.followed_id = ? AND followers.follower_id = user.id
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>NOTEï¼šå¦‚æžœæ–¹æ³•é›†æˆåœ¨modelé‡Œï¼Œæ–¹æ³•åä¸è¦å’Œå­—æ®µåç›¸åŒï¼Œè‡ªå·±å®šä¹‰çš„æ–¹æ³•ä¼šè¦†ç›–è¯¥å­—æ®µã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>æŸ¥çœ‹å·²å…³æ³¨ç”¨æˆ·çš„åŠ¨æ€&lt;/p>
&lt;ul>
&lt;li>
&lt;p>SQL è¯­å¥ï¼š&lt;code>SELECT * FROM post JOIN followers on followers.followed_id = post.user_id where followers.follower_id = 2&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SQLalchemy æŽ¥å£ï¼š&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Post&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">followers&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">followers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">followed_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Post&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="p">)).&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">followers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">follower_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">order_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Post&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">timestamp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">desc&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>å®žé™…æ‰§è¡Œçš„SQLè¯­å¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">,,,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">,,,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">post&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">JOIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">followers&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">followers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">followed_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">post&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">followers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">follower_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">UNION&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">post&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">post&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">anon_1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ORDER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">anon_1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">post_timestamp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DESC&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ç”±äºŽpythonçš„å¼±ç±»åž‹ç‰¹å¾ï¼Œæœ‰æ—¶å€™å¾ˆéš¾æ˜Žç™½å‡½æ•°ä¹‹é—´ä¼ é€’çš„æ˜¯ä»€ä¹ˆå¯¹è±¡ã€‚æˆ‘ä»¬ä»Žä¸Šå¾€ä¸‹æ¢³ç†ä¸€éï¼š&lt;/p>
&lt;ul>
&lt;li>è¯·æ±‚åˆ°è¾¾è·¯ç”±å‡½æ•°ï¼Œå¼€å§‹æ‰§è¡ŒæŸ¥è¯¢&lt;code>Post.query.....&lt;/code>ï¼Œæ­¤æ—¶åªæ˜¯åœ¨æž„é€ æŸ¥è¯¢ï¼Œå¹¶æœªå–å¾—æ•°æ®ï¼Œæ­¤æ—¶çš„å¯¹è±¡ç±»åž‹ï¼š&lt;code>&amp;lt;class 'sqlalchemy.orm.query.Query'&amp;gt;&lt;/code>&lt;/li>
&lt;li>ç›´åˆ°&lt;code>get()&lt;/code>,&lt;code>all()&lt;/code>,&lt;code>paginate().items&lt;/code>ç»“æŸç¬¦ç­‰å‡ºçŽ°ï¼ŒæŸ¥è¯¢æ‰è¢«æ‰§è¡Œï¼Œè¿”å›žæ•°æ®ç±»åž‹å®žä¾‹ï¼Œå¦‚Userã€‚&lt;/li>
&lt;li>æ•°æ®ç±»å®žä¾‹ä¼ å…¥æ¨¡æ¿ï¼Œå¹¶ç”±&lt;code>__str__&lt;/code>ç­‰æ–¹æ³•å‚ä¸Žæ¸²æŸ“ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="0x05-ç½‘ç«™ç¾ŽåŒ–">0x05 ç½‘ç«™ç¾ŽåŒ–&lt;/h2>
&lt;p>æœ¬æ•™ç¨‹æä¾›çš„flask-bootstrapæ’ä»¶ï¼Œè¾ƒä¸ºç®€é™‹ï¼Œä¸”è¯¥æ’ä»¶å¹´ä¹…å¤±ä¿®ï¼Œé‚æ›¿æ¢ä¹‹ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆæžæ˜Žç™½ç›®å‰é¡¹ç›®å‰ç«¯çš„æž¶æž„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/templates
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> auth/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> errors/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> base.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _posts.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ‰€æœ‰æ¨¡æ¿éƒ½æœ‰ä¸€ä¸ªçˆ¶æ¨¡ç‰ˆï¼š&lt;code>base.html&lt;/code>ï¼Œå…¶ç»“æž„å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">{% extends &amp;#39;bootstrap/base.html&amp;#39; %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{% block title %}Hallo Wolrd{% endblock %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{% block head %} ... {% endblock %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{% block scripts %} ... {% endblock %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{% block navbar %} ... {% endblock %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{% block content %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {% block app_content %}{% endblock %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{% endblock %}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>app_content&lt;/code>ç•™ç©ºï¼Œå³å…¶ä½™æ¨¡æ¿å‡åœ¨&lt;code>app_content&lt;/code>å†…å¡«å……ã€‚&lt;/p>
&lt;p>è¿›ä¸€æ­¥è¿½æº¯&lt;code>bootstrap/base.html&lt;/code>çš„æºç ï¼Œå‘çŽ°å…¶å®ƒ block è¯¸å¦‚&lt;code>navbar&lt;/code>ä¹Ÿéƒ½ç•™ç©ºæˆ–ä»…ä»…é…ç½®äº† Bootstrap çš„ cdnã€‚ ç”±æ­¤ï¼Œåªéœ€å°†&lt;code>base.html&lt;/code>è¿ç§»å³å¯ã€‚&lt;/p>
&lt;p>åœ¨ç½‘ä¸Šå¯»æ‰¾æ–°çš„UIæ¨¡æ¿ï¼Œä¸è¦åœ¨ä¸­æ–‡äº’è”ç½‘æœç´¢ï¼Œbasically garbageã€‚æ‰¾åˆ°ä¸€ä¸ª &lt;a class="link" href="https://demos.creative-tim.com/material-kit/index.html" target="_blank" rel="noopener"
>Meterial æ¨¡æ¿&lt;/a> è¿˜ç®—é¡ºçœ¼ï¼Œé‚ç”¨ä¹‹ã€‚&lt;/p>
&lt;p>ä¸ç†Ÿæ‚‰ Bootstrap å¸ƒå±€çš„å¯ä»¥ä½¿ç”¨å¯è§†åŒ–å·¥å…·æ¥è®¾è®¡å‰ç«¯ï¼Œå¦‚ï¼šhttp://www.ibootstrap.cn/&lt;/p>
&lt;p>å¯¹ç…§æ¨¡æ¿ï¼Œå°†&lt;code>base.html&lt;/code>æŽç©ºï¼Œæ•ˆæžœå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://lonelyuan.github.io/post-images/1631795716824.png"
loading="lazy"
>&lt;/p>
&lt;p>é‡åˆ°çš„bugæœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸‹æ‹‰èœå•å¤±æ•ˆï¼šæŸ¥è¯¢å¾—çŸ¥æœ‰å¯èƒ½æ˜¯bootstrapç‰ˆæœ¬å†²çª
&lt;ul>
&lt;li>//ç»“æžœå¹¶ä¸æ˜¯ï¼Œåªæ˜¯å¿˜è®°å¼•å…¥jsæ–‡ä»¶è€Œå·²ï¼Œæˆ‘æ˜¯å‚»é€¼ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æ–‡ä»¶ä¸Šä¼ æŒ‰é’®æ¶ˆå¤±ï¼šæœ¬æ•™ç¨‹ä¸­ï¼Œè¡¨å•æ¸²æŸ“é‡‡ç”¨&lt;code>wtf.quick_form()&lt;/code>ï¼Œè¿™çŽ©æ„è¿˜æ˜¯æ¥è‡ª&lt;code>bootstrap/wtf.html&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æœ€åŽå†³å®šæ•´ä¸ªðŸäº† Flask-Bootstrap æ’ä»¶ã€‚&lt;/p>
&lt;h4 id="å¯Œæ–‡æœ¬ç¼–è¾‘å™¨">å¯Œæ–‡æœ¬ç¼–è¾‘å™¨&lt;/h4>
&lt;p>åœ¨ã€ŠFlask Webå¼€å‘ï¼šåŸºäºŽPythonçš„Webåº”ç”¨å¼€å‘å®žæˆ˜ã€‹ä¸­æåˆ°äº†markdownç¼–è¾‘å™¨çš„å®žçŽ°ã€‚&lt;/p>
&lt;p>éœ€è¦çš„åŒ…ï¼š&lt;/p>
&lt;ul>
&lt;li>PageDown: JS ç‰ˆ Markdown æ¸²æŸ“å™¨ï¼Œç”¨äºŽå®¢æˆ·ç«¯é¢„è§ˆã€‚&lt;/li>
&lt;li>Flask-PageDown: flask é›†æˆæ’ä»¶ã€‚è¯¥æ’ä»¶éœ€è¦æ³¨å†Œ&lt;/li>
&lt;li>Markdown: Python ç‰ˆ Markdown æ¸²æŸ“å™¨ï¼Œç”¨äºŽæœåŠ¡ç«¯æ¸²æŸ“ã€‚&lt;/li>
&lt;li>Bleach: HTML æ¸…ç†å™¨ï¼Œä¿è¯å®‰å…¨æ€§&lt;/li>
&lt;/ul>
&lt;p>ä¸ºäº†å…¼é¡¾å®‰å…¨å’Œæ•ˆçŽ‡ï¼Œåšæ³•æ˜¯åŒæ—¶ä¿å­˜ markdown æºæ–‡æœ¬å’Œ HTML æ–‡ä»¶ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>è¡¨å•æ”¹ä¸º &lt;code>PageDownField&lt;/code>&lt;/li>
&lt;li>æ¨¡æ¿å¼•å…¥ PageDown å®ï¼Œä»¥å®žçŽ°å³æ—¶é¢„è§ˆ&lt;/li>
&lt;li>ä¸º Post æ¨¡åž‹å¢žåŠ å­—æ®µï¼Œå¹¶æ·»åŠ  markdown æ¸²æŸ“æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸ºç±»æ–¹æ³•ï¼Œéœ€è¦&lt;code>@staticmethod&lt;/code>ä¿®é¥°&lt;/li>
&lt;li>åœ¨æ¨¡åž‹å¤–éƒ¨ç›‘å¬æ•°æ®åº“äº‹ä»¶ï¼Œä»…å½“ markdown æ–‡æœ¬å‡ºçŽ°å˜åŠ¨æ—¶è°ƒç”¨æ¸²æŸ“æ–¹æ³•ã€‚&lt;/li>
&lt;li>ä¿®æ”¹æ¨¡æ¿ä»¥æ˜¾ç¤ºæœåŠ¡ç«¯è¿”å›žçš„ html æ–‡æœ¬&lt;/li>
&lt;/ul>
&lt;p>ç„¶è€Œé¢„è§ˆå™¨è¿‡äºŽç®€é™‹ï¼Œä¹Ÿå¾ˆéš¾ä¿®æ”¹ã€‚åœ¨githubä»“åº“ä¸Šå‘çŽ°è¯¥æ’ä»¶ä¹Ÿæ˜¯æœ¬æ•™ç¨‹ä½œè€…å†™çš„ï¼Œå·²ç»å¾ˆä¹…æ²¡æœ‰ç»´æŠ¤ã€‚é¡¿æ—¶å¯¹æœ¬ä¹¦ä½œè€…æœ‰äº›ä¸æ»¡ã€‚&lt;/p>
&lt;h2 id="0x06-æ¨¡å—åŒ–åº”ç”¨åŠŸèƒ½è§£è€¦">0x06 æ¨¡å—åŒ–åº”ç”¨ï¼šåŠŸèƒ½è§£è€¦&lt;/h2>
&lt;p>ä¿æŒ app ä½œä¸ºå…¨å±€å˜é‡çš„æ¨¡å¼ï¼Œå¯èƒ½ä¼šç»™åŽç»­å¼•å…¥æ–°åŠŸèƒ½å’Œå•å…ƒæµ‹è¯•å¸¦æ¥éº»çƒ¦ã€‚
è¦é€‚åº”å¤§åž‹é¡¹ç›®éœ€æ±‚ï¼Œéœ€è¦æŠŠç½‘ç«™åŠŸèƒ½æ‹†åˆ†æˆç‹¬ç«‹çš„æ¨¡å—ã€‚&lt;/p>
&lt;h3 id="blueprintåŒ–">BlueprintåŒ–&lt;/h3>
&lt;p>è¦å®žçŽ°è§£è€¦ï¼Œä¸€ç§åŠŸèƒ½çš„ç›¸å…³ä»£ç å¯ä»¥å€ŸåŠ©Blueprintå½’ç±»åˆ°ä¸€ä¸ªåŒ…é‡Œã€‚å…¶æ–‡ä»¶ç»“æž„å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">app/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> some_fuction/ &amp;lt;-- blueprint package
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> __init__.py &amp;lt;-- blueprint creation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ... other code ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> templates/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> some_fuction/ &amp;lt;-- templates
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> __init__.py &amp;lt;-- blueprint registration
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åˆ›å»ºblueprintä¸Žåˆ›å»ºåº”ç”¨éžå¸¸ç›¸ä¼¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">flask&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Blueprint&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Blueprint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;func&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="vm">__name__&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">app.func&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Func&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è€Œæ¶ˆç­äº†&lt;code>app&lt;/code>ï¼Œè“å›¾å†…éƒ¨çš„å¼•ç”¨ç»Ÿä¸€å˜æˆäº†è“å›¾åã€‚è€Œå¤–éƒ¨è¯¸å¦‚&lt;code>url_for&lt;/code>çš„å‚æ•°åˆ™éœ€è¦åŠ ä¸Š&lt;code>åŒ…å.&lt;/code>åšå‰ç¼€ã€‚&lt;/p>
&lt;h3 id="åº”ç”¨å·¥åŽ‚æ¨¡å¼">åº”ç”¨å·¥åŽ‚æ¨¡å¼&lt;/h3>
&lt;p>å·¥åŽ‚å‡½æ•°æ˜¯ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨æ‰§è¡Œæ’ä»¶æ³¨å†Œå’Œé…ç½®å·¥ä½œï¼Œå¹¶é€šè¿‡ä»–è¿”å›žåº”ç”¨å®žä¾‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># app/__init__.py&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SQLAlchemy&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">create_app&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">Config&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">app&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Flask&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="vm">__name__&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">app&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_object&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_class&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">init_app&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿”å›žåŽï¼Œflaskæä¾›çš„ä¸Šä¸‹æ–‡å¯¹è±¡&lt;code>current_app&lt;/code>å°†æŒ‡å‘åº”ç”¨å®žä¾‹ã€‚è¯¦è§å®˜æ–¹æ–‡æ¡£ï¼š&lt;a class="link" href="http://docs.jinkan.org/docs/flask/appcontext.html" target="_blank" rel="noopener"
>åº”ç”¨ä¸Šä¸‹æ–‡&lt;/a>&lt;/p>
&lt;h4 id="å¤šçº¿ç¨‹">å¤šçº¿ç¨‹&lt;/h4>
&lt;p>&lt;code>current_app&lt;/code>æ˜¯çº¿ç¨‹ç»‘å®šçš„ï¼Œè‹¥è¦åœ¨è¯¸å¦‚é‚®ä»¶æœåŠ¡çš„ä½äºŽå…¶ä»–çº¿ç¨‹çš„åŠŸèƒ½è°ƒç”¨ä»–ï¼Œåˆ™ä¼šå‘çŽ°æ²¡æœ‰èµ‹å€¼ã€‚
éœ€è¦ä½¿ç”¨&lt;code>current_app._get_current_object()&lt;/code>è¡¨è¾¾å¼ã€‚&lt;/p>
&lt;h4 id="pythonæ¦‚å¿µè¾¨æžåŒ…åº“æ’ä»¶">Pythonæ¦‚å¿µè¾¨æžï¼šåŒ…ï¼Œåº“ï¼Œæ’ä»¶&lt;/h4>
&lt;blockquote>
&lt;p>åŒ… (package) æ˜¯æŒ‡ä¸€ç§ä»£ç ç»“æž„ï¼Œåªè¦æœ‰æ–‡ä»¶å¤¹å’Œ &lt;code>__init__.py&lt;/code> éƒ½æ˜¯åŒ…ã€‚
åº“ (library) å’Œæ’ä»¶ (plugin) éƒ½æ˜¯ä»Žå¤–éƒ¨å¼•å…¥çš„åŒ…ï¼ŒåŒºåˆ«åœ¨äºŽï¼Œæ’ä»¶è¦é›†æˆè¿›åº”ç”¨ï¼Œæ‰€ä»¥éœ€è¦æ³¨å†Œç­‰æ­¥éª¤ï¼›è€Œåº“æ›´ç‹¬ç«‹ï¼Œå¯ä»¥éšæ—¶éšåœ°è°ƒç”¨&lt;/p>
&lt;/blockquote>
&lt;h2 id="0x07-å¼€å‘å¸®æ‰‹">0x07 å¼€å‘å¸®æ‰‹&lt;/h2>
&lt;p>æœ¬èŠ‚è®²è§£ä¸€äº›æ‚é¡¹ã€‚&lt;/p>
&lt;h4 id="è°ƒè¯•">è°ƒè¯•&lt;/h4>
&lt;ul>
&lt;li>&lt;code>flask shell&lt;/code>å‘½ä»¤ï¼šä¸ºé¿å…æ¯æ¬¡è°ƒè¯•éƒ½è¦é‡æ–°import appï¼Œä½¿ç”¨ä¸Šä¸‹æ–‡è°ƒç”¨è§£é‡Šå™¨ï¼Œç”¨&lt;code>@app.shell_context_processor&lt;/code>è£…é¥°ä¸Šä¸‹æ–‡å‡½æ•°&lt;/li>
&lt;/ul>
&lt;h4 id="å•å…ƒæµ‹è¯•">å•å…ƒæµ‹è¯•&lt;/h4>
&lt;p>unittest åº“ï¼Œè¯¦è§&lt;a class="link" href="" >ä¸‹ä¸€ç¯‡&lt;/a>ã€‚&lt;/p>
&lt;h4 id="è®°å½•æ—¥å¿—åˆ°æ–‡ä»¶">è®°å½•æ—¥å¿—åˆ°æ–‡ä»¶&lt;/h4>
&lt;p>logger åº“&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">app&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">debug&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exists&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;logs&amp;#39;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mkdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;logs&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_handler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RotatingFileHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;logs/microblog.log&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">maxBytes&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10240&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">backupCount&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_handler&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setFormatter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Formatter&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="si">%(asctime)s&lt;/span>&lt;span class="s1"> &lt;/span>&lt;span class="si">%(levelname)s&lt;/span>&lt;span class="s1">: &lt;/span>&lt;span class="si">%(message)s&lt;/span>&lt;span class="s1"> [in &lt;/span>&lt;span class="si">%(pathname)s&lt;/span>&lt;span class="s1">:&lt;/span>&lt;span class="si">%(lineno)d&lt;/span>&lt;span class="s1">]&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_handler&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setLevel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">INFO&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">app&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">logger&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">addHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_handler&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">app&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">logger&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setLevel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">INFO&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">app&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">logger&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Microblog startup&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="requirementtxt">requirement.txt&lt;/h4>
&lt;p>è£…çš„åº“å¤ªå¤šæ€Žä¹ˆåŠžï¼Ÿåªéœ€è¦ä¸¤æ¡å‘½ä»¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">pip freeze &amp;gt; requirements.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip install -r requirements.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="0x08-ç½‘ç«™ä¸Šçº¿">0x08 ç½‘ç«™ä¸Šçº¿&lt;/h2>
&lt;p>æœ€åŽç®€å•åˆ—å‡ºå‡ ç§ç½‘ç«™éƒ¨ç½²çš„æ–¹æ³•ï¼Œè¯¦æƒ…å‚è€ƒæœ¬æ•™ç¨‹æˆ–è‡ªè¡Œæœç´¢ã€‚&lt;/p>
&lt;h4 id="nativeæ¨¡å¼">nativeæ¨¡å¼&lt;/h4>
&lt;ul>
&lt;li>ä¹°ä¸»æœº
&lt;ul>
&lt;li>è¿žä¸»æœºï¼šssh&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä¹°åŸŸå
&lt;ul>
&lt;li>é…åŸŸå&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>é…çŽ¯å¢ƒ
&lt;ul>
&lt;li>æ•°æ®åº“&lt;/li>
&lt;li>æœåŠ¡å™¨&lt;/li>
&lt;li>å…¶ä»–ä¾èµ–&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æŒç»­è¿ç»´&lt;/li>
&lt;/ul>
&lt;h4 id="å®¹å™¨åŒ–æŠ€æœ¯docker">å®¹å™¨åŒ–æŠ€æœ¯ï¼šdocker&lt;/h4>
&lt;ul>
&lt;li>å†™dockerfile&lt;/li>
&lt;li>docker-compose up &amp;ndash;build -d&lt;/li>
&lt;/ul>
&lt;h4 id="äº‘æŠ€æœ¯paas">äº‘æŠ€æœ¯ï¼šPaaS&lt;/h4>
&lt;ul>
&lt;li>æ³¨å†Œäº‘å¹³å°è´¦æˆ·&lt;/li>
&lt;li>å†™Procfile&lt;/li>
&lt;li>git push&lt;/li>
&lt;/ul></description></item></channel></rss>