<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='本文为 Flask 框架学习笔记，主要参考了 The-Flask-Mega-Tutorial 和 《Flask Web开发：基于Python的Web应用开发实战》两本书，并在原项目的基础上拓展。（下文统称'>
<title>年轻人的第二个网站 - The Flask Mega Tutorial</title>

<link rel='canonical' href='https://lonelyuan.github.io/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99-the-flask-mega-tutorial/'>

<link rel="stylesheet" href="/scss/style.min.24ef1cc321916467896e8c70c10c0ad7b98c2a8df14298032fb637216e397f50.css"><meta property='og:title' content='年轻人的第二个网站 - The Flask Mega Tutorial'>
<meta property='og:description' content='本文为 Flask 框架学习笔记，主要参考了 The-Flask-Mega-Tutorial 和 《Flask Web开发：基于Python的Web应用开发实战》两本书，并在原项目的基础上拓展。（下文统称'>
<meta property='og:url' content='https://lonelyuan.github.io/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99-the-flask-mega-tutorial/'>
<meta property='og:site_name' content='lonelyuan&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='flask' /><meta property='article:published_time' content='2021-09-09T20:18:56&#43;00:00'/><meta property='article:modified_time' content='2021-09-09T20:18:56&#43;00:00'/><meta property='og:image' content='https://lonelyuan.github.io/' />
<meta name="twitter:title" content="年轻人的第二个网站 - The Flask Mega Tutorial">
<meta name="twitter:description" content="本文为 Flask 框架学习笔记，主要参考了 The-Flask-Mega-Tutorial 和 《Flask Web开发：基于Python的Web应用开发实战》两本书，并在原项目的基础上拓展。（下文统称"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://lonelyuan.github.io/' />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BLVC1PKZKD"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-BLVC1PKZKD', { 'anonymize_ip': false });
}
</script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-BLVC1PKZKD', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/rick_hubede16acaa63e012983e5eadbe210d5c_33168_300x0_resize_q75_box.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">👴</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">lonelyuan&#39;s Blog</a></h1>
            <h2 class="site-description"> &gt;&gt; 不要恐慌 | Don&#39;t Panic </h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/lonelyuan'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/FTrumpyeah'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about-me/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About Me</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/categories/cs/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                
                <span>CS</span>
            </a>
        </li>
        
        
        <li >
            <a href='/categories/ctf/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M9.828 9.172a4 4 0 1 0 0 5.656 a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828 a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828" />
</svg>



                
                <span>CTF</span>
            </a>
        </li>
        
        
        <li >
            <a href='/categories/sec/' >
                
                
                
                    <svg data-immersive-translate-effect="1" data-immersive_translate_walked="0b66fd33-9d65-4c0d-a958-cdfe41102bc1" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" data-immersive-translate-effect="1" data-immersive_translate_walked="0b66fd33-9d65-4c0d-a958-cdfe41102bc1"></path>
</svg>
                
                <span>Sec</span>
            </a>
        </li>
        
        
        <li >
            <a href='/todo/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                
                <span>TODO</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                <form action="/search/" class="search-form widget" >
        <p>
            <label>Search</label>
            <input name="keyword" required placeholder="Type something..." />
        
            <button title="Search">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



            </button>
        </p>
    </form>
            
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#0x00-大型项目结构">0x00 大型项目结构</a></li>
    <li><a href="#0x01-hello-world模板和视图">0x01 Hello world：模板和视图</a>
      <ol>
        <li>
          <ol>
            <li><a href="#路由视图">路由/视图</a></li>
            <li><a href="#表单">表单</a></li>
            <li><a href="#flash-闪现消息">flash 闪现消息</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#0x02-数据库-orm">0x02 数据库 ORM</a>
      <ol>
        <li><a href="#sqlalchemymodel层">SQLalchemy：model层</a>
          <ol>
            <li><a href="#模型定义">模型定义</a></li>
            <li><a href="#curd基本操作">CURD基本操作</a></li>
          </ol>
        </li>
        <li><a href="#flask-migrate-数据库迁移">Flask-Migrate: 数据库迁移</a></li>
      </ol>
    </li>
    <li><a href="#0x03-开发范式用户系统">0x03 开发范式：用户系统</a>
      <ol>
        <li>
          <ol>
            <li><a href="#usermixin类">UserMixin类</a></li>
            <li><a href="#prg-模式">PRG 模式</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#0x04-深入数据库粉丝机制">0x04 深入数据库：粉丝机制</a>
      <ol>
        <li><a href="#数据库关系">数据库关系</a></li>
        <li><a href="#粉丝机制">粉丝机制</a>
          <ol>
            <li><a href="#模型">模型</a></li>
            <li><a href="#复杂查询">复杂查询</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#0x05-网站美化">0x05 网站美化</a>
      <ol>
        <li>
          <ol>
            <li><a href="#富文本编辑器">富文本编辑器</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#0x06-模块化应用功能解耦">0x06 模块化应用：功能解耦</a>
      <ol>
        <li><a href="#blueprint化">Blueprint化</a></li>
        <li><a href="#应用工厂模式">应用工厂模式</a>
          <ol>
            <li><a href="#多线程">多线程</a></li>
            <li><a href="#python概念辨析包库插件">Python概念辨析：包，库，插件</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#0x07-开发帮手">0x07 开发帮手</a>
      <ol>
        <li>
          <ol>
            <li><a href="#调试">调试</a></li>
            <li><a href="#单元测试">单元测试</a></li>
            <li><a href="#记录日志到文件">记录日志到文件</a></li>
            <li><a href="#requirementtxt">requirement.txt</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#0x08-网站上线">0x08 网站上线</a>
      <ol>
        <li>
          <ol>
            <li><a href="#native模式">native模式</a></li>
            <li><a href="#容器化技术docker">容器化技术：docker</a></li>
            <li><a href="#云技术paas">云技术：PaaS</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
            
                <section class="widget tagCloud">
    <div class="widget-icon">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



    </div>
    <h2 class="widget-title section-title">Categories</h2>

    <div class="tagCloud-tags">
        
            <a href="/categories/cs/" class="font_size_9">
                CS
            </a>
        
            <a href="/categories/sec/" class="font_size_3">
                Sec
            </a>
        
            <a href="/categories/web/" class="font_size_3">
                Web
            </a>
        
            <a href="/categories/ctf/" class="font_size_1">
                CTF
            </a>
        
    </div>
</section>

            
        
            
                <section class="widget tagCloud">
    <div class="widget-icon">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11 3L20 12a1.5 1.5 0 0 1 0 2L14 20a1.5 1.5 0 0 1 -2 0L3 11v-4a4 4 0 0 1 4 -4h4" />
  <circle cx="9" cy="9" r="2" />
</svg>



    </div>
    <h2 class="widget-title section-title">Tags</h2>

    <div class="tagCloud-tags">
        
            <a href="/tags/csapp/" class="font_size_3">
                CSAPP
            </a>
        
            <a href="/tags/fuzz/" class="font_size_3">
                fuzz
            </a>
        
            <a href="/tags/fuzzing101/" class="font_size_3">
                fuzzing101
            </a>
        
            <a href="/tags/libafl/" class="font_size_3">
                Libafl
            </a>
        
            <a href="/tags/rust/" class="font_size_3">
                rust
            </a>
        
    </div>
</section>
            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/web/" >
                Web
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99-the-flask-mega-tutorial/">年轻人的第二个网站 - The Flask Mega Tutorial</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2021-9-9&nbsp;published
                </time></time> 
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    11 minute read
                    <span class="post-word-count">, 5252 words</span> 
                </time>
            </div>
            
        

    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <blockquote>
<p>本文为 Flask 框架学习笔记，主要参考了 <a class="link" href="https://luhuisicnu.gitbook.io/the-flask-mega-tutorial-zh"  target="_blank" rel="noopener"
    >The-Flask-Mega-Tutorial</a> 和 《Flask Web开发：基于Python的Web应用开发实战》两本书，并在原项目的基础上拓展。（下文统称这两个资源为“本教程”）
不熟悉 Flask 框架请先阅读<a class="link" href="https://dormousehole.readthedocs.io/en/latest/quickstart.html"  target="_blank" rel="noopener"
    >快速上手 - flask 中文文档</a> 。</p>
<p>这两本书的作者是同一个人，就内容上说后者算是前者的豪华版。本教程的优点是内容全面，从入门到部署一站式服务；缺点是不够深入，且有些过时，书中举例的诸多插件均为作者为了此书而开发的，已经许久不再维护，导致很难在其示例项目上拓展。一看扉页，2015年出版，那没事了。
至于第一个网站？参见<a class="link" href="#%e6%88%91%e8%bf%98%e6%b2%a1%e5%86%99%e5%91%a2" >#TODO:年轻人的第一个网站</a></p>
</blockquote>
<hr>
<h2 id="0x00-大型项目结构">0x00 大型项目结构</h2>
<p>在大部分面向初学者的 demo 中，应用以简单的项目结构甚至单文件表示。在大型项目中，网站的不同功能被拆分成独立的模块，以方便拓展和维护。一个更通用的 Flask 项目代码架构如下：（仅考虑业务代码）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">microblog/ # 根目录
</span></span><span class="line"><span class="cl">  app/ # 项目源码
</span></span><span class="line"><span class="cl">    __init__.py # 项目初始化，当该包被import，首先执行__init__.py
</span></span><span class="line"><span class="cl">    routes.py
</span></span><span class="line"><span class="cl">    forms.py
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">  main.py # 框架入口
</span></span><span class="line"><span class="cl">  config.py # Config配置类
</span></span><span class="line"><span class="cl">  .flaskenv
</span></span><span class="line"><span class="cl">  ...
</span></span></code></pre></td></tr></table>
</div>
</div><p>根目录下的文件有：</p>
<ul>
<li><code>app/</code>所有网站源代码统一归到app目录下。
<ul>
<li>在<code>app/</code>内部，不同的功能可进一步划分成独立模块，详见[模块化应用](#0x05 模块化应用：功能解耦)一章。</li>
</ul>
</li>
<li><code>main.py</code>: 入口脚本，通过该文件引入app中的代码并生成应用实例（命名随意）</li>
<li><code>.flaskenv</code>: flask环境变量，以配合flask命令。入口脚本被定义为<code>FLASK_APP</code>，执行<code>flask run</code>时将启动该脚本。</li>
<li><code>config.py</code>: 配置脚本，整个项目的配置信息都写在Config类里。与环境变量的区别在于，因为是python脚本，功能更强大，可被任何地方的代码引用。</li>
</ul>
<h2 id="0x01-hello-world模板和视图">0x01 Hello world：模板和视图</h2>
<p>最基本的 web 功能，无非接受请求、返回数据。其中，路由 (route) 用来区分不同的请求，模板 (templates) 用来生成不同的数据。</p>
<h4 id="路由视图">路由/视图</h4>
<p>在非前后端分离的项目中，视图函数直接返回渲染好的网页，由<code>@app.route()</code>修饰后，视图和路由便绑定在一起。
在mvc模型中更像controller控制器的角色，然而在flask生态中更喜欢称为视图函数。</p>
<ul>
<li><code>url_for()</code> 使用URL到视图函数的内部映射关系来生成URL，用来替换硬链接。在业务功能解耦后必须使用这种方式。
<ul>
<li>NOTE：当路由和视图函数名不一致，访问该路由可以正确响应，但是使用<code>url_for()</code>调用该视图时会报错</li>
</ul>
</li>
<li><code>{% extends &quot;base.html&quot; %}</code> and <code>{% include &quot;_post.html&quot; %}</code> 使用子模板来实现网页公用的部分。如：页眉，页脚，列表项等。
<ul>
<li>模板和 Python 代码的关系有些类似与 JSP 和 Java 代码的关系，但模板语法并不是完整的脚本语言，相较而言限制更多，安全性更好。</li>
</ul>
</li>
</ul>
<h4 id="表单">表单</h4>
<blockquote>
<p>几乎所有成功的框架都有丰富的插件生态。下面引入新功能时，大多借助插件来方便的实现。大多数Flask插件使用<code>flask_&lt;name&gt;</code> 命名约定。</p>
</blockquote>
<p>Flask-WTF插件提供了对Web表单的抽象，只需定义表单类以及设置类属性即可。</p>
<p>模板语法：</p>
<ul>
<li><code>{{ form.&lt;name&gt;.label }}</code>渲染标签</li>
<li><code>{{ form.&lt;name&gt;() }}</code>获取属性值</li>
<li><code>form.hidden_tag()</code>模板参数生成了一个隐藏字段，其中包含一个用于保护表单免受CSRF攻击的token</li>
</ul>
<p>将表单引入模板</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span> <span class="c1"># 生成了一个实例传入模板</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Sign In&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="flash-闪现消息">flash 闪现消息</h4>
<p>flash 通过 session 储存，用于显示只出现一次的提示消息。用法：</p>
<ul>
<li>在路由中使用<code>flash()</code>，触发时消息便写入 session 中的 message 列表</li>
<li>在模板中使用<code>get_flashed_messages()</code>，从 session 中读取</li>
</ul>
<h2 id="0x02-数据库-orm">0x02 数据库 ORM</h2>
<p>很久很久以前，web网站和数据库交互还需要写很多很硬的 SQL 语句，效率低且容易出现注入漏洞(SQLi)。现代web开发都使用 ORM 框架简化数据库交互，且基本杜绝了 SQLi 漏洞。</p>
<p>本项目使用如下插件打通数据库：</p>
<ul>
<li>Flask-SQLAlchemy: Python生态最知名的ORM框架</li>
<li>Flask-Migrate: 本教程作者编写的数据库迁移框架</li>
</ul>
<blockquote>
<p>插件首先要注册。统一流程: 初始化app实例，传入插件类作为插件实例的参数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># app/__init__.py</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span> <span class="c1"># flask基类</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">Config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">migrate</span> <span class="o">=</span> <span class="n">Migrate</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<h3 id="sqlalchemymodel层">SQLalchemy：model层</h3>
<h4 id="模型定义">模型定义</h4>
<p>使用类和类属性代表 table 和 colunm ，便可轻松编写数据模型。SQLalchemy 的概念抽象如下图：
<img src="/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99-the-flask-mega-tutorial/1631793936306.png"
	width="760"
	height="229"
	srcset="/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99-the-flask-mega-tutorial/1631793936306_hu7f25cecc8aefde770917be517cb2f54b_27444_480x0_resize_box_3.png 480w, /p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99-the-flask-mega-tutorial/1631793936306_hu7f25cecc8aefde770917be517cb2f54b_27444_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="331"
		data-flex-basis="796px"
	
></p>
<p>Flask-SQLAlchemy 自动设置类名为小写来作为对应表的名称，也可以用<code>__tablename__</code>类属性来定义。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span> <span class="c1"># 表</span>
</span></span><span class="line"><span class="cl">    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 列</span>
</span></span><span class="line"><span class="cl">    <span class="o">....</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="curd基本操作">CURD基本操作</h4>
<p>ORM 框架通常集成了常用操作，但也支持更底层的数据库接口。</p>
<blockquote>
<p>在 Springboot Jpa 中，根据方法名的拼写来写自定义查询，而在 SQLalchemy 中，提供的接口通过链式调用拼接。</p>
</blockquote>
<p>在 SQLalchemy 中，基本操作大都有基于事务 (session) 的和基于查询 (query) 的两种方式。</p>
<ul>
<li>
<p>查</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>query方法只有构造一个查询，只有在<code>Query.get()</code>、<code>Query.all()</code>、<code>Query.one()</code>等结束符之后才会执行查询</p>
</li>
<li>
<p>增：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>删</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># or</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>改</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">session</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">+</span> <span class="s2">&#34;a&#34;</span><span class="p">},</span> <span class="n">synchronize_session</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># or</span>
</span></span><span class="line"><span class="cl"><span class="n">user</span> <span class="o">=</span> <span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s2">&#34;zxcv&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="flask-migrate-数据库迁移">Flask-Migrate: 数据库迁移</h3>
<p>配置数据库的初始数据框架，一般写成SQL脚本形式。
migrate 框架直接根据 model 层生成迁移脚本，可以方便的跟踪数据模型的修改和数据库的切换。（这个框架还是本教程作者自己开发的，强）</p>
<p>flask db子命令</p>
<ul>
<li><code>flask db init</code>：初始化，生成migrations目录</li>
<li><code>flask db migrate</code>：生成迁移脚本，修改model后使其生效
<ul>
<li><code>flask db migrate -m &quot;posts table&quot; </code></li>
</ul>
</li>
<li><code>flask db upgrade</code>：应用数据库修改（开发阶段默认使用sqlite数据库</li>
<li><code>flask db downgrade</code>：回滚上次的迁移</li>
</ul>
<h2 id="0x03-开发范式用户系统">0x03 开发范式：用户系统</h2>
<blockquote>
<p>mixin：混入，多重继承的一种形式</p>
</blockquote>
<p>表单和数据库支持分别解决了前端和后端的基本需求，下面可以上线一个基本功能了，用户登录。
所需插件：Flask-Login。</p>
<h4 id="usermixin类">UserMixin类</h4>
<p>UserMixin类集成了login插件要求的用户模型属性，将其混入到 User 模型中，即可用<code>@login_required </code>实现权限控制。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@app.route(&#39;/result/&#39;, methods=[&#39;POST&#39;]) # NOTE：有顺序关系，反之则不生效
</span></span><span class="line"><span class="cl">@login_required 
</span></span></code></pre></td></tr></table>
</div>
</div><p>用户系统，包括登录、登出、注册几个功能。编写这些功能的步骤其实很类似：</p>
<ul>
<li>设计数据库，在model.py中</li>
<li>设计表单对象，在form.py中</li>
<li>设计页面，在模板.html中</li>
<li>设计视图函数，在routes.py中</li>
</ul>
<p>也对应了mvc框架的设计理念，比如设计表单就有些像 javaweb 中的 DAO 层。但也有区别， Flask 框架更希望业务逻辑写在数据库模型中，而视图函数尽量保持简洁，以方便单元测试。</p>
<h4 id="prg-模式">PRG 模式</h4>
<p>即为 <code>Post/Redirect/Get</code>，其格式大概如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@bp.route</span><span class="p">(</span><span class="s1">&#39;/some_form&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">some_form</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># prepare forms </span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># submit modification</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;main.some_form&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    	<span class="c1"># GET data</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;some_form.html&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>默认情况，提交 POST 请求后，如果直接刷新浏览器，会重新在 POST 一次。使用PRG模式即可解决重复提交表单的问题。</p>
<h2 id="0x04-深入数据库粉丝机制">0x04 深入数据库：粉丝机制</h2>
<h3 id="数据库关系">数据库关系</h3>
<p>要关注别人，就要让数据库记住我关注的人的名字，当然，只记住名字肯定不够，万一改名了呢。因此每个用户都需要有唯一有效的标识（其实更重要的是性能因素）。正因如此，数据库中每个表都要有一个唯一的列，称为<strong>主键</strong>(primary key)。当不同表之间存在关系，一个表要通过主键寻找其他表项，其他表的主键储存在本表中，称为<strong>外键</strong>(foreign key)。外键关联既可以表示一对一的关系，也可以一对多(1-&gt;n)。</p>
<p>SQLalchemy 对关系的定义如下：</p>
<ul>
<li>外键：<code>db.ForeignKey('user.id')</code></li>
<li>关系：<code>db.relationship('Post', backref='author', lazy='dynamic')</code>
<ul>
<li>参数1：所关联的表(n in 1-&gt;n)，这里是模型的变量名</li>
<li>参数2：由 &ldquo;n&rdquo; 回调 &ldquo;1&rdquo; 的虚拟字段，用法：<code>post.author</code></li>
</ul>
</li>
</ul>
<h3 id="粉丝机制">粉丝机制</h3>
<p>然而，粉丝机制包括关注和被关注。这是一种多对多的关系，于是需要用含有两个外键的<strong>关联表</strong>表示。又因为关注者和被关注者在一个表里（User），这种关系又称为<strong>自引用</strong>。</p>
<h4 id="模型">模型</h4>
<ul>
<li>
<p>关联表只有引用类型，故不需要派生模型类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">followers</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;followers&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;follower_id&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.id&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;followed_id&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.id&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>为User添加关系</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">followed</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="c1"># 右侧实体</span>
</span></span><span class="line"><span class="cl">    <span class="n">secondary</span><span class="o">=</span><span class="n">followers</span><span class="p">,</span> <span class="c1"># 指定关联表</span>
</span></span><span class="line"><span class="cl">    <span class="n">primaryjoin</span><span class="o">=</span><span class="p">(</span><span class="n">followers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">follower_id</span> <span class="o">==</span> <span class="nb">id</span><span class="p">),</span> <span class="c1"># 指定左关系</span>
</span></span><span class="line"><span class="cl">    <span class="n">secondaryjoin</span><span class="o">=</span><span class="p">(</span><span class="n">followers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">followed_id</span> <span class="o">==</span> <span class="nb">id</span><span class="p">),</span> <span class="c1"># 指定右关系</span>
</span></span><span class="line"><span class="cl">    <span class="n">backref</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">backref</span><span class="p">(</span><span class="s1">&#39;followers&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s1">&#39;dynamic&#39;</span><span class="p">),</span> <span class="n">lazy</span><span class="o">=</span><span class="s1">&#39;dynamic&#39;</span><span class="p">)</span> <span class="c1"># 指定回调</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="复杂查询">复杂查询</h4>
<ul>
<li>
<p>查询粉丝列表</p>
<ul>
<li>
<p>SQL 语句：<code>SELECT * FROM  user, followers  WHERE followers.follower_id = 3 AND followers.followed_id = user.id</code></p>
</li>
<li>
<p>SQLalchemy 接口：<code>user.followers.all()</code></p>
</li>
<li>
<p>实际执行的 SQL 语句：（打印 query 对象得到）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SELECT ,,,  FROM user, followers 
</span></span><span class="line"><span class="cl">WHERE followers.followed_id = ? AND followers.follower_id = user.id
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>NOTE：如果方法集成在model里，方法名不要和字段名相同，自己定义的方法会覆盖该字段。</p>
</li>
</ul>
</li>
<li>
<p>查看已关注用户的动态</p>
<ul>
<li>
<p>SQL 语句：<code>SELECT * FROM post JOIN followers on followers.followed_id = post.user_id where followers.follower_id = 2</code></p>
</li>
<li>
<p>SQLalchemy 接口：</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">Post</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="k">join</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">followers</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">followers</span><span class="p">.</span><span class="k">c</span><span class="p">.</span><span class="n">followed_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Post</span><span class="p">.</span><span class="n">user_id</span><span class="p">)).</span><span class="n">filter</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">followers</span><span class="p">.</span><span class="k">c</span><span class="p">.</span><span class="n">follower_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">self</span><span class="p">.</span><span class="n">id</span><span class="p">).</span><span class="n">order_by</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">Post</span><span class="p">.</span><span class="k">timestamp</span><span class="p">.</span><span class="k">desc</span><span class="p">())</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>实际执行的SQL语句：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="p">,,,</span><span class="w"> </span><span class="k">FROM</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="p">,,,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">FROM</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">followers</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">followers</span><span class="p">.</span><span class="n">followed_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">post</span><span class="p">.</span><span class="n">user_id</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">WHERE</span><span class="w"> </span><span class="n">followers</span><span class="p">.</span><span class="n">follower_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">UNION</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">FROM</span><span class="w"> </span><span class="n">post</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">WHERE</span><span class="w"> </span><span class="n">post</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">anon_1</span><span class="p">.</span><span class="n">post_timestamp</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<p>由于python的弱类型特征，有时候很难明白函数之间传递的是什么对象。我们从上往下梳理一遍：</p>
<ul>
<li>请求到达路由函数，开始执行查询<code>Post.query.....</code>，此时只是在构造查询，并未取得数据，此时的对象类型：<code>&lt;class 'sqlalchemy.orm.query.Query'&gt;</code></li>
<li>直到<code>get()</code>,<code>all()</code>,<code>paginate().items</code>结束符等出现，查询才被执行，返回数据类型实例，如User。</li>
<li>数据类实例传入模板，并由<code>__str__</code>等方法参与渲染。</li>
</ul>
<h2 id="0x05-网站美化">0x05 网站美化</h2>
<p>本教程提供的flask-bootstrap插件，较为简陋，且该插件年久失修，遂替换之。在此之前，先搞明白目前项目前端的架构</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/templates
</span></span><span class="line"><span class="cl">   auth/
</span></span><span class="line"><span class="cl">   errors/
</span></span><span class="line"><span class="cl">   base.html
</span></span><span class="line"><span class="cl">   _posts.html
</span></span><span class="line"><span class="cl">   index.html
</span></span><span class="line"><span class="cl">   ... 
</span></span></code></pre></td></tr></table>
</div>
</div><p>所有模板都有一个父模版：<code>base.html</code>，其结构如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">{% extends &#39;bootstrap/base.html&#39; %}
</span></span><span class="line"><span class="cl">{% block title %}Hallo Wolrd{% endblock %}
</span></span><span class="line"><span class="cl">{% block head %} ... {% endblock %}
</span></span><span class="line"><span class="cl">{% block scripts %} ... {% endblock %}
</span></span><span class="line"><span class="cl">{% block navbar %} ... {% endblock %}
</span></span><span class="line"><span class="cl">{% block content %}
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    {% block app_content %}{% endblock %}
</span></span><span class="line"><span class="cl">{% endblock %}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>app_content</code>留空，即其余模板均在<code>app_content</code>内填充。</p>
<p>进一步追溯<code>bootstrap/base.html</code>的源码，发现其它 block 诸如<code>navbar</code>也都留空或仅仅配置了 Bootstrap 的 cdn。 由此，只需将<code>base.html</code>迁移即可。</p>
<p>在网上寻找新的UI模板，不要在中文互联网搜索，basically garbage。找到一个 <a class="link" href="https://demos.creative-tim.com/material-kit/index.html"  target="_blank" rel="noopener"
    >Meterial 模板</a> 还算顺眼，遂用之。</p>
<p>不熟悉 Bootstrap 布局的可以使用可视化工具来设计前端，如：http://www.ibootstrap.cn/</p>
<p>对照模板，将<code>base.html</code>掏空，效果如下：</p>
<p><img src="/post-images/1631795716824.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>遇到的bug有：</p>
<ul>
<li>下拉菜单失效：查询得知有可能是bootstrap版本冲突
<ul>
<li>//结果并不是，只是忘记引入js文件而已，我是傻逼。</li>
</ul>
</li>
<li>文件上传按钮消失：本教程中，表单渲染采用<code>wtf.quick_form()</code>，这玩意还是来自<code>bootstrap/wtf.html</code></li>
</ul>
<p>最后决定整个🐏了 Flask-Bootstrap 插件。</p>
<h4 id="富文本编辑器">富文本编辑器</h4>
<p>在《Flask Web开发：基于Python的Web应用开发实战》中提到了markdown编辑器的实现。</p>
<p>需要的包：</p>
<ul>
<li>PageDown: JS 版 Markdown 渲染器，用于客户端预览。</li>
<li>Flask-PageDown: flask 集成插件。该插件需要注册</li>
<li>Markdown: Python 版 Markdown 渲染器，用于服务端渲染。</li>
<li>Bleach: HTML 清理器，保证安全性</li>
</ul>
<p>为了兼顾安全和效率，做法是同时保存 markdown 源文本和 HTML 文件。步骤如下：</p>
<ul>
<li>表单改为 <code>PageDownField</code></li>
<li>模板引入 PageDown 宏，以实现即时预览</li>
<li>为 Post 模型增加字段，并添加 markdown 渲染方法，该方法为类方法，需要<code>@staticmethod</code>修饰</li>
<li>在模型外部监听数据库事件，仅当 markdown 文本出现变动时调用渲染方法。</li>
<li>修改模板以显示服务端返回的 html 文本</li>
</ul>
<p>然而预览器过于简陋，也很难修改。在github仓库上发现该插件也是本教程作者写的，已经很久没有维护。顿时对本书作者有些不满。</p>
<h2 id="0x06-模块化应用功能解耦">0x06 模块化应用：功能解耦</h2>
<p>保持 app 作为全局变量的模式，可能会给后续引入新功能和单元测试带来麻烦。
要适应大型项目需求，需要把网站功能拆分成独立的模块。</p>
<h3 id="blueprint化">Blueprint化</h3>
<p>要实现解耦，一种功能的相关代码可以借助Blueprint归类到一个包里。其文件结构大致如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">app/ 
</span></span><span class="line"><span class="cl">    some_fuction/                       &lt;-- blueprint package
</span></span><span class="line"><span class="cl">        __init__.py                     &lt;-- blueprint creation
</span></span><span class="line"><span class="cl">        ... other code ...
</span></span><span class="line"><span class="cl">    templates/
</span></span><span class="line"><span class="cl">        some_fuction/                   &lt;--  templates
</span></span><span class="line"><span class="cl">    __init__.py                         &lt;-- blueprint registration
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建blueprint与创建应用非常相似。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Blueprint</span>
</span></span><span class="line"><span class="cl"><span class="n">bp</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">app.func</span> <span class="kn">import</span> <span class="n">Func</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>而消灭了<code>app</code>，蓝图内部的引用统一变成了蓝图名。而外部诸如<code>url_for</code>的参数则需要加上<code>包名.</code>做前缀。</p>
<h3 id="应用工厂模式">应用工厂模式</h3>
<p>工厂函数是一个外部函数，在这个函数内部执行插件注册和配置工作，并通过他返回应用实例。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># app/__init__.py</span>
</span></span><span class="line"><span class="cl"><span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_app</span><span class="p">(</span><span class="n">config_class</span><span class="o">=</span><span class="n">Config</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">config_class</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">db</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>返回后，flask提供的上下文对象<code>current_app</code>将指向应用实例。详见官方文档：<a class="link" href="http://docs.jinkan.org/docs/flask/appcontext.html"  target="_blank" rel="noopener"
    >应用上下文</a></p>
<h4 id="多线程">多线程</h4>
<p><code>current_app</code>是线程绑定的，若要在诸如邮件服务的位于其他线程的功能调用他，则会发现没有赋值。
需要使用<code>current_app._get_current_object()</code>表达式。</p>
<h4 id="python概念辨析包库插件">Python概念辨析：包，库，插件</h4>
<blockquote>
<p>包 (package) 是指一种代码结构，只要有文件夹和 <code>__init__.py</code> 都是包。
库 (library) 和插件 (plugin) 都是从外部引入的包，区别在于，插件要集成进应用，所以需要注册等步骤；而库更独立，可以随时随地调用</p>
</blockquote>
<h2 id="0x07-开发帮手">0x07 开发帮手</h2>
<p>本节讲解一些杂项。</p>
<h4 id="调试">调试</h4>
<ul>
<li><code>flask shell</code>命令：为避免每次调试都要重新import app，使用上下文调用解释器，用<code>@app.shell_context_processor</code>装饰上下文函数</li>
</ul>
<h4 id="单元测试">单元测试</h4>
<p>unittest 库，详见<a class="link" href="" >下一篇</a>。</p>
<h4 id="记录日志到文件">记录日志到文件</h4>
<p>logger 库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">file_handler</span> <span class="o">=</span> <span class="n">RotatingFileHandler</span><span class="p">(</span><span class="s1">&#39;logs/microblog.log&#39;</span><span class="p">,</span> <span class="n">maxBytes</span><span class="o">=</span><span class="mi">10240</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                           <span class="n">backupCount</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1"> [in </span><span class="si">%(pathname)s</span><span class="s1">:</span><span class="si">%(lineno)d</span><span class="s1">]&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Microblog startup&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="requirementtxt">requirement.txt</h4>
<p>装的库太多怎么办？只需要两条命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">pip freeze &gt; requirements.txt
</span></span><span class="line"><span class="cl">pip install -r requirements.txt
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x08-网站上线">0x08 网站上线</h2>
<p>最后简单列出几种网站部署的方法，详情参考本教程或自行搜索。</p>
<h4 id="native模式">native模式</h4>
<ul>
<li>买主机
<ul>
<li>连主机：ssh</li>
</ul>
</li>
<li>买域名
<ul>
<li>配域名</li>
</ul>
</li>
<li>配环境
<ul>
<li>数据库</li>
<li>服务器</li>
<li>其他依赖</li>
</ul>
</li>
<li>持续运维</li>
</ul>
<h4 id="容器化技术docker">容器化技术：docker</h4>
<ul>
<li>写dockerfile</li>
<li>docker-compose up &ndash;build -d</li>
</ul>
<h4 id="云技术paas">云技术：PaaS</h4>
<ul>
<li>注册云平台账户</li>
<li>写Procfile</li>
<li>git push</li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/flask/">flask</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99%E4%BA%8C-flask-supreme-tutorial/">
        
        

        <div class="article-details">
            <h2 class="article-title">年轻人的第二个网站（二） - flask-supreme-tutorial</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E9%97%B2%E6%9D%A5%E6%97%A0%E4%BA%8B%E5%80%92%E8%85%BE%E5%8D%9A%E5%AE%A2/">
        
        

        <div class="article-details">
            <h2 class="article-title">闲来无事，倒腾博客</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="lonelyuan/giscus-comment"
    data-repo-id="R_kgDOK1hIpw"
    data-category="Announcements"
    data-category-id="DIC_kwDOK1hIp84Cbey0"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="zh-CN"
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark_dimmed');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2023 lonelyuan&#39;s Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.20.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
